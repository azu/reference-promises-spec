<!-- http://www.w3.org/TR/xmlenc-core1/ -->
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <title>XML Encryption Syntax and Processing Version 1.1</title>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    
    
    
    
  <style>/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #ff4500;
}


/* --- --- */
ol.algorithm { counter-reset:numsection; list-style-type: none; }
ol.algorithm li { margin: 0.5em 0; }
ol.algorithm li:before { font-weight: bold; counter-increment: numsection; content: counters(numsection, ".") ") "; }

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}
</style><style>/* --- EXAMPLES --- */
div.example-title {
    min-width: 7.5em;
    color: #b9ab2d;
}
div.example-title span {
    text-transform: uppercase;   
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;    
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example div.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
div.issue-title, div.note-title {
    padding-right:  1em;
    min-width: 7.5em;
    color: #b9ab2d;
}
div.issue-title { color: #e05252; }
div.note-title { color: #52e052; }
div.issue-title span, div.note-title span {
    text-transform: uppercase;
}
div.note, div.issue {
    margin-top: 1em;
    margin-bottom: 1em;
}
.note > p:first-child, .issue > p:first-child { margin-top: 0 }
.issue, .note {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
div.issue, div.note {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
span.note, span.issue { padding: .1em .5em .15em; }

.issue {
    border-color: #e05252;
    background: #fbe9e9;
}
.note {
    border-color: #52e052;
    background: #e9fbe9;
}


</style><style>/* HIGHLIGHTS */
code.prettyprint {
    color:  inherit;
}

/* this from google-code-prettify */
.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun,.opn,.clo{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:bold}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:bold}.lit{color:#044}.pun,.opn,.clo{color:#440}.tag{color:#006;font-weight:bold}.atn{color:#404}.atv{color:#060}}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}
</style><link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/W3C-REC"><!--[if lt IE 9]><script src='http://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--></head>
  <body><div class="head">
  <p>
    
      <a href="http://www.w3.org/"><img width="72" height="48" src="http://www.w3.org/Icons/w3c_home" alt="W3C"></a>
    
  </p>
  <h1 class="title" id="title">XML Encryption Syntax and Processing Version 1.1</h1>
  
  <h2 id="w3c-recommendation-11-april-2013"><abbr title="World Wide Web Consortium">W3C</abbr> Recommendation 11 April 2013</h2>
  <dl>
    
      <dt>This version:</dt>
      <dd><a href="http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411/">http://www.w3.org/TR/2013/REC-xmlenc-core1-20130411/</a></dd>
      <dt>Latest published version:</dt>
      <dd><a href="http://www.w3.org/TR/xmlenc-core1/">http://www.w3.org/TR/xmlenc-core1/</a></dd>
    
    
      <dt>Latest editor's draft:</dt>
      <dd><a href="http://www.w3.org/2008/xmlsec/Drafts/xmlenc-core-11/">http://www.w3.org/2008/xmlsec/Drafts/xmlenc-core-11/</a></dd>
    
    
    
    
    
      <dt>Previous version:</dt>
      <dd><a href="http://www.w3.org/TR/2013/PR-xmlenc-core1-20130124/">http://www.w3.org/TR/2013/PR-xmlenc-core1-20130124/</a></dd>
    
    
    <dt>Editors:</dt>
    <dd><span>Donald Eastlake</span>, <span class="ed_mailto"><a href="mailto:d3e3e3@gmail.com">d3e3e3@gmail.com</a></span></dd>
<dd><span>Joseph Reagle</span>, <span class="ed_mailto"><a href="mailto:reagle@mit.edu">reagle@mit.edu</a></span></dd>
<dd><span>Frederick Hirsch</span>, <span class="ed_mailto"><a href="mailto:frederick.hirsch@nokia.com">frederick.hirsch@nokia.com</a></span> (1.1)</dd>
<dd><span>Thomas Roessler</span>, <span class="ed_mailto"><a href="mailto:tlr@w3.org">tlr@w3.org</a></span> (1.1)</dd>

    
      <dt>Authors:</dt>
      <dd><span>Takeshi Imamura</span>, <span class="ed_mailto"><a href="mailto:IMAMU@jp.ibm.com">IMAMU@jp.ibm.com</a></span></dd>
<dd><span>Blair Dillaway</span>, <span class="ed_mailto"><a href="mailto:blaird@microsoft.com">blaird@microsoft.com</a></span></dd>
<dd><span>Ed Simon</span>, <span class="ed_mailto"><a href="mailto:edsimon@xmlsec.com">edsimon@xmlsec.com</a></span></dd>
<dd><span>Kelvin Yiu</span>, <span class="ed_mailto"><a href="mailto:kelviny@microsoft.com">kelviny@microsoft.com</a></span> (1.1)</dd>
<dd><span>Magnus Nyström</span>, <span class="ed_mailto"><a href="mailto:mnystrom@microsoft.com">mnystrom@microsoft.com</a></span> (1.1)</dd>

    
  </dl>
  
    <p>
      Please refer to the <a href="http://www.w3.org/2008/xmlsec/errata/xmlenc-core-11-errata.html">errata</a> for this document, which may include some normative corrections.
    </p>
  
  
  
    <p>
      The English version of this specification is the only normative version. Non-normative 
      <a href="http://www.w3.org/Consortium/Translation/">translations</a> may also be available.
    </p>
  
  
    
      <p class="copyright">
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 
        2013
        
        <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> 
        (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
        <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved.
        <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
        <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.
      </p>
    
  
  <hr>
</div>
    <section id="abstract" class="introductory"><h2>Abstract</h2>
      <p>This document specifies a process for encrypting data and
        representing the result in XML. The data may be in a variety
        of formats, including octet streams and other unstructured
        data, or structured data formats such as  XML documents, an
        XML element, or XML element content. The result of 
        encrypting data is an XML Encryption element that contains or
        references the cipher data.</p>
    </section><section id="sotd" class="introductory"><h2>Status of This Document</h2>
  
    
      
        <p>
          <em>This section describes the status of this document at the time of its publication. Other
          documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision
          of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports
          index</a> at http://www.w3.org/TR/.</em>
        </p>
        

      <p>This document has been reviewed by <abbr title="World Wide Web Consortium">W3C</abbr> Members, by software developers, and by other <abbr title="World Wide Web Consortium">W3C</abbr> groups and interested parties, and is endorsed by the Director as a <abbr title="World Wide Web Consortium">W3C</abbr> Recommendation. It is a stable document and may be used as reference material or cited from another document. <abbr title="World Wide Web Consortium">W3C</abbr>'s role in making the Recommendation is to draw attention to the specification and to promote its widespread deployment. This enhances the functionality and interoperability of the Web.</p>

      <p>The <a href="http://www.w3.org/TR/2002/REC-xmlenc-core-20021210/">original version</a> of
        this specification was produced by the <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Encryption/2001/Overview.html">XML Encryption
          Working Group</a> 
        ; the <a href="http://www.w3.org/Encryption/2002/02-xenc-interop.html">Interoperability
          Report</a> shows four implementations with at least two
        interoperable implementations over every feature.</p>

        <p>
          Please refer to the <a href="http://www.w3.org/TR/2012/NOTE-xmlenc-core1-interop-20121113/">implementation report for version 1.1 of this specification</a> for additional details about the implementation status of features added in this revision.</p>

      <p>
        Conformance-affecting changes against the previous Recommendation
        mainly affect the set of mandatory to implement cryptographic
        algorithms, by adding Elliptic Curve Diffie-Hellman Key Agreement,
        making AES-128 GCM mandatory, changing RSA v1.5 to optional, adding
        optional AES192-GCM and adding optional RSA-OEAP algorithm
        variants. Important security considerations have also been added.
        A detailed summary  of changes is available in [<cite><a class="bibref" href="#bib-XMLENC-CORE1-CHGS">XMLENC-CORE1-CHGS</a></cite>].
        Changes are also described in a <a href="Overview_diff_rec.html">diff document showing changes since
        the original Recommendation</a>, as well as a <a href="Overview_diff.html">diff document showing changes
        since the previous PR draft</a>. 
      </p>
    
        <p>
          This document was published by the <a href="http://www.w3.org/2008/xmlsec/">XML Security Working Group</a> as a Recommendation.
          
          
          If you wish to make comments regarding this document, please send them to 
          <a href="mailto:public-xmlsec@w3.org">public-xmlsec@w3.org</a> 
          (<a href="mailto:public-xmlsec-request@w3.org?subject=subscribe">subscribe</a>,
          <a href="http://lists.w3.org/Archives/Public/public-xmlsec/">archives</a>).
          
          
          
          
        All comments are welcome.
        
        
        
        </p><p>
          
            This document was produced by a group operating under the 
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
          
          
          
            
              <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="http://www.w3.org/2004/01/pp-impl/42458/status" rel="disclosure">public list of any patent disclosures</a> 
            
            made in connection with the deliverables of the group; that page also includes instructions for 
            disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the
            information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
            6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
          
          
        </p>
        <p><a href="https://www.w3.org/2011/xmlsec-pag/pagreport.html">Additional information related to the IPR  status of XML Encryption 1.1</a> is also available.</p>
      
    
  
</section><section id="toc"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#sec-Introduction" class="tocxref"><span class="secno">1. </span>Introduction</a><ul class="toc"><li class="tocline"><a href="#sec-Editorial" class="tocxref"><span class="secno">1.1 </span>Editorial and Conformance Conventions</a></li><li class="tocline"><a href="#sec-Design" class="tocxref"><span class="secno">1.2 </span>Design Philosophy</a></li><li class="tocline"><a href="#sec-Versions" class="tocxref"><span class="secno">1.3 </span>Versions, Namespaces, URIs, and Identifiers</a></li><li class="tocline"><a href="#sec-Acknowledgements" class="tocxref"><span class="secno">1.4 </span>Acknowledgements</a></li></ul></li><li class="tocline"><a href="#sec-Overview" class="tocxref"><span class="secno">2. </span>Encryption Overview and Examples</a><ul class="toc"><li class="tocline"><a href="#sec-eg-Granularity" class="tocxref"><span class="secno">2.1 </span>Encryption Granularity</a><ul class="toc"><li class="tocline"><a href="#sec-eg-Element" class="tocxref"><span class="secno">2.1.1 </span>Encrypting an XML Element</a></li><li class="tocline"><a href="#sec-eg-Element-Content" class="tocxref"><span class="secno">2.1.2 </span>Encrypting XML Element Content (Elements)</a></li><li class="tocline"><a href="#sec-eg-Element-Content-Character" class="tocxref"><span class="secno">2.1.3 </span>Encrypting XML Element Content (Character Data)</a></li><li class="tocline"><a href="#sec-eg-Arbitrary-Data" class="tocxref"><span class="secno">2.1.4 </span>Encrypting Arbitrary Data and XML Documents</a></li><li class="tocline"><a href="#sec-eg-Super-Encryption" class="tocxref"><span class="secno">2.1.5 </span>Super-Encryption: Encrypting EncryptedData</a></li></ul></li><li class="tocline"><a href="#sec-Usage" class="tocxref"><span class="secno">2.2 </span><code>EncryptedData</code> and <code>EncryptedKey</code> Usage</a><ul class="toc"><li class="tocline"><a href="#sec-eg-Symmetric-Key" class="tocxref"><span class="secno">2.2.1 </span><code>EncryptedData</code> with Symmetric Key (<code>KeyName</code>)</a></li><li class="tocline"><a href="#sec-eg-EncryptedKey" class="tocxref"><span class="secno">2.2.2 </span><code>EncryptedKey</code>
            (<code>ReferenceList</code>, <code>ds:RetrievalMethod</code>,
            <code>CarriedKeyName</code>)</a></li></ul></li></ul></li><li class="tocline"><a href="#sec-Encryption-Syntax" class="tocxref"><span class="secno">3. </span>Encryption Syntax</a><ul class="toc"><li class="tocline"><a href="#sec-EncryptedType" class="tocxref"><span class="secno">3.1 </span>The <code>EncryptedType</code> Element</a></li><li class="tocline"><a href="#sec-EncryptionMethod" class="tocxref"><span class="secno">3.2 </span>The <code>EncryptionMethod</code> Element</a></li><li class="tocline"><a href="#sec-CipherData" class="tocxref"><span class="secno">3.3 </span>The <code>CipherData</code> Element</a><ul class="toc"><li class="tocline"><a href="#sec-CipherReference" class="tocxref"><span class="secno">3.3.1 </span>The <code>CipherReference</code> Element</a></li></ul></li><li class="tocline"><a href="#sec-EncryptedData" class="tocxref"><span class="secno">3.4 </span>The <code>EncryptedData</code> Element</a></li><li class="tocline"><a href="#sec-Extensions-to-KeyInfo" class="tocxref"><span class="secno">3.5 </span>Extensions to <code>ds:KeyInfo</code> Element</a><ul class="toc"><li class="tocline"><a href="#sec-EncryptedKey" class="tocxref"><span class="secno">3.5.1 </span>The <code>EncryptedKey</code> Element</a></li><li class="tocline"><a href="#sec-DerivedKey" class="tocxref"><span class="secno">3.5.2 </span>The <code>DerivedKey</code> Element</a></li><li class="tocline"><a href="#sec-ds-RetrievalMethod" class="tocxref"><span class="secno">3.5.3 </span>The <code>ds:RetrievalMethod</code> Element</a></li></ul></li><li class="tocline"><a href="#sec-ReferenceList" class="tocxref"><span class="secno">3.6 </span>The <code>ReferenceList</code> Element</a></li><li class="tocline"><a href="#sec-EncryptionProperties" class="tocxref"><span class="secno">3.7 </span>The <code>EncryptionProperties</code> Element</a></li></ul></li><li class="tocline"><a href="#sec-Processing" class="tocxref"><span class="secno">4. </span>Processing Rules</a><ul class="toc"><li class="tocline"><a href="#sec-Intended-Processing" class="tocxref"><span class="secno">4.1 </span>Intended Application Model</a></li><li class="tocline"><a href="#sec-Type-Parameters" class="tocxref"><span class="secno">4.2 </span>Well-known <code>Type</code> parameter values</a></li><li class="tocline"><a href="#sec-Processing-Encryption" class="tocxref"><span class="secno">4.3 </span>Encryption</a></li><li class="tocline"><a href="#sec-Processing-Decryption" class="tocxref"><span class="secno">4.4 </span>Decryption</a></li><li class="tocline"><a href="#sec-Processing-XML" class="tocxref"><span class="secno">4.5 </span>XML Encryption</a><ul class="toc"><li class="tocline"><a href="#sec-Decrypt-Imp" class="tocxref"><span class="secno">4.5.1 </span>A Decrypt
            Implementation (Non-normative)</a></li><li class="tocline"><a href="#sec-Decrypt-Replace-Imp" class="tocxref"><span class="secno">4.5.2 </span>A Decrypt and Replace Implementation (Non-normative)</a></li><li class="tocline"><a href="#sec-Serializing-XML" class="tocxref"><span class="secno">4.5.3 </span>Serializing XML (Non-normative)</a><ul class="toc"><li class="tocline"><a href="#sec-Default-Namespace-Considerations" class="tocxref"><span class="secno">4.5.3.1 </span>Default Namespace Considerations</a></li><li class="tocline"><a href="#sec-XML-Attribute-Considerations" class="tocxref"><span class="secno">4.5.3.2 </span>XML Attribute Considerations</a></li></ul></li><li class="tocline"><a href="#sec-Text-Wrapping" class="tocxref"><span class="secno">4.5.4 </span>Text Wrapping</a></li></ul></li></ul></li><li class="tocline"><a href="#sec-Algorithms" class="tocxref"><span class="secno">5. </span>Algorithms</a><ul class="toc"><li class="tocline"><a href="#sec-AlgID" class="tocxref"><span class="secno">5.1 </span>Algorithm Identifiers and Implementation Requirements</a><ul class="toc"><li class="tocline"><a href="#sec-Table-of-Algorithms" class="tocxref"><span class="secno">5.1.1 </span>Table of Algorithms</a></li></ul></li><li class="tocline"><a href="#sec-Alg-Block" class="tocxref"><span class="secno">5.2 </span>Block Encryption Algorithms</a><ul class="toc"><li class="tocline"><a href="#sec-Padding" class="tocxref"><span class="secno">5.2.1 </span>Padding</a></li><li class="tocline"><a href="#sec-tripledes-cbc" class="tocxref"><span class="secno">5.2.2 </span>Triple DES</a></li><li class="tocline"><a href="#sec-AES" class="tocxref"><span class="secno">5.2.3 </span>AES</a></li><li class="tocline"><a href="#sec-AES-GCM" class="tocxref"><span class="secno">5.2.4 </span>AES-GCM</a></li></ul></li><li class="tocline"><a href="#sec-Alg-Stream" class="tocxref"><span class="secno">5.3 </span>Stream Encryption Algorithms</a></li><li class="tocline"><a href="#sec-Alg-KeyDerivation" class="tocxref"><span class="secno">5.4 </span>Key Derivation</a><ul class="toc"><li class="tocline"><a href="#sec-ConcatKDF" class="tocxref"><span class="secno">5.4.1 </span>ConcatKDF</a></li><li class="tocline"><a href="#sec-PBKDF2" class="tocxref"><span class="secno">5.4.2 </span>PBKDF2</a></li></ul></li><li class="tocline"><a href="#sec-Alg-KeyTransport" class="tocxref"><span class="secno">5.5 </span>Key Transport</a><ul class="toc"><li class="tocline"><a href="#sec-RSA-1_5" class="tocxref"><span class="secno">5.5.1 </span>RSA Version 1.5</a></li><li class="tocline"><a href="#sec-RSA-OAEP" class="tocxref"><span class="secno">5.5.2 </span>RSA-OAEP</a></li></ul></li><li class="tocline"><a href="#sec-Alg-KeyAgreement" class="tocxref"><span class="secno">5.6 </span>Key Agreement</a><ul class="toc"><li class="tocline"><a href="#sec-DHKeyValue" class="tocxref"><span class="secno">5.6.1 </span>Diffie-Hellman Key
            Values</a></li><li class="tocline"><a href="#sec-DHKeyAgreement" class="tocxref"><span class="secno">5.6.2 </span>Diffie-Hellman
            Key Agreement</a><ul class="toc"><li class="tocline"><a href="#sec-DHKeyAgreementExplicitKDF" class="tocxref"><span class="secno">5.6.2.1 </span>Diffie-Hellman Key Agreement with Explicit Key Derivation Functions</a></li><li class="tocline"><a href="#sec-DHKeyAgreementLegacyKDF" class="tocxref"><span class="secno">5.6.2.2 </span>Diffie-Hellman Key Agreement with Legacy Key Derivation Function</a></li></ul></li><li class="tocline"><a href="#sec-ECCKeyValue" class="tocxref"><span class="secno">5.6.3 </span>Elliptic Curve Diffie-Hellman (ECDH) Key
            Values</a></li><li class="tocline"><a href="#sec-ECDH-ES" class="tocxref"><span class="secno">5.6.4 </span>Elliptic Curve Diffie-Hellman (ECDH)
            Key Agreement (Ephemeral-Static Mode)</a></li></ul></li><li class="tocline"><a href="#sec-Alg-SymmetricKeyWrap" class="tocxref"><span class="secno">5.7 </span>Symmetric Key Wrap</a><ul class="toc"><li class="tocline"><a href="#sec-kw-tripledes" class="tocxref"><span class="secno">5.7.1 </span>CMS Triple DES Key Wrap</a></li><li class="tocline"><a href="#sec-kw-aes" class="tocxref"><span class="secno">5.7.2 </span>AES KeyWrap</a></li></ul></li><li class="tocline"><a href="#sec-Alg-MessageDigest" class="tocxref"><span class="secno">5.8 </span>Message Digest</a><ul class="toc"><li class="tocline"><a href="#sec-SHA1" class="tocxref"><span class="secno">5.8.1 </span>SHA1</a></li><li class="tocline"><a href="#sec-SHA256" class="tocxref"><span class="secno">5.8.2 </span>SHA256</a></li><li class="tocline"><a href="#sec-SHA384" class="tocxref"><span class="secno">5.8.3 </span>SHA384</a></li><li class="tocline"><a href="#sec-SHA512" class="tocxref"><span class="secno">5.8.4 </span>SHA512</a></li><li class="tocline"><a href="#sec-RIPEMD-160" class="tocxref"><span class="secno">5.8.5 </span>RIPEMD-160</a></li></ul></li><li class="tocline"><a href="#sec-Alg-Canonicalition" class="tocxref"><span class="secno">5.9 </span>Canonicalization</a><ul class="toc"><li class="tocline"><a href="#sec-Inclusive-Canonicalization" class="tocxref"><span class="secno">5.9.1 </span>Inclusive
            Canonicalization</a></li><li class="tocline"><a href="#sec-Exclusive-Canonicalization" class="tocxref"><span class="secno">5.9.2 </span>Exclusive
            Canonicalization</a></li></ul></li></ul></li><li class="tocline"><a href="#sec-Security" class="tocxref"><span class="secno">6. </span>Security Considerations</a><ul class="toc"><li class="tocline"><a href="#sec-chosen-ciphertext-attacks" class="tocxref"><span class="secno">6.1 </span>Chosen-Ciphertext Attacks</a><ul class="toc"><li class="tocline"><a href="#sec-edata-attacks" class="tocxref"><span class="secno">6.1.1 </span> Attacks against the encrypted data (<code>&lt;EncryptedData&gt;</code> part)</a></li><li class="tocline"><a href="#sec-bleichenbacher-attack" class="tocxref"><span class="secno">6.1.2 </span>Attacks against the encrypted key (Bleichenbacher's Million
            question attack on PKCS#1.5)</a></li><li class="tocline"><a href="#sec-backwards-compatibility-attacks" class="tocxref"><span class="secno">6.1.3 </span>Backwards Compatibility Attacks</a></li></ul></li><li class="tocline"><a href="#sec-Sign-with-Encrypt" class="tocxref"><span class="secno">6.2 </span>Relationship to XML Digital Signatures</a></li><li class="tocline"><a href="#sec-InformationRevealed" class="tocxref"><span class="secno">6.3 </span>Information Revealed</a></li><li class="tocline"><a href="#sec-Nonce" class="tocxref"><span class="secno">6.4 </span>Nonce and IV (Initialization Value or Vector)</a></li><li class="tocline"><a href="#sec-Denial" class="tocxref"><span class="secno">6.5 </span>Denial of Service</a></li><li class="tocline"><a href="#sec-Unsafe-Content" class="tocxref"><span class="secno">6.6 </span>Unsafe Content</a></li><li class="tocline"><a href="#sec-Errors" class="tocxref"><span class="secno">6.7 </span>Error Messages</a></li><li class="tocline"><a href="#sec-TimingAttacks" class="tocxref"><span class="secno">6.8 </span>Timing Attacks</a></li><li class="tocline"><a href="#sec-cbcBlockEncryptionAttacks" class="tocxref"><span class="secno">6.9 </span>CBC Block Encryption Vulnerability</a></li></ul></li><li class="tocline"><a href="#sec-Conformance" class="tocxref"><span class="secno">7. </span>Conformance</a></li><li class="tocline"><a href="#sec-MediaType" class="tocxref"><span class="secno">8. </span>XML Encryption Media Type</a><ul class="toc"><li class="tocline"><a href="#sec-MediaType-Introduction" class="tocxref"><span class="secno">8.1 </span>Introduction</a></li><li class="tocline"><a href="#sec-MediaType-Registration" class="tocxref"><span class="secno">8.2 </span>application/xenc+xml Registration</a></li></ul></li><li class="tocline"><a href="#sec-Schema" class="tocxref"><span class="secno">9. </span>Schema</a><ul class="toc"><li class="tocline"><a href="#sec-xsdSchema" class="tocxref"><span class="secno">9.1 </span>XSD Schema</a></li><li class="tocline"><a href="#sec-rngSchema" class="tocxref"><span class="secno">9.2 </span>RNG Schema</a></li></ul></li><li class="tocline"><a href="#reserved-algorithm-identifiers" class="tocxref"><span class="secno">A. </span>Reserved Algorithm Identifiers</a><ul class="toc"><li class="tocline"><a href="#sec-kw-aes-with-pad" class="tocxref"><span class="secno">A.1 </span>AES KeyWrap with Padding</a></li></ul></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">B. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">B.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">B.2 </span>Informative references</a></li></ul></li></ul></section>
    
    <section id="sec-Introduction">
      <!--OddPage--><h2><span class="secno">1. </span>Introduction</h2>
      <p>This document specifies a process for encrypting data and
        representing the 
        result in XML. The data may be arbitrary data (including an XML
        document), an 
        XML element, or XML element content. The result of encrypting
        data is an XML 
        Encryption <code>EncryptedData</code> element that contains (via
        one of its 
        children's content) or identifies (via a URI reference) the
        cipher data.</p> 

      <p>When encrypting an XML element or element content the
        <code>EncryptedData</code> element replaces the element or content
        (respectively) in the encrypted version of the XML document.</p>

      <p>When encrypting arbitrary data (including entire XML documents), the
        <code>EncryptedData</code> element may become the root of a new
        XML document 
        or become a child element in an application-chosen XML document.</p>

      <section id="sec-Editorial">
        <h3><span class="secno">1.1 </span>Editorial and Conformance Conventions</h3>

        <p>This specification uses XML schemas [<cite><a class="bibref" href="#bib-XMLSCHEMA-1">XMLSCHEMA-1</a></cite>],
          [<cite><a class="bibref" href="#bib-XMLSCHEMA-2">XMLSCHEMA-2</a></cite>] to describe the content model.
          The full normative grammar is defined by the XSD schema
          and the normative text in this specification. The standalone XSD
          schema file is authoritative in case there is any disagreement between
          it and the XSD schema portions. 
        </p>

        <p>The key words "<em class="rfc2119" title="MUST">MUST</em>", "<em class="rfc2119" title="MUST NOT">MUST NOT</em>", "<em class="rfc2119" title="REQUIRED">REQUIRED</em>", "<em class="rfc2119" title="SHALL">SHALL</em>", "<em class="rfc2119" title="SHALL NOT">SHALL NOT</em>",
          "<em class="rfc2119" title="SHOULD">SHOULD</em>", "<em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em>", "<em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em>", "<em class="rfc2119" title="MAY">MAY</em>", and "<em class="rfc2119" title="OPTIONAL">OPTIONAL</em>" in this
          specification are to be interpreted as described in [<cite><a class="bibref" href="#bib-RFC2119">RFC2119</a></cite>]:</p>

        <blockquote>
          <p>"They <em class="rfc2119" title="MUST">MUST</em> only be used where it is actually required for
            interoperation 
            or to limit behavior which has potential for causing harm
            (e.g., limiting 
            retransmissions)"</p>
        </blockquote>

        <p>Consequently, we use these capitalized keywords to
          unambiguously specify 
          requirements over protocol and application features and
          behavior that affect 
          the interoperability and security of implementations. These
          key words are not 
          used (capitalized) to describe XML grammar; schema definitions
          unambiguously 
          describe such requirements and we wish to reserve the
          prominence of these 
          terms for the natural language descriptions of protocols and
          features. For 
          instance, an XML attribute might be described as being
          "optional". Compliance 
          with the XML-namespace specification [<cite><a class="bibref" href="#bib-XML-NAMES">XML-NAMES</a></cite>] is
          described as "<em class="rfc2119" title="REQUIRED">REQUIRED</em>".</p>
      </section>
      <section id="sec-Design">
        <h3><span class="secno">1.2 </span>Design Philosophy</h3>
        <p>The design philosophy and requirements of this
          specification (including 
          the limitations related to instance validity) are addressed in the
          original 
          <a href="http://www.w3.org/TR/xml-encryption-req">XML Encryption
            Requirements</a> [<cite><a class="bibref" href="#bib-XML-ENCRYPTION-REQ">XML-ENCRYPTION-REQ</a></cite>]
          and the XML Security 1.1 Requirements document [<cite><a class="bibref" href="#bib-XMLSEC11-REQS">XMLSEC11-REQS</a></cite>].
        </p>
      </section>
      <section id="sec-Versions">
        <h3><span class="secno">1.3 </span>Versions, Namespaces, URIs, and Identifiers</h3>
        <p>This specification makes use of XML namespaces, and uses Uniform
          Resource Identifiers [<cite><a class="bibref" href="#bib-URI">URI</a></cite>] to identify resources, algorithms, and
          semantics.</p> 
        <p>Implementations of this specification <em class="rfc2119" title="MUST">MUST</em> use the following XML
          namespace URIs:</p> 
        <table class="namespaces">
          <thead>
            <tr><th>URI</th><th>namespace prefix</th><th>XML internal entity</th></tr>
          </thead>
          <tbody>
            <tr><td><code>http://www.w3.org/2001/04/xmlenc#</code></td><td><i>default namespace</i>,
                <code>xenc:</code></td><td><code>&lt;!ENTITY xenc "http://www.w3.org/2001/04/xmlenc#"&gt;</code></td></tr>
            <tr><td><code>http://www.w3.org/2009/xmlenc11#</code></td><td><code>xenc11:</code></td><td><code>&lt;!ENTITY xenc11 "http://www.w3.org/2009/xmlenc11#"&gt;</code></td></tr>
          </tbody>
        </table>
        <p>The <code>http://www.w3.org/2001/04/xmlenc#</code>
          (<code>xenc:</code>) namespace was 
          introduced in version 1.0 of this specification.  The present
          version does not coin any new 
          elements or algorithm identifiers in that namespace; instead, the
          <code>http://www.w3.org/2009/xmlenc11#</code> (<code>xenc11:</code>)
          namespace 
          is used.</p>
        <p>No provision is made for an explicit version number in this
          syntax.  If a future version of 
          this specification requires explicit versioning of the
          document format, a different namespace will 
          be used.</p>
        <p>Additionally, this specification uses elements and
          algorithm identifiers from the XML Signature name spaces
          [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>]:</p> 
        <table class="namespaces">
          <thead>
            <tr><th>URI</th><th>namespace prefix</th><th>XML internal entity</th></tr>
          </thead>
          <tbody>
            <tr><td><code>http://www.w3.org/2000/09/xmldsig#</code></td><td><i>default namespace</i>,
                <code>ds:</code>, <code>dsig:</code></td><td><code>&lt;!ENTITY dsig "http://www.w3.org/2000/09/xmldsig#"&gt;</code></td></tr>
            <tr><td><code>http://www.w3.org/2009/xmldsig11#</code></td><td><code>dsig11:</code></td><td><code>&lt;!ENTITY dsig11 "http://www.w3.org/2009/xmldsig11#"&gt;</code></td></tr>
          </tbody>
        </table>
      </section>
      <section id="sec-Acknowledgements">
        <h3><span class="secno">1.4 </span>Acknowledgements</h3>
        <p>The contributions of the following members of the original
          Working Group  to the original XML Encryption specification
          are gratefully  
          acknowledged in accordance with the 
          <a href="http://www.w3.org/Encryption/2001/Contributor.html">contributor
            policies</a> and the active <a href="http://www.w3.org/Encryption/2001/Participants.html">WG
            roster</a>: Joseph Ashwood, Simon 
          Blake-Wilson, Certicom, Frank D. Cavallito, BEA Systems, Eric
          Cohen, PricewaterhouseCoopers, Blair 
          Dillaway, Microsoft (Author), Blake Dournaee, RSA Security,
          Donald Eastlake, Motorola (Editor), Barb 
          Fox, Microsoft, Christian Geuer-Pollmann, University of
          Siegen, Tom Gindin, IBM, Jiandong Guo, 
          Phaos, Phillip Hallam-Baker, Verisign, Amir Herzberg,
          NewGenPay, Merlin Hughes, Baltimore, Frederick 
          Hirsch, Maryann Hondo, IBM, Takeshi Imamura, IBM (Author),
          Mike Just, Entrust, Inc., Brian 
          LaMacchia, Microsoft, Hiroshi Maruyama, IBM, John Messing,
          Law-on-Line, Shivaram Mysore, Sun
          Microsystems, Thane Plambeck, Verisign, Joseph Reagle, <abbr title="World Wide Web Consortium">W3C</abbr>
          (Chair, Editor), Aleksey Sanin, Jim 
          Schaad, Soaring Hawk Consulting, Ed Simon, XMLsec (Author),
          Daniel Toth, Ford, Yongge Wang, 
          Certicom, Steve Wiley, myProof.
        </p>
        <p>Additionally, we thank the following for their comments
          during and subsequent to the Last Call of the original
          Recommendation:  
          Martin Dürst, <abbr title="World Wide Web Consortium">W3C</abbr>, Dan Lanz, Zolera, Susan Lesch, <abbr title="World Wide Web Consortium">W3C</abbr>,
          David Orchard, BEA Systems, Ronald 
          Rivest, <abbr title="Massachusetts Institute of Technology">MIT</abbr>.</p>

        <p>Contributions for version 1.1 were received from the
          members of the XML Security Working Group: 
          Scott Cantor, Juan Carlos Cruellas, Pratik Datta, Gerald
          Edgar, Ken Graf, Phillip Hallam-Baker, Brad 
          Hill, Frederick Hirsch, Brian LaMacchia, Konrad Lanz, Hal
          Lockhart, Cynthia Martin, Rob Miller, Sean 
          Mullan, Shivaram Mysore, Magnus Nyström, Bruce Rich, Thomas
          Roessler, Ed Simon, Chris Solc, John 
          Wray, Kelvin Yiu.</p>
        <p>The working group also acknowledges the contribution of Juraj
          Somorovsky  raising the issue of the CBC chosen ciphertext attack
          and contributions to revising the security considerations of XML
          Encryption 1.1.</p>  
      </section>
    </section>
    <section id="sec-Overview" class="informative">
      <!--OddPage--><h2><span class="secno">2. </span>Encryption Overview and Examples</h2><p><em>This section is non-normative.</em></p>

      <p>This section provides an overview and examples of XML Encryption syntax.
        The formal syntax is found in <a class="sectionRef sec-ref" href="#sec-Encryption-Syntax">section 3. Encryption Syntax</a> ; the specific
        processing is given in <a class="link-sec" href="http://www.w3.org/TR/2000/WD-xmldsig-core-20000104/#sec-Processing">Processing 
          Rules</a> (section 4).</p>

      <p>Expressed in shorthand form, the <code><a href="#sec-EncryptedData">EncryptedData</a></code> element has the following
        structure (where "?" denotes zero or one occurrence; "+" denotes one or more
        occurrences; "*" denotes zero or more occurrences; "|" denotes a choice; and the empty element tag
        means the element must be empty ):</p>

      <div><div class="example"><div class="example-title"><span>Example 1</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">Id</span><span class="pln">? </span><span class="atn">Type</span><span class="pln">? </span><span class="atn">MimeType</span><span class="pln">? </span><span class="atn">Encoding</span><span class="pln">?</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;EncryptionMethod/&gt;</span><span class="pln">?
  </span><span class="tag">&lt;ds:KeyInfo&gt;</span><span class="pln">
    </span><span class="tag">&lt;EncryptedKey&gt;</span><span class="pln">?
    </span><span class="tag">&lt;AgreementMethod&gt;</span><span class="pln">?
    </span><span class="tag">&lt;ds:KeyName&gt;</span><span class="pln">?
    </span><span class="tag">&lt;ds:RetrievalMethod&gt;</span><span class="pln">?
    </span><span class="tag">&lt;ds</span><span class="pln">:*</span><span class="tag">&gt;</span><span class="pln">?
  </span><span class="tag">&lt;/ds:KeyInfo&gt;</span><span class="pln">?
  </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">
    </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln"> | </span><span class="tag">&lt;CipherReference</span><span class="pln"> </span><span class="atn">URI</span><span class="pln">?</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
  </span><span class="tag">&lt;EncryptionProperties&gt;</span><span class="pln">?
</span><span class="tag">&lt;/EncryptedData&gt;</span></pre></div></div>

      <p>The <code>CipherData</code> element envelopes or references the raw
        encrypted data. A <code>CipherData</code> element must have either a <code>CipherValue</code> or <code>CipherReference</code> child element. If enveloping, the raw encrypted data is the
        <code>CipherValue</code> element's content; if referencing, the
        <code>CipherReference</code> element's <code>URI</code> attribute points to
        the location of the raw encrypted data</p>

      <section id="sec-eg-Granularity">
        <h3><span class="secno">2.1 </span>Encryption Granularity</h3><p><em>This section is non-normative.</em></p>

        <p>Note: Examples in this document do not consider plaintext guessing
          attacks or other risks, and are only for illustrative purposes.</p> 

        <p>Consider the following fictitious payment information, which includes
          identification information and information appropriate to a payment method
          (e.g., credit card, money transfer, or electronic
          check):</p>

        <div><div class="example"><div class="example-title"><span>Example 2</span></div><pre class="example highlight prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pun">?&gt;</span><span class="pln">

</span><span class="tag">&lt;PaymentInfo</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/paymentv2"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;Name&gt;</span><span class="pln">John Smith</span><span class="tag">&lt;/Name&gt;</span><span class="pln">
  </span><span class="tag">&lt;CreditCard</span><span class="pln"> </span><span class="atn">Limit</span><span class="pun">=</span><span class="atv">"5,000"</span><span class="pln"> </span><span class="atn">Currency</span><span class="pun">=</span><span class="atv">"USD"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;Number&gt;</span><span class="pln">4019 2445 0277 5567</span><span class="tag">&lt;/Number&gt;</span><span class="pln">
    </span><span class="tag">&lt;Issuer&gt;</span><span class="pln">Example Bank</span><span class="tag">&lt;/Issuer&gt;</span><span class="pln">
    </span><span class="tag">&lt;Expiration&gt;</span><span class="pln">04/02</span><span class="tag">&lt;/Expiration&gt;</span><span class="pln">
  </span><span class="tag">&lt;/CreditCard&gt;</span><span class="pln">
</span><span class="tag">&lt;/PaymentInfo&gt;</span></pre></div></div>

        <p>This markup represents that John Smith is using his credit card with a
          limit of $5,000USD.</p>

        <section id="sec-eg-Element">
          <h4><span class="secno">2.1.1 </span>Encrypting an XML Element</h4><p><em>This section is non-normative.</em></p>

          <p>Smith's credit card number is sensitive information! If the application
            wishes to keep that information confidential, it can encrypt the
            <code>CreditCard</code> element:</p>

          <div><div class="example"><div class="example-title"><span>Example 3</span></div><pre class="example highlight prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pun">?&gt;</span><span class="pln">

</span><span class="tag">&lt;PaymentInfo</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/paymentv2"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;Name&gt;</span><span class="pln">John Smith</span><span class="tag">&lt;/Name&gt;</span><span class="pln">
  </span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">Type</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#Element"</span><span class="pln">
                 </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">
      </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln">A23B45C56</span><span class="tag">&lt;/CipherValue&gt;</span><span class="pln">
    </span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
  </span><span class="tag">&lt;/EncryptedData&gt;</span><span class="pln">
</span><span class="tag">&lt;/PaymentInfo&gt;</span></pre></div></div>

          <p>By encrypting the entire <code>CreditCard</code> element from its start to
            end tags, the identity of the element itself is hidden. (An eavesdropper
            doesn't know whether he used a credit card or money transfer.) The
            <code>CipherData</code> element contains the encrypted serialization of the
            <code>CreditCard</code> element.</p>
        </section>
        <section id="sec-eg-Element-Content">
          <h4><span class="secno">2.1.2 </span>Encrypting XML Element Content (Elements)</h4>

          <p>As an alternative scenario, it may be useful for intermediate agents to
            know that John used a credit card with a particular limit, but not the card's
            number, issuer, and expiration date. In this case, the content (character
            data or children elements) of the <code>CreditCard</code> element can be
            encrypted:</p>

          <div><div class="example"><div class="example-title"><span>Example 4</span></div><pre class="example highlight prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pun">?&gt;</span><span class="pln">

</span><span class="tag">&lt;PaymentInfo</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/paymentv2"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;Name&gt;</span><span class="pln">John Smith</span><span class="tag">&lt;/Name&gt;</span><span class="pln">
  </span><span class="tag">&lt;CreditCard</span><span class="pln"> </span><span class="atn">Limit</span><span class="pun">=</span><span class="atv">"5,000"</span><span class="pln"> </span><span class="atn">Currency</span><span class="pun">=</span><span class="atv">"USD"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
                   </span><span class="atn">Type</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#Content"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">
        </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln">A23B45C56</span><span class="tag">&lt;/CipherValue&gt;</span><span class="pln">
      </span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
    </span><span class="tag">&lt;/EncryptedData&gt;</span><span class="pln">
  </span><span class="tag">&lt;/CreditCard&gt;</span><span class="pln">
</span><span class="tag">&lt;/PaymentInfo&gt;</span></pre></div></div>

        </section>
        <section id="sec-eg-Element-Content-Character">
          <h4><span class="secno">2.1.3 </span>Encrypting XML Element Content (Character Data)</h4>

          <p>Alternatively, consider the scenario in which all the information <em>except</em> the
            actual credit card number can be in the clear, including the fact that the
            Number element exists:</p>

          <div><div class="example"><div class="example-title"><span>Example 5</span></div><pre class="example highlight prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pun">?&gt;</span><span class="pln">

</span><span class="tag">&lt;PaymentInfo</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/paymentv2"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;Name&gt;</span><span class="pln">John Smith</span><span class="tag">&lt;/Name&gt;</span><span class="pln">
  </span><span class="tag">&lt;CreditCard</span><span class="pln"> </span><span class="atn">Limit</span><span class="pun">=</span><span class="atv">"5,000"</span><span class="pln"> </span><span class="atn">Currency</span><span class="pun">=</span><span class="atv">"USD"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;Number&gt;</span><span class="pln">
      </span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
                     </span><span class="atn">Type</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#Content"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">
          </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln">A23B45C56</span><span class="tag">&lt;/CipherValue&gt;</span><span class="pln">
        </span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
      </span><span class="tag">&lt;/EncryptedData&gt;</span><span class="pln">
    </span><span class="tag">&lt;/Number&gt;</span><span class="pln">
    </span><span class="tag">&lt;Issuer&gt;</span><span class="pln">Example Bank</span><span class="tag">&lt;/Issuer&gt;</span><span class="pln">
    </span><span class="tag">&lt;Expiration&gt;</span><span class="pln">04/02</span><span class="tag">&lt;/Expiration&gt;</span><span class="pln">
  </span><span class="tag">&lt;/CreditCard&gt;</span><span class="pln">
</span><span class="tag">&lt;/PaymentInfo&gt;</span></pre></div></div>

          <p>Both <code>CreditCard</code> and <code>Number</code> are in the clear, but
            the character data content of <code>Number</code> is encrypted.</p>

        </section>
        <section id="sec-eg-Arbitrary-Data">
          <h4><span class="secno">2.1.4 </span>Encrypting Arbitrary Data and XML Documents</h4>

          <p>If the application scenario requires all of the information to be
            encrypted, the whole document is encrypted as an octet sequence. This applies
            to arbitrary data including XML documents.</p>

          <div><div class="example"><div class="example-title"><span>Example 6</span></div><pre class="example highlight prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pun">?&gt;</span><span class="pln">

</span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
               </span><span class="atn">MimeType</span><span class="pun">=</span><span class="atv">"text/xml"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">
    </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln">A23B45C56</span><span class="tag">&lt;/CipherValue&gt;</span><span class="pln">
  </span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
</span><span class="tag">&lt;/EncryptedData&gt;</span></pre></div></div>
          <p>
            Where appropriate, such as in the case of encrypting an entire EXI
            stream, the Type attribute <em class="rfc2119" title="SHOULD">SHOULD</em> be provided 
            and indicate the use of EXI. The optional MimeType <em class="rfc2119" title="MAY">MAY</em> be used to
            record the actual (non-EXI-encoded) type, but is not necessary and may
            be omitted, as in the following EXI encryption example: 
          </p>

          <div><div class="example"><div class="example-title"><span>Example 7</span></div><pre class="example highlight prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pun">?&gt;</span><span class="pln"> 

</span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
               </span><span class="atn">Type</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#EXI"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">
    </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln">A23B45C56</span><span class="tag">&lt;/CipherValue&gt;</span><span class="pln">
  </span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
</span><span class="tag">&lt;/EncryptedData&gt;</span></pre></div></div>

        </section>
        <section id="sec-eg-Super-Encryption">
          <h4><span class="secno">2.1.5 </span>Super-Encryption: Encrypting EncryptedData</h4>

          <p>An XML document may contain zero or more <code>EncryptedData</code>
            elements. <code>EncryptedData</code> cannot be the parent or child of another
            <code>EncryptedData</code> element. However, the actual data encrypted can be
            anything, including <code>EncryptedData</code> and <code>EncryptedKey</code>
            elements (i.e., super-encryption). During super-encryption of an
            <code>EncryptedData</code> or <code>EncryptedKey</code> element, one must
            encrypt the entire element. Encrypting only the content of these elements, or
            encrypting selected child elements is an invalid instance under the provided
            schema.<br></p>
          <p>For example, consider the following:</p>

          <div><div class="example"><div class="example-title"><span>Example 8</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;pay:PaymentInfo</span><span class="pln"> </span><span class="atn">xmlns:pay</span><span class="pun">=</span><span class="atv">"http://example.org/paymentv2"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">Id</span><span class="pun">=</span><span class="atv">"ED1"</span><span class="pln"> 
                 </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
                 </span><span class="atn">Type</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#Element"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">
      </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln">originalEncryptedData</span><span class="tag">&lt;/CipherValue&gt;</span><span class="pln">
    </span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
  </span><span class="tag">&lt;/EncryptedData&gt;</span><span class="pln">
</span><span class="tag">&lt;/pay:PaymentInfo&gt;</span></pre></div></div>

          <p>A valid super-encryption of "<code>//xenc:EncryptedData[@Id='ED1']</code>"
            would be:</p>

          <div><div class="example"><div class="example-title"><span>Example 9</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;pay:PaymentInfo</span><span class="pln"> </span><span class="atn">xmlns:pay</span><span class="pun">=</span><span class="atv">"http://example.org/paymentv2"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">Id</span><span class="pun">=</span><span class="atv">"ED2"</span><span class="pln"> 
                 </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
                 </span><span class="atn">Type</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#Element"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">
      </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln">newEncryptedData</span><span class="tag">&lt;/CipherValue&gt;</span><span class="pln">
    </span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
  </span><span class="tag">&lt;/EncryptedData&gt;</span><span class="pln">
</span><span class="tag">&lt;/pay:PaymentInfo&gt;</span></pre></div></div>

          <p>where the <code>CipherValue</code> content of
            '<code>newEncryptedData</code>' is the base64 encoding of the encrypted octet
            sequence resulting from encrypting the <code>EncryptedData</code> element
            with <code>Id='ED1'</code>.</p>
        </section>
      </section>
      <section id="sec-Usage">
        <h3><span class="secno">2.2 </span><code>EncryptedData</code> and <code>EncryptedKey</code> Usage</h3>

        <section id="sec-eg-Symmetric-Key">
          <h4><span class="secno">2.2.1 </span><code>EncryptedData</code> with Symmetric Key (<code>KeyName</code>)</h4>

          <div><div class="example"><div class="example-title"><span>Example 10</span></div><pre class="example highlight prettyprint"><span class="pun">[</span><span class="pln">s01</span><span class="pun">]&lt;</span><span class="typ">EncryptedData</span><span class="pln"> xmlns</span><span class="pun">=</span><span class="str">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
                    </span><span class="typ">Type</span><span class="pun">=</span><span class="str">"http://www.w3.org/2001/04/xmlenc#Element"</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">s02</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="typ">EncryptionMethod</span><span class="pln">
           </span><span class="typ">Algorithm</span><span class="pun">=</span><span class="str">"http://www.w3.org/2001/04/xmlenc#tripledes-cbc"</span><span class="pun">/&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">s03</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyInfo</span><span class="pln"> xmlns</span><span class="pun">:</span><span class="pln">ds</span><span class="pun">=</span><span class="str">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">s04</span><span class="pun">]</span><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyName</span><span class="pun">&gt;</span><span class="typ">John</span><span class="pln"> </span><span class="typ">Smith</span><span class="pun">&lt;</span><span class="str">/ds:KeyName&gt;
[s05]  &lt;/</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyInfo</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">s06</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="typ">CipherData</span><span class="pun">&gt;&lt;</span><span class="typ">CipherValue</span><span class="pun">&gt;</span><span class="pln">DEADBEEF</span><span class="pun">&lt;</span><span class="str">/CipherValue&gt;&lt;/</span><span class="typ">CipherData</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">s07</span><span class="pun">]&lt;/</span><span class="typ">EncryptedData</span><span class="pun">&gt;</span></pre></div></div>

          <p><code>[s1]</code> The type of data encrypted may be represented as an
            attribute value to aid in decryption and subsequent processing. In this case,
            the data encrypted was an 'element'. Other alternatives include 'content' of
            an element, or an external octet sequence which can also be identified via
            the <code>MimeType</code> and <code>Encoding</code> attributes.</p>

          <p><code>[s2]</code> This (3DES CBC) is a symmetric key cipher.</p>

          <p><code>[s4]</code> The symmetric key has an associated name "John
            Smith".</p>

          <p><code>[s6]</code> <code>CipherData</code> contains a
            <code>CipherValue</code>, which is a base64 encoded octet sequence.
            Alternately, it could contain a <code>CipherReference</code>, which is a URI
            reference along with transforms necessary to obtain the encrypted data as an
            octet sequence</p>

        </section>
        <section id="sec-eg-EncryptedKey">
          <h4><span class="secno">2.2.2 </span><code>EncryptedKey</code>
            (<code>ReferenceList</code>, <code>ds:RetrievalMethod</code>,
            <code>CarriedKeyName</code>)</h4>

          <p>The following <code>EncryptedData</code> structure is very similar to the
            one above, except this time the key is referenced using a
            <code>ds:RetrievalMethod</code>:</p>

          <div><div class="example"><div class="example-title"><span>Example 11</span></div><pre class="example highlight prettyprint"><span class="pun">[</span><span class="pln">t01</span><span class="pun">]&lt;</span><span class="typ">EncryptedData</span><span class="pln"> </span><span class="typ">Id</span><span class="pun">=</span><span class="str">"ED"</span><span class="pln"> 
                    xmlns</span><span class="pun">=</span><span class="str">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t02</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="typ">EncryptionMethod</span><span class="pln"> 
           </span><span class="typ">Algorithm</span><span class="pun">=</span><span class="str">"http://www.w3.org/2001/04/xmlenc#aes128-cbc"</span><span class="pun">/&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t03</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyInfo</span><span class="pln"> xmlns</span><span class="pun">:</span><span class="pln">ds</span><span class="pun">=</span><span class="str">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t04</span><span class="pun">]</span><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">RetrievalMethod</span><span class="pln"> URI</span><span class="pun">=</span><span class="str">"#EK"</span><span class="pln">
                             </span><span class="typ">Type</span><span class="pun">=</span><span class="str">"http://www.w3.org/2001/04/xmlenc#EncryptedKey"</span><span class="pun">/&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t05</span><span class="pun">]</span><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyName</span><span class="pun">&gt;</span><span class="typ">Sally</span><span class="pln"> </span><span class="typ">Doe</span><span class="pun">&lt;</span><span class="str">/ds:KeyName&gt;
[t06]  &lt;/</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyInfo</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t07</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="typ">CipherData</span><span class="pun">&gt;&lt;</span><span class="typ">CipherValue</span><span class="pun">&gt;</span><span class="pln">DEADBEEF</span><span class="pun">&lt;</span><span class="str">/CipherValue&gt;&lt;/</span><span class="typ">CipherData</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t08</span><span class="pun">]&lt;/</span><span class="typ">EncryptedData</span><span class="pun">&gt;</span></pre></div></div>

          <p><code>[t02]</code> This (AES-128-CBC) is a symmetric key cipher.</p>

          <p><code>[t04]</code> <code>ds:RetrievalMethod</code> is used to indicate the
            location of a key with type <code>xenc:EncryptedKey</code>. The (AES)
            key is located at '#EK'.</p>

          <p><code>[t05]</code> <code>ds:KeyName</code> provides an alternative method
            of identifying the key needed to decrypt the <code>CipherData</code>. Either
            or both the <code>ds:KeyName</code> and <code>ds:KeyRetrievalMethod</code>
            could be used to identify the same key.</p>

          <p>Within the same XML document, there existed an <code>EncryptedKey</code>
            structure that was referenced within <code>[t04]</code>:</p>

          <div><div class="example"><div class="example-title"><span>Example 12</span></div><pre class="example highlight prettyprint"><span class="pun">[</span><span class="pln">t09</span><span class="pun">]&lt;</span><span class="typ">EncryptedKey</span><span class="pln"> </span><span class="typ">Id</span><span class="pun">=</span><span class="str">"EK"</span><span class="pln"> xmlns</span><span class="pun">=</span><span class="str">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t10</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="typ">EncryptionMethod</span><span class="pln"> 
           </span><span class="typ">Algorithm</span><span class="pun">=</span><span class="str">"http://www.w3.org/2001/04/xmlenc#rsa-1_5"</span><span class="pun">/&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t11</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyInfo</span><span class="pln"> xmlns</span><span class="pun">:</span><span class="pln">ds</span><span class="pun">=</span><span class="str">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t12</span><span class="pun">]</span><span class="pln">    </span><span class="pun">&lt;</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyName</span><span class="pun">&gt;</span><span class="typ">John</span><span class="pln"> </span><span class="typ">Smith</span><span class="pun">&lt;</span><span class="str">/ds:KeyName&gt;
[t13]  &lt;/</span><span class="pln">ds</span><span class="pun">:</span><span class="typ">KeyInfo</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t14</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="typ">CipherData</span><span class="pun">&gt;&lt;</span><span class="typ">CipherValue</span><span class="pun">&gt;</span><span class="pln">xyzabc</span><span class="pun">&lt;</span><span class="str">/CipherValue&gt;&lt;/</span><span class="typ">CipherData</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t15</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="typ">ReferenceList</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t16</span><span class="pun">]</span><span class="pln">    </span><span class="pun">&lt;</span><span class="typ">DataReference</span><span class="pln"> URI</span><span class="pun">=</span><span class="str">"#ED"</span><span class="pun">/&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t17</span><span class="pun">]</span><span class="pln">  </span><span class="pun">&lt;</span><span class="str">/ReferenceList&gt;
[t18]  &lt;CarriedKeyName&gt;Sally Doe&lt;/</span><span class="typ">CarriedKeyName</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">[</span><span class="pln">t19</span><span class="pun">]&lt;/</span><span class="typ">EncryptedKey</span><span class="pun">&gt;</span></pre></div></div>

          <p><code>[t09]</code> The <code>EncryptedKey</code> element is similar to the
            <code>EncryptedData</code> element except that the data encrypted is always a
            key value.</p>

          <p><code>[t10]</code> The <code>EncryptionMethod</code> is the RSA public key
            algorithm.</p>

          <p><code>[t12]</code> <code>ds:KeyName</code> of "John Smith" is a property
            of the key necessary for decrypting (using RSA) the
            <code>CipherData</code>.</p>

          <p><code>[t14]</code> The <code>CipherData</code>'s <code>CipherValue</code>
            is an octet sequence that is processed (serialized, encrypted, and encoded)
            by a referring encrypted object's <code>EncryptionMethod</code>. (Note, an
            EncryptedKey's <code>EncryptionMethod</code> is the algorithm used to encrypt
            these octets and does not speak about what type of octets they are.)</p>

          <p><code>[t15-17]</code> A <code>ReferenceList</code> identifies the
            encrypted objects (<code>DataReference</code> and <code>KeyReference</code>)
            encrypted with this key. The <code>ReferenceList</code> contains a list of
            references to data encrypted by the symmetric key carried within this
            structure.</p>

          <p><code>[t18]</code> The <code>CarriedKeyName</code> element is used to
            identify the encrypted key value which may be referenced by the
            <code>KeyName</code> element in <code>ds:KeyInfo</code>. (Since ID attribute
            values must be unique to a document,<code>CarriedKeyName</code> can indicate
            that several <code>EncryptedKey</code> structures contain the same key value
            encrypted for different recipients.)</p>
        </section>
      </section>
    </section>
    <section id="sec-Encryption-Syntax">
      <!--OddPage--><h2><span class="secno">3. </span>Encryption Syntax</h2>

      <p>This section provides a detailed description of the syntax and features
        for XML Encryption. Features described in this section <em class="rfc2119" title="MUST">MUST</em> be implemented
        unless otherwise noted. The syntax is defined via [<cite><a class="bibref" href="#bib-XMLSCHEMA-1">XMLSCHEMA-1</a></cite>], [<cite><a class="bibref" href="#bib-XMLSCHEMA-2">XMLSCHEMA-2</a></cite>] with the following XML preamble,
        declaration, internal entity, and import:</p>

      <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"utf-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="dec">&lt;!DOCTYPE schema  PUBLIC "-//W3C//DTD XMLSchema 200102//EN"
[
&lt;!ATTLIST schema
xmlns:xenc CDATA #FIXED 'http://www.w3.org/2001/04/xmlenc'#
xmlns:ds CDATA #FIXED 'http://www.w3.org/2000/09/xmldsig#'&gt;</span><span class="pln">
</span><span class="dec">&lt;!ENTITY xenc 'http://www.w3.org/2001/04/xmlenc#'&gt;</span><span class="pln">
</span><span class="dec">&lt;!ENTITY % p ''&gt;</span><span class="pln">
</span><span class="dec">&lt;!ENTITY % s ''&gt;</span><span class="pln">
]&gt;
        
</span><span class="tag">&lt;schema</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema"</span><span class="pln"> </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"1.0"</span><span class="pln">
        </span><span class="atn">xmlns:ds</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pln">
        </span><span class="atn">xmlns:xenc</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
        </span><span class="atn">targetNamespace</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
        </span><span class="atn">elementFormDefault</span><span class="pun">=</span><span class="atv">"qualified"</span><span class="tag">&gt;</span><span class="pln">

  </span><span class="tag">&lt;import</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pln">
          </span><span class="atn">schemaLocation</span><span class="pun">=</span><span class="atv">"http://www.w3.org/TR/2002/
            REC-xmldsig-core-20020212/xmldsig-core-schema.xsd"</span><span class="tag">/&gt;</span></pre></div>


      (Note: A newline has been added to the schemaLocation URI to fit on this page, but is not part of the URI.)

      <p>Additional markup defined in this specification uses the <code>xenc11:</code> namespace.  The syntax is defined in an XML schema with the following preamble:</p>
      <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="pun">&lt;?</span><span class="pln">xml version</span><span class="pun">=</span><span class="str">"1.0"</span><span class="pln"> encoding</span><span class="pun">=</span><span class="str">"utf-8"</span><span class="pun">?&gt;</span><span class="pln">
</span><span class="dec">&lt;!DOCTYPE schema  PUBLIC "-//W3C//DTD XMLSchema 200102//EN"
[
&lt;!ATTLIST schema
xmlns:xenc CDATA #FIXED "http://www.w3.org/2001/04/xmlenc#"
xmlns:ds CDATA #FIXED "http://www.w3.org/2000/09/xmldsig#"
xmlns:xenc11 CDATA #FIXED "http://www.w3.org/2009/xmlenc11#"&gt;</span><span class="pln">
</span><span class="dec">&lt;!ENTITY xenc "http://www.w3.org/2001/04/xmlenc#"&gt;</span><span class="pln">
</span><span class="dec">&lt;!ENTITY % p ""&gt;</span><span class="pln">
</span><span class="dec">&lt;!ENTITY % s ""&gt;</span><span class="pln">
]&gt;

</span><span class="tag">&lt;schema</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema"</span><span class="pln"> </span><span class="atn">version</span><span class="pun">=</span><span class="atv">"1.0"</span><span class="pln">
        </span><span class="atn">xmlns:xenc</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
        </span><span class="atn">xmlns:xenc11</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#"</span><span class="pln">
        </span><span class="atn">xmlns:ds</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pln">
        </span><span class="atn">targetNamespace</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#"</span><span class="pln">
        </span><span class="atn">elementFormDefault</span><span class="pun">=</span><span class="atv">"qualified"</span><span class="tag">&gt;</span><span class="pln">

  </span><span class="tag">&lt;import</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pln">
          </span><span class="atn">schemaLocation</span><span class="pun">=</span><span class="atv">"http://www.w3.org/TR/2002/
                          REC-xmldsig-core-20020212/xmldsig-core-schema.xsd"</span><span class="tag">/&gt;</span><span class="pln">

  </span><span class="tag">&lt;import</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
          </span><span class="atn">schemaLocation</span><span class="pun">=</span><span class="atv">"http://www.w3.org/TR/2002/
                          REC-xmlenc-core-20021210/xenc-schema.xsd"</span><span class="tag">/&gt;</span></pre></div>
      (Note: A newline has been added to the schemaLocation URI to fit on this page, but is not part of the URI.)

      <section id="sec-EncryptedType">
        <h3><span class="secno">3.1 </span>The <code>EncryptedType</code> Element</h3>

        <p><code>EncryptedType</code> is the abstract type from which
          <code>EncryptedData</code> and <code>EncryptedKey</code> are derived. While
          these two latter element types are very similar with respect to their content
          models, a syntactical distinction is useful to processing. Implementations
          <em class="rfc2119" title="MUST">MUST</em> generate laxly schema valid [<cite><a class="bibref" href="#bib-XMLSCHEMA-1">XMLSCHEMA-1</a></cite>], [<cite><a class="bibref" href="#bib-XMLSCHEMA-2">XMLSCHEMA-2</a></cite>]
          <code>EncryptedData</code> or <code>EncryptedKey</code> elements as specified by the
          subsequent schema declarations. (Note the laxly schema valid generation means
          that the content permitted by <code>xsd:ANY</code> need not be valid.)
          Implementations <em class="rfc2119" title="SHOULD">SHOULD</em> create these XML structures
          (<code>EncryptedType</code> elements and their descendants/content) in
          Normalization Form C [<cite><a class="bibref" href="#bib-NFC">NFC</a></cite>].</p>

        <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptedType"</span><span class="pln"> </span><span class="atn">abstract</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptionMethod"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:EncryptionMethodType"</span><span class="pln"> 
             </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"ds:KeyInfo"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"xenc:CipherData"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"xenc:EncryptionProperties"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Id"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ID"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Type"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"MimeType"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Encoding"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln"> 
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>

        <p><code>EncryptionMethod</code> is an optional element that describes the
          encryption algorithm applied to the cipher data. If the element is absent,
          the encryption algorithm must be known by the recipient or the decryption
          will fail.</p>

        <p><code>ds:KeyInfo</code> is an optional element, defined by [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>], that carries information about the key
          used to encrypt the data. Subsequent sections of this specification define
          new elements that may appear as children of <code>ds:KeyInfo</code>.</p>

        <p><code>CipherData</code> is a mandatory element that contains the
          <code>CipherValue</code> or <code>CipherReference</code> with the encrypted
          data.</p>

        <p><code>EncryptionProperties</code> can contain additional information
          concerning the generation of the <code>EncryptedType</code> (e.g., date/time
          stamp).</p>

        <p><code>Id</code> is an optional attribute providing for the standard method
          of assigning a string id to the element within the document context.</p>

        <p><code>Type</code> is an optional attribute identifying type information
          about the plaintext form of the encrypted content. While optional, this
          specification takes advantage of it for processing described in <a class="sectionRef sec-ref" href="#sec-Processing-Decryption">section 4.4 Decryption</a>. If the <code>EncryptedData</code> element
          contains data of <code>Type</code> 'element' or element 'content', and
          replaces that data in an XML document context, or contains data of
          <code>Type</code> 'EXI', it is strongly recommended the
          <code>Type</code> attribute be provided. Without this information, the
          decryptor will be unable to automatically restore the XML document to its
          original cleartext form.</p>

        <p><code>MimeType</code> is an optional (advisory) attribute which describes
          the media type of the data which has been encrypted. The value of this
          attribute is a string with values defined by [<cite><a class="bibref" href="#bib-RFC2045">RFC2045</a></cite>].
          For example, if the data that is encrypted is a base64 encoded PNG, the
          transfer <code>Encoding</code> may be specified as '<a href="http://www.w3.org/2000/09/xmldsig#base64">http://www.w3.org/2000/09/xmldsig#base64</a>'
          and the <code>MimeType</code> as 'image/png'. This attribute is purely
          advisory; no validation of the <code>MimeType</code> information is required
          and it does not indicate the encryption application must do any additional
          processing. Note, this information may not be necessary if it is already
          bound to the identifier in the <code>Type</code> attribute. For example, the
          Element and Content types defined in this specification are always UTF-8
          encoded text.
          In the case of Type EXI the MimeType attribute is not necessary, but
          if used should reflect the underlying type and not "EXI".
        </p>
        <p><code>Encoding</code> is an optional (advisory) attribute which describes
          the transfer encoding of the data that has been encrypted.
        </p>
      </section>
      <section id="sec-EncryptionMethod">
        <h3><span class="secno">3.2 </span>The <code>EncryptionMethod</code> Element</h3>

        <p>EncryptionMethod is an optional element that describes the encryption
          algorithm applied to the cipher data. If the element is absent, the
          encryption algorithm must be known to the recipient or the decryption will
          fail.</p>
        <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Encryptionmethodtype"</span><span class="pln"> </span><span class="atn">mixed</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"KeySize"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:KeySizeType"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"OAEPparams"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"base64Binary"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;any</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"##other"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">"unbounded"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Algorithm"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"required"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>


        <p>The permitted child elements of the <code>EncryptionMethod</code> are
          determined by the specific value of the <code>Algorithm</code> attribute URI,
          and the <code>KeySize</code> child element is always permitted. For example,
          the RSA-OAEP algorithm (<a href="#sec-RSA-OAEP" class="sectionRef sec-ref">section 5.5.2 RSA-OAEP</a>) uses the 
          <code>ds:DigestMethod</code> and <code>OAEPparams</code> elements, and
          may use the <code>xenc11:MGF</code> element when needed. (We rely
          upon the <code>ANY</code> schema construct because it is not possible to
          specify element content based on the value of an attribute.)</p>
        <p>The presence of any child element under <code>EncryptionMethod</code>
          that is not permitted by the algorithm or the presence of a
          <code>KeySize</code> child inconsistent with the algorithm <em class="rfc2119" title="MUST">MUST</em> be treated as
          an error. (All algorithm URIs specified in this document imply a key size but
          this is not true in general. Most popular stream cipher algorithms take
          variable size keys.)</p>

      </section>
      <section id="sec-CipherData">
        <h3><span class="secno">3.3 </span>The <code>CipherData</code> Element</h3>

        <p>The <code>CipherData</code> is a mandatory element that provides the
          encrypted data. It must either contain the encrypted octet sequence as base64
          encoded text as element content of the <code>CipherValue</code> element, or provide a reference
          to an external location containing the encrypted octet sequence via the
          <code>CipherReference</code> element.</p>

        <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"CipherData"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:CipherDataType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"CipherDataType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;choice&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"CipherValue"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"base64Binary"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"xenc:CipherReference"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/choice&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>

        <section id="sec-CipherReference">
          <h4><span class="secno">3.3.1 </span>The <code>CipherReference</code> Element</h4>

          <p>If <code>CipherValue</code> is not supplied directly, the
            <code>CipherReference</code> identifies a source which, when processed,
            yields the encrypted octet sequence.</p>

          <p>The actual value is obtained as follows. The <code>CipherReference</code>
            <code>URI</code> contains an identifier that is dereferenced. Should the
            <code>CipherReference</code> element contain an <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> sequence of
            <code>Transform</code>s, the data resulting from dereferencing the URI is
            transformed as specified so as to yield the intended cipher value. For
            example, if the value is base64 encoded within an XML document; the
            transforms could specify an XPath expression followed by a base64 decoding so
            as to extract the octets.</p>

          <p>
            The syntax of the URI and Transforms is defined in XML Signature 
            [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>], however XML Encryption places
            the <code>Transforms</code> element in the XML Encryption namespace
            since it  is 
            used in XML Encryption to obtain an  octet stream for decryption.
            In [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>] both generation and validation processing
            start with the same source data and perform that transform in the same order.
            In encryption, the decryptor has only the cipher data and the specified
            transforms are enumerated for the decryptor, in the order necessary to obtain
            the octets. Consequently, because it has different semantics
            <code>Transforms</code> is in the <code>xenc:</code> namespace.</p>

          <p>For example, if the relevant cipher value is captured
            within a 
            <code>CipherValue</code> element within a different XML
            document, the 
            <code>CipherReference</code> might look as follows:</p>

          <div><div class="example"><div class="example-title"><span>Example 13</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;CipherReference</span><span class="pln"> </span><span class="atn">URI</span><span class="pun">=</span><span class="atv">"http://www.example.com/CipherValues.xml"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;Transforms&gt;</span><span class="pln">
    </span><span class="tag">&lt;ds:Transform</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/TR/1999/REC-xpath-19991116"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;ds:XPath</span><span class="pln"> </span><span class="atn">xmlns:xenc</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="tag">&gt;</span><span class="pln">
        self::text()[parent::enc:CipherValue[@Id="example1"]]
      </span><span class="tag">&lt;/ds:XPath&gt;</span><span class="pln">
    </span><span class="tag">&lt;/ds:Transform&gt;</span><span class="pln">
    </span><span class="tag">&lt;ds:Transform</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#base64"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/Transforms&gt;</span><span class="pln">
</span><span class="tag">&lt;/CipherReference&gt;</span></pre></div></div>

          <p>Implementations <em class="rfc2119" title="MUST">MUST</em> support the <code>CipherReference</code> feature and
            the same URI encoding, dereferencing, scheme, and HTTP response codes as that
            of [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>]. The <code>Transform</code> feature
            and particular transform algorithms are <em class="rfc2119" title="OPTIONAL">OPTIONAL</em>.</p>

          <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"CipherReference"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:CipherReferenceType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"CipherReferenceType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Transforms"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:TransformsType"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"URI"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"required"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"TransformsType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"ds:Transform"</span><span class="pln"> </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">"unbounded"</span><span class="tag">/&gt;</span><span class="pln"> 
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>

        </section>
      </section>
      <section id="sec-EncryptedData">
        <h3><span class="secno">3.4 </span>The <code>EncryptedData</code> Element</h3>

        <p>The <code>EncryptedData</code> element is the core element
          in the syntax. 
          Not only does its <code>CipherData</code> child contain the
          encrypted data, 
          but it's also the element that replaces the encrypted element, or
          element content, or serves as 
          the new document root.</p>

        <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptedData"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:EncryptedDataType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptedDataType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;complexContent&gt;</span><span class="pln">
    </span><span class="tag">&lt;extension</span><span class="pln"> </span><span class="atn">base</span><span class="pun">=</span><span class="atv">"xenc:EncryptedType"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;/extension&gt;</span><span class="pln">
  </span><span class="tag">&lt;/complexContent&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>

      </section>
      <section id="sec-Extensions-to-KeyInfo">
        <h3><span class="secno">3.5 </span>Extensions to <code>ds:KeyInfo</code> Element</h3>

        <p>There are three ways that the keying material needed to decrypt
          <code>CipherData</code> can be provided:</p>
        <ol>
          <li>The <code>EncryptedData</code> or <code>EncryptedKey</code> element
            specify the associated keying material via a child of
            <code>ds:KeyInfo</code>. All of the child elements of
            ds:<code>KeyInfo</code> specified in [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>] <em class="rfc2119" title="MAY">MAY</em> be used as qualified: 
            <ol>
              <li>Support for <code>ds:KeyValue</code> is <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> and may
                be used to transport public keys, such as Diffie-Hellman Key
                Values (<a href="#sec-DHKeyValue" class="sectionRef sec-ref">section 5.6.1 Diffie-Hellman Key
            Values</a>).
                (Including the plaintext decryption key, whether a private key or a
                secret key, is obviously <em class="rfc2119" title="NOT RECOMMENDED">NOT RECOMMENDED</em>.)</li>
              <li>Support of <code>ds:KeyName</code> to refer to an
                <code>EncryptedKey</code> <code>CarriedKeyName</code> is
                <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em>.</li>
              <li>Support for same document <code>ds:RetrievalMethod</code> is
                <em class="rfc2119" title="REQUIRED">REQUIRED</em>.</li>
            </ol>
            <p>In addition, we provide two additional child elements: applications
              <em class="rfc2119" title="MUST">MUST</em> support <code>EncryptedKey</code>
              (<a href="#sec-EncryptedKey" class="sectionRef sec-ref">section 3.5.1 The EncryptedKey Element</a>) 
              and <em class="rfc2119" title="MAY">MAY</em> support <code>AgreementMethod</code>  (<a href="#sec-Alg-KeyAgreement" class="sectionRef sec-ref">section 5.6 Key Agreement</a>).</p>
          </li>
          <li>A detached (not inside <code>ds:KeyInfo</code>)
            <code>EncryptedKey</code> element can specify the
            <code>EncryptedData</code> or <code>EncryptedKey</code> to which its
            decrypted key will apply via a <code>DataReference</code> or
            <code>KeyReference</code> (
            <a class="sectionRef sec-ref" href="#sec-ReferenceList">section 3.6 The ReferenceList Element</a>).
          </li>
          <li>The keying material can be determined by the recipient by application
            context and thus need not be explicitly mentioned in the transmitted
            XML.</li>
        </ol>

        <section id="sec-EncryptedKey">
          <h4><span class="secno">3.5.1 </span>The <code>EncryptedKey</code> Element</h4>
          <dl>
            <dt>Identifier</dt>
            <dd><code><a id="EncryptedKey">Type="http://www.w3.org/2001/04/xmlenc#EncryptedKey"</a></code> 
              <p>(This can be used within a <code>ds:RetrievalMethod</code> element
                to identify the referent's type.)</p>
            </dd>
          </dl>

          <p>The <code>EncryptedKey</code> element is used to transport encryption keys
            from the originator to a known recipient(s). It may be used as a stand-alone
            XML document, be placed within an application document, or appear inside an
            <code>EncryptedData</code> element as a child of a <code>ds:KeyInfo</code>
            element. The key value is always encrypted to the recipient(s). When
            <code>EncryptedKey</code> is decrypted the resulting octets are made
            available to the <code>EncryptionMethod</code> algorithm without any
            additional processing.</p>

          <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptedKey"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:EncryptedKeyType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptedKeyType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;complexContent&gt;</span><span class="pln">
    </span><span class="tag">&lt;extension</span><span class="pln"> </span><span class="atn">base</span><span class="pun">=</span><span class="atv">"xenc:EncryptedType"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
        </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"xenc:ReferenceList"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"CarriedKeyName"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
      </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Recipient"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/extension&gt;</span><span class="pln">
  </span><span class="tag">&lt;/complexContent&gt;</span><span class="pln">   
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>

          <p><code>ReferenceList</code> is an optional element containing pointers to
            data and keys encrypted using this key. The reference list may contain
            multiple references to <code>EncryptedKey</code> and
            <code>EncryptedData</code> elements. This is done using
            <code>KeyReference</code> and <code>DataReference</code> elements
            respectively. These are defined below.</p>

          <p><code>CarriedKeyName</code> is an optional element for associating a user
            readable name with the key value. This may then be used to reference the key
            using the <code>ds:KeyName</code> element within <code>ds:KeyInfo</code>. The
            same <code>CarriedKeyName</code> label, unlike an ID type, may occur multiple
            times within a single document. The value of the key <em class="rfc2119" title="MUST">MUST</em> be the same in all
            <code>EncryptedKey</code> elements identified with the same
            <code>CarriedKeyName</code> label within a single XML document. Note that
            because whitespace is significant in the value of the <code>ds:KeyName</code>
            element, whitespace is also significant in the value of the
            <code>CarriedKeyName</code> element.</p>

          <p><code>Recipient</code> is an optional attribute that contains a hint as to
            which recipient this encrypted key value is intended for. Its contents are
            application dependent.</p>

          <p>The <code>Type</code> attribute inherited from <code>EncryptedType</code>
            can be used to further specify the type of the encrypted key if the
            <code>EncryptionMethod</code> <code>Algorithm</code> does not define a
            unambiguous encoding/representation. (Note, all the algorithms in this
            specification have an unambiguous representation for their associated key
            structures.)</p>
        </section>
        <section id="sec-DerivedKey">
          <h4><span class="secno">3.5.2 </span>The <code>DerivedKey</code> Element</h4>
          <dl>
            <dt>Identifier</dt>
            <dd><code><a id="DerivedKey">Type="http://www.w3.org/2009/xmlenc11#DerivedKey"</a></code> 
              <p>(This can be used within a <code>ds:RetrievalMethod</code> element
                to identify the referent's type.)</p>
            </dd>
          </dl>

          <p>
            The <code>DerivedKey</code> element is used to transport information
            about a derived key from the originator to recipient(s). It may be
            used as a stand-alone XML document, be placed within an application
            document, or appear inside an <code>EncryptedData</code> or
            <code>Signature</code> element as a child of a <code>ds:KeyInfo</code>
            element. The key value itself is never sent by the
            originator. Rather, the originator provides information to the
            recipient(s) by which the recipient(s) can derive the same key
            value. When the key has been derived the resulting octets are made
            available to the <code>EncryptionMethod</code> or
            <code>SignatureMethod</code> algorithm without any additional
            processing.
          </p>
          <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="com">&lt;!-- targetNamespace=&amp;#x27;http://www.w3.org/2009/xmlenc11#&amp;#x27; --&gt;</span><span class="pln">

</span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"DerivedKey"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc11:DerivedKeyType"</span><span class="tag">/&gt;</span><span class="pln"> 

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"DerivedKeyType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"xenc11:KeyDerivationMethod"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"xenc:ReferenceList"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"DerivedKeyName"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"MasterKeyName"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Recipient"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"string"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Id"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ID"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Type"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">

</span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"KeyDerivationMethod"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:KeyDerivationMethodType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"KeyDerivationMethodType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;any</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"##any"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">"unbounded"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Algorithm"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"required"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">
</span></pre></div>

          <p>
            <code>KeyDerivationMethod</code> is an optional element that describes
            the key derivation algorithm applied to the master (underlying)
            key material. If the element is absent, the key derivation algorithm must
            be known by the recipient or the recipient's key derivation will fail.
          </p>
          <p>
            <code>ReferenceList</code> is an optional element containing pointers
            to data and keys encrypted using this key. The reference list may
            contain multiple references to <code>EncryptedKey</code> or
            <code>EncryptedData</code> elements. This is done using
            <code>KeyReference</code> and <code>DataReference</code> elements
            from XML Encryption.
          </p>
          <p>
            The optional <code>DerivedKeyName</code> element is used to identify
            the derived key value. This element may then be referenced by the
            <code>ds:KeyName</code> element in <code>ds:KeyInfo</code>. The
            same <code>DerivedKeyName</code> label, unlike an ID type, may occur
            multiple times within a single document. Note that because whitespace
            is significant in the value of the <code>ds:KeyName</code> element,
            whitespace is also significant in the value of the
            <code>DerivedKeyName</code> element.
          </p>
          <p>
            <code>MasterKeyName</code> is an optional element for associating a
            user readable name with the master key (or secret) value. The
            same <code>MasterKeyName</code> label, unlike an ID type, may occur
            multiple times within a single document. The value of the master
            key <em class="rfc2119" title="MUST">MUST</em> be the same in all <code>DerivedKey</code> elements
            identified with the same <code>MasterKeyName</code> label within a
            single XML document. If no <code>MasterKeyName</code> is provided, the
            master key material must be known by the recipient or key
            derivation will fail.
          </p>
          <p>
            <code>Recipient</code> is an optional attribute that contains a hint
            as to which recipient this derived key value is intended for. Its
            contents are application dependent. 
          </p>
          <p>
            The optional <code>Id</code> attribute provides for the standard
            method of assigning a string id to the element within the document
            context.
          </p>
          <p>
            The <code>Type</code> attribute can be used to further specify the
            type of the derived key if the <code>KeyDerivationMethod</code>
            algorithm does not define an unambiguous encoding/representation.
          </p>

        </section>
        <section id="sec-ds-RetrievalMethod">
          <h4><span class="secno">3.5.3 </span>The <code>ds:RetrievalMethod</code> Element</h4>

          <p>The <code>ds:RetrievalMethod</code> <code>[<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>]</code> with a <code>Type</code> of 
            '<code>http://www.w3.org/2001/04/xmlenc#EncryptedKey</code>' provides a way
            to express a link to an <code>EncryptedKey</code> element containing the key
            needed to decrypt the <code>CipherData</code> associated with an
            <code>EncryptedData</code> or <code>EncryptedKey</code> element. The <code>ds:RetrievalMethod</code> <code>[<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>]</code> with a <code>Type</code> of '<code>http://www.w3.org/2001/04/xmlenc#DerivedKey</code>' provides a way
            to express a link to a <code>DerivedKey</code> element used to derive the key
            needed to decrypt the <code>CipherData</code> associated with an
            <code>EncryptedData</code> or <code>EncryptedKey</code> element. The
            <code>ds:RetrievalMethod</code> with one of these types is always a child of the
            <code>ds:KeyInfo</code> element and may appear multiple times. If there is
            more than one instance of a <code>ds:RetrievalMethod</code> in a
            <code>ds:KeyInfo</code> of this type, then the <code>EncryptedKey</code>
            objects referred to must contain the same key value, possibly encrypted in
            different ways or for different recipients.</p>
        </section>
      </section>
      <section id="sec-ReferenceList">
        <h3><span class="secno">3.6 </span>The <code>ReferenceList</code> Element</h3>

        <p><code>ReferenceList</code> is an element that contains pointers from a key
          value of an <code>EncryptedKey</code> or <code>DerivedKey</code> to items encrypted by that key value
          (<code>EncryptedData</code> or <code>EncryptedKey</code> elements).</p>
        <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"ReferenceList"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;complexType&gt;</span><span class="pln">
    </span><span class="tag">&lt;choice</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"1"</span><span class="pln"> </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">"unbounded"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"DataReference"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:ReferenceType"</span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"KeyReference"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:ReferenceType"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/choice&gt;</span><span class="pln">
  </span><span class="tag">&lt;/complexType&gt;</span><span class="pln">
</span><span class="tag">&lt;/element&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"ReferenceType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;any</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"##other"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">"unbounded"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"URI"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"required"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">
</span></pre></div>

        <p><code>DataReference</code> elements are used to refer to
          <code>EncryptedData</code> elements that were encrypted using the key defined
          in the enclosing <code>EncryptedKey</code> or <code>DerivedKey</code> element. Multiple
          <code>DataReference</code> elements can occur if multiple
          <code>EncryptedData</code> elements exist that are encrypted by the same
          key.</p>

        <p><code>KeyReference</code> elements are used to refer to
          <code>EncryptedKey</code> elements that were encrypted using the key defined
          in the enclosing <code>EncryptedKey</code> or <code>DerivedKey</code> element. Multiple
          <code>KeyReference</code> elements can occur if multiple
          <code>EncryptedKey</code> elements exist that are encrypted by the same
          key.</p>

        <p>For both types of references one may optionally specify child elements to
          aid the recipient in retrieving the <code>EncryptedKey</code> and/or
          <code>EncryptedData</code> elements. These could include information such as
          XPath transforms, decompression transforms, or information on how to retrieve
          the elements from a document storage facility. For example:</p>

        <div><div class="example"><div class="example-title"><span>Example 14</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;ReferenceList&gt;</span><span class="pln">
  </span><span class="tag">&lt;DataReference</span><span class="pln"> </span><span class="atn">URI</span><span class="pun">=</span><span class="atv">"#invoice34"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;ds:Transforms&gt;</span><span class="pln">
      </span><span class="tag">&lt;ds:Transform</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/TR/1999/REC-xpath-19991116"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;ds:XPath</span><span class="pln"> </span><span class="atn">xmlns:xenc</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="tag">&gt;</span><span class="pln">
          self::xenc:EncryptedData[@Id="example1"]
        </span><span class="tag">&lt;/ds:XPath&gt;</span><span class="pln">
      </span><span class="tag">&lt;/ds:Transform&gt;</span><span class="pln">
    </span><span class="tag">&lt;/ds:Transforms&gt;</span><span class="pln">
  </span><span class="tag">&lt;/DataReference&gt;</span><span class="pln">
</span><span class="tag">&lt;/ReferenceList&gt;</span></pre></div></div>
      </section>
      <section id="sec-EncryptionProperties">
        <h3><span class="secno">3.7 </span>The <code>EncryptionProperties</code> Element</h3>
        <dl>
          <dt>Identifier</dt>
          <dd><code><a id="EncryptionProperties">Type="http://www.w3.org/2001/04/xmlenc#EncryptionProperties"</a></code> 
            <p>(This can be used within a <code>ds:Reference</code> element to
              identify the referent's type.)</p>
          </dd>
        </dl>

        <p>Additional information items concerning the generation of the
          <code>EncryptedData</code> or <code>EncryptedKey</code> can be placed in an
          <code>EncryptionProperty</code> element (e.g., date/time stamp or the serial
          number of cryptographic hardware used during encryption). The
          <code>Target</code> attribute identifies the <code>EncryptedType</code>
          structure being described. <code>anyAttribute</code> permits the inclusion of
          attributes from the XML namespace to be included (i.e.,
          <code>xml:space</code>, <code>xml:lang</code>, and <code>xml:base</code>).</p>
        <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptionProperties"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:EncryptionPropertiesType"</span><span class="tag">/&gt;</span><span class="pln"> 

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptionPropertiesType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"xenc:EncryptionProperty"</span><span class="pln"> </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">"unbounded"</span><span class="tag">/&gt;</span><span class="pln"> 
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Id"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ID"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln"> 
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">

</span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptionProperty"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:EncryptionPropertyType"</span><span class="tag">/&gt;</span><span class="pln"> 

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"EncryptionPropertyType"</span><span class="pln"> </span><span class="atn">mixed</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;choice</span><span class="pln"> </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">"unbounded"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;any</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"##other"</span><span class="pln"> </span><span class="atn">processContents</span><span class="pun">=</span><span class="atv">"lax"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/choice&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Target"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln"> 
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Id"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ID"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"optional"</span><span class="tag">/&gt;</span><span class="pln"> 
  </span><span class="tag">&lt;anyAttribute</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"http://www.w3.org/XML/1998/namespace"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">
</span></pre></div>
      </section>
    </section>
    <section id="sec-Processing">
      <!--OddPage--><h2><span class="secno">4. </span>Processing Rules</h2>

      <p>This section describes the operations to be performed as part of
        encryption and decryption processing by implementations of this
        specification. The conformance requirements are specified over the following
        roles:</p>
      <dl>
        <dt><a id="def-Encryptor">Encryptor</a></dt>
        <dd>An XML Encryption implementation with the role of encrypting
          data.</dd>
        <dt><a id="def-Decryptor">Decryptor</a></dt>
        <dd>An XML Encryption implementation with the role of decrypting
          data.</dd>
      </dl>

      <p>Encryptor and Decryptor are invoked by the <a id="def-Application">Application</a>.  This specification does not include normative definitions for application behavior.  However, this specification does include conformance requirements on encrypted data that may only be achievable through appropriate behavior by all three parties.  It is up to specific deployment contexts how this is achieved.</p>

      <section id="sec-Intended-Processing">
        <h3><span class="secno">4.1 </span>Intended Application Model</h3>

        <p>The processing rules for XML Encryption are designed around an intended application model that this version of the specification does not cover normatively.</p>

        <p>In the intended processing model, XML Encryption is used to encrypt
          an octet-stream, an EXI stream, or a fragment of an XML document that
          matches either the <code>content</code> or <code>element</code>
          production from [<cite><a class="bibref" href="#bib-XML10">XML10</a></cite>].</p>

        <p>If XML Encryption is used with some octet-stream, the precise encoding and meaning of that octet-stream is up to the application, but treated as opaque by the Encryptor or Decryptor.  The application may use the <code>Type</code>, <code>Encoding</code> and <code>MimeType</code> parameters to transport further information about the nature of that octet-stream. Hence, an unknown <code>Type</code> parameter is, in general, not treated as an error by either the Encryptor or Decryptor, but instead simply passed through, along with the other relevant parameters and the cleartext octet-stream.</p>

        <p>If XML Encryption is used with an XML <code>element</code> or XML <code>content</code>, then Encryptors and Decryptors commonly perform type-specific processing:</p>

        <ul>
          <li>If an <code>element</code> is encrypted, then the Encryptor
            will replace the element in question with an appropriately
            constructed <code>EncryptedData</code> element.  The Decryptor
            will, conversely, replace the <code>EncryptedData</code> element
            with its cleartext.</li> 
          <li>If XML <code>content</code> is encrypted, then the Encryptor will likewise replace this content with an appropriately constructed <code>EncryptedData</code> element, and the Decryptor will reverse this operation.</li>
        </ul>

        <p>Note that the intended Encryptor behavior 
          will often cause the document with encrypted parts to become
          invalid with respect to its schema
          for 
          the hosting XML format, unless that format is specifically prepared
          to be used with XML Encryption.  An Encryptor or Decryptor that
          implements the intended processing model is <em class="rfc2119" title="NOT REQUIRED">NOT REQUIRED</em> to ensure
          that the resulting XML is schema-valid for the hosting XML
          format.</p> 
        
        <p>If XML processing is handled inside the Encryptor and Decryptor, and the <code>Type</code> attribute values for <code>element</code> and <code>content</code> cleartext are used, then the Encryptor and Decryptor <em class="rfc2119" title="MUST">MUST</em> ensure that the XML cleartext is serialized as UTF-8 before encryption, and -- if needed -- converted back to whatever other encoding might be used by the surrounding XML context.</p>

        <p>If XML Encryption is used with an EXI stream [<cite><a class="bibref" href="#bib-EXI">EXI</a></cite>], then Encryptors and
          Decryptors process content as for XML element or XML content processing, but taking into account EXI serialization. In particular,
          the encryptor will replace the XML element or XML fragment in question
          with an appropriately constructed EncryptedData element. The Decryptor
          will conversely replace the EncryptedData element with its cleartext
          XML element or XML fragment. Note that the XML document into which the
          EncryptedData element is embedded may be encoded using EXI and/or EXI
          may be used to encode the cleartext before encryption.  </p>
      </section>

      <section id="sec-Type-Parameters">
        <h3><span class="secno">4.2 </span>Well-known <code>Type</code> parameter values</h3>

        <p>For interoperability purposes, the following types <em class="rfc2119" title="MUST">MUST</em> be implemented
          such that an implementation will be able to take as input and yield as output
          data matching the production rules 39 and 43 from [<cite><a class="bibref" href="#bib-XML10">XML10</a></cite>]:</p>
        <dl>
          <dt><a id="Element">element</a> '<a href="http://www.w3.org/2001/04/xmlenc#Element">http://www.w3.org/2001/04/xmlenc#Element</a>'</dt>
          <dd>"[39]&nbsp; <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-element">element</a>
            ::= <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-EmptyElemTag"><code>EmptyElemTag</code></a>
            | <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-STag">STag</a>
            <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-content">content</a>
            <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-ETag">ETag</a>"</dd>
          <dt><a id="Content">content</a>&nbsp;'<a href="http://www.w3.org/2001/04/xmlenc#Content">http://www.w3.org/2001/04/xmlenc#Content</a>'</dt>
          <dd>"[43] <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-content">content</a>
            ::= <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-CharData"><code>CharData</code></a>?
            ((<a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-element">element</a>
            | <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-Reference">Reference</a>
            | <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-CDSect">CDSect</a>
            | <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-PI">PI</a> |
            <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-Comment">Comment</a>)
            <a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-CharData"><code>CharData</code></a>?)*"</dd>
        </dl>

        <p>Support for the following type is <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> for Encryptors and Decryptors:</p>

        <dl>
          <dt><a href="http://www.w3.org/2009/xmlenc11#EXI" id="EXI">http://www.w3.org/2009/xmlenc11#EXI</a></dt>
          <dd>Presence of this <code>Type</code> indicates that the cleartext is an EXI stream [<cite><a class="bibref" href="#bib-EXI">EXI</a></cite>].  Encryptors and Decryptors that support this type <em class="rfc2119" title="MAY">MAY</em> operate directly on (parts of) EXI streams.</dd>
        </dl>

        <p>Encryptors and Decryptors <em class="rfc2119" title="SHOULD">SHOULD</em> handle unknown or empty <code>Type</code> attribute values as a signal that the cleartext is to be handled as an opaque octet-stream, whose specific processing is up to the invoking application. In this case, the <code>Type</code>, <code>MimeType</code> and <code>Encoding</code> parameters <em class="rfc2119" title="SHOULD">SHOULD</em> be treated as opaque data whose appropriate processing is up to the application.</p>

      </section>

      <section id="sec-Processing-Encryption">
        <h3><span class="secno">4.3 </span>Encryption</h3>

        <p>The selection of the algorithm, parameters, and encryption keys is out of scope for this specification.</p>

        <p>The cleartext data are assumed to be present as an octet stream.  If the cleartext is of type <code>element</code> or <code>content</code>, the data <em class="rfc2119" title="MUST">MUST</em> be serialized in UTF-8 as specified in [<cite><a class="bibref" href="#bib-XML10">XML10</a></cite>], using Normal Form C [<cite><a class="bibref" href="#bib-NFC">NFC</a></cite>].</p>

        <p>For each data item to be encrypted as an <code>EncryptedData</code> or
          <code>EncryptedKey</code> element, the <strong>encryptor</strong> <em class="rfc2119" title="MUST">MUST</em>:</p>
        <ol>
          <li>Obtain (or derive) and (optionally) represent the key. 
            <ol>
              <li><p>If the key is to be identified (via naming, URI, or included in a
                  child element), construct the <code>ds:KeyInfo</code> as appropriate
                  (e.g., <code>ds:KeyName</code>, <code>ds:KeyValue</code>,
                  <code>ds:RetrievalMethod</code>, etc.)</p></li>
              <li><p>If the key itself is to be encrypted, construct an
                  <code>EncryptedKey</code> element by recursively applying this
                  encryption process. The result may then be a child of
                  <code>ds:KeyInfo</code>, or it may exist elsewhere and may be
                  identified in the preceding step.</p></li>
              <li><p>If the key was derived from a master key, construct a
                  <code>DerivedKey</code> element with associated child
                  elements. The result may, as in the <code>EncryptedKey</code>
                  case, be a child of <code>ds:KeyInfo</code>, or it may exist
                  elsewhere.</p></li>
            </ol>
          </li>
          <li><p>Encrypt the data:</p>
            <ol>
              <li><p>Encrypt the octets using the algorithm and key.</p></li>
              <li>
                <p>Unless the <strong>decryptor</strong> will implicitly know the type of the
                  encrypted data, the <strong>encryptor</strong> <em class="rfc2119" title="SHOULD">SHOULD</em> set the
                  <code>Type</code> to indicate the intended interpretation of the cleartext
                  data. See <a class="sectionRef sec-ref" href="#sec-Type-Parameters">section 4.2 Well-known Type parameter values</a>
                  for known parameter values.</p>
                <p>If the data is a
                  simple octet sequence it <em class="rfc2119" title="MAY">MAY</em> be described with the
                  <code>MimeType</code> and <code>Encoding</code> attributes. For
                  example, the data might be an XML document
                  (<code>MimeType="text/xml"</code>), sequence of characters
                  (<code>MimeType="text/plain"</code>), or binary image data
                  (<code>MimeType="image/png</code>").</p>
              </li>
            </ol>
          </li>
          <li>Build the <code>EncryptedData</code> or
            <code>EncryptedKey</code> structure: 
            <p>An <code>EncryptedData</code> or <code>EncryptedKey</code> structure represents all of the
              information previously discussed including the type of the encrypted
              data, encryption algorithm, parameters, key, type of the encrypted data,
              etc.</p>
            <ol>
              <li>If the encrypted octet sequence obtained in step 2 is to be stored
                in the <code>CipherData</code> element within the
                <code>EncryptedData</code> or <code>EncryptedKey</code> element, then the base64 representation of the encrypted octet sequence is
                inserted as the content of a
                <code>CipherValue</code> element.</li>
              <li><p>If the encrypted octet sequence is stored externally to the
                  <code>EncryptedData</code> or <code>EncryptedKey</code> element, 
                  then  the URI and transforms (if
                  any) required for the Decryptor to retrieve the encrypted octet
                  sequence are described within a 
                  <code>CipherReference</code> element.</p>
              </li>
            </ol>
          </li>
        </ol>
      </section>
      <section id="sec-Processing-Decryption">
        <h3><span class="secno">4.4 </span>Decryption</h3>

        <p>For each <code>EncryptedData</code> or <code>EncryptedKey</code> to be decrypted,
          the <strong>decryptor</strong> <em class="rfc2119" title="MUST">MUST</em>:</p>
        <ol>
          <li>Determine the algorithm, parameters and key information to be used.
            This information may be obtained out-of-band, or determined according to
            a <code>ds:KeyInfo</code> element;
            see <a href="#sec-Extensions-to-KeyInfo" class="sectionRef sec-ref">section 3.5 Extensions to ds:KeyInfo Element</a>.
          </li>
          <li><p>Decrypt the data contained in the <code>CipherData</code> element. 
              </p><ol>
                <li><p>If a <code>CipherValue</code> child element is present, then the
                    associated text value is retrieved and base64 decoded so as to obtain
                    the encrypted octet sequence.</p></li>
                <li><p>If a <code>CipherReference</code> child element is present, the URI
                    and transforms (if any) are used to retrieve the encrypted octet
                    sequence.</p></li>
                <li><p>The encrypted octet sequence is decrypted using the
                    algorithm, parameters and key value already determined from step 1.</p></li>
              </ol>
          </li>
        </ol>
      </section>

      <section id="sec-Processing-XML">
        <h3><span class="secno">4.5 </span>XML Encryption</h3>

        <p>Encryption and decryption operations are operations on octets. The
          <strong>application</strong> is responsible for the marshalling XML such that
          it can be serialized into an octet sequence, encrypted, decrypted, and be of
          use to the recipient.</p>

        <p>For example, if the application wishes to canonicalize its data or
          encode/compress the data in an XML packaging format, the application needs to
          marshal the XML accordingly and identify the resulting type via the
          <code>EncryptedData</code> <code>Type</code> attribute. The likelihood of
          successful decryption and subsequent processing will be dependent on the
          recipient's support for the given type. Also, if the data is intended to be
          processed both before encryption and after decryption (e.g., XML Signature
          [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>] validation or an XSLT transform) the
          encrypting application must be careful to preserve information necessary for
          that process's success.</p>


        <p>The following sections contain specifications for decrypting, replacing,
          and serializing XML content (i.e., <code>Type</code> '<a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-element">element</a>' or
          element '<a href="http://www.w3.org/TR/2008/REC-xml-20081126/#NT-content">content</a>')
          using the [<cite><a class="bibref" href="#bib-XPATH">XPATH</a></cite>] data model. These sections are
          non-normative and <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> to implementers of this specification, but they
          may be normatively referenced by and be required by other specifications that
          require a consistent processing for applications, such as [<cite><a class="bibref" href="#bib-XMLENC-DECRYPT">XMLENC-DECRYPT</a></cite>].</p>

        <section id="sec-Decrypt-Imp">
          <h4><span class="secno">4.5.1 </span>A Decrypt
            Implementation (Non-normative)</h4>

          <p>Where <em>P</em> is the context in which the serialized XML should be
            parsed (a document node or element node) and <em>O</em> is the octet sequence
            representing UTF-8 encoded characters resulting from step 4.3 in  <a class="sectionRef sec-ref" href="#sec-Processing-Decryption">section 4.4 Decryption</a>. <em>Y</em>
            is node-set representing the decrypted content 
            obtained by the following steps:</p>
          <ol>
            <li>Let <em>C</em> be the <a class="def" id="def-parsing-context">parsing context</a>
              of a child of <em>P</em>, which consists of the following items: 
              <ul>
                <li>Prefix and namespace name of each namespace that is in scope for
                  <em>P</em>.</li>
                <li>Name and value of each general entity that is effective for the XML
                  document causing <em>P</em>.</li>
              </ul>
            </li>
            <li>Wrap the decrypted octet stream <em>O</em> in the context <em>C</em> as
              specified in <a class="sectionRef sec-ref" href="#sec-Text-Wrapping">section 4.5.4 Text Wrapping</a>.</li>
            <li>Parse the wrapped octet stream as described in <a class="link-sec" href="http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-ReferenceProcessingModel">The
                Reference Processing Model</a> (section 4.3.3.2) of [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>], resulting in a node-set.</li>
            <li><em>Y</em> is the node-set obtained by removing the root node, the
              wrapping element node, and its associated set of attribute and namespace
              nodes from the node-set obtained in Step 3.</li>
          </ol>

        </section>
        <section id="sec-Decrypt-Replace-Imp">
          <h4><span class="secno">4.5.2 </span>A Decrypt and Replace Implementation (Non-normative)</h4>

          <p>Where <em>X</em> is the [<cite><a class="bibref" href="#bib-XPATH">XPATH</a></cite>] node set
            corresponding to an XML document and <em>e</em> is an
            <code>EncryptedData</code> element node in <em>X</em>.</p>
          <ol>
            <li><em>Z</em> is an [<cite><a class="bibref" href="#bib-XPATH">XPATH</a></cite>] node-set that
              identical to X except where the element node <em>e</em> is an
              <code>EncryptedData</code> element type. In which case: 
              <ol>
                <li>Decrypt <em>e</em> in the context of its parent node as specified
                  in the <a class="sectionRef sec-ref" href="#sec-Decrypt-Imp">section 4.5.1 A Decrypt
            Implementation (Non-normative)</a>
                  yielding <em>Y</em>, an [<cite><a class="bibref" href="#bib-XPATH">XPATH</a></cite>] node set.</li> 
                <li>Include <em>Y</em> in place of <em>e</em> and its descendants in
                  <em>X</em>. Since [<cite><a class="bibref" href="#bib-XPATH">XPATH</a></cite>] does not define
                  methods of replacing node-sets from different documents, the result
                  <em class="rfc2119" title="MUST">MUST</em> be equivalent to replacing e with the octet stream resulting
                  from its decryption in the serialized form of <em>X</em> and
                  re-parsing the document. However, the actual method of performing this
                  operation is left to the implementor.</li>
              </ol>
            </li>
          </ol>

        </section>
        <section id="sec-Serializing-XML">
          <h4><span class="secno">4.5.3 </span>Serializing XML (Non-normative)</h4>

          <section id="sec-Default-Namespace-Considerations">
            <h5><span class="secno">4.5.3.1 </span>Default Namespace Considerations</h5>

            <p>In <a class="sectionRef sec-ref" href="#sec-Processing-Encryption">section 4.3 Encryption</a>
              (step 3.1), when serializing an XML fragment special 
              care <em class="rfc2119" title="SHOULD">SHOULD</em> be taken with respect to default namespaces. If the data will be
              subsequently decrypted in the context of a parent XML document then
              serialization can produce elements in the wrong namespace. Consider the
              following fragment of XML:</p>

            <div><div class="example"><div class="example-title"><span>Example 15</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;Document</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;ToBeEncrypted</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/Document&gt;</span></pre></div></div>

            <p>Serialization of the element <code>ToBeEncrypted</code> fragment via [<cite><a class="bibref" href="#bib-XML-C14N">XML-C14N</a></cite>] would result in the characters
              "<code>&lt;ToBeEncrypted&gt;&lt;/ToBeEncrypted&gt;</code>" as an octet
              stream. The resulting encrypted document would be:</p>

            <div><div class="example"><div class="example-title"><span>Example 16</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;Document</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"..."</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="com">&lt;!-- Containing the encrypted "&lt;ToBeEncrypted&gt;&lt;/ToBeEncrypted&gt;" --&gt;</span><span class="pln">
  </span><span class="tag">&lt;/EncryptedData&gt;</span><span class="pln">
</span><span class="tag">&lt;/Document&gt;</span></pre></div></div>

            <p>Decrypting and replacing the <code>EncryptedData</code> within this
              document would produce the following incorrect result:</p>

            <div><div class="example"><div class="example-title"><span>Example 17</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;Document</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;ToBeEncrypted/&gt;</span><span class="pln">
</span><span class="tag">&lt;/Document&gt;</span><span class="pln"> </span></pre></div></div>

            <p>This problem arises because most XML serializations assume that the
              serialized data will be parsed directly in a context where there is no
              default namespace declaration. Consequently, they do not redundantly declare
              the empty default namespace with an <code>xmlns=""</code>. If, however, the
              serialized data is parsed in a context where a default namespace declaration
              is in scope (e.g., the parsing context as described in <a class="sectionRef sec-ref" href="#sec-Decrypt-Imp">section 4.5.1 A Decrypt
            Implementation (Non-normative)</a>), then
              it may affect the interpretation of the serialized data.</p>

            <p>To solve this problem, a canonicalization algorithm <em class="rfc2119" title="MAY">MAY</em> be augmented as
              follows for use as an XML encryption serializer:</p>
            <ul>
              <li>A default namespace declaration with an empty value (i.e.,
                <code>xmlns=""</code>) <em class="rfc2119" title="SHOULD">SHOULD</em> be emitted where it would normally be
                suppressed by the canonicalization algorithm.</li>
            </ul>

            <p>While the result may not be in proper canonical form, this is harmless as
              the resulting octet stream will not be used directly in a
              [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>] signature value computation. 
              Returning to the preceding example with our new augmentation, the
              <code>ToBeEncrypted</code> element would be serialized as follows:</p>
            <pre>&lt;ToBeEncrypted xmlns=""&gt;&lt;/ToBeEncrypted&gt;</pre>

            <p>When processed in the context of the parent document, this serialized
              fragment will be parsed and interpreted correctly.</p>

            <p>This augmentation can be retroactively applied to an existing
              canonicalization implementation by canonicalizing each apex node and its
              descendants from the node set, inserting <code>xmlns=""</code> at the
              appropriate points, and concatenating the resulting octet streams.</p>
          </section>

          <section id="sec-XML-Attribute-Considerations">
            <h5><span class="secno">4.5.3.2 </span>XML Attribute Considerations</h5>

            <p>Similar attention between the relationship of a fragment and the context
              into which it is being inserted should be given to the <code>xml:base</code>,
              <code>xml:lang</code>, and <code>xml:space</code> attributes as mentioned in
              the <a class="link-sec" href="http://www.w3.org/TR/xml-exc-c14n/#sec-Considerations">Security
                Considerations</a> of [<cite><a class="bibref" href="#bib-XML-EXC-C14N">XML-EXC-C14N</a></cite>]. For
              example, if the element:</p>

            <div><div class="example"><div class="example-title"><span>Example 18</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;Bongo</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"example.xml"</span><span class="tag">/&gt;</span></pre></div></div>

            <p>is taken from a context and serialized with no <code>xml:base</code> [<cite><a class="bibref" href="#bib-XMLBASE">XMLBASE</a></cite>] attribute and parsed in the context of the
              element:</p>

            <div><div class="example"><div class="example-title"><span>Example 19</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;Baz</span><span class="pln"> </span><span class="atn">xml:base</span><span class="pun">=</span><span class="atv">"http://example.org/"</span><span class="tag">/&gt;</span></pre></div></div>

            <p>the result will be:</p>

            <div><div class="example"><div class="example-title"><span>Example 20</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;Baz</span><span class="pln"> </span><span class="atn">xml:base</span><span class="pun">=</span><span class="atv">"http://example.org/"</span><span class="tag">&gt;&lt;Bongo</span><span class="pln"> </span><span class="atn">href</span><span class="pun">=</span><span class="atv">"example.xml"</span><span class="tag">/&gt;&lt;/Baz&gt;</span></pre></div></div>


            <p><code>Bongo</code>'s <code>href</code> is subsequently interpreted as
              "<code>http://example.org/example.xml</code>". If this is not the correct
              URI, <code>Bongo</code> should have been serialized with its own
              <code>xml:base</code> attribute.</p>

            <p>Unfortunately, the recommendation that an empty value be emitted to
              divorce the default namespace of the fragment from the context into which it
              is being inserted cannot be made for <span>the attributes
                <code>xml:base</code>, and <code>xml:space</code>. (<a class="link-sec" href="http://www.w3.org/XML/xml-V10-2e-errata#E41">Error 41</a> of the <a href="http://www.w3.org/XML/xml-V10-2e-errata">XML 1.0 Second Edition
                  Specification Errata</a> clarifies that an empty string value of the
                attribute <code>xml:lang</code> <em>is</em> considered as if, "there is no
                language information available, just as if <code>xml:lang</code> had not been
                specified".)</span>The interpretation of an empty value for the
              <code>xml:base</code> or <code>xml:space</code> attributes is undefined or
              maintains the contextual value. Consequently, applications <em class="rfc2119" title="SHOULD">SHOULD</em> ensure (1)
              fragments that are to be encrypted are not dependent on XML attributes, or
              (2) if they are dependent and the resulting document is intended to be <a class="link-def" href="http://www.w3.org/TR/2008/REC-xml-20081126/#dt-valid">valid</a> [<cite><a class="bibref" href="#bib-XML10">XML10</a></cite>], the fragment's definition permits the presence of
              the attributes and that the attributes have non-empty values.</p>
          </section>
        </section>
        <section id="sec-Text-Wrapping" class="information">
          <h4><span class="secno">4.5.4 </span>Text Wrapping</h4>

          <p>This section specifies the process for wrapping text in a given parsing
            context. The process is based on the proposal by Richard Tobin [<cite><a class="bibref" href="#bib-Tobin">Tobin</a></cite>] for constructing the infoset [<cite><a class="bibref" href="#bib-XML-INFOSET">XML-INFOSET</a></cite>] of an external entity.</p>

          <p>The process consists of the following steps:</p>
          <ol>
            <li><p>If the parsing context contains any general entities, then emit a
                document type declaration that provides entity declarations.</p></li>
            <li><p>Emit a <code>dummy</code> element start-tag with namespace declaration
                attributes declaring all the namespaces in the parsing context.</p></li>
            <li><p>Emit the text.</p></li>
            <li><p>Emit a <code>dummy</code> element end-tag.</p></li>
          </ol>

          <p>In the above steps, the document type declaration and <code>dummy</code>
            element tags <em class="rfc2119" title="MUST">MUST</em> be encoded in UTF-8.</p>

          <p>Consider the following document containing an <code>EncryptedData</code>
            element:</p>

          <div><div class="example"><div class="example-title"><span>Example 21</span></div><pre class="example highlight prettyprint"><span class="dec">&lt;!DOCTYPE Document [
&lt;!ENTITY dsig "http://www.w3.org/2000/09/xmldsig#"&gt;</span><span class="pln">
]&gt;
</span><span class="tag">&lt;Document</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;foo:Body</span><span class="pln"> </span><span class="atn">xmlns:foo</span><span class="pun">=</span><span class="atv">"http://example.org/foo"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;EncryptedData</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
                   </span><span class="atn">Type</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#Element"</span><span class="tag">&gt;</span><span class="pln">
      ...
    </span><span class="tag">&lt;/EncryptedData&gt;</span><span class="pln"> 
  </span><span class="tag">&lt;/foo:Body&gt;</span><span class="pln">
</span><span class="tag">&lt;/Document&gt;</span></pre></div></div>

          <p>If the <code>EncryptedData</code> element is decrypted to
            the text "<code>&lt;One&gt;&lt;foo:Two/&gt;&lt;/One&gt;</code>", then the
            wrapped form is as follows:</p>

          <div><div class="example"><div class="example-title"><span>Example 22</span></div><pre class="example highlight prettyprint"><span class="dec">&lt;!DOCTYPE dummy [
&lt;!ENTITY dsig "http://www.w3.org/2000/09/xmldsig#"&gt;</span><span class="pln">
]&gt;
</span><span class="tag">&lt;dummy</span><span class="pln"> </span><span class="atn">xmlns</span><span class="pun">=</span><span class="atv">"http://example.org/"</span><span class="pln">
       </span><span class="atn">xmlns:foo</span><span class="pun">=</span><span class="atv">"http://example.org/foo"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;One&gt;</span><span class="pln">
    </span><span class="tag">&lt;foo:Two/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/One&gt;</span><span class="pln">
</span><span class="tag">&lt;/dummy&gt;</span></pre></div></div>

        </section>
      </section>
    </section>
    <section id="sec-Algorithms">
      <!--OddPage--><h2><span class="secno">5. </span>Algorithms</h2>

      <p>This section discusses algorithms used with the XML Encryption
        specification. Entries contain the identifier to be used as the value of the
        <code>Algorithm</code> attribute of the <code>EncryptionMethod</code> element
        or other element representing the role of the algorithm, a reference to the
        formal specification, definitions for the representation of keys and the
        results of cryptographic operations where applicable, and general
        applicability comments.</p>

      <section id="sec-AlgID">
        <h3><span class="secno">5.1 </span>Algorithm Identifiers and Implementation Requirements</h3>

        <p>All algorithms listed below have implicit parameters depending on their
          role. For example, the data to be encrypted or decrypted, keying material,
          and direction of operation (encrypting or decrypting) for encryption
          algorithms. Any explicit additional parameters to an algorithm appear as
          content elements within the element. Such parameter child elements have
          descriptive element names, which are frequently algorithm specific, and
          <em class="rfc2119" title="SHOULD">SHOULD</em> be in the same namespace as this XML Encryption specification, the XML
          Signature specification, or in an algorithm specific namespace. An example of
          such an explicit parameter could be a nonce (unique quantity) provided to a
          key agreement algorithm.</p>

        <p>This specification defines a set of algorithms, their URIs, and
          requirements for implementation. Levels of requirement specified, such as
          "<em class="rfc2119" title="REQUIRED">REQUIRED</em>" or "<em class="rfc2119" title="OPTIONAL">OPTIONAL</em>", refer to implementation, not use. Furthermore, the
          mechanism is extensible, and alternative algorithms may be used.</p>



        <section id="sec-Table-of-Algorithms">
          <h4><span class="secno">5.1.1 </span>Table of Algorithms</h4>

          <p>The table below lists the categories of algorithms. Within each category,
            a brief name, the level of implementation requirement, and an identifying URI
            are given for each algorithm.</p>
          <dl>
            <dt>Block Encryption</dt>
            <dd><ol>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> TRIPLEDES<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#tripledes-cbc">http://www.w3.org/2001/04/xmlenc#tripledes-cbc</a></li>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> AES-128<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#aes128-cbc">http://www.w3.org/2001/04/xmlenc#aes128-cbc</a></li>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> AES-256<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#aes256-cbc">http://www.w3.org/2001/04/xmlenc#aes256-cbc</a></li>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> AES128-GCM<br>
                  <a href="http://www.w3.org/2009/xmlenc11#aes128-gcm">http://www.w3.org/2009/xmlenc11#aes128-gcm</a></li>

                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> AES-192<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#aes192-cbc">http://www.w3.org/2001/04/xmlenc#aes192-cbc</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> AES192-GCM<br>
                  <a href="http://www.w3.org/2009/xmlenc11#aes192-gcm">http://www.w3.org/2009/xmlenc11#aes192-gcm</a></li>

                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> AES256-GCM<br>
                  <a href="http://www.w3.org/2009/xmlenc11#aes256-gcm">http://www.w3.org/2009/xmlenc11#aes256-gcm</a></li>
              </ol>
              <p>
                <strong id="cbc-warning">Note:</strong> Use
                of AES GCM is strongly recommended over any CBC block encryption
                algorithms as recent
                advances in cryptanalysis [<cite><a class="bibref" href="#bib-XMLENC-CBC-ATTACK">XMLENC-CBC-ATTACK</a></cite>][<cite><a class="bibref" href="#bib-XMLENC-CBC-ATTACK-COUNTERMEASURES">XMLENC-CBC-ATTACK-COUNTERMEASURES</a></cite>]
                have cast doubt on the ability of CBC block encryption algorithms to
                protect plain text when used with XML Encryption. Other mitigations
                should be considered when using CBC block encryption, such as
                conveying the encrypted data over a secure channel such as TLS.  The
                CBC block encryption algorithms that are listed as required remain
                so for backward compatibility.
              </p>
            </dd>
            <dt>Stream Encryption</dt>
            <dd><ol>
                <li>none<br>
                  Syntax and recommendations are given below to support user
                  specified algorithms.</li>
              </ol>
            </dd>
            <dt>Key Derivation</dt>
            <dd><ol>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> ConcatKDF<br>
                  <a href="http://www.w3.org/2009/xmlenc11#ConcatKDF">http://www.w3.org/2009/xmlenc11#ConcatKDF</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> PBKDF2<br>
                  <a href="http://www.w3.org/2009/xmlenc11#pbkdf2">http://www.w3.org/2009/xmlenc11#pbkdf2</a></li>
              </ol>
            </dd>
            <dt>Key Transport</dt>
            <dd><ol>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> RSA-OAEP (including MGF1 with SHA1)<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p">http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p</a></li>
                <li>Optional RSA-OAEP<br>
                  <a href="http://www.w3.org/2009/xmlenc11#rsa-oaep">http://www.w3.org/2009/xmlenc11#rsa-oaep</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> RSA-v1.5 (see <a href="#rsav15note">RSA-v1.5 security note</a>)<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#rsa-1_5">http://www.w3.org/2001/04/xmlenc#rsa-1_5</a></li>
              </ol>
            </dd>
            <dt>Key Agreement</dt>
            <dd><ol>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> Elliptic Curve Diffie-Hellman (Ephemeral-Static mode) <br>
                  <a href="http://www.w3.org/2009/xmlenc11#ECDH-ES">http://www.w3.org/2009/xmlenc11#ECDH-ES</a></li>

                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Diffie-Hellman Key Agreement (Ephemeral-Static mode) with Legacy Key Derivation Function<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#dh">http://www.w3.org/2001/04/xmlenc#dh</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Diffie-Hellman Key Agreement (Ephemeral-Static
                  mode) with explicit Key Derivation Functions<br>
                  <a href="http://www.w3.org/2009/xmlenc11#dh-es">http://www.w3.org/2009/xmlenc11#dh-es</a></li>

              </ol>
            </dd>
            <dt>Symmetric Key Wrap</dt>
            <dd><ol>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> TRIPLEDES KeyWrap<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#kw-tripledes">http://www.w3.org/2001/04/xmlenc#kw-tripledes</a></li>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> AES-128 KeyWrap<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#kw-aes128">http://www.w3.org/2001/04/xmlenc#kw-aes128</a></li>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> AES-256 KeyWrap<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#kw-aes256">http://www.w3.org/2001/04/xmlenc#kw-aes256</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> AES-192 KeyWrap<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#kw-aes192">http://www.w3.org/2001/04/xmlenc#kw-aes192</a></li>
                <!--                 <li>OPTIONAL AES-128-pad KeyWrap<br /> -->
                <!--                   <a -->
                                          <!--                      href="http://www.w3.org/2009/xmlenc11#kw-aes-128-pad">http://www.w3.org/2009/xmlenc11#kw-aes-128-pad</a></li> -->
                                          <!--                 <li>OPTIONAL AES-192-pad KeyWrap<br /> -->
                                          <!--                   <a -->
                                                                    <!--                      href="http://www.w3.org/2009/xmlenc11#kw-aes-192-pad">http://www.w3.org/2009/xmlenc11#kw-aes-192-pad</a></li> -->
                                                                    <!--                 <li>OPTIONAL AES-256-pad KeyWrap<br /> -->
                                                                    <!--                   <a -->
                                                                                              <!--                      href="http://www.w3.org/2009/xmlenc11#kw-aes-256-pad">http://www.w3.org/2009/xmlenc11#kw-aes-256-pad</a></li> -->
              </ol>
            </dd>
            <dt>Message Digest</dt>
            <dd><ol>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> SHA1 (<em>Use is DISCOURAGED</em>; see below).<br>
                  <a href="http://www.w3.org/2000/09/xmldsig#sha1">http://www.w3.org/2000/09/xmldsig#sha1</a></li>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> SHA256<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#sha256">http://www.w3.org/2001/04/xmlenc#sha256</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> SHA384<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#sha384">http://www.w3.org/2001/04/xmlenc#sha384</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> SHA512<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#sha512">http://www.w3.org/2001/04/xmlenc#sha512</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> RIPEMD-160<br>
                  <a href="http://www.w3.org/2001/04/xmlenc#ripemd160">http://www.w3.org/2001/04/xmlenc#ripemd160</a></li>
              </ol>
            </dd>
            <dt>Canonicalization</dt>
            <dd><ol>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Canonical XML 1.0 (omit comments)<br>
                  <a href="http://www.w3.org/TR/2001/REC-xml-c14n-20010315">http://www.w3.org/TR/2001/REC-xml-c14n-20010315</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Canonical XML 1.0 (with comments)<br>
                  <a href="http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments">http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Canonical XML 1.1 (omit comments)<br>
                  <a href="http://www.w3.org/2006/12/xml-c14n11">http://www.w3.org/2006/12/xml-c14n11</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Canonical XML 1.1 (with comments)<br>
                  <a href="http://www.w3.org/2006/12/xml-c14n11#WithComments">http://www.w3.org/2006/12/xml-c14n11#WithComments</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Exclusive XML Canonicalization 1.0 (omit comments)<br>
                  <a href="http://www.w3.org/2001/10/xml-exc-c14n#">http://www.w3.org/2001/10/xml-exc-c14n#</a></li>
                <li><em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Exclusive XML Canonicalization 1.0 (with comments)<br>
                  <a href="http://www.w3.org/2001/10/xml-exc-c14n#WithComments">http://www.w3.org/2001/10/xml-exc-c14n#WithComments</a></li>
              </ol>
            </dd>
            <dt>Encoding</dt>
            <dd><ol>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> base64 (<a href="#base64note">*note</a>)<br>
                  
                  <a href="http://www.w3.org/2000/09/xmldsig#base64">http://www.w3.org/2000/09/xmldsig#base64</a></li>
              </ol>
            </dd>
            <dt>Transforms</dt>
            <dd>
              <ol>
                <li><em class="rfc2119" title="REQUIRED">REQUIRED</em> base64 (<a href="#base64note">*note</a>)<br>
                  <a href="http://www.w3.org/2000/09/xmldsig#base64">http://www.w3.org/2000/09/xmldsig#base64</a></li>
              </ol>
            </dd>
          </dl>
          <div id="base64note">
            <p>*note:
              The same URI is used to identify base64 both in "encoding"
              context (e.g. when used with the <code>Encoding</code> attribute
              of an <code>EncryptedKey</code> element,
              see <a href="#sec-EncryptedType" class="sectionRef sec-ref">section 3.1 The EncryptedType Element</a>) as 
              well as in "transform" context (when identifying a base64
              transform for a <code>CipherReference</code>, see <a href="#sec-CipherReference" class="sectionRef sec-ref">section 3.3.1 The CipherReference Element</a>).</p> 
          </div>
        </section>
      </section>
      <section id="sec-Alg-Block">
        <h3><span class="secno">5.2 </span>Block Encryption Algorithms</h3>

        <p>Block encryption algorithms are designed for encrypting and decrypting
          data in fixed size, multiple octet blocks. Their identifiers appear as the
          value of the <code>Algorithm</code> attributes of
          <code>EncryptionMethod</code> elements that are children of
          <code>EncryptedData</code>.</p>
        <p>
          <strong>Note</strong>: CBC block encryption algorithms should not be used without
          consideration of <a href="#cbc-warning">possibly severe
            security risks</a>. 
        </p>
        <p>Block encryption algorithms take, as implicit arguments, the data to be
          encrypted or decrypted, the keying material, and their direction of
          operation. For all of these algorithms specified below, an initialization
          vector (IV) is required that is encoded with the cipher text. For user
          specified block encryption algorithms, the IV, if any, could be specified as
          being with the cipher data, as an algorithm content element, or elsewhere.</p>

        <p>The IV is encoded with and before the cipher text for the algorithms below
          for ease of availability to the decryption code and to emphasize its
          association with the cipher text. Good cryptographic practice requires that a
          different IV be used for every encryption.</p>

        <section id="sec-Padding">
          <h4><span class="secno">5.2.1 </span>Padding</h4>

          <p>Since the data being encrypted is an arbitrary number of octets, it may
            not be a multiple of the block size. This is solved by padding the plain text
            up to the block size before encryption and unpadding after decryption. The
            padding algorithm is to calculate the smallest non-zero number of octets, say
            <code>N</code>, that must be suffixed to the plain text to bring it up to a
            multiple of the block size. We will assume the block size is <code>B</code>
            octets so <code>N</code> is in the range of 1 to <code>B</code>. Pad by
            suffixing the plain text with <code>N-1</code> arbitrary pad bytes and a
            final byte whose value is <code>N</code>. On decryption, just take the last
            byte and, after sanity checking it, strip that many bytes from the end of the
            decrypted cipher text.</p>

          <p>For example, assume an 8 byte block size and plain text of
            <code>0x616263</code>. The padded plain text would then be
            <code>0x616263????????05</code> where the "??" bytes can be any value.
            Similarly, plain text of <code>0x2122232425262728</code> would be padded to
            <code>0x2122232425262728??????????????08</code>.</p>

        </section>
        <section id="sec-tripledes-cbc">
          <h4><span class="secno">5.2.2 </span>Triple DES</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="tripledes-cbc" href="http://www.w3.org/2001/04/xmlenc#tripledes-cbc">http://www.w3.org/2001/04/xmlenc#tripledes-cbc</a>
            </dd>
          </dl>

          <p>NIST SP800-67 [<cite><a class="bibref" href="#bib-SP800-67">SP800-67</a></cite>] specifies three
            sequential FIPS 46-3 [<cite><a class="bibref" href="#bib-DES">DES</a></cite>] operations. The XML
            Encryption TRIPLEDES consists of a DES encrypt, a DES decrypt, and a DES
            encrypt used in the Cipher Block Chaining (CBC) mode with 192 bits of key and
            a 64 bit Initialization Vector (IV). Of the key bits, the first 64 are used
            in the first DES operation, the second 64 bits in the middle DES operation,
            and the third 64 bits in the last DES operation.</p>

          <p>Note: Each of these 64 bits of key contain 56 effective bits and 8 parity
            bits. Thus there are only 168 operational bits out of the 192 being
            transported for a TRIPLEDES key. (Depending on the criterion used for
            analysis, the effective strength of the key may be thought to be 112 bits
            (due to meet in the middle attacks) or even less.)</p>

          <p>The resulting cipher text is prefixed by the IV. If included in XML
            output, it is then base64 encoded. An example TRIPLEDES EncryptionMethod is
            as follows:</p>

          <div><div class="example"><div class="example-title"><span>Example 23</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#tripledes-cbc"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>

          <p>
            <strong>Note</strong>: CBC block encryption algorithms should not be used without
            consideration of <a href="#cbc-warning">possibly severe
              security risks</a>. 
          </p>
        </section>
        <section id="sec-AES">
          <h4><span class="secno">5.2.3 </span>AES</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="aes128-cbc" href="http://www.w3.org/2001/04/xmlenc#aes128-cbc">http://www.w3.org/2001/04/xmlenc#aes128-cbc</a>
            </dd>
            <dd><a id="aes192-cbc" href="http://www.w3.org/2001/04/xmlenc#aes192-cbc">http://www.w3.org/2001/04/xmlenc#aes192-cbc</a>
            </dd>
            <dd><a id="aes256-cbc" href="http://www.w3.org/2001/04/xmlenc#aes256-cbc">http://www.w3.org/2001/04/xmlenc#aes256-cbc</a>
            </dd>
          </dl>

          <p>[<cite><a class="bibref" href="#bib-AES">AES</a></cite>] is used in the Cipher Block Chaining (CBC)
            mode with a 128 bit initialization vector (IV). The resulting cipher text is
            prefixed by the IV. If included in XML output, it is then base64 encoded. An
            example AES EncryptionMethod is as follows:</p>
          <div><div class="example"><div class="example-title"><span>Example 24</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#aes128-cbc"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>
          <p>
            <strong>Note</strong>: CBC block encryption algorithms should not be used without
            consideration of <a href="#cbc-warning">possibly severe
              security risks</a>. 
          </p>
        </section>
        <section id="sec-AES-GCM">
          <h4><span class="secno">5.2.4 </span>AES-GCM</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="aes128-gcm" href="http://www.w3.org/2009/xmlenc11#aes128-gcm">http://www.w3.org/2009/xmlenc11#aes128-gcm</a>
            </dd>
            <dd><a id="aes192-gcm" href="http://www.w3.org/2009/xmlenc11#aes192-gcm">http://www.w3.org/2009/xmlenc11#aes192-gcm</a> </dd>
            <dd><a id="aes256-gcm" href="http://www.w3.org/2009/xmlenc11#aes256-gcm">http://www.w3.org/2009/xmlenc11#aes256-gcm</a>
            </dd>
          </dl>
          <p>
            AES-GCM [<cite><a class="bibref" href="#bib-SP800-38D">SP800-38D</a></cite>] is an authenticated encryption mechanism. It is
            equivalent to doing these two operations in one step - AES
            encryption  followed by HMAC signing.</p>
          <p>AES-GCM is very attractive from a performance point of
            view because the cost of AES-GCM is similar to regular AES-CBC
            encryption, yet it achieves the same result as encryption and HMAC
            signing. Also AES-GCM can be pipelined so it is amenable to
            hardware acceleration.
          </p>
          <p>For the purposes of this specification, AES-GCM shall be used with a
            96 bit Initialization Vector (IV) and a 128 bit Authentication Tag
            (T). The cipher text contains the IV first, followed by the encrypted
            octets and finally the Authentication tag. No padding should be used
            during encryption. During decryption the implementation should compare
            the authentication tag computed during decryption with the specified
            Authentication Tag, and fail if they don't match. For details on the
            implementation of AES-GCM, see [<cite><a class="bibref" href="#bib-SP800-38D">SP800-38D</a></cite>]. 
          </p>
        </section>
      </section>
      <section id="sec-Alg-Stream">
        <h3><span class="secno">5.3 </span>Stream Encryption Algorithms</h3>

        <p>Simple stream encryption algorithms generate, based on the key, a stream
          of bytes which are XORed with the plain text data bytes to produce the cipher
          text on encryption and with the cipher text bytes to produce plain text on
          decryption. They are normally used for the encryption of data and are
          specified by the value of the <code>Algorithm</code> attribute of the
          <code>EncryptionMethod</code> child of an <code>EncryptedData</code>
          element.</p>

        <p>NOTE: It is critical that each simple stream encryption key (or key and
          initialization vector (IV) if an IV is also used) be used once only. If the
          same key (or key and IV) is ever used on two messages then, by XORing the two
          cipher texts, you can obtain the XOR of the two plain texts. This is usually
          very compromising.</p>

        <p>No specific stream encryption algorithms are specified herein but this
          section is included to provide general guidelines.</p>

        <p>Stream algorithms typically use the optional <code>KeySize</code> explicit
          parameter. In cases where the key size is not apparent from the algorithm URI
          or key source, as in the use of key agreement methods, this parameter sets
          the key size. If the size of the key to be used is apparent and disagrees
          with the <code>KeySize</code> parameter, an error <em class="rfc2119" title="MUST">MUST</em> be returned.
          Implementation of any stream algorithms is optional. The schema for the
          KeySize parameter is as follows:</p>
        <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;simpleType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"KeySizeType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;restriction</span><span class="pln"> </span><span class="atn">base</span><span class="pun">=</span><span class="atv">"integer"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/simpleType&gt;</span></pre></div>
      </section>

      <section id="sec-Alg-KeyDerivation">
        <h3><span class="secno">5.4 </span>Key Derivation</h3>

        <p>
          Key derivation is a well-established mechanism for generating new
          cryptographic key material from some existing, original ("master")
          key material and potentially other information. Derived keys are
          used for a variety of purposes including data encryption and message
          authentication. The reason for doing key derivation itself is
          typically a combination of a desire to expand a given, but limited,
          set of original key material and prudent security practices of
          limiting use (exposure) of such key material. Key separation (such as
          avoiding use of the same key material for multiple purposes) is an
          example of such practices.
        </p>
        <p>
          The key derivation process may be based on passphrases agreed upon
          or remembered by users, or it can be based on some shared "master"
          cryptographic keys (and be intended to reduce exposure of such master
          keys), etc. Derived keys themselves may be used in XML Signature and
          XML Encryption as any other keys; in particular, they may be used to
          compute message authentication codes (e.g. digital signatures using
          symmetric keys) or for encryption/decryption purposes.
        </p>

        <section id="sec-ConcatKDF">
          <h4><span class="secno">5.4.1 </span>ConcatKDF</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="ConcatKDF" href="http://www.w3.org/2009/xmlenc11#ConcatKDF">http://www.w3.org/2009/xmlenc11#ConcatKDF</a>
            </dd>
          </dl>

          <p>The ConcatKDF key derivation algorithm, defined in Section 5.8.1 of NIST
            SP 800-56A [<cite><a class="bibref" href="#bib-SP800-56A">SP800-56A</a></cite>] (and equivalent to
            the KDF3 function defined in ANSI X9.44-2007 [<cite><a class="bibref" href="#bib-ANSI-X9-44-2007">ANSI-X9-44-2007</a></cite>] when
            the contents of the 
            <code>OtherInfo</code> parameter is structured as in NIST SP 800-56A),
            takes several parameters. These parameters are represented in the
            <code>xenc11:ConcatKDFParamsType</code>:
          </p>
          <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="com">&lt;!-- targetNamespace=&amp;#x27;http://www.w3.org/2009/xmlenc11#&amp;#x27; --&gt;</span><span class="pln">

</span><span class="com">&lt;!-- use this element type as a child of xenc11:KeyDerivationMethod
     when used with ConcatKDF --&gt;</span><span class="pln"> 
</span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"ConcatKDFParams"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc11:ConcatKDFParamsType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"ConcatKDFParamsType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">ref</span><span class="pun">=</span><span class="atv">"ds:DigestMethod"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"AlgorithmID"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"hexBinary"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"PartyUInfo"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"hexBinary"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"PartyVInfo"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"hexBinary"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"SuppPubInfo"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"hexBinary"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"SuppPrivInfo"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"hexBinary"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">
</span></pre></div>

          <p>
            The <code>ds:DigestMethod</code> element identifies the digest
            algorithm used by the KDF. Compliant implementations <em class="rfc2119" title="MUST">MUST</em> support
            SHA-256 and SHA-1 (support for SHA-1 is present only for
            backwards-compatibility reasons). Support for SHA-384 and SHA-512 is
            <em class="rfc2119" title="OPTIONAL">OPTIONAL</em>.
          </p>

          <p>
            The <code>AlgorithmID</code>, <code>PartyUInfo</code>,
            <code>PartyVInfo</code>, <code>SuppPubInfo</code> and
            <code>SuppPrivInfo</code> attributes are as defined in
            [<cite><a class="bibref" href="#bib-SP800-56A">SP800-56A</a></cite>]. Their 
            presence is optional but <code>AlgorithmID</code>,
            <code>PartyVInfo</code> and <code>PartyUInfo</code> <em class="rfc2119" title="MUST">MUST</em> be present
            for applications that need to comply with [<cite><a class="bibref" href="#bib-SP800-56A">SP800-56A</a></cite>].
            Note: The <code>PartyUInfo</code> component shall include a nonce when
            ConcatKDF is 
            used in conjunction with a static-static Diffie-Hellman (or 
            static-static ECDH) key agreement scheme; see further [<cite><a class="bibref" href="#bib-SP800-56A">SP800-56A</a></cite>].  
          </p>

          <p>
            In [<cite><a class="bibref" href="#bib-SP800-56A">SP800-56A</a></cite>], <code>AlgorithmID</code>, <code>PartyUInfo</code>, <code>PartyVInfo</code>, <code>SuppPubInfo</code>
            and
            <code>SuppPrivInfo</code> attributes are all defined as
            arbitrary-length bitstrings, thus they may need to be padded in order
            to be encoded into hexBinary for XML Encryption.  The following
            padding and encoding method <em class="rfc2119" title="MUST">MUST</em> be used when encoding bitstring
            values for the <code>AlgorithmID</code>, <code>PartyUInfo</code>,
            <code>PartyVInfo</code>, <code>SuppPubInfo</code> and
            <code>SuppPrivInfo</code>:
          </p>

          <ol>
            <li><p>
                The bitstring is divided into octets using big-endian encoding.  If
                the length of the bitstring is not a multiple of 8 then add padding
                bits (value 0) as necessary to the last octet to make it a multiple of
                8.</p>
            </li>
            <li><p>
                Prepend one octet to the octets string from step 1. This octet shall
                identify (in a big-endian representation) the number of padding bits
                added to the last octet in step 1.</p>
            </li>
            <li><p>
                Encode the octet string resulting from step 2 as a hexBinary string.</p>
            </li>
          </ol>

          <p>
            Example: the bitstring <code>11011</code>, which is 5 bits long, gets
            3 additional padding bits to become the
            bitstring <code>11011000</code> (or <code>D8</code> in hex).  This
            bitstring is then prepended with one octet identifying the number of
            padding bits to become the octet string (in hex) <code>03D8</code>, which then
            finally is encoded as a hexBinary string value of "03D8".
          </p>

          <p>
            Note that as specified in [<cite><a class="bibref" href="#bib-SP800-56A">SP800-56A</a></cite>],
            these attributes shall be concatenated to form a bit string
            “OtherInfo” that is used with the key derivation function. The
            concatenation <em class="rfc2119" title="SHALL">SHALL</em> be done using the original, unpadded bit string
            values.”  Applications <em class="rfc2119" title="MUST">MUST</em> also verify that these attributes, in an
            application-specific way not defined in this document, identify
            algorithms and parties in accordance with NIST SP800-56.
          </p>



          <p>
            An example of an <code>xenc11:DerivedKey</code> element with this key
            derivation algorithm given below.  In this example, the bitstring
            value of <code>AlgorithmID</code> is <code>00000000</code>, the
            bitstring value of <code>PartyUInfo</code> is <code>11011</code> and
            the bitstring value of <code>PartyVInfo</code> is <code>11010</code>:
          </p>

          <div><div class="example"><div class="example-title"><span>Example 25</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;xenc11:DerivedKey</span><span class="pln">
    </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
    </span><span class="atn">xmlns:ds</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pln">
    </span><span class="atn">xmlns:xenc</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
    </span><span class="atn">xmlns:xenc11</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc11:KeyDerivationMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#ConcatKDF"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc11:ConcatKDFParams</span><span class="pln"> </span><span class="atn">AlgorithmID</span><span class="pun">=</span><span class="atv">"0000"</span><span class="pln"> </span><span class="atn">PartyUInfo</span><span class="pun">=</span><span class="atv">"03D8"</span><span class="pln"> </span><span class="atn">PartyVInfo</span><span class="pun">=</span><span class="atv">"03D0"</span><span class="tag">&gt;</span><span class="pln"> 
      </span><span class="tag">&lt;ds:DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#sha256"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/xenc11:ConcatKDFParams&gt;</span><span class="pln">
  </span><span class="tag">&lt;/xenc11:KeyDerivationMethod&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc:ReferenceList&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc:DataReference</span><span class="pln"> </span><span class="atn">URI</span><span class="pun">=</span><span class="atv">"#ED"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/xenc:ReferenceList&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc11:MasterKeyName&gt;</span><span class="pln">Our other secret</span><span class="tag">&lt;/xenc11:MasterKeyName&gt;</span><span class="pln">
</span><span class="tag">&lt;/xenc11:DerivedKey&gt;</span></pre></div></div>
          <div class="note"><div class="note-title"><span>Note</span></div><div class="">
            While any bit string can be used with ConcatKDF, it is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> to keep byte
            aligned for greatest interoperability.
          </div></div> 
        </section>
        <section id="sec-PBKDF2">
          <h4><span class="secno">5.4.2 </span>PBKDF2</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="PBKDF2" href="http://www.w3.org/2009/xmlenc11#pbkdf2">http://www.w3.org/2009/xmlenc11#pbkdf2</a>
            </dd>
          </dl>
          <p>
            The PBKDF2 key derivation algorithm and the ASN.1 type definitions for
            its parameters are defined in PKCS #5 v2.0 [<cite><a class="bibref" href="#bib-PKCS5">PKCS5</a></cite>]. The XML schema
            definitions for the parameters is defined in [<cite><a class="bibref" href="#bib-PKCS5Amd1">PKCS5Amd1</a></cite>] and the same
            can be specified by enclosing them within an <code>xenc11:PBKDF2-params</code> child
            element of the <code>xenc11:KeyDerivationMethod</code> element.
          </p>
          <p>
            </p><div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"PBKDF2-params"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc11:PBKDF2ParameterType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"PBKDF2ParameterType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Salt"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;complexType&gt;</span><span class="pln">
        </span><span class="tag">&lt;choice&gt;</span><span class="pln">
          </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Specified"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"base64Binary"</span><span class="tag">/&gt;</span><span class="pln">
          </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"OtherSource"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc11:AlgorithmIdentifierType"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/choice&gt;</span><span class="pln">
      </span><span class="tag">&lt;/complexType&gt;</span><span class="pln">
    </span><span class="tag">&lt;/element&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"IterationCount"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"positiveInteger"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"KeyLength"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"positiveInteger"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"PRF"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc11:PRFAlgorithmIdentifierType"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"AlgorithmIdentifierType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Parameters"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyType"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Algorithm"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"PRFAlgorithmIdentifierType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;complexContent&gt;</span><span class="pln">
    </span><span class="tag">&lt;restriction</span><span class="pln"> </span><span class="atn">base</span><span class="pun">=</span><span class="atv">"xenc11:AlgorithmIdentifierType"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Algorithm"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/restriction&gt;</span><span class="pln">
  </span><span class="tag">&lt;/complexContent&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span><span class="pln">
</span></pre></div>
          <p>(Note: A newline has been added to the Algorithm attribute to fit on this page, but is not part of the URI.)</p>
          <p>
            The <code>PBKDF2-params</code> element and its child elements have the
            same names 
            and meaning as the corresponding components of
            the <code>PBKDF2-params</code> ASN.1 
            type in [<cite><a class="bibref" href="#bib-PKCS5">PKCS5</a></cite>]. Note, in case of ConcatKDF and the Diffie Hellman
            legacy KDF,  <code>KeyLength</code> is an implied parameter and needs to be
            inferred from the context, but in the case of PBKDF2
            the <code>KeyLength</code> child 
            element has to be specified, as it has been made a mandatory parameter
            to be consistent with PKCS5. For PBKDF2, the inferred key length must
            match the specified key length, otherwise it is an error condition.
          </p>
          <p>
            The <code>AlgorithmIdentifierType</code> corresponds to
            the <code>AlgorithmIdentifier</code> type of [<cite><a class="bibref" href="#bib-PKCS5">PKCS5</a></cite>] and carries the
            algorithm identifier in the <code>Algorithm</code> attribute. Algorithm
            specific parameters, where applicable, can be specified using
            the <code>Parameters</code> element.
          </p>
          <p>
            The <code>PRFAlgorithmIdentifierType</code> is derived from the
            <code>AlgorithmIdentifierType</code> and constrains the choice of
            algorithms to those contained in the PBKDF2-PRFs set defined in
            [<cite><a class="bibref" href="#bib-PKCS5">PKCS5</a></cite>]. This type is used to specify a pseudorandom function (PRF)
            for PBKDF2. Whereas HMAC-SHA1 is the default PRF algorithm in [<cite><a class="bibref" href="#bib-PKCS5">PKCS5</a></cite>],
            use of HMAC-SHA256 is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> by this specification (see [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>],
            [<cite><a class="bibref" href="#bib-HMAC">HMAC</a></cite>]).
          </p>
          <p>
            An example of an <code>xenc11:DerivedKey</code> element with this key
            derivation algorithm is:
          </p>
          <p>
            </p><div><div class="example"><div class="example-title"><span>Example 26</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;xenc11:DerivedKey</span><span class="pln">
    </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
    </span><span class="atn">xmlns:xenc</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
    </span><span class="atn">xmlns:xenc11</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc11:KeyDerivationMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#pbkdf2"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc11:PBKDF2-params&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc11:Salt&gt;</span><span class="pln">
      </span><span class="tag">&lt;xenc11:Specified&gt;</span><span class="pln">Df3dRAhjGh8=</span><span class="tag">&lt;/xenc11:Specified&gt;</span><span class="pln">
    </span><span class="tag">&lt;/xenc11:Salt&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc11:IterationCount&gt;</span><span class="pln">2000</span><span class="tag">&lt;/xenc11:IterationCount&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc11:KeyLength&gt;</span><span class="pln">16</span><span class="tag">&lt;/xenc11:KeyLength&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc11:PRF</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmldsig-more#hmac-sha256"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/xenc11:PBKDF2-params&gt;</span><span class="pln">
</span><span class="tag">&lt;/xenc11:KeyDerivationMethod&gt;</span><span class="pln">
</span><span class="tag">&lt;xenc:ReferenceList&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc:DataReference</span><span class="pln"> </span><span class="atn">URI</span><span class="pun">=</span><span class="atv">"#ED"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/xenc:ReferenceList&gt;</span><span class="pln">
</span><span class="tag">&lt;xenc11:MasterKeyName&gt;</span><span class="pln">Our shared secret</span><span class="tag">&lt;/xenc11:MasterKeyName&gt;</span><span class="pln">
</span><span class="tag">&lt;/xenc11:DerivedKey&gt;</span></pre></div></div>
        </section>
      </section>
      <section id="sec-Alg-KeyTransport">
        <h3><span class="secno">5.5 </span>Key Transport</h3>

        <p>Key Transport algorithms are public key encryption algorithms especially
          specified for encrypting and decrypting keys. Their identifiers appear as
          <code>Algorithm</code> attributes to <code>EncryptionMethod</code> elements
          that are children of <code>EncryptedKey</code>. <code>EncryptedKey</code> is
          in turn the child of a <code>ds:KeyInfo</code> element. The type of key being
          transported, that is to say the algorithm in which it is planned to use the
          transported key, is given by the <code>Algorithm</code> attribute of the
          <code>EncryptionMethod</code> child of the <code>EncryptedData</code> or
          <code>EncryptedKey</code> parent of this <code>ds:KeyInfo</code> element.</p>

        <p>(Key Transport algorithms may optionally be used to encrypt data in which
          case they appear directly as the <code>Algorithm</code> attribute of an
          <code>EncryptionMethod</code> child of an <code>EncryptedData</code> element.
          Because they use public key algorithms directly, Key Transport algorithms are
          not efficient for the transport of any amounts of data significantly larger
          than symmetric keys.)</p>
        <section id="sec-RSA-1_5">
          <h4><span class="secno">5.5.1 </span>RSA Version 1.5</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="rsa-1_5" href="http://www.w3.org/2001/04/xmlenc#rsa-1_5">http://www.w3.org/2001/04/xmlenc#rsa-1_5</a>
            </dd>
          </dl>

          <p>The RSAES-PKCS1-v1_5 algorithm, specified in RFC 3447 [<cite><a class="bibref" href="#bib-PKCS1">PKCS1</a></cite>], takes no explicit parameters. An example of an
            RSA Version 1.5 <code>EncryptionMethod</code> element is:</p>

          <div><div class="example"><div class="example-title"><span>Example 27</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#rsa-1_5"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>

          <p>The <code>CipherValue</code> for such an encrypted key is the base64 [<cite><a class="bibref" href="#bib-RFC2045">RFC2045</a></cite>] encoding of the octet string computed as per RFC
            3447 [<cite><a class="bibref" href="#bib-PKCS1">PKCS1</a></cite>], section 7.2.1: Encryption operation].
            As specified in the EME-PKCS1-v1_5 function RFC 3447 [<cite><a class="bibref" href="#bib-PKCS1">PKCS1</a></cite>],
            section 7.2.1, the value input to the key 
            transport function is as follows:</p>
          <div class="example"><div class="example-title"><span>Example 28</span></div><pre class="example highlight prettyprint"><span class="pln">CRYPT </span><span class="pun">(</span><span class="pln"> PAD </span><span class="pun">(</span><span class="pln"> KEY </span><span class="pun">))</span></pre></div>

          <p>where the padding is of the following special form:</p>
          <div class="example"><div class="example-title"><span>Example 29</span></div><pre class="example highlight prettyprint"><span class="lit">02</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> PS</span><span class="pun">*</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="lit">00</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> key</span></pre></div>

          <p>where "|" is concatenation, "02" and "00" are fixed octets of the
            corresponding hexadecimal value, PS is a string of strong pseudo-random
            octets [<cite><a class="bibref" href="#bib-RANDOM">RANDOM</a></cite>] at least eight octets long,
            containing no zero octets, and long enough that the value of the quantity
            being CRYPTed is one octet shorter than the RSA modulus, and "key" is the key
            being transported. The key is 192 bits for TRIPLEDES and 128, 192, or 256
            bits for AES.</p>
          <p>Implementations <em class="rfc2119" title="MUST">MUST</em> support this key transport algorithm for transporting 192-bit TRIPLEDES keys. Support of this algorithm for
            transporting other keys is <em class="rfc2119" title="OPTIONAL">OPTIONAL</em>. RSA-OAEP is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> for the
            transport of AES keys.</p>

          <p>The resulting base64 [<cite><a class="bibref" href="#bib-RFC2045">RFC2045</a></cite>] string is the value of
            the child text node of the <code>CipherData</code> element, e.g.</p>

          <div><div class="example"><div class="example-title"><span>Example 30</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;CipherData&gt;</span><span class="pln">
  </span><span class="tag">&lt;CipherValue&gt;</span><span class="pln">IWijxQjUrcXBYoCei4QxjWo9Kg8D3p9tlWoT4
t0/gyTE96639In0FZFY2/rvP+/bMJ01EArmKZsR5VW3rwoPxw=</span><span class="tag">&lt;/CipherValue&gt;</span><span class="pln">
</span><span class="tag">&lt;/CipherData&gt;</span></pre></div></div>

          (Note: A newline has been added to the <code>CipherValue</code>
          to fit on this page, but is not part of value.) 
          <div id="rsav15note">
            <p>Note: Implementation of RSA v1.5 is <em class="rfc2119" title="NOT RECOMMENDED">NOT RECOMMENDED</em> due
              to security risks associated with the algorithm.</p> 
          </div>
        </section>
        <section id="sec-RSA-OAEP">
          <h4><span class="secno">5.5.2 </span>RSA-OAEP</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="rsa-oaep-mgf1p" href="http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p">http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p</a>
              (including <code>MGF1 with SHA1</code> mask generation function)</dd>
            <dt>Identifier:</dt>
            <dd><a id="rsa-oaep" href="http://www.w3.org/2009/xmlenc11#rsa-oaep">http://www.w3.org/2009/xmlenc11#rsa-oaep</a></dd>
          </dl>
          <p>
            The RSAES-OAEP-ENCRYPT algorithm, as specified in RFC 3447 [<cite><a class="bibref" href="#bib-PKCS1">PKCS1</a></cite>],
            has options that define the message digest function and mask
            generation function, as well as an optional <code>PSourceAlgorithm</code>
            parameter. Default values defined in RFC 3447 are <code>SHA1</code>
            for the message 
            digest and <code>MGF1 with SHA1</code> for the mask generation
            function. Both the 
            message digest and mask generation functions are used in the
            EME-OAEP-ENCODE operation as part of RSAES- OAEP-ENCRYPT. </p>
          <p>
            The http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p identifier defines
            the mask generation function as the fixed value of <code>MGF1 with
              SHA1</code>. In 
            this case the optional <code>xenc11:MGF</code> element of the
            <code>xenc:EncryptionMethod</code> element <em class="rfc2119" title="MUST NOT">MUST NOT</em> be provided. </p>
          <p>
            The http://www.w3.org/2009/xmlenc11#rsa-oaep identifier defines the
            mask generation function using the optional <code>xenc11:MGF</code>
            element of the <code>xenc:EncryptionMethod</code> element. If not present, the
            default of <code>MGF1 with SHA1</code> is to be used.</p>
          <p>The following URIs define the various mask generation function URI
            values that may be used. These correspond to the object identifiers
            defined in RFC 4055 [<cite><a class="bibref" href="#bib-RFC4055">RFC4055</a></cite>]: </p>
          <ul>
            <li>MGF1 with SHA1: http://www.w3.org/2009/xmlenc11#mgf1sha1</li>
            <li>MGF1 with SHA224: http://www.w3.org/2009/xmlenc11#mgf1sha224</li>
            <li>MGF1 with SHA256: http://www.w3.org/2009/xmlenc11#mgf1sha256</li>
            <li>MGF1 with SHA384: http://www.w3.org/2009/xmlenc11#mgf1sha384</li>
            <li>MGF1 with SHA512: http://www.w3.org/2009/xmlenc11#mgf1sha512</li>
          </ul>
          <p>Otherwise the two identifiers define the same usage of the RSA-OAEP
            algorithm, as follows. </p>
          <p>The message digest function <em class="rfc2119" title="SHOULD">SHOULD</em> be specified using the Algorithm
            attribute of the <code>ds:DigestMethod</code> child element 
            of the <code>xenc:EncryptionMethod</code> element. If it is not specified, the
            default value of <code>SHA1</code> is to be used. </p>
          <p>The optional RSA-OAEP <code>PSourceAlgorithm</code> parameter value <em class="rfc2119" title="MAY">MAY</em> be
            explicitly provided by placing the base64 encoded octets in the
            <code>xenc:OAEPparams</code> XML element. </p>
          <p>The XML Encryption 1.0 schema definition and description for
            the <code>EncryptionMethod</code> element is in  
            <a href="#sec-EncryptionMethod" class="sectionRef sec-ref">section 3.2 The EncryptionMethod Element</a>. The following
            shows the XML Encryption 1.1 addition for the MGF type:</p>

          <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"MGF"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc11:MGFType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"MGFType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;complexContent&gt;</span><span class="pln">
    </span><span class="tag">&lt;restriction</span><span class="pln"> </span><span class="atn">base</span><span class="pun">=</span><span class="atv">"xenc11:AlgorithmIdentifierType"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Algorithm"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"required"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/restriction&gt;</span><span class="pln">
  </span><span class="tag">&lt;/complexContent&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>

          <p>An example of an RSA-OAEP element is:</p>

          <div><div class="example"><div class="example-title"><span>Example 31</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;OAEPparams&gt;</span><span class="pln">9lWu3Q==</span><span class="tag">&lt;/OAEPparams&gt;</span><span class="pln">
  </span><span class="tag">&lt;ds:DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#sha1"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;EncryptionMethod&gt;</span></pre></div></div>

          <div class="example"><div class="example-title"><span>Example 32</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#rsa-oaep-mgf1p"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;OAEPparams&gt;</span><span class="pln">9lWu3Q==</span><span class="tag">&lt;/OAEPparams&gt;</span><span class="pln">
            </span><span class="tag">&lt;ds:DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#sha1"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;EncryptionMethod&gt;</span></pre></div>
          <p>Another example is:</p>
          <div><div class="example"><div class="example-title"><span>Example 33</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#rsa-oaep"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;OAEPparams&gt;</span><span class="pln">9lWu3Q==</span><span class="tag">&lt;/OAEPparams&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc11:MGF</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#MGF1withSHA1"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;ds:DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#sha1"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;EncryptionMethod&gt;</span></pre></div></div>

          <p>The <code>CipherValue</code> for an RSA-OAEP encrypted key is the base64
            [<cite><a class="bibref" href="#bib-RFC2045">RFC2045</a></cite>] encoding of the octet string computed as per
            RFC 3447 [<cite><a class="bibref" href="#bib-PKCS1">PKCS1</a></cite>], section 7.1.1: Encryption
            operation. As described in the EME-OAEP-ENCODE function RFC 3447
            [<cite><a class="bibref" href="#bib-PKCS1">PKCS1</a></cite>], section 7.1.1, the value input to the key 
            transport function is calculated using the message digest function and string
            specified in the <code>DigestMethod</code> and <code>OAEPparams</code>
            elements and using either the mask generator function specified with
            the <code>xenc11:MGF</code> element or the default <code>MGF1 with
              SHA1</code> specified in 
            RFC 3447. The desired output length for EME-OAEP-ENCODE is one byte shorter
            than the RSA modulus.</p>
          <p>The transported key size is 192 bits for TRIPLEDES and 128, 192, or 256
            bits for AES. Implementations <em class="rfc2119" title="MUST">MUST</em> implement RSA-OAEP for the transport of
            all key types and sizes that are mandatory to implement for symmetric 
            encryption. They <em class="rfc2119" title="MAY">MAY</em> implement RSA-OAEP for the transport of other
            keys.</p>
        </section>
      </section>
      <section id="sec-Alg-KeyAgreement">
        <h3><span class="secno">5.6 </span>Key Agreement</h3>

        <p>A Key Agreement algorithm provides for the derivation of a shared secret
          key based on a shared secret computed from certain types of compatible public
          keys from both the sender and the recipient. Information from the originator
          to determine the secret is indicated by an optional
          <code>OriginatorKeyInfo</code> parameter child of an
          <code>AgreementMethod</code> element while that associated with the recipient
          is indicated by an optional <code>RecipientKeyInfo</code>. A shared key is
          derived from this shared secret by a method determined by the Key Agreement
          algorithm.</p>

        <p>Note: XML Encryption does not provide an online key agreement negotiation
          protocol. The <code>AgreementMethod</code> element can be used by the
          originator to identify the keys and computational procedure that were used to
          obtain a shared encryption key. The method used to obtain or select the keys
          or algorithm used for the agreement computation is beyond the scope of this
          specification.</p>

        <p>The <code>AgreementMethod</code> element appears as the content of a
          <code>ds:KeyInfo</code> since, like other <code>ds:KeyInfo</code> children,
          it yields a key. This <code>ds:KeyInfo</code> is in turn a child of an
          <code>EncryptedData</code> or <code>EncryptedKey</code> element. The
          <code>Algorithm</code> attribute and <code>KeySize</code> child of the
          <code>EncryptionMethod</code> element under this <code>EncryptedData</code>
          or <code>EncryptedKey</code> element are implicit parameters to the key
          agreement computation. In cases where this <code>EncryptionMethod</code>
          algorithm URI is insufficient to determine the key length, a
          <code>KeySize</code> <em class="rfc2119" title="MUST">MUST</em> have been included.
        </p>
        <p>
          Key derivation algorithms (with associated parameters) may be
          explicitly declared by using the
          <code>xenc11:KeyDerivationMethod</code> element. This element will
          then be placed at the extensibility point of the
          <code>xenc:AgreementMethodType</code> (see below).
        </p>
        <p>
          In addition, the sender may place a <code>KA-Nonce</code> element under
          <code>AgreementMethod</code> to assure that different keying material
          is generated even for repeated agreements using the same sender and
          recipient public keys. For example:</p> 

        <div><div class="example"><div class="example-title"><span>Example 34</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptedData&gt;</span><span class="pln">
  </span><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"Example:Block/Alg"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;KeySize&gt;</span><span class="pln">80</span><span class="tag">&lt;/KeySize&gt;</span><span class="pln">
  </span><span class="tag">&lt;/EncryptionMethod&gt;</span><span class="pln">
  </span><span class="tag">&lt;ds:KeyInfo</span><span class="pln"> </span><span class="atn">xmlns:ds</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;AgreementMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"example:Agreement/Algorithm"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;KA-Nonce&gt;</span><span class="pln">Zm9v</span><span class="tag">&lt;/KA-Nonce&gt;</span><span class="pln">
      </span><span class="tag">&lt;xenc11:KeyDerivationMethod</span><span class="pln">
          </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#ConcatKDF"</span><span class="tag">&gt;</span><span class="pln">
        </span><span class="tag">&lt;xenc11:ConcatKDFParams</span><span class="pln"> 
            </span><span class="atn">AlgorithmID</span><span class="pun">=</span><span class="atv">"00"</span><span class="pln"> </span><span class="atn">PartyUInfo</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="atn">PartyVInfo</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln"> 
          </span><span class="tag">&lt;ds:DigestMethod</span><span class="pln"> 
              </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#sha256"</span><span class="tag">/&gt;</span><span class="pln">
        </span><span class="tag">&lt;/xenc11:ConcatKDFParams&gt;</span><span class="pln">
      </span><span class="tag">&lt;/xenc11:KeyDerivationMethod&gt;</span><span class="pln">
          
      </span><span class="tag">&lt;OriginatorKeyInfo&gt;</span><span class="pln">
        </span><span class="tag">&lt;ds:KeyValue&gt;</span><span class="pln">....</span><span class="tag">&lt;/ds:KeyValue&gt;</span><span class="pln">
      </span><span class="tag">&lt;/OriginatorKeyInfo&gt;</span><span class="pln">
      </span><span class="tag">&lt;RecipientKeyInfo&gt;</span><span class="pln">
        </span><span class="tag">&lt;ds:KeyValue&gt;</span><span class="pln">....</span><span class="tag">&lt;/ds:KeyValue&gt;</span><span class="pln">
      </span><span class="tag">&lt;/RecipientKeyInfo&gt;</span><span class="pln"> 
    </span><span class="tag">&lt;/AgreementMethod&gt;</span><span class="pln">
  </span><span class="tag">&lt;/ds:KeyInfo&gt;</span><span class="pln">
  </span><span class="tag">&lt;CipherData&gt;</span><span class="pln">...</span><span class="tag">&lt;/CipherData&gt;</span><span class="pln">
</span><span class="tag">&lt;/EncryptedData&gt;</span></pre></div></div>

        <p>If the agreed key is being used to wrap a key, rather than data as above,
          then <code>AgreementMethod</code> would appear inside a
          <code>ds:KeyInfo</code> inside an <code>EncryptedKey</code> element.</p>

        <p>The Schema for <code>AgreementMethod</code> is as follows:</p>

        <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"AgreementMethod"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:AgreementMethodType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"AgreementMethodType"</span><span class="pln"> </span><span class="atn">mixed</span><span class="pun">=</span><span class="atv">"true"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"KA-Nonce"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"base64Binary"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="com">&lt;!-- &lt;element ref="ds:DigestMethod" minOccurs="0"/&gt; --&gt;</span><span class="pln">
    </span><span class="tag">&lt;any</span><span class="pln"> </span><span class="atn">namespace</span><span class="pun">=</span><span class="atv">"##other"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> </span><span class="atn">maxOccurs</span><span class="pun">=</span><span class="atv">"unbounded"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"OriginatorKeyInfo"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> 
             </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ds:KeyInfoType"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"RecipientKeyInfo"</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="pln"> 
             </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ds:KeyInfoType"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;attribute</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Algorithm"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"anyURI"</span><span class="pln"> </span><span class="atn">use</span><span class="pun">=</span><span class="atv">"required"</span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>

        <section id="sec-DHKeyValue">
          <h4><span class="secno">5.6.1 </span>Diffie-Hellman Key
            Values</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="DHKeyValue" href="http://www.w3.org/2001/04/xmlenc#DHKeyValue">http://www.w3.org/2001/04/xmlenc#DHKeyValue</a>
            </dd>
          </dl>

          <p>Diffie-Hellman keys can appear directly within <code>KeyValue</code>
            elements or be obtained by <code>ds:RetrievalMethod</code> fetches as well as
            appearing in certificates and the like. The above identifier can be used as
            the value of the <code>Type</code> attribute of <code>Reference</code> or
            <code>ds:RetrievalMethod</code> elements.</p>

          <p>As specified in [<cite><a class="bibref" href="#bib-ESDH">ESDH</a></cite>], a DH public key consists
            of up to six quantities, two large primes p and q, a "generator" g, the
            public key, and validation parameters "seed" and "pgenCounter". These relate
            as follows: The public key = ( g**x mod p ) where x is the corresponding
            private key; p = j*q + 1 where j &gt;= 2. "seed" and "pgenCounter" are
            optional and can be used to determine if the Diffie-Hellman key has been
            generated in conformance with the algorithm specified in [<cite><a class="bibref" href="#bib-ESDH">ESDH</a></cite>]. Because the primes and generator can be safely
            shared over many DH keys, they may be known from the application environment
            and are optional. The schema for a <code>DHKeyValue</code> is as follows:</p>
          <div><pre class="dtd highlight prettyprint"><span class="typ">Schema</span><span class="pln"> </span><span class="typ">Definition</span><span class="pun">:</span></pre><pre class="dtd highlight prettyprint"><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"DHKeyValue"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"xenc:DHKeyValueType"</span><span class="tag">/&gt;</span><span class="pln">

</span><span class="tag">&lt;complexType</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"DHKeyValueType"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;sequence</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"P"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ds:CryptoBinary"</span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Q"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ds:CryptoBinary"</span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Generator"</span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ds:CryptoBinary"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
    </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"Public"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ds:CryptoBinary"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;sequence</span><span class="pln"> </span><span class="atn">minOccurs</span><span class="pun">=</span><span class="atv">"0"</span><span class="tag">&gt;</span><span class="pln">
      </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"seed"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ds:CryptoBinary"</span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="tag">&lt;element</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"pgenCounter"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"ds:CryptoBinary"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
  </span><span class="tag">&lt;/sequence&gt;</span><span class="pln">
</span><span class="tag">&lt;/complexType&gt;</span></pre></div>

        </section>
        <section id="sec-DHKeyAgreement">
          <h4><span class="secno">5.6.2 </span>Diffie-Hellman
            Key Agreement</h4>

          <p>The Diffie-Hellman (DH) key agreement protocol [<cite><a class="bibref" href="#bib-ESDH">ESDH</a></cite>] involves the derivation of shared secret
            information based on compatible DH keys from the sender and recipient. Two DH
            public keys are compatible if they have the same prime and generator. If, for
            the second one, <code>Y = g**y mod p</code>, then the two parties can
            calculate the shared secret <code>ZZ = ( g**(x*y) mod p )</code> even though
            each knows only their own private key and the other party's public key.
            Leading zero bytes <em class="rfc2119" title="MUST">MUST</em> be maintained in <code>ZZ</code> so it will be the
            same length, in bytes, as <code>p</code>. The size of <code>p</code> <em class="rfc2119" title="MUST">MUST</em> be
            at least 512 bits and <code>g</code> at least 160 bits. There are numerous
            other complex security considerations in the selection of <code>g</code>,
            <code>p</code>, and a random <code>x</code> as described in [<cite><a class="bibref" href="#bib-ESDH">ESDH</a></cite>].</p>

          <p>The Diffie-Hellman shared secret <code>zz</code> is used as the input to a KDF to produce a
            secret key.  XML Signature 1.0 defined a 
            specific KDF to be used with Diffie-Hellman; that KDF is now known as the "Legacy KDF" and is defined in Section 5.6.2.2.  
            Use of Diffie-Hellman with explicit KDFs is described in Section 5.6.2.1.</p>

          <p>Implementation of Diffie-Hellman key agreement is <em class="rfc2119" title="OPTIONAL">OPTIONAL</em>.  However, if implemented, 
            such implementations <em class="rfc2119" title="MUST">MUST</em> support the Legacy Key Derivation Function
            and <em class="rfc2119" title="SHOULD">SHOULD</em> support Diffie-Hellman with explicit Key Derivation Functions</p>

          <p>An example of a DH
            <code>AgreementMethod</code> element using the Legacy Key Derivation Function 
            (Section 5.6.2.2) is as follows:</p>

          <div><div class="example"><div class="example-title"><span>Example 35</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;AgreementMethod</span><span class="pln">
    </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#dh"</span><span class="pln">
    </span><span class="atn">ds:xmlns</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;KA-Nonce&gt;</span><span class="pln">Zm9v</span><span class="tag">&lt;/KA-Nonce&gt;</span><span class="pln">
  </span><span class="tag">&lt;ds:DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#sha1"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;OriginatorKeyInfo&gt;</span><span class="pln">
    </span><span class="tag">&lt;ds:X509Data&gt;</span><span class="pln">
      </span><span class="tag">&lt;ds:X509Certificate&gt;</span><span class="pln">...</span><span class="tag">&lt;/ds:X509Certificate&gt;</span><span class="pln">
    </span><span class="tag">&lt;/ds:X509Data&gt;</span><span class="pln">
  </span><span class="tag">&lt;/OriginatorKeyInfo&gt;</span><span class="pln">
  </span><span class="tag">&lt;RecipientKeyInfo&gt;</span><span class="pln">
    </span><span class="tag">&lt;ds:KeyValue&gt;</span><span class="pln">...</span><span class="tag">&lt;/ds:KeyValue&gt;</span><span class="pln">
  </span><span class="tag">&lt;/RecipientKeyInfo&gt;</span><span class="pln">
</span><span class="tag">&lt;/AgreementMethod&gt;</span></pre></div></div>
          <p></p>
          <section id="sec-DHKeyAgreementExplicitKDF">
            <h5><span class="secno">5.6.2.1 </span>Diffie-Hellman Key Agreement with Explicit Key Derivation Functions</h5>

            <dl>
              <dt>Identifier:</dt>
              <dd><a id="dh-es" href="http://www.w3.org/2009/xmlenc11#dh-es">http://www.w3.org/2009/xmlenc11#dh-es</a> </dd>
            </dl>

            <p>It is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that the shared key material for a Diffie-Hellman key agreement be calculated from the Diffie-Hellman shared secret 
              using a key derivation function (KDF) in accordance with <a href="#sec-Alg-KeyDerivation">Section 5.4</a>.
            </p>

            <p>
              An example of a DH <code>AgreementMethod</code> element using an
              explicit key derivation function is as follows:
            </p>

            <div><div class="example"><div class="example-title"><span>Example 36</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;xenc:AgreementMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#dh-es"</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc11:KeyDerivationMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#ConcatKDF"</span><span class="tag">&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc11:ConcatKDFParams</span><span class="pln"> </span><span class="atn">AlgorithmID</span><span class="pun">=</span><span class="atv">"00"</span><span class="pln"> </span><span class="atn">PartyUInfo</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="atn">PartyVInfo</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln"> 
      </span><span class="tag">&lt;ds:DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#sha256"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/xenc11:ConcatKDFParams&gt;</span><span class="pln">
  </span><span class="tag">&lt;/xenc11:KeyDerivationMethod&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc:OriginatorKeyInfo&gt;</span><span class="pln">
    </span><span class="tag">&lt;ds:X509Data&gt;</span><span class="pln">
      </span><span class="tag">&lt;ds:X509Certificate&gt;</span><span class="com">&lt;!-- X.509 Certificate here --&gt;</span><span class="tag">&lt;/ds:X509Certificate&gt;</span><span class="pln">
    </span><span class="tag">&lt;/ds:X509Data&gt;</span><span class="pln">
  </span><span class="tag">&lt;/xenc:OriginatorKeyInfo&gt;</span><span class="pln">
  </span><span class="tag">&lt;xenc:RecipientKeyInfo&gt;</span><span class="pln">
    </span><span class="tag">&lt;ds:X509Data&gt;</span><span class="pln">
      </span><span class="tag">&lt;ds:X509SKI&gt;&lt;/ds:X509SKI&gt;</span><span class="pln">
      </span><span class="com">&lt;!-- hint for the recipient's private key --&gt;</span><span class="pln">
    </span><span class="tag">&lt;/ds:X509Data&gt;</span><span class="pln">
  </span><span class="tag">&lt;/xenc:RecipientKeyInfo&gt;</span><span class="pln">
</span><span class="tag">&lt;/xenc:AgreementMethod&gt;</span></pre></div></div>

          </section>
          <section id="sec-DHKeyAgreementLegacyKDF">
            <h5><span class="secno">5.6.2.2 </span>Diffie-Hellman Key Agreement with Legacy Key Derivation Function</h5>
            <dl>
              <dt>Identifier:</dt>
              <dd><a id="dh" href="http://www.w3.org/2001/04/xmlenc#dh">http://www.w3.org/2001/04/xmlenc#dh</a>
              </dd>
            </dl>

            <p>XML Signature 1.0 defined a specific KDF for use with Diffie-Hellman key agreement.  In order to guarantee interoperability, 
              implementations that choose to implement Diffie-Hellman <em class="rfc2119" title="MUST">MUST</em> support the use of the Diffie-Hellman Legacy KDF defined in this section.
            </p>

            <p>Assume that the Diffie-Hellman shared secret is the octet sequence
              <code>ZZ</code>. The Diffie-Hellman Legacy KDF calculates the shared keying material as follows:</p>
            <div class="example"><div class="example-title"><span>Example 37</span></div><pre class="example highlight prettyprint"><span class="typ">Keying</span><span class="pln"> </span><span class="typ">Material</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> KM</span><span class="pun">(</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> KM</span><span class="pun">(</span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="pun">...</span></pre></div>

            <p>where "|" is byte stream concatenation and</p>
            <div class="example"><div class="example-title"><span>Example 38</span></div><pre class="example highlight prettyprint"><span class="pln">KM</span><span class="pun">(</span><span class="pln">counter</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="typ">DigestAlg</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> ZZ </span><span class="pun">|</span><span class="pln"> counter </span><span class="pun">|</span><span class="pln"> </span><span class="typ">EncryptionAlg</span><span class="pln"> </span><span class="pun">|</span><span class="pln">
            KA</span><span class="pun">-</span><span class="typ">Nonce</span><span class="pln"> </span><span class="pun">|</span><span class="pln"> </span><span class="typ">KeySize</span><span class="pln"> </span><span class="pun">)</span></pre></div>
            <dl>
              <dt><code>DigestAlg</code></dt>
              <dd>The message digest algorithm specified by the
                <code>DigestMethod</code> child of <code>AgreementMethod</code>.</dd>
              <dt><code>EncryptionAlg</code></dt>
              <dd>The URI of the encryption algorithm, including possible key wrap
                algorithms, in which the derived keying material is to be used
                ("Example:Block/Alg" in the example above), not the URI of the
                agreement algorithm. This is the value of the <code>Algorithm</code>
                attribute of the <code>EncryptionMethod</code> child of the
                <code>EncryptedData</code> or <code>EncryptedKey</code> grandparent of
                <code>AgreementMethod</code>.</dd>
              <dt><code>KA-Nonce</code></dt>
              <dd>The base64 decoding the content of the <code>KA-Nonce</code> child of
                <code>AgreementMethod</code>, if present. If the <code>KA-Nonce</code>
                element is absent, it is null.</dd>
              <dt><code>Counter</code></dt>
              <dd>A one byte counter starting at one and incrementing by one. It is
                expressed as two hex digits where letters A through F are in upper
                case.</dd>
              <dt><code>KeySize</code></dt>
              <dd>The size in bits of the key to be derived from the shared secret as
                the UTF-8 string for the corresponding decimal integer with only digits
                in the string and no leading zeros. For some algorithms the key size is
                inherent in the URI. For others, such as most stream ciphers, it must
                be explicitly provided.</dd>
            </dl>

            <p>For example, the initial <code>(KM(1))</code> calculation for the
              <code>EncryptionMethod</code> of the <a href="#sec-Alg-KeyAgreement">Key
                Agreement</a> example (section 5.5) would be as follows, where the binary one
              byte counter value of 1 is represented by the two character UTF-8 sequence
              <code>01</code>, <code>ZZ</code> is the shared secret, and "<code>foo</code>"
              is the base64 decoding of "<code>Zm9v</code>".</p>
            <div class="example"><div class="example-title"><span>Example 39</span></div><pre class="example highlight prettyprint"><span class="pln">SHA</span><span class="pun">-</span><span class="lit">1</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> ZZ01Example</span><span class="pun">:</span><span class="typ">Block</span><span class="pun">/</span><span class="typ">Algfoo80</span><span class="pln"> </span><span class="pun">)</span></pre></div>

            <p>Assuming that <code>ZZ</code> is <code>0xDEADBEEF</code>, that would be</p>
            <div class="example"><div class="example-title"><span>Example 40</span></div><pre class="example highlight prettyprint"><span class="pln">SHA</span><span class="pun">-</span><span class="lit">1</span><span class="pun">(</span><span class="pln"> </span><span class="lit">0xDEADBEEF30314578616D706C653A426C6F636B2F416C67666F6F3830</span><span class="pln"> </span><span class="pun">)</span></pre></div>

            <p>whose value is</p>
            <div class="example"><div class="example-title"><span>Example 41</span></div><pre class="example highlight prettyprint"><span class="lit">0x534C9B8C4ABDCB50038B42015A181711068B08C1</span></pre></div>

            <p>Each application of <code>DigestAlg</code> for successive values of
              <code>Counter</code> will produce some additional number of bytes of keying
              material. From the concatenated string of one or more <code>KM</code>'s,
              enough leading bytes are taken to meet the need for an actual key and the
              remainder discarded. For example, if <code>DigestAlg</code> is SHA-1 which
              produces 20 octets of hash, then for 128 bit AES the first 16 bytes from
              <code>KM(1)</code> would be taken and the remaining 4 bytes discarded. For
              256 bit AES, all of <code>KM(1)</code> suffixed with the first 12 bytes of
              KM(2) would be taken and the remaining 8 bytes of <code>KM(2)</code>
              discarded.</p>

          </section>
        </section>
        <section id="sec-ECCKeyValue">
          <h4><span class="secno">5.6.3 </span>Elliptic Curve Diffie-Hellman (ECDH) Key
            Values</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="ECKeyValue" href="http://www.w3.org/2009/xmldsig11#ECKeyValue">http://www.w3.org/2009/xmldsig11#ECKeyValue</a>
            </dd>
          </dl>

          <p>ECDH has identical public key parameters as ECDSA and can be represented 
            with the <code>ECKeyValue</code> element [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>]. 
            Note that if the curve parameters are explicitly stated using the ECParameters 
            element, then the Cofactor element <em class="rfc2119" title="MUST">MUST</em> be included.</p>

          <p>As with Diffie-Hellman keys, Elliptic Curve Key Values can appear directly 
            within <code>KeyValue</code> elements or be obtained by 
            <code>ds:RetrievalMethod</code> fetches as well as appearing in certificates 
            and the like. The above identifier can be used as the value of the 
            <code>Type</code> attribute of <code>Reference</code> or
            <code>ds:RetrievalMethod</code> elements.</p>

        </section>
        <section id="sec-ECDH-ES">
          <h4><span class="secno">5.6.4 </span>Elliptic Curve Diffie-Hellman (ECDH)
            Key Agreement (Ephemeral-Static Mode)</h4>

          <dl>
            <dt>Identifier:</dt>
            <dd><a id="ECDH-ES" href="http://www.w3.org/2009/xmlenc11#ECDH-ES">http://www.w3.org/2009/xmlenc11#ECDH-ES</a> 
            </dd>
          </dl>

          <p>ECDH is the elliptic curve analogue to the Diffie-Hellman key agreement 
            algorithm. Details of the ECDH primitive can be found in
            [<cite><a class="bibref" href="#bib-ECC-ALGS">ECC-ALGS</a></cite>]. When ECDH is used in  
            Ephemeral-Static (ES) mode, the recipient has a static key pair, but the sender 
            generates a ephemeral key pair for each message. The same ephemeral key may be 
            used when there are multiple recipients that use the same curve parameters.</p>

          <p>Compliant implementations are <em class="rfc2119" title="REQUIRED">REQUIRED</em> to support ECDH-ES key agreement
            using the P-256 prime curve specified in Section D.2.3 of FIPS 186-3
            [<cite><a class="bibref" href="#bib-FIPS-186-3">FIPS-186-3</a></cite>]. (This is the same curve that
            is <em class="rfc2119" title="REQUIRED">REQUIRED</em> in XML Signature 1.1 to be supported for the ECDSAwithSHA256
            algorithm.) It is further <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that implementations also support
            the P-384 and P-521 prime curves for ECDH-ES; these curves are defined
            in Sections D.2.4 and D.2.5 of FIPS 186-3, respectively.</p>

          <p>The shared key material is calculated from the Diffie-Hellman shared secret 
            using a key derivation function (KDF). While applications may define other 
            KDFs, compliant implementations <em class="rfc2119" title="MUST">MUST</em> implement ConcatKDF (see <a href="#sec-ConcatKDF" class="sectionRef sec-ref">section 5.4.1 ConcatKDF</a>).
            An example of <code>xenc:EncryptedData</code> using the ECDH-ES key
            agreement algorithm with the ConcatKDF key derivation algorithm is as
            follows:</p>

          <div><div class="example"><div class="example-title"><span>Example 42</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;xenc:EncryptedData</span><span class="pln">
    </span><span class="atn">xmlns:xsi</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/XMLSchema-instance"</span><span class="pln">
    </span><span class="atn">xmlns:xenc</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="pln">
    </span><span class="atn">xmlns:ds</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#"</span><span class="pln">
    </span><span class="atn">xmlns:dsig11</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmldsig11#"</span><span class="pln">
    </span><span class="atn">xmlns:xenc11</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#"</span><span class="pln">
    </span><span class="atn">Type</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#"</span><span class="tag">&gt;</span><span class="pln">

  </span><span class="tag">&lt;xenc:EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#aes128-cbc"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="com">&lt;!-- describes the encrypted AES content encryption key --&gt;</span><span class="pln">
  </span><span class="tag">&lt;ds:KeyInfo&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc:EncryptedKey&gt;</span><span class="pln">
      </span><span class="tag">&lt;xenc:EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#kw-aes128"</span><span class="tag">/&gt;</span><span class="pln">
      </span><span class="com">&lt;!-- describes the key encryption key --&gt;</span><span class="pln">
      </span><span class="tag">&lt;ds:KeyInfo&gt;</span><span class="pln">
        </span><span class="tag">&lt;xenc:AgreementMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#ECDH-ES"</span><span class="tag">&gt;</span><span class="pln">
          </span><span class="tag">&lt;xenc11:KeyDerivationMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2009/xmlenc11#ConcatKDF"</span><span class="tag">&gt;</span><span class="pln">
            </span><span class="tag">&lt;xenc11:ConcatKDFParams</span><span class="pln"> </span><span class="atn">AlgorithmID</span><span class="pun">=</span><span class="atv">"00"</span><span class="pln"> </span><span class="atn">PartyUInfo</span><span class="pun">=</span><span class="atv">""</span><span class="pln"> </span><span class="atn">PartyVInfo</span><span class="pun">=</span><span class="atv">""</span><span class="tag">&gt;</span><span class="pln"> 
              </span><span class="tag">&lt;ds:DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#sha256"</span><span class="tag">/&gt;</span><span class="pln">
            </span><span class="tag">&lt;/xenc11:ConcatKDFParams&gt;</span><span class="pln">
          </span><span class="tag">&lt;/xenc11:KeyDerivationMethod&gt;</span><span class="pln">
          </span><span class="tag">&lt;xenc:OriginatorKeyInfo&gt;</span><span class="pln">
            </span><span class="tag">&lt;ds:KeyValue&gt;</span><span class="pln">
              </span><span class="tag">&lt;dsig11:ECKeyValue&gt;</span><span class="pln">
                </span><span class="com">&lt;!-- ephemeral ECC public key of the originator --&gt;</span><span class="pln">
              </span><span class="tag">&lt;/dsig11:ECKeyValue&gt;</span><span class="pln">
            </span><span class="tag">&lt;/ds:KeyValue&gt;</span><span class="pln">
          </span><span class="tag">&lt;/xenc:OriginatorKeyInfo&gt;</span><span class="pln">
          </span><span class="tag">&lt;xenc:RecipientKeyInfo&gt;</span><span class="pln">
            </span><span class="tag">&lt;ds:X509Data&gt;</span><span class="pln">
              </span><span class="tag">&lt;ds:X509SKI&gt;&lt;/ds:X509SKI&gt;</span><span class="pln">
              </span><span class="com">&lt;!-- hint for the recipient's private key --&gt;</span><span class="pln">
            </span><span class="tag">&lt;/ds:X509Data&gt;</span><span class="pln">
          </span><span class="tag">&lt;/xenc:RecipientKeyInfo&gt;</span><span class="pln">
        </span><span class="tag">&lt;/xenc:AgreementMethod&gt;</span><span class="pln">
      </span><span class="tag">&lt;/ds:KeyInfo&gt;</span><span class="pln">
      </span><span class="tag">&lt;xenc:CipherData&gt;</span><span class="pln">
        </span><span class="tag">&lt;xenc:CipherValue&gt;</span><span class="com">&lt;!-- encrypted AES content encryption key --&gt;</span><span class="tag">&lt;/xenc:CipherValue&gt;</span><span class="pln">
      </span><span class="tag">&lt;/xenc:CipherData&gt;</span><span class="pln">
    </span><span class="tag">&lt;/xenc:EncryptedKey&gt;</span><span class="pln">
  </span><span class="tag">&lt;/ds:KeyInfo&gt;</span><span class="pln">
  
  </span><span class="tag">&lt;xenc:CipherData&gt;</span><span class="pln">
    </span><span class="tag">&lt;xenc:CipherValue&gt;</span><span class="pln">
      </span><span class="com">&lt;!-- encrypted data --&gt;</span><span class="pln">
    </span><span class="tag">&lt;/xenc:CipherValue&gt;</span><span class="pln">
  </span><span class="tag">&lt;/xenc:CipherData&gt;</span><span class="pln">
  
</span><span class="tag">&lt;/xenc:EncryptedData&gt;</span></pre></div></div>
        </section>
      </section>

      <section id="sec-Alg-SymmetricKeyWrap">
        <h3><span class="secno">5.7 </span>Symmetric Key Wrap</h3>

        <p>
          Symmetric Key Wrap algorithms are shared secret key encryption  
          algorithms especially specified for encrypting and decrypting  
          symmetric keys.  When wrapped keys are used, then an <code>EncryptedKey</code>  
          element will appear as a child of a <code>ds:KeyInfo</code> element.  This  
          <code>EncryptedKey</code> element will have
          an <code>EncryptionMethod</code> child whose   
          <code>Algorithm</code> attribute in turn identifies the key wrap algorithm.
        </p>
        <p>
          The algorithm for which the encrypted key is intended depends on the  
          context of the <code>ds:KeyInfo</code>
          element:  <code>ds:KeyInfo</code> can occur as a child   
          of either an <code>EncryptedData</code> or <code>EncryptedKey</code>
          element; in both cases,   
          <code>ds:KeyInfo</code> will have an <code>EncryptionMethod</code> sibling that
          identifies the   
          algorithm.
        </p>
        <div><div class="example"><div class="example-title"><span>Example 43</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptedData</span><span class="pln"> |</span><span class="atn">EncryptedKey</span><span class="tag">&gt;</span><span class="pln">
  </span><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"@alg1"</span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;ds:KeyInfo&gt;</span><span class="pln">
    </span><span class="tag">&lt;EncryptedKey&gt;</span><span class="pln">
      </span><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"@alg2"</span><span class="tag">/&gt;</span><span class="pln">
    </span><span class="tag">&lt;/EncryptedKey&gt;</span><span class="pln">
  </span><span class="tag">&lt;/ds:KeyInfo&gt;</span><span class="pln">
</span><span class="tag">&lt;/EncryptedData</span><span class="pln"> |</span><span class="atn">EncryptedKey</span><span class="tag">&gt;</span></pre></div></div>
        <section id="sec-kw-tripledes">
          <h4><span class="secno">5.7.1 </span>CMS Triple DES Key Wrap</h4>
          <dl>
            <dt>Identifiers:</dt>
            <dd><a id="kw-tripledes" href="http://www.w3.org/2001/04/xmlenc#kw-tripledes">http://www.w3.org/2001/04/xmlenc#kw-tripledes</a>
            </dd>
          </dl>

          <p>XML Encryption implementations <em class="rfc2119" title="MUST">MUST</em> support TRIPLEDES wrapping of 168 bit
            keys as described in [<cite><a class="bibref" href="#bib-CMS-WRAP">CMS-WRAP</a></cite>] and may optionally support TRIPLEDES wrapping of other keys.</p>

          <p>An example of a TRIPLEDES Key Wrap <code>EncryptionMethod</code> element
            is as follows:</p>

          <div><div class="example"><div class="example-title"><span>Example 44</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;EncryptionMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#kw-tripledes"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>

        </section>
        <section id="sec-kw-aes">
          <h4><span class="secno">5.7.2 </span>AES KeyWrap</h4>
          <dl>
            <dt>Identifiers:</dt>
            <dd><a id="kw-aes128" href="http://www.w3.org/2001/04/xmlenc#kw-aes128">http://www.w3.org/2001/04/xmlenc#kw-aes128</a>
            </dd>
            <dd><a id="kw-aes192" href="http://www.w3.org/2001/04/xmlenc#kw-aes192">http://www.w3.org/2001/04/xmlenc#kw-aes192</a>
            </dd>
            <dd><a id="kw-aes256" href="http://www.w3.org/2001/04/xmlenc#kw-aes256">http://www.w3.org/2001/04/xmlenc#kw-aes256</a>
            </dd>
          </dl>

          <p>Implementation of AES key wrap is described in [<cite><a class="bibref" href="#bib-AES-WRAP">AES-WRAP</a></cite>].
            It provides for confidentiality and integrity. This algorithm is defined only
            for inputs which are a multiple of 64 bits. The information wrapped need not
            actually be a key. The algorithm is the same whatever the size of the AES key
            used in wrapping, called the key encrypting key or <code>KEK</code>. The
            implementation requirements are indicated below.</p>
          <dl>
            <dt>128 bit AES Key Encrypting Key</dt>
            <dd>Implementation of wrapping 128 bit keys <em class="rfc2119" title="REQUIRED">REQUIRED</em>.<br>
              Wrapping of other key sizes <em class="rfc2119" title="OPTIONAL">OPTIONAL</em>.</dd>
            <dt>192 bit AES Key Encrypting Key</dt>
            <dd>All support <em class="rfc2119" title="OPTIONAL">OPTIONAL</em>.</dd>
            <dt>256 bit AES Key Encrypting Key</dt>
            <dd>Implementation of wrapping 256 bit keys <em class="rfc2119" title="REQUIRED">REQUIRED</em>.<br>
              Wrapping of other key sizes <em class="rfc2119" title="OPTIONAL">OPTIONAL</em>.</dd>
          </dl>

        </section>
      </section>
      <section id="sec-Alg-MessageDigest">
        <h3><span class="secno">5.8 </span>Message Digest</h3>

        <p>Message digest algorithms can be used in
          <code>AgreementMethod</code> as part of the key derivation, within
          RSA-OAEP encryption as a hash function, and in connection with the
          HMAC message authentication code method [<cite><a class="bibref" href="#bib-HMAC">HMAC</a></cite>]
          as described in [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>].) Use of SHA-256 is strongly
          recommended over SHA-1 because recent advances in cryptanalysis (see
          e.g. [<cite><a class="bibref" href="#bib-SHA-1-Analysis">SHA-1-Analysis</a></cite>], [<cite><a class="bibref" href="#bib-SHA-1-Collisions">SHA-1-Collisions</a></cite>] )
          have cast doubt on the long-term collision resistance of SHA-1.
          Therefore, SHA-1 support is <em class="rfc2119" title="REQUIRED">REQUIRED</em> in this specification only for
          backwards-compatibility reasons.</p>

        <section id="sec-SHA1">
          <h4><span class="secno">5.8.1 </span>SHA1</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a href="http://www.w3.org/2000/09/xmldsig#sha1">http://www.w3.org/2000/09/xmldsig#sha1</a>
            </dd>
          </dl>

          <p>The SHA-1 algorithm [<cite><a class="bibref" href="#bib-FIPS-180-3">FIPS-180-3</a></cite>] takes no explicit
            parameters. An example of an SHA-1 <code>DigestMethod</code> element is:</p>
          <div><div class="example"><div class="example-title"><span>Example 45</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2000/09/xmldsig#sha1"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>

          <p>A SHA-1 digest is a 160-bit string. The content of the
            <code>DigestValue</code> element shall be the base64 encoding of this bit
            string viewed as a 20-octet octet stream. For example, the
            <code>DigestValue</code> element for the message digest:</p>
          <div class="example"><div class="example-title"><span>Example 46</span></div><pre class="example highlight prettyprint"><code><span class="pln">A9993E36 </span><span class="lit">4706816A</span><span class="pln"> BA3E2571 </span><span class="lit">7850C26C</span><span class="pln"> </span><span class="lit">9CD0D89D</span></code></pre></div>

          <p>from Appendix A of the SHA-1 standard would be:</p>
          <div><div class="example"><div class="example-title"><span>Example 47</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;DigestValue&gt;</span><span class="pln">qZk+NkcGgWq6PiVxeFDCbJzQ2J0=</span><span class="tag">&lt;/DigestValue&gt;</span></pre></div></div>

        </section>
        <section id="sec-SHA256">
          <h4><span class="secno">5.8.2 </span>SHA256</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="sha256" href="http://www.w3.org/2001/04/xmlenc#sha256">http://www.w3.org/2001/04/xmlenc#sha256</a>
            </dd>
          </dl>

          <p>The SHA-256 algorithm [<cite><a class="bibref" href="#bib-FIPS-180-3">FIPS-180-3</a></cite>] takes no explicit
            parameters. An example of an SHA-256 <code>DigestMethod</code> element is:</p>
          <div><div class="example"><div class="example-title"><span>Example 48</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#sha256"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>

          <p>A SHA-256 digest is a 256-bit string. The content of the
            <code>DigestValue</code> element shall be the base64 encoding of this bit
            string viewed as a 32-octet octet stream.</p>

        </section>
        <section id="sec-SHA384">
          <h4><span class="secno">5.8.3 </span>SHA384</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="sha384" href="http://www.w3.org/2001/04/xmlenc#sha384">http://www.w3.org/2001/04/xmlenc#sha384</a>
            </dd>
          </dl>

          <p>The SHA-384 algorithm [<cite><a class="bibref" href="#bib-FIPS-180-3">FIPS-180-3</a></cite>] takes no explicit
            parameters. An example of an SHA-384 <code>DigestMethod</code> element is:</p>
          <div><div class="example"><div class="example-title"><span>Example 49</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#sha384"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>

          <p>A SHA-384 digest is a 384-bit string. The content of the
            <code>DigestValue</code> element shall be the base64 encoding of this bit
            string viewed as a 48-octet octet stream.</p>

        </section>
        <section id="sec-SHA512">
          <h4><span class="secno">5.8.4 </span>SHA512</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="sha512" href="http://www.w3.org/2001/04/xmlenc#sha512">http://www.w3.org/2001/04/xmlenc#sha512</a>
            </dd>
          </dl>

          <p>The SHA-512 algorithm [<cite><a class="bibref" href="#bib-FIPS-180-3">FIPS-180-3</a></cite>] takes no explicit
            parameters. An example of an SHA-512 <code>DigestMethod</code> element is:</p>
          <div><div class="example"><div class="example-title"><span>Example 50</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#sha512"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>

          <p>A SHA-512 digest is a 512-bit string. The content of the
            <code>DigestValue</code> element shall be the base64 encoding of this bit
            string viewed as a 64-octet octet stream.</p>

        </section>
        <section id="sec-RIPEMD-160">
          <h4><span class="secno">5.8.5 </span>RIPEMD-160</h4>
          <dl>
            <dt>Identifier:</dt>
            <dd><a id="ripemd160" href="http://www.w3.org/2001/04/xmlenc#ripemd160">http://www.w3.org/2001/04/xmlenc#ripemd160</a>
            </dd>
          </dl>

          <p>The RIPEMD-160 algorithm [<cite><a class="bibref" href="#bib-RIPEMD-160">RIPEMD-160</a></cite>] takes
            no explicit parameters. An example of an RIPEMD-160 <code>DigestMethod</code>
            element is:</p>
          <div><div class="example"><div class="example-title"><span>Example 51</span></div><pre class="example highlight prettyprint"><span class="tag">&lt;DigestMethod</span><span class="pln"> </span><span class="atn">Algorithm</span><span class="pun">=</span><span class="atv">"http://www.w3.org/2001/04/xmlenc#ripemd160"</span><span class="pln"> </span><span class="tag">/&gt;</span></pre></div></div>

          <p>A RIPEMD-160 digest is a 160-bit string. The content of the
            <code>DigestValue</code> element shall be the base64 encoding of this bit
            string viewed as a 20-octet octet stream.</p>
        </section>
      </section>

      <section id="sec-Alg-Canonicalition">
        <h3><span class="secno">5.9 </span>Canonicalization</h3>

        <p>A Canonicalization of XML is a method of consistently serializing XML into
          an octet stream as is necessary prior to encrypting XML.</p>

        <section id="sec-Inclusive-Canonicalization">
          <h4><span class="secno">5.9.1 </span>Inclusive
            Canonicalization</h4>
          <dl>
            <dt>Identifiers:</dt>
            <dd><a href="http://www.w3.org/TR/2001/REC-xml-c14n-20010315">http://www.w3.org/TR/2001/REC-xml-c14n-20010315</a>
            </dd>
            <dd><a href="http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments">http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments</a>
            </dd>
            <dd><a href="http://www.w3.org/2006/12/xml-c14n11">http://www.w3.org/2006/12/xml-c14n11</a>
            </dd>
            <dd><a href="http://www.w3.org/2006/12/xml-c14n11#WithComments">http://www.w3.org/2006/12/xml-c14n11#WithComments</a>
            </dd>
          </dl>

          <p>Canonical XML [<cite><a class="bibref" href="#bib-XML-C14N11">XML-C14N11</a></cite>] is a method of
            serializing XML which includes the in scope namespace and xml namespace
            attribute context from ancestors of the XML being serialized.</p>

          <p>If XML is to be encrypted and then later decrypted into a different
            environment and it is desired to preserve namespace prefix bindings and the
            value of attributes in the "xml" namespace of its original environment, then
            the canonical XML with comments version of the XML should be the
            serialization that is encrypted.</p>

        </section>
        <section id="sec-Exclusive-Canonicalization">
          <h4><span class="secno">5.9.2 </span>Exclusive
            Canonicalization</h4>
          <dl>
            <dt>Identifiers:</dt>
            <dd><a href="http://www.w3.org/2001/10/xml-exc-c14n#">http://www.w3.org/2001/10/xml-exc-c14n#</a>
            </dd>
            <dd><a href="http://www.w3.org/2001/10/xml-exc-c14n#WithComments">http://www.w3.org/2001/10/xml-exc-c14n#WithComments</a>
            </dd>
          </dl>

          <p>Exclusive XML Canonicalization [<cite><a class="bibref" href="#bib-XML-EXC-C14N">XML-EXC-C14N</a></cite>]
            serializes XML in such a way as to include to the minimum extent practical
            the namespace prefix binding and xml namespace attribute context inherited
            from ancestor elements.</p>

          <p>It is the recommended method where the outer context of a fragment which
            was signed and then encrypted may be changed. Otherwise the validation of the
            signature over the fragment may fail because the canonicalization by
            signature validation may include unnecessary namespaces into the fragment.</p>
        </section>
      </section>
    </section>
    <section id="sec-Security">
      <!--OddPage--><h2><span class="secno">6. </span>Security Considerations</h2>

      <section id="sec-chosen-ciphertext-attacks">
        <h3><span class="secno">6.1 </span>Chosen-Ciphertext Attacks</h3>
        <p>
          A number of chosen-ciphertext attacks against implementations of this
          specification have been published and demonstrated. They all
          involve the following elements:  
        </p>
        <ol>
          <li>The attacker knows about the format of the
            cleartext.</li>
          <li>The attacker is able to submit substantial numbers of ciphertext messages.</li>
          <li>The attacker is able to send arbitrary ciphertext, based on previous results.</li>
          <li>The attacker is able to force the server to use the same key
            (secret key by CBC-based attacks and server's private key by PKCS#1.5
            attacks) for processing of the adapted ciphertext.</li>
          <li>The server attempting to decrypt the ciphertext in some way
            signals whether the decrypted text is well-formed or
            not.</li> 
        </ol> 
        <p>
          The attacker uses the knowledge of the format and the information
          about well-formedness to construct a series of ciphertext
          guesses which reveal the plaintext with much less work than
          brute force. Attacks of this type have been demonstrated against
          symmetric encryption using CBC mode [<cite><a class="bibref" href="#bib-XMLENC-CBC-ATTACK">XMLENC-CBC-ATTACK</a></cite>][<cite><a class="bibref" href="#bib-XMLENC-CBC-ATTACK-COUNTERMEASURES">XMLENC-CBC-ATTACK-COUNTERMEASURES</a></cite>] and on
          PKCS#1 v1.5. Other future attacks can be expected whenever
          these conditions are met. 
        </p>
        <section id="sec-edata-attacks">
          <h4><span class="secno">6.1.1 </span> Attacks against the encrypted data (<code>&lt;EncryptedData&gt;</code> part)</h4>
          <p>
            Using the CBC-based chosen-ciphertext attacks, the attacker sends to the
            server an XML document with modified encrypted data in the symmetric
            part (<code>&lt;EncryptedData&gt;</code>). After a few requests, the
            attacker is able to get the whole 
            cleartext without knowledge of the symmetric key.
          </p><p>
            It would seem that these attacks can be countered by by disrupting any
            of the conditions, however in practice only preventing condition
            3 (sending arbitrary ciphertext) is fully effective. To counter condition 3, it is necessary
            for the decrypting system to require authenticated integrity
            protection over the ciphertext. However, unless the mechanism
            used is bound to the encryption key, there will no way to be sure
            that the signer is not attempting to recover the plaintext. The
            simplest and most efficient way to do this is to use an
            authenticating block mode, such as GCM. An alternative would be
            an HMAC based on the encryption key over the ciphertext, but it
            is less efficient and provides no advantages. 
          </p><p>
            Other countermeasures are not likely to be effective. Limiting the
            number of messages presented or the number of messages using the
            same key is not practical in large server farms. Attackers can
            spread their attempts over different servers and long or short
            periods of time, to foil attempts to detect attacks in progress
            or determine the location of the attacker. 
          </p><p>
            Signaling well-formedness can occur by emitting different messages for
            distinct security errors or by exhibiting timing
            differences. Implementations should avoid these practices,
            however that is not sufficient to prevent such attacks in an XML
            protocol environment, such as SOAP. Using a technique called
            encryption wrapping, the attacker can insert the ciphertext in
            some schema-legal part of the message. If the decryption code
            notices a format error, an error will be returned, but if not
            the message will be passed to the application which will ignore
            the bogus plaintext and ultimately respond with an application
            level success or failure message. 
          </p>
        </section>
        <section id="sec-bleichenbacher-attack">
          <h4><span class="secno">6.1.2 </span>Attacks against the encrypted key (Bleichenbacher's Million
            question attack on PKCS#1.5)</h4>
          <p>
            The goal of the attacker applying the Bleichenbacher's attack is to get
            the symmetric secret key, which is encrypted in the <code>&lt;EncryptedKey&gt;</code> part.
            Afterward, he would be able to decrypt the whole data carried in the
            <code>&lt;EncryptedData&gt;</code> part.
          </p><p>
            The basic idea of this attack is to modify the data in the
            <code>&lt;EncryptedKey&gt;</code> part, send the document to the server, and observe if the
            modified ciphertext contains PKCS#1.5 conformant data. This can be
            done by:
          </p>
          <ol>
            <li>Observing fault messages of the server notifying directly that
              the request was not PKCS#1.5 conformant (this should not happen).</li>
            <li>Enlarging the data in the <code>&lt;EncryptedData&gt;</code> part and observing the
              timing differences between inclusion of PKCS-valid and PKCS-invalid
              keys: if the key is PKCS-valid, the session key is extracted, and the
              large data is decrypted. Otherwise, the session key cannot be extracted
              and the large data is not processed, which yields a timing difference.</li>
            <li>Making specific modifications of the <code>&lt;EncryptedData&gt;</code> part based on CBC
              and padding-properties.</li>
          </ol>
          <p>
            These problems are  described in detail in RFC 3218 [<cite><a class="bibref" href="#bib-RFC3218">RFC3218</a></cite>].
          </p><p>
            The most effective countermeasure against the timing attack (2) is to
            generate a random secret key every time when the decrypted data was not
            PKCS#1-conformant. This way, the attacker would not get any timing
            side-channel.
          </p><p>
            Please note  however that this is not a valid countermeasure against the
            specific modification of the <code>&lt;EncryptedData&gt;</code>
            described in part (3). The attacker
            could still use a few millions of requests to decrypt the encrypted
            symmetric key. Therefore, we recommend the usage of RSA-OAEP. 
            RSA-OAEP  also has a risk of a chosen ciphertext attack [<cite><a class="bibref" href="#bib-OAEP-ATTACK">OAEP-ATTACK</a></cite>] which
            can be mitigated in security library implementations.
          </p>
        </section>
        <section id="sec-backwards-compatibility-attacks">
          <h4><span class="secno">6.1.3 </span>Backwards Compatibility Attacks</h4>
          <p>
            Use of state-of-the-art and secure encryption algorithms
            such as RSA-OAEP and AES-GCM can become insecure when the
            adversary can force the server to process eavesdropped
            ciphertext with legacy algorithms such as RSA-PKCS#1 v1.5 or
            AES-CBC [<cite><a class="bibref" href="#bib-XMLENC-BACKWARDS-COMP">XMLENC-BACKWARDS-COMP</a></cite>]: 
          </p>
          <ol>
            <li>The attacker may be able to break the security of an AES-GCM ciphertext if he
              is able to force the server to process the ciphertext with AES-CBC
              and the same symmetric key.</li>
            <li>The attacker may be able to decrypt an RSA-OAEP ciphertext if he is able to
              force the server to process the ciphertext with RSA-PKCS#1 v1.5 and
              the same asymmetric key.</li>
            <li>The attacker may be able to forge valid server signatures if the server
              decrypts RSA-PKCS#1 v1.5 ciphertexts and the signatures are computed
              with the same asymmetric key pair. 
            </li>
          </ol>
          <p>
            Accordingly, in situations where an attacker may be able
            to  mount chosen-ciphertext attacks, we recommend the following to implementers:
          </p>
          <ol>
            <li>
              Implementations <em class="rfc2119" title="SHOULD">SHOULD</em> always use a different public key pair for data
              confidentiality and for data integrity functionality.
            </li>
            <li>Implementations using symmetric keys <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> use the same key
              material for different algorithms, even if serving the same
              purpose. Key derivation based on a single key and the
              algorithm identifier can be used to accomplish this, for
              example.
            </li>
            <li>Implementations that plan to use the same  symmetric key for both confidentiality and
              integrity functions <em class="rfc2119" title="SHOULD">SHOULD</em>  use it as the basis for a key
              derivation producing different keys for those functions.
            </li>
            <li>Implementations <em class="rfc2119" title="SHOULD">SHOULD</em> restrict algorithm usage to algorithms known to be secure in the
              face of chosen-ciphertext attacks  (RSA-OAEP, AES-GCM). 
              In that case, documents containing RSA-PKCS#1 v1.5
              [<cite><a class="bibref" href="#bib-XMLENC-PKCS15-ATTACK">XMLENC-PKCS15-ATTACK</a></cite>]
              and AES-CBC [<cite><a class="bibref" href="#bib-XMLENC-CBC-ATTACK">XMLENC-CBC-ATTACK</a></cite>]
              ciphertexts <em class="rfc2119" title="SHOULD">SHOULD</em> be rejected without decryption.  
            </li>
          </ol>
        </section>
      </section>
      <section id="sec-Sign-with-Encrypt">
        <h3><span class="secno">6.2 </span>Relationship to XML Digital Signatures</h3>

        <p>The application of both encryption and digital signatures over portions of
          an XML document can make subsequent decryption and signature verification
          difficult. In particular, when verifying a signature one must know whether
          the signature was computed over the encrypted or unencrypted form of
          elements.</p>

        <p>A separate, but important, issue is introducing cryptographic
          vulnerabilities when combining digital signatures and encryption over a
          common XML element. Hal Finney has suggested that encrypting digitally signed
          data, while leaving the digital signature in the clear, may allow plaintext
          guessing attacks. This vulnerability can be mitigated by using secure hashes
          and the nonces in the text being processed.</p>

        <p>In accordance with the requirements document [<cite><a class="bibref" href="#bib-XML-ENCRYPTION-REQ">XML-ENCRYPTION-REQ</a></cite>] the interaction of encryption and signing is
          an application issue and out of scope of the specification. However, we make
          the following recommendations:</p>
        <ol>
          <li><p>When data is encrypted, any digest or signature over that data should
              be encrypted. This satisfies the first issue in that only those
              signatures that can be seen can be validated. It also addresses the
              possibility of a plaintext guessing vulnerability, though it may not be
              possible to identify (or even know of) all the signatures over a given
              piece of data.</p></li>
          <li><p>Employ the "decrypt-except" signature transform [<cite><a class="bibref" href="#bib-XMLENC-DECRYPT">XMLENC-DECRYPT</a></cite>]. It works as follows:
              during signature transform processing, if you encounter a decrypt
              transform, decrypt all encrypted content in the document except for those
              excepted by an enumerated set of references.</p></li>
        </ol>

        <p>Additionally, while the following warnings pertain to incorrect inferences
          by the user about the authenticity of information encrypted, applications
          should discourage user misapprehension by communicating clearly which
          information has integrity, or is authenticated, confidential, or
          non-repudiable when multiple processes (e.g., signature and encryption) and
          algorithms (e.g., symmetric and asymmetric) are used:</p>
        <ol>
          <li><p>When an encrypted envelope contains a signature, the
              signature does not 
              necessarily protect the authenticity or integrity of the
              ciphertext [<cite><a class="bibref" href="#bib-Davis">Davis</a></cite>].</p></li> 
          <li><p>While the signature secures plaintext it only covers that which is
              signed, recipients of encrypted messages must not infer integrity or
              authenticity of other unsigned information (e.g., headers) within the
              encrypted envelope, see [<cite><a class="bibref" href="#bib-XMLDSIG-CORE1">XMLDSIG-CORE1</a></cite>], <a href="http://www.w3.org/TR/xmldsig-core/#sec-Secure">section 8.1.1 Only What is
                Signed is Secure</a>].</p></li>
        </ol>

      </section>
      <section id="sec-InformationRevealed">
        <h3><span class="secno">6.3 </span>Information Revealed</h3>

        <p>Where a symmetric key is shared amongst multiple recipients, that
          symmetric key should <em>only</em> be used for the data intended for
          <em>all</em> recipients; even if one recipient is not directed to information
          intended (exclusively) for another in the same symmetric key, the information
          might be discovered and decrypted.</p>

        <p>Additionally, application designers should be careful not to reveal any
          information in parameters or algorithm identifiers (e.g., information in a
          URI) that weakens the encryption.</p>
      </section>
      <section id="sec-Nonce">
        <h3><span class="secno">6.4 </span>Nonce and IV (Initialization Value or Vector)</h3>

        <p>An undesirable characteristic of many encryption algorithms and/or their
          modes is that the same plaintext when encrypted with the same key has the
          same resulting ciphertext. While this is unsurprising, it invites various
          attacks which are mitigated by including an arbitrary and non-repeating
          (under a given key) data with the plaintext prior to encryption. In
          encryption chaining modes this data is the first to be encrypted and is
          consequently called the IV (initialization value or vector).</p>

        <p>Different algorithms and modes have further requirements on the
          characteristic of this information (e.g., randomness and secrecy) that affect
          the features (e.g., confidentiality and integrity) and their resistance to
          attack.</p>

        <p>Given that XML data is redundant (e.g., Unicode encodings and repeated
          tags ) and that attackers may know the data's structure (e.g., DTDs and
          schemas) encryption algorithms must be carefully implemented and used in this
          regard.</p>

        <p>For the Cipher Block Chaining (CBC) mode used by this specification, the
          IV must not be reused for any key and should be random, but it need not be
          secret. Additionally, under this mode an adversary modifying the IV can make
          a known change in the plain text after decryption. This attack can be avoided
          by securing the integrity of the plain text data, for example by signing
          it.</p>

        <p>Note: CBC block encryption algorithms should not be used
          without consideration of possibly severe security risks. 
        </p>
        <p>
          For the Galois/Counter Mode (GCM) used by this specification, the IV
          must not be reused for any key and should be random, but it need
          not be secret. 
        </p>

      </section>
      <section id="sec-Denial">
        <h3><span class="secno">6.5 </span>Denial of Service</h3>

        <p>This specification permits recursive processing. For example, the
          following scenario is possible: <code>EncryptedKey</code> <strong>A</strong>
          requires <code>EncryptedKey</code> <strong>B</strong> to be decrypted, which
          itself requires <code>EncryptedKey</code> <strong>A</strong>! Or, an attacker
          might submit an <code>EncryptedData</code> for decryption that references
          network resources that are very large or continually redirected.
          Consequently, implementations should be able to restrict arbitrary recursion
          and the total amount of processing and networking resources a request can
          consume.</p>
      </section>
      <section id="sec-Unsafe-Content">
        <h3><span class="secno">6.6 </span>Unsafe Content</h3>

        <p>XML Encryption can be used to obscure, via encryption, content
          that applications (e.g., firewalls, virus detectors, etc.) consider unsafe
          (e.g., executable code, viruses, etc.). Consequently, such applications must
          consider encrypted content to be as unsafe as the unsafest content
          transported in its application context. Consequently, such applications may
          choose to (1) disallow such content, (2) require access to the decrypted form
          for inspection, or (3) ensure that arbitrary content can be safely processed
          by receiving applications.</p>
      </section>
      <section id="sec-Errors">
        <h3><span class="secno">6.7 </span>Error Messages</h3> 
        <p>
          Implementations <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> provide detailed error responses related to
          security algorithm processing. Error messages should be limited to a
          generic error message to avoid providing information to a potential
          attacker related to the specifics of the algorithm implementation. For
          example, if an error occurs in  decryption processing the error
          response should be a generic message providing no
          specifics on the details of the processing error.
        </p>
      </section>
      <section id="sec-TimingAttacks">
        <h3><span class="secno">6.8 </span>Timing Attacks</h3> 
        <p>
          It has been known for some time that it is feasible for an attacker to
          recover keys or cleartext by repeatedly sending chosen ciphertext and
          measuring the time required to process different requests with
          different types of errors. It has been demonstrated that attacks of
          this type are practical even when communicating over large and busy
          networks, especially if the receiver is willing to process large
          numbers of ciphertext blocks.
        </p><p>
          Implementers <em class="rfc2119" title="SHOULD">SHOULD</em> ensure that distinct errors detected during
          security algorithm processing do not consume systematically different
          amounts of processing time from each other. Implementers <em class="rfc2119" title="SHOULD">SHOULD</em>
          consult the technical literature for more details on specific attacks
          and recommended countermeasures. 
        </p><p>
          Deployments <em class="rfc2119" title="SHOULD">SHOULD</em> treat as suspect inputs when a large number of security
          algorithm processing errors are detected within a short period of
          time, especially in messages from the same origin.
        </p>
      </section>
      <section id="sec-cbcBlockEncryptionAttacks">
        <h3><span class="secno">6.9 </span>CBC Block Encryption Vulnerability</h3> 
        <p>
          <strong>Note</strong>: CBC block encryption algorithms
          should not be used without 
          consideration of <a href="#cbc-warning">possibly severe
            security risks</a>. 
        </p>
      </section>
    </section>
    <section id="sec-Conformance">
      <!--OddPage--><h2><span class="secno">7. </span>Conformance</h2>

      <p>An implementation is conformant to this specification if it successfully
        generates syntax according to the schema definitions and satisfies all
        <em class="rfc2119" title="MUST">MUST</em>/<em class="rfc2119" title="REQUIRED">REQUIRED</em>/<em class="rfc2119" title="SHALL">SHALL</em> requirements, including <a href="#sec-AlgID">algorithm</a> support and <a href="#sec-Processing">processing</a>. Processing requirements are specified
        over the roles of <a class="link-def" href="#def-Decryptor"><strong>decryptor</strong>,</a> <a class="link-def" href="#def-Encryptor"><strong>encryptor</strong>,</a> and their calling <a class="link-def" href="#def-Application"><strong>application</strong></a>.</p>

    </section>
    <section id="sec-MediaType">
      <!--OddPage--><h2><span class="secno">8. </span>XML Encryption Media Type</h2>

      <section id="sec-MediaType-Introduction">
        <h3><span class="secno">8.1 </span>Introduction</h3>

        <p>XML Encryption Syntax and Processing (XMLENC-CORE1, this document)
          specifies a process for encrypting 
          data and representing the result in XML. The data may be arbitrary data
          (including an XML document), an XML element, or XML element content. The
          result of encrypting data is an XML Encryption element which contains or
          references the cipher data.</p>

        <p>The <code>application/xenc+xml</code> media type allows XML Encryption
          applications to identify encrypted documents. Additionally it allows
          applications cognizant of this media-type (even if they are not XML
          Encryption implementations) to note that the media type of the decrypted
          (original) object might be a type other than XML.</p>
      </section>
      <section id="sec-MediaType-Registration">
        <h3><span class="secno">8.2 </span>application/xenc+xml Registration</h3>

        <p>This is a media type registration as defined in Multipurpose Internet Mail
          Extensions (MIME) Part Four: Registration Procedures [<cite><a class="bibref" href="#bib-MIME-REG">MIME-REG</a></cite>]</p>

        <p>Type name: application</p>

        <p>Subtype name: xenc+xml</p>

        <p>Required parameters: none</p>

        <p>Optional parameters: charset</p>

        <blockquote>
          <p>The allowable and recommended values for, and interpretation of the
            charset parameter are identical to those given for 'application/xml' in
            section 3.2 of RFC 3023 [<cite><a class="bibref" href="#bib-XML-MT">XML-MT</a></cite>].</p>
        </blockquote>

        <p>Encoding considerations:</p>

        <blockquote>
          <p>The encoding considerations are identical to those given for
            'application/xml' in section 3.2 of RFC 3023 [<cite><a class="bibref" href="#bib-XML-MT">XML-MT</a></cite>].</p>
        </blockquote>

        <p>Security considerations:</p>

        <blockquote>
          See the (XMLENC-CORE1, this document) <a href="#sec-Security">Security Considerations</a> section.</blockquote>
        <p>Interoperability considerations: none</p>
        <p>Published specification:  (XMLENC-CORE1, this document)</p>
        <p>Applications which use this media type:</p>
        <blockquote>
          XML Encryption is device-, platform-, and vendor-neutral and is supported
          by a range of Web applications.</blockquote>
        <p>Additional Information:</p>
        <blockquote>
          <p>Magic number(s): none</p>
          <blockquote>
            Although no byte sequences can be counted on to consistently identify XML
            Encryption documents, there will be XML documents in which the root
            element's <code>QName</code>'s <code>LocalPart</code> is
            <code>'EncryptedData'</code> or '<code>EncryptedKey</code>' with an
            associated namespace name of '<a href="http://www.w3.org/2001/04/xmlenc#">http://www.w3.org/2001/04/xmlenc#</a>'.
            The <code>application/xenc+xml</code> type name <em class="rfc2119" title="MUST">MUST</em> only be used for
            data objects in which the root element is from the XML Encryption
            namespace. XML documents which contain these element types in places
            other than the root element can be described using facilities such as [<cite><a class="bibref" href="#bib-XMLSCHEMA-1">XMLSCHEMA-1</a></cite>], [<cite><a class="bibref" href="#bib-XMLSCHEMA-2">XMLSCHEMA-2</a></cite>].</blockquote>
          <p>File extension(s): .xml</p>
          <p>Macintosh File Type Code(s): "TEXT"</p>
        </blockquote>
        <p>Person &amp; email address to contact for further information:</p>
        <blockquote>
          <p>World Wide Web Consortium &lt;web-human at w3.org&gt;</p>
        </blockquote>
        <p>Intended usage: COMMON</p>
        <p>Author/Change controller:</p>
        <p>The XML Encryption specification is a work product of the World Wide Web
          Consortium (<abbr title="World Wide Web Consortium">W3C</abbr>) which has change control over the specification.</p>
      </section>
    </section>
    <section id="sec-Schema">
      <!--OddPage--><h2><span class="secno">9. </span>Schema</h2>
      <section id="sec-xsdSchema">
        <h3><span class="secno">9.1 </span>XSD Schema</h3>
        <dl>
          <dt>XML Encryption Core Schema Instance</dt>
          <dd><a href="xenc-schema.xsd">xenc-schema.xsd</a></dd>

          <dt>XML Encryption 1.1 Schema Instance</dt>
          <dd><a href="xenc-schema-11.xsd">xenc-schema11.xsd</a></dd>
          <dd>This schema document defines the additional material defined in
            XML Encryption 1.1.</dd> 
          <dt>Example (non-normative)</dt>
          <dd><a href="enc-example.xml">enc-example.xml</a> (not cryptographically
            valid but exercises much of the schema)</dd>
        </dl>
      </section>
      <section id="sec-rngSchema" class="informative">
        <h3><span class="secno">9.2 </span>RNG Schema</h3><p><em>This section is non-normative.</em></p>
        <p>Non-normative RELAX NG schema [<cite><a class="bibref" href="#bib-RELAXNG-SCHEMA">RELAXNG-SCHEMA</a></cite>] information is
          available in a separate document [<cite><a class="bibref" href="#bib-XMLSEC-RELAXNG">XMLSEC-RELAXNG</a></cite>].
        </p>
      </section>
    </section>
    <section class="appendix" id="reserved-algorithm-identifiers">
      <!--OddPage--><h2><span class="secno">A. </span>Reserved Algorithm Identifiers</h2>
      <p>This informative section outlines the definition and
        reserves identifiers for algorithms
        that have no requirements for implementation 
        and  have not been tested for interoperability.</p> 
      <section id="sec-kw-aes-with-pad" class="informative">
        <h3><span class="secno">A.1 </span>AES KeyWrap with Padding</h3><p><em>This section is non-normative.</em></p>
        <dl>
          <dt>Identifiers:</dt>
          <dd><a id="kw-aes-128-pad" href="http://www.w3.org/2009/xmlenc11#kw-aes-128-pad">http://www.w3.org/2009/xmlenc11#kw-aes-128-pad</a>
          </dd>
          <dd><a id="kw-aes-192-pad" href="http://www.w3.org/2009/xmlenc11#kw-aes-192-pad">http://www.w3.org/2009/xmlenc11#kw-aes-192-pad</a>
          </dd>
          <dd><a id="kw-aes-256-pad" href="http://www.w3.org/2009/xmlenc11#kw-aes-256-pad">http://www.w3.org/2009/xmlenc11#kw-aes-256-pad</a>
          </dd>
        </dl>

        <p>
          These identifiers are reserved for symmetric key wrapping
          using the AES key wrap with padding 
          algorithm with a 128, 192, and 256 bit AES key encrypting
          key, respectively.  Implementation of 
          AES key wrap with padding is defined in [<cite><a class="bibref" href="#bib-AES-WRAP-PAD">AES-WRAP-PAD</a></cite>].
          The algorithm is defined for inputs 
          between 9 and 2^32 octets.  Unlike the unpadded AES Key
          Wrap algorithm, the input length is not 
          constrained to multiples of 64 bits (8 octets).
        </p>
        <p>
          Note that the wrapped key will be distinct from the one
          generated by the unpadded AES Key Wrap 
          algorithm, even if the input length is a multiple of 64 bits.
        </p>
      </section>
    </section>
  

<section id="references" class="appendix"><!--OddPage--><h2><span class="secno">B. </span>References</h2><p>Dated references below are to the latest known or appropriate edition of the referenced work.  The referenced works may be subject to revision, and conformant implementations may follow, and are encouraged to investigate the appropriateness of following, some or all more recent editions or replacements of the works cited. It is in each case implementation-defined which  editions are supported.</p><section id="normative-references"><h3><span class="secno">B.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-AES">[AES]</dt><dd><a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf"><cite>NIST FIPS 197: Advanced Encryption Standard (AES)</cite></a>. November 2001. URL: <a href="http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf">http://csrc.nist.gov/publications/fips/fips197/fips-197.pdf</a>
</dd><dt id="bib-AES-WRAP">[AES-WRAP]</dt><dd>J. Schaad; R. Housley. <a href="http://www.ietf.org/rfc/rfc3394.txt"><cite>RFC3394: Advanced Encryption Standard (AES) Key Wrap Algorithm</cite></a>. September 2002. IETF Informational RFC. URL: <a href="http://www.ietf.org/rfc/rfc3394.txt">http://www.ietf.org/rfc/rfc3394.txt</a>
</dd><dt id="bib-AES-WRAP-PAD">[AES-WRAP-PAD]</dt><dd>R. Housley; M. Dworkin. <a href="http://www.ietf.org/rfc/rfc5649.txt"><cite>RFC 5649: Advanced Encryption Standard (AES) Key Wrap with Padding Algorithm</cite></a>. August 2009.    IETF Informational RFC. URL: <a href="http://www.ietf.org/rfc/rfc5649.txt">http://www.ietf.org/rfc/rfc5649.txt</a>
</dd><dt id="bib-ANSI-X9-44-2007">[ANSI-X9-44-2007]</dt><dd><a href="http://webstore.ansi.org/RecordDetail.aspx?sku=ANSI+X9.44-2007"><cite>ANSI X9.44-2007: Key Establishment Using Integer Factorization Cryptography.</cite></a> URL: <a href="http://webstore.ansi.org/RecordDetail.aspx?sku=ANSI+X9.44-2007">http://webstore.ansi.org/RecordDetail.aspx?sku=ANSI+X9.44-2007</a>
</dd><dt id="bib-CMS-WRAP">[CMS-WRAP]</dt><dd>R. Housley. <a href="http://www.ietf.org/rfc/rfc3217.txt"><cite>RFC3217: Triple-DES and R2 Key Wrapping</cite></a>. December 2001. IETF Informational RFC. URL: <a href="http://www.ietf.org/rfc/rfc3217.txt">http://www.ietf.org/rfc/rfc3217.txt</a>
</dd><dt id="bib-DES">[DES]</dt><dd><a href="http://csrc.nist.gov/publications/fips/fips46-3/fips46-3.pdf"><cite>NIST FIPS 46-3: Data Encryption Standard (DES)</cite></a> . October 1999. URL: <a href="http://csrc.nist.gov/publications/fips/fips46-3/fips46-3.pdf">http://csrc.nist.gov/publications/fips/fips46-3/fips46-3.pdf</a>
</dd><dt id="bib-ESDH">[ESDH]</dt><dd>E. Rescorla. <a href="http://www.ietf.org/rfc/rfc2631.txt"><cite> Diffie-Hellman Key Agreement Method.</cite></a>. IETF RFC 2631 Standards Track, 1999. URL: <a href="http://www.ietf.org/rfc/rfc2631.txt">http://www.ietf.org/rfc/rfc2631.txt</a>
</dd><dt id="bib-EXI">[EXI]</dt><dd>Takuki Kamiya; John Schneider. <a href="http://www.w3.org/TR/2009/CR-exi-20091208/"><cite>Efficient XML Interchange (EXI) Format 1.0</cite></a>. 8 December 2009. W3C Candidate Recommendation. URL: <a href="http://www.w3.org/TR/2009/CR-exi-20091208/">http://www.w3.org/TR/2009/CR-exi-20091208/</a>
</dd><dt id="bib-FIPS-180-3">[FIPS-180-3]</dt><dd><a href="http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf"><cite>FIPS PUB 180-3 Secure Hash Standard</cite></a>.  U.S. Department of Commerce/National Institute of Standards and Technology. URL: <a href="http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf">http://csrc.nist.gov/publications/fips/fips180-3/fips180-3_final.pdf</a>
</dd><dt id="bib-FIPS-186-3">[FIPS-186-3]</dt><dd><a href="http://csrc.nist.gov/publications/fips/fips186-3/fips_186-3.pdf"><cite>FIPS PUB 186-3:  Digital Signature Standard (DSS)</cite></a>. June 2009. U.S. Department of Commerce/National Institute of Standards and Technology. URL: <a href="http://csrc.nist.gov/publications/fips/fips186-3/fips_186-3.pdf">http://csrc.nist.gov/publications/fips/fips186-3/fips_186-3.pdf</a>
</dd><dt id="bib-HMAC">[HMAC]</dt><dd>H. Krawczyk, M. Bellare, R. Canetti. <a href="http://www.ietf.org/rfc/rfc2104.txt"><cite>HMAC: Keyed-Hashing for Message Authentication</cite></a>. February 1997. IETF RFC 2104.  URL: <a href="http://www.ietf.org/rfc/rfc2104.txt">http://www.ietf.org/rfc/rfc2104.txt</a>
</dd><dt id="bib-NFC">[NFC]</dt><dd>M. Davis, Ken Whistler. <a href="http://www.unicode.org/reports/tr15/"><cite>TR15, Unicode Normalization Forms.</cite></a>. 17 September 2010, URL: <a href="http://www.unicode.org/reports/tr15/">http://www.unicode.org/reports/tr15/</a>
</dd><dt id="bib-PKCS1">[PKCS1]</dt><dd>J. Jonsson and B. Kaliski. <a href="http://www.ietf.org/rfc/rfc3447.txt"><cite>Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications  Version 2.1.</cite></a> RFC 3447 (Informational), February  2003. URL: <a href="http://www.ietf.org/rfc/rfc3447.txt">http://www.ietf.org/rfc/rfc3447.txt</a> 
</dd><dt id="bib-PKCS5">[PKCS5]</dt><dd>B. Kaliski. <a href="http://www.ietf.org/rfc/rfc2898.txt"><cite>PKCS #5 v2.0: Password-Based Cryptography Standard</cite></a>. September 2000. IETF RFC 2898. URL: <a href="http://www.ietf.org/rfc/rfc2898.txt">http://www.ietf.org/rfc/rfc2898.txt</a>
</dd><dt id="bib-PKCS5Amd1">[PKCS5Amd1]</dt><dd><a href="ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-5v2/pkcs-5v2-0a1.pdf"><cite>PKCS #5 v2.0 Amendment 1: XML Schema for Password-Based Cryptography</cite></a> RSA Laboratories, March 2007. URL: <a href="ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-5v2/pkcs-5v2-0a1.pdf">ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-5v2/pkcs-5v2-0a1.pdf</a>
</dd><dt id="bib-RANDOM">[RANDOM]</dt><dd>D.  Eastlake, S. Crocker, J. Schiller. <a href="http://www.ietf.org/rfc/rfc4086.txt"><cite>Randomness Recommendations for Security.</cite></a>. IETF RFC 4086. June 2005. URL: <a href="http://www.ietf.org/rfc/rfc4086.txt">http://www.ietf.org/rfc/rfc4086.txt</a>
</dd><dt id="bib-RFC2045">[RFC2045]</dt><dd>N. Freed and N. Borenstein. <a href="http://www.ietf.org/rfc/rfc2045.txt"><cite>Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies.</cite></a> November 1996. URL: <a href="http://www.ietf.org/rfc/rfc2045.txt">http://www.ietf.org/rfc/rfc2045.txt</a> 
</dd><dt id="bib-RFC2119">[RFC2119]</dt><dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key words for use in RFCs to Indicate Requirement Levels.</cite></a> March 1997. Internet RFC 2119.  URL: <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a> 
</dd><dt id="bib-RFC4055">[RFC4055]</dt><dd>J. Schaad, B. Kaliski, R. Housley. <a href="http://www.ietf.org/rfc/rfc4055.txt"><cite>Additional Algorithms and Identifiers for RSA Cryptography for use in the Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</cite></a>. June 2005. IETF RFC 4055. URL: <a href="http://www.ietf.org/rfc/rfc4055.txt">http://www.ietf.org/rfc/rfc4055.txt</a>
</dd><dt id="bib-RIPEMD-160">[RIPEMD-160]</dt><dd>B. Preneel, A. Bosselaers, and H. Dobbertin. <a href="http://www.cosic.esat.kuleuven.be/publications/article-317.pdf"><cite>The Cryptographic Hash Function RIPEMD-160</cite></a>. CryptoBytes, Volume 3, Number 2. pp. 9-14, RSA Laboratories 1997. URL: <a href="http://www.cosic.esat.kuleuven.be/publications/article-317.pdf">http://www.cosic.esat.kuleuven.be/publications/article-317.pdf</a>
</dd><dt id="bib-SP800-38D">[SP800-38D]</dt><dd>M. Dworkin. <a href="http://csrc.nist.gov/publications/nistpubs/800-38D/SP-800-38D.pdf"><cite> NIST Special Publication 800-38D: Recommendation for Block Cipher Modes of Operation: Galois/Counter Mode (GCM) and GMAC</cite></a>. November 2007 URL: <a href="http://csrc.nist.gov/publications/nistpubs/800-38D/SP-800-38D.pdf">http://csrc.nist.gov/publications/nistpubs/800-38D/SP-800-38D.pdf</a>
</dd><dt id="bib-SP800-56A">[SP800-56A]</dt><dd><a href="http://csrc.nist.gov/publications/nistpubs/800-56A/SP800-56A_Revision1_Mar08-2007.pdf"><cite> NIST Special Publication 800-56A: Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography (Revised)</cite></a>. March 2007 URL: <a href="http://csrc.nist.gov/publications/nistpubs/800-56A/SP800-56A_Revision1_Mar08-2007.pdf">http://csrc.nist.gov/publications/nistpubs/800-56A/SP800-56A_Revision1_Mar08-2007.pdf</a>
</dd><dt id="bib-SP800-67">[SP800-67]</dt><dd><a href="http://csrc.nist.gov/publications/nistpubs/800-67-Rev1/SP-800-67-Rev1.pdf"><cite> Recommendation for the Triple Data Encryption Algorithm (TDEA) Block Cipher, Revised January 2012.</cite></a> SP-800-67 Revision 1. U.S. Department of Commerce/National Institute of Standards and Technology. URL: <a href="http://csrc.nist.gov/publications/nistpubs/800-67-Rev1/SP-800-67-Rev1.pdf">http://csrc.nist.gov/publications/nistpubs/800-67-Rev1/SP-800-67-Rev1.pdf</a>
</dd><dt id="bib-URI">[URI]</dt><dd>T. Berners-Lee; R. Fielding; L. Masinter. <a href="http://www.ietf.org/rfc/rfc3986.txt"><cite>Uniform Resource Identifiers (URI): generic syntax</cite></a>. January 2005. RFC 3986. URL: <a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a>
</dd><dt id="bib-XML-ENCRYPTION-REQ">[XML-ENCRYPTION-REQ]</dt><dd>Joseph Reagle. <a href="http://www.w3.org/TR/2002/NOTE-xml-encryption-req-20020304"><cite>XML Encryption Requirements</cite></a>. 4 March 2002. W3C Note. URL: <a href="http://www.w3.org/TR/2002/NOTE-xml-encryption-req-20020304">http://www.w3.org/TR/2002/NOTE-xml-encryption-req-20020304</a>
</dd><dt id="bib-XML-NAMES">[XML-NAMES]</dt><dd>Richard Tobin et al. <a href="http://www.w3.org/TR/2009/REC-xml-names-20091208/"><cite>Namespaces in XML 1.0 (Third Edition)</cite></a>. 8 December 2009. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2009/REC-xml-names-20091208/">http://www.w3.org/TR/2009/REC-xml-names-20091208/</a>
</dd><dt id="bib-XML10">[XML10]</dt><dd>C. M. Sperberg-McQueen et al. <a href="http://www.w3.org/TR/2008/REC-xml-20081126/"><cite>Extensible Markup Language (XML) 1.0 (Fifth Edition)</cite></a>. 26 November 2008. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2008/REC-xml-20081126/">http://www.w3.org/TR/2008/REC-xml-20081126/</a>
</dd><dt id="bib-XMLDSIG-CORE1">[XMLDSIG-CORE1]</dt><dd>D. Eastlake; J. Reagle; D. Solo; F. Hirsch; T. Roessler; K. Yiu. <a href="http://www.w3.org/TR/2013/REC-xmldsig-core1-20130411/"><cite>XML Signature Syntax and Processing Version 1.1</cite></a>. 11 April 2013. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2013/REC-xmldsig-core1-20130411/">http://www.w3.org/TR/2013/REC-xmldsig-core1-20130411/</a>
</dd><dt id="bib-XMLSCHEMA-1">[XMLSCHEMA-1]</dt><dd>Henry S. Thompson et al. <a href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/"><cite>XML Schema Part 1: Structures Second Edition</cite></a>. 28 October 2004. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/">http://www.w3.org/TR/2004/REC-xmlschema-1-20041028/</a>
</dd><dt id="bib-XMLSCHEMA-2">[XMLSCHEMA-2]</dt><dd>Paul V. Biron; Ashok Malhotra. <a href="http://www.w3.org/TR/2004/REC-xmlschema-2-20041028/"><cite>XML Schema Part 2: Datatypes Second Edition</cite></a>. 28 October 2004. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2004/REC-xmlschema-2-20041028/">http://www.w3.org/TR/2004/REC-xmlschema-2-20041028/</a>
</dd><dt id="bib-XPATH">[XPATH]</dt><dd>James Clark; Steven DeRose. <a href="http://www.w3.org/TR/1999/REC-xpath-19991116/"><cite>XML Path Language (XPath) Version 1.0</cite></a>. 16 November 1999. W3C Recommendation. URL: <a href="http://www.w3.org/TR/1999/REC-xpath-19991116/">http://www.w3.org/TR/1999/REC-xpath-19991116/</a>
</dd></dl></section><section id="informative-references"><h3><span class="secno">B.2 </span>Informative references</h3><dl class="bibliography"><dt id="bib-Davis">[Davis]</dt><dd><a href="http://www.usenix.org/publications/library/proceedings/usenix01/davis.html"><cite>Defective Sign &amp; Encrypt in S/MIME, PKCS#7, MOSS, PEM, PGP, and XML.</cite></a> D. Davis. USENIX Annual Technical Conference. 2001. URL: <a href="http://www.usenix.org/publications/library/proceedings/usenix01/davis.html">http://www.usenix.org/publications/library/proceedings/usenix01/davis.html</a>
</dd><dt id="bib-ECC-ALGS">[ECC-ALGS]</dt><dd>D. McGrew; K. Igoe; M. Salter. <a href="http://www.rfc-editor.org/rfc/rfc6090.txt"><cite>RFC 6090: Fundamental Elliptic Curve Cryptography Algorithms</cite></a>. February 2011. IETF Informational RFC. URL: <a href="http://www.rfc-editor.org/rfc/rfc6090.txt">http://www.rfc-editor.org/rfc/rfc6090.txt</a>
</dd><dt id="bib-MIME-REG">[MIME-REG]</dt><dd>N. Freed, J. Klensin. <a href="http://www.ietf.org/rfc/rfc4289.txt"><cite>RFC 4289: Multipurpose Internet Mail Extensions (MIME) Part Four: Registration Procedures</cite></a>. December 2005. Best Current Practice. URL: <a href="http://www.ietf.org/rfc/rfc4289.txt">http://www.ietf.org/rfc/rfc4289.txt</a>
</dd><dt id="bib-OAEP-ATTACK">[OAEP-ATTACK]</dt><dd>Manger, James. <a href="http://archiv.infsec.ethz.ch/education/fs08/secsem/Manger01.pdf"><cite> A Chosen Ciphertext Attack on RSA Optimal Asymmetric Encryption Padding (OAEP) as Standardized in PKCS #1 v2.0</cite></a>. URL: <a href="http://archiv.infsec.ethz.ch/education/fs08/secsem/Manger01.pdf">http://archiv.infsec.ethz.ch/education/fs08/secsem/Manger01.pdf</a>
</dd><dt id="bib-RELAXNG-SCHEMA">[RELAXNG-SCHEMA]</dt><dd><a href="http://standards.iso.org/ittf/PubliclyAvailableStandards/c052348_ISO_IEC_19757-2_2008(E).zip"><cite>Information technology -- Document Schema Definition Language (DSDL) -- Part 2: Regular-grammar-based validation -- RELAX NG</cite></a>. ISO/IEC 19757-2:2008. URL: <a href="http://standards.iso.org/ittf/PubliclyAvailableStandards/c052348_ISO_IEC_19757-2_2008(E).zip">http://standards.iso.org/ittf/PubliclyAvailableStandards/c052348_ISO_IEC_19757-2_2008(E).zip</a>
</dd><dt id="bib-RFC3218">[RFC3218]</dt><dd>E. Rescorla. <a href="http://www.rfc-editor.org/rfc/rfc3218.txt"><cite>Preventing the Million Message Attack on Cryptographic Message Syntax (RFC 3218)</cite></a>. January 2002. RFC. URL: <a href="http://www.rfc-editor.org/rfc/rfc3218.txt">http://www.rfc-editor.org/rfc/rfc3218.txt</a>
</dd><dt id="bib-SHA-1-Analysis">[SHA-1-Analysis]</dt><dd>McDonald, C., Hawkes, P., and J. Pieprzyk. <a href="http://eurocrypt2009rump.cr.yp.to/837a0a8086fa6ca714249409ddfae43d.pdf"><cite>SHA-1 collisions now 2<sup>52</sup> </cite></a>. EuroCrypt 2009 Rump session. URL: <a href="http://eurocrypt2009rump.cr.yp.to/837a0a8086fa6ca714249409ddfae43d.pdf">http://eurocrypt2009rump.cr.yp.to/837a0a8086fa6ca714249409ddfae43d.pdf</a>
</dd><dt id="bib-SHA-1-Collisions">[SHA-1-Collisions]</dt><dd>X. Wang, Y.L. Yin, H. Yu. <a href="http://people.csail.mit.edu/yiqun/SHA1AttackProceedingVersion.pdf"><cite>Finding Collisions in the Full SHA-1</cite></a>. In Shoup, V., editor, Advances in Cryptology - CRYPTO 2005, 25th Annual International Cryptology Conference, Santa Barbara, California, USA, August 14-18, 2005, Proceedings, volume 3621 of LNCS, pages 17–36. Springer, 2005. URL: <a href="http://people.csail.mit.edu/yiqun/SHA1AttackProceedingVersion.pdf">http://people.csail.mit.edu/yiqun/SHA1AttackProceedingVersion.pdf</a> (also published in <a href="http://www.springerlink.com/content/26vljj3xhc28ux5m/">http://www.springerlink.com/content/26vljj3xhc28ux5m/</a>)
</dd><dt id="bib-Tobin">[Tobin]</dt><dd>R. Tobin. <a href="http://lists.w3.org/Archives/Member/w3c-xml-core-wg/2000OctDec/0054"><cite>Infoset for external entities.</cite></a> 2000. URL: <a href="http://lists.w3.org/Archives/Member/w3c-xml-core-wg/2000OctDec/0054">http://lists.w3.org/Archives/Member/w3c-xml-core-wg/2000OctDec/0054</a> [XML Core mailing list, <a href="http://cgi.w3.org/MemberAccess/AccessRequest">W3C Member Only</a>].
</dd><dt id="bib-XML-C14N">[XML-C14N]</dt><dd>John Boyer. <a href="http://www.w3.org/TR/2001/REC-xml-c14n-20010315"><cite>Canonical XML Version 1.0</cite></a>. 15 March 2001. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2001/REC-xml-c14n-20010315">http://www.w3.org/TR/2001/REC-xml-c14n-20010315</a>
</dd><dt id="bib-XML-C14N11">[XML-C14N11]</dt><dd>John Boyer; Glenn Marcy. <a href="http://www.w3.org/TR/2008/REC-xml-c14n11-20080502/"><cite>Canonical XML Version 1.1</cite></a>. 2 May 2008. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2008/REC-xml-c14n11-20080502/">http://www.w3.org/TR/2008/REC-xml-c14n11-20080502/</a>
</dd><dt id="bib-XML-EXC-C14N">[XML-EXC-C14N]</dt><dd>Donald E. Eastlake 3rd; Joseph Reagle; John Boyer. <a href="http://www.w3.org/TR/2002/REC-xml-exc-c14n-20020718/"><cite>Exclusive XML Canonicalization Version 1.0</cite></a>. 18 July 2002. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2002/REC-xml-exc-c14n-20020718/">http://www.w3.org/TR/2002/REC-xml-exc-c14n-20020718/</a>
</dd><dt id="bib-XML-INFOSET">[XML-INFOSET]</dt><dd>John Cowan; Richard Tobin. <a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/"><cite>XML Information Set (Second Edition)</cite></a>. 4 February 2004. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2004/REC-xml-infoset-20040204/">http://www.w3.org/TR/2004/REC-xml-infoset-20040204/</a>
</dd><dt id="bib-XML-MT">[XML-MT]</dt><dd>M. Murata, S. St.Laurent, D. Kohn. <a href="http://www.ietf.org/rfc/rfc3023.txt"><cite>XML Media Types</cite></a>. IETF RFC 3023. URL: <a href="http://www.ietf.org/rfc/rfc3023.txt"> http://www.ietf.org/rfc/rfc3023.txt</a>.
</dd><dt id="bib-XMLBASE">[XMLBASE]</dt><dd>Jonathan Marsh; Richard Tobin. <a href="http://www.w3.org/TR/2009/REC-xmlbase-20090128/"><cite>XML Base (Second Edition)</cite></a>. 28 January 2009. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2009/REC-xmlbase-20090128/">http://www.w3.org/TR/2009/REC-xmlbase-20090128/</a>
</dd><dt id="bib-XMLENC-BACKWARDS-COMP">[XMLENC-BACKWARDS-COMP]</dt><dd>Tibor Jager; Kenneth G. Paterson; Juraj Somorovsky. <a href="http://www.nds.ruhr-uni-bochum.de/research/publications/backwards-compatibility/"><cite>One Bad Apple: Backwards Compatibility Attacks on State-of-the-Art Cryptography</cite></a>. 2013. URL: <a href="http://www.nds.ruhr-uni-bochum.de/research/publications/backwards-compatibility/">http://www.nds.ruhr-uni-bochum.de/research/publications/backwards-compatibility/</a>
</dd><dt id="bib-XMLENC-CBC-ATTACK">[XMLENC-CBC-ATTACK]</dt><dd>Tibor Jager; Juraj Somorovsky. <a href="http://www.nds.ruhr-uni-bochum.de/research/publications/breaking-xml-encryption/"><cite>How to Break XML Encryption</cite></a>. 17-21 October 2011. CCS’11, ACM. URL: <a href="http://www.nds.ruhr-uni-bochum.de/research/publications/breaking-xml-encryption/">http://www.nds.ruhr-uni-bochum.de/research/publications/breaking-xml-encryption/</a>
</dd><dt id="bib-XMLENC-CBC-ATTACK-COUNTERMEASURES">[XMLENC-CBC-ATTACK-COUNTERMEASURES]</dt><dd>Juraj Somorovsky; Jörg Schwenk. <a href="http://www.w3.org/2008/xmlsec/papers/xmlEncCountermeasuresW3C.pdf"><cite>Technical Analysis of Countermeasures against Attack on XML Encryption - or - Just Another Motivation for Authenticated Encryption</cite></a>. 2011. URL: <a href="http://www.w3.org/2008/xmlsec/papers/xmlEncCountermeasuresW3C.pdf">http://www.w3.org/2008/xmlsec/papers/xmlEncCountermeasuresW3C.pdf</a>
</dd><dt id="bib-XMLENC-CORE1-CHGS">[XMLENC-CORE1-CHGS]</dt><dd>Frederick Hirsch. <a href="http://www.w3.org/TR/2013/NOTE-xmlenc-core1-explain-20130411/"><cite>Functional Explanation of in XML Encryption 1.1</cite></a>. 11 April 2013. W3C Working Group Note. URL: <a href="http://www.w3.org/TR/2013/NOTE-xmlenc-core1-explain-20130411/">http://www.w3.org/TR/2013/NOTE-xmlenc-core1-explain-20130411/</a>
</dd><dt id="bib-XMLENC-DECRYPT">[XMLENC-DECRYPT]</dt><dd>Takeshi Imamura; Merlin Hughes; Hiroshi Maruyama. <a href="http://www.w3.org/TR/2002/REC-xmlenc-decrypt-20021210"><cite>Decryption Transform for XML Signature</cite></a>. 10 December 2002. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2002/REC-xmlenc-decrypt-20021210">http://www.w3.org/TR/2002/REC-xmlenc-decrypt-20021210</a>
</dd><dt id="bib-XMLENC-PKCS15-ATTACK">[XMLENC-PKCS15-ATTACK]</dt><dd>Tibor Jager; Sebastian Schinzel; Juraj Somorovsky. <a href="http://www.nds.rub.de/research/publications/breaking-xml-encryption-pkcs15.pdf"><cite>Bleichenbacher"s Attack Strikes Again: Breaking PKCS#1.5 in XML Encryption</cite></a>. 2012. URL: <a href="http://www.nds.rub.de/research/publications/breaking-xml-encryption-pkcs15.pdf">http://www.nds.rub.de/research/publications/breaking-xml-encryption-pkcs15.pdf</a>
</dd><dt id="bib-XMLSEC-RELAXNG">[XMLSEC-RELAXNG]</dt><dd>Makoto Murata; Frederick Hirsch. <a href="http://www.w3.org/TR/2013/NOTE-xmlsec-rngschema-20130411/"><cite>XML Security RELAX NG Schemas</cite></a>. 11 April 2013. W3C Working Group Note. URL: <a href="http://www.w3.org/TR/2013/NOTE-xmlsec-rngschema-20130411/">http://www.w3.org/TR/2013/NOTE-xmlsec-rngschema-20130411/</a>
</dd><dt id="bib-XMLSEC11-REQS">[XMLSEC11-REQS]</dt><dd>Frederick Hirsch; Thomas Roessler. <a href="http://www.w3.org/TR/2013/NOTE-xmlsec-reqs-20130411/"><cite>XML Security 1.1 Requirements and Design Considerations</cite></a>. 11 April 2013. W3C Working Group Note. URL: <a href="http://www.w3.org/TR/2013/NOTE-xmlsec-reqs-20130411/">http://www.w3.org/TR/2013/NOTE-xmlsec-reqs-20130411/</a>
</dd></dl></section></section></body></html>
