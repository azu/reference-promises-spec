<!-- http://www.w3.org/TR/fragid-best-practices/ -->
<!DOCTYPE html>
<html lang="en" dir="ltr">
<head> 
		<title>Best Practices for Fragment Identifiers and Media Type Definitions</title> 
		<meta http-equiv="content-type" content="text/html;charset=utf-8"> 
		<!-- 
			=== NOTA BENE ===
			For the three scripts below, if your spec resides on dev.w3 you can check them
			out in the same tree and use relative links so that they'll work offline,
		--> 
		<!--
		<script src='http://respec.specifiction.com/js/profiles/w3c-common.js' class='remove'></script>
		-->
 		<!--
		<script src='http://dev.w3.org/2009/dap/ReSpec.js/js/respec.js' class='remove'></script>
		-->

		 
	<style>/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #ff4500;
}


/* --- --- */
ol.algorithm { counter-reset:numsection; list-style-type: none; }
ol.algorithm li { margin: 0.5em 0; }
ol.algorithm li:before { font-weight: bold; counter-increment: numsection; content: counters(numsection, ".") ") "; }

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #005a9c;
}

.simple th {
    background: #005a9c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}
</style><style>/* --- Best Practices --- */
div.practice {
    border: solid #bebebe 1px;
    margin: 2em 1em 1em 2em;
}

span.practicelab {
    margin: 1.5em 0.5em 1em 1em;
    font-weight: bold;
    font-style: italic;
    background: #dfffff;
    position: relative;
    padding: 0 0.5em;
    top: -1.5em;
}

p.practicedesc {
    margin: 1.5em 0.5em 1em 1em;
}

@media screen {
    p.practicedesc {
        position: relative;
        top: -2em;
        padding: 0;
        margin: 1.5em 0.5em -1em 1em;
    }
}
</style><link rel="stylesheet" href="http://www.w3.org/StyleSheets/TR/W3C-WD"><!--[if lt IE 9]><script src='http://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--></head> 
	<body><div class="head">
  <p>
    
      <a href="http://www.w3.org/"><img width="72" height="48" src="http://www.w3.org/Icons/w3c_home" alt="W3C"></a>
    
  </p>
  <h1 class="title" id="title">Best Practices for Fragment Identifiers and Media Type Definitions</h1>
  
  <h2 id="w3c-working-draft-25-october-2012"><abbr title="World Wide Web Consortium">W3C</abbr> Working Draft 25 October 2012</h2>
  <dl>
    
      <dt>This version:</dt>
      <dd><a href="http://www.w3.org/TR/2012/WD-fragid-best-practices-20121025/">http://www.w3.org/TR/2012/WD-fragid-best-practices-20121025/</a></dd>
      <dt>Latest published version:</dt>
      <dd><a href="http://www.w3.org/TR/fragid-best-practices/">http://www.w3.org/TR/fragid-best-practices/</a></dd>
    
    
      <dt>Latest editor's draft:</dt>
      <dd><a href="http://www.w3.org/2001/tag/doc/mimeTypesAndFragids">http://www.w3.org/2001/tag/doc/mimeTypesAndFragids</a></dd>
    
    
    
    
    
      <dt>Previous version:</dt>
      <dd><a href="http://www.w3.org/TR/2012/WD-fragid-best-practices-20120726/">http://www.w3.org/TR/2012/WD-fragid-best-practices-20120726/</a></dd>
    
    
    <dt>Editor:</dt>
    <dd><a href="http://www.jenitennison.com/">Jeni Tennison</a>, <a href="http://theodi.org/">Open Data Institute</a></dd>

    
  </dl>
  
  
  
  
    
      <p class="copyright">
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 
        2012
        
        <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> 
        (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>,
        <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
        <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved.
        <abbr title="World Wide Web Consortium">W3C</abbr> <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
        <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and
        <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.
      </p>
    
  
  <hr>
</div> 
		<section id="abstract" class="introductory"><h2>Abstract</h2> 
			<p>
				Fragment identifiers (<a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a>) within URIs are specified as being interpreted based on the media type of a representation. Media type definitions therefore have to provide details about how fragids are interpreted for that media type. This document recommends best practices for the authors of media type definitions, for the authors of structured syntax suffix registrations (such as <code>+xml</code>), for the authors of specifications that define <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a>, and for authors that publish documents that are intended to be used with fragids or who refer to fragments within documents using URIs with fragids.
			</p>
			<p>
				Media type registrations should ensure that fragids matching syntax "inherited" from top-level types such as <code>image/*</code> and <a title="+suffix registration" href="#dfn-suffix-registration" class="internalDFN">+suffix registrations</a> such as for <code>+xml</code> are always interpreted based on that generic processing. If the "inherited" fragid syntaxes overlap and may provide inconsistent meanings or processing for the same fragid, they should not adopt the +suffix. Where media type registrations reuse fragid structures that overlap, media type registrations should specify which take priority in resolving a given fragid. Media type registrations should also reserve the use of plain name fragids for local identifiers within content, and specify any restrictions on the interpretation of fragids by scripts. They should avoid defining new fragid structures within the registration document itself, and should avoid constraining how applications handle fragids that do not resolve.
			</p>
			<p>
				Structured syntax suffix registrations are based on a <a href="#dfn-metaformat" class="internalDFN">metaformat</a> which usually will have its own media type registration. The <a href="#dfn-suffix-registration" class="internalDFN">+suffix registration</a> should define the same fragid rules as are used in that media type registration. Further, they should specify that any fragids that do not resolve according to these rules should be handled in the way specified by the specific media type adopting that <a href="#dfn-suffix" class="internalDFN">+suffix</a>.
			</p>
			<p>
				The designers of fragid structures (such as XPointer) should avoid syntactic overlaps with existing fragid structures and ensure that fragids can be used across formats with similar semantics.
			</p>
			<p>
				Publishers should ensure that any addressable structures within documents that are served through content negotiation are consistent across content-negotiated variants. They should also ensure that scripts handle fragids consistently with the fragid rules for the relevant media type. Authors referring to URIs with fragids should avoid using fragids that are specific to a particular document format (such as XPointer, which is specific to XML) unless they can ascertain that the base URI only serves one representation.
			</p>
		</section><section id="sotd" class="introductory"><h2>Status of This Document</h2>
  
    
      
        <p>
          <em>This section describes the status of this document at the time of its publication. Other
          documents may supersede this document. A list of current <abbr title="World Wide Web Consortium">W3C</abbr> publications and the latest revision
          of this technical report can be found in the <a href="http://www.w3.org/TR/"><abbr title="World Wide Web Consortium">W3C</abbr> technical reports
          index</a> at http://www.w3.org/TR/.</em>
        </p>
        
        <p>
          This document was published by the <a href="http://www.w3.org/2001/tag/">Technical Architecture Group</a> as a Last Call Working Draft.
          
            This document is intended to become a <abbr title="World Wide Web Consortium">W3C</abbr> Recommendation.
          
          If you wish to make comments regarding this document, please send them to 
          <a href="mailto:www-tag@w3.org">www-tag@w3.org</a> 
          (<a href="mailto:www-tag-request@w3.org?subject=subscribe">subscribe</a>,
          <a href="http://lists.w3.org/Archives/Public/www-tag/">archives</a>).
          The Last Call period ends 13 December 2012.
          
          All feedback is welcome.
        </p>
        
          <p>
            Publication as a Working Draft does not imply endorsement by the <abbr title="World Wide Web Consortium">W3C</abbr> Membership.
            This is a draft document and may be updated, replaced or obsoleted by other documents at 
            any time. It is inappropriate to cite this document as other than work in progress.
          </p>
        
        
          <p>
            This is a Last Call Working Draft and thus the Working Group has determined that this document has satisfied the
            relevant technical requirements and is sufficiently stable to advance through the Technical Recommendation process.
          </p>
        
        <p>
          
            This document was produced by a group operating under the 
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
          
          
          
            
              <abbr title="World Wide Web Consortium">W3C</abbr> maintains a <a href="http://www.w3.org/2001/tag/disclosures" rel="disclosure">public list of any patent disclosures</a> 
            
            made in connection with the deliverables of the group; that page also includes instructions for 
            disclosing a patent. An individual who has actual knowledge of a patent which the individual believes contains
            <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a> must disclose the
            information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
            6 of the <abbr title="World Wide Web Consortium">W3C</abbr> Patent Policy</a>.
          
          
        </p>
        
      
    
  
</section><section id="toc"><h2 class="introductory">Table of Contents</h2><ul class="toc"><li class="tocline"><a href="#conformance" class="tocxref"><span class="secno">1. </span>Conformance</a></li><li class="tocline"><a href="#terminology" class="tocxref"><span class="secno">2. </span>Terminology</a></li><li class="tocline"><a href="#bp-summary" class="tocxref"><span class="secno">3. </span>Best Practices Summary</a></li><li class="tocline"><a href="#registrations" class="tocxref"><span class="secno">4. </span>Best Practices for Media Type Registrations</a></li><li class="tocline"><a href="#suffixes" class="tocxref"><span class="secno">5. </span>Best Practices for +Suffix Registrations</a></li><li class="tocline"><a href="#structures" class="tocxref"><span class="secno">6. </span>Best Practices for Fragid Structures</a></li><li class="tocline"><a href="#authors" class="tocxref"><span class="secno">7. </span>Best Practices for Document Authors</a><ul class="toc"><li class="tocline"><a href="#publishers" class="tocxref"><span class="secno">7.1 </span>Best Practices for Publishers</a></li><li class="tocline"><a href="#referrers" class="tocxref"><span class="secno">7.2 </span>Best Practices for Referrers</a></li></ul></li><li class="tocline"><a href="#acknowledgements" class="tocxref"><span class="secno">A. </span>Acknowledgements</a></li><li class="tocline"><a href="#analysis" class="tocxref"><span class="secno">B. </span>Analysis</a><ul class="toc"><li class="tocline"><a href="#media-fragment-uris" class="tocxref"><span class="secno">B.1 </span>Media Fragment URIs</a></li><li class="tocline"><a href="#xml-media-types" class="tocxref"><span class="secno">B.2 </span>XML Media Types</a></li><li class="tocline"><a href="#svg-fragment-identifiers" class="tocxref"><span class="secno">B.3 </span>SVG Fragment Identifiers</a></li><li class="tocline"><a href="#active-content" class="tocxref"><span class="secno">B.4 </span>Active Content</a></li><li class="tocline"><a href="#semantic-content" class="tocxref"><span class="secno">B.5 </span>Semantic Content</a></li></ul></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">C. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">C.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">C.2 </span>Informative references</a></li></ul></li></ul></section> 
		
		<section class="introductory">
			<h2 id="introduction">Introduction</h2>
			<p>
				Fragment identifiers (<a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a>) within URIs are used in three main ways:
			</p>
			<ul>
				<li>to jump to, highlight, or zoom in to a particular piece of content when displaying a larger document</li>
				<li>to identify a piece of content for extraction, for example for embedding within another document</li>
				<li>to provide an identifier for either a piece of content or something described within a document that can be used as the basis of annotation</li>
			</ul>
			<p>
				When URIs contain fragids, they are interpreted based on the media type of the representation that is retrieved when the URI is requested. The <a href="http://www.ietf.org/rfc/rfc3986.txt">Generic Syntax for URIs</a> [<cite><a class="bibref" href="#bib-URI">URI</a></cite>] states:
			</p> 
			<blockquote>
				<p>
					The semantics of a fragment identifier are defined by the set of
					representations that might result from a retrieval action on the
					primary resource.  The fragment's format and resolution is therefore
					dependent on the media type [<cite><a class="bibref" href="#bib-RFC2046">RFC2046</a></cite>] of a potentially retrieved
					representation, even though such a retrieval is only performed if the
					URI is dereferenced.  If no such representation exists, then the
					semantics of the fragment are considered unknown and are effectively
					unconstrained.  Fragment identifier semantics are independent of the
					URI scheme and thus cannot be redefined by scheme specifications.
				</p>
				<p>
					Individual media types may define their own restrictions on or
					structures within the fragment identifier syntax for specifying
					different types of subsets, views, or external references that are
					identifiable as secondary resources by that media type.  If the
					primary resource has multiple representations, as is often the case
					for resources whose representation is selected based on attributes of
					the retrieval request (a.k.a., content negotiation), then whatever is
					identified by the fragment should be consistent across all of those
					representations.  Each representation should either define the
					fragment so that it corresponds to the same secondary resource,
					regardless of how it is represented, or should leave the fragment
					undefined (i.e., not found).
				</p>
			</blockquote>
			<p>
				<a href="http://tools.ietf.org/html/draft-ietf-appsawg-media-type-regs-14">Media Type Specifications and Registration Procedures</a> includes a "Fragment identifier considerations" section within the template for registering media types and says:
			</p>
			<blockquote>
				<p>
					Media type registrations can specify how applications should
					interpret fragment identifiers (specified in section 3.5 of
					[<cite><a class="bibref" href="#bib-RFC3986">RFC3986</a></cite>]) associated with the media type.
				</p>
				<p>
					Media types are encouraged to adopt fragment identifier schemes that
					are used with semantically similar media types.  In particular, media
					types that use a named structured syntax with a registered "+suffix"
					<em class="rfc2119" title="must">must</em> follow whatever fragment identifier rules are given in the
					structured syntax suffix registration.
				</p>
			</blockquote>
			<p>
				Problems arise when a media type wishes to adopt several <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> because of its similarity with other media types and/or its use of a <a href="#dfn-metaformat" class="internalDFN">metaformat</a>. For example, as well as defining its own method of interpreting fragids, <a href="http://www.w3.org/TR/2003/REC-SVG11-20030114/">SVG</a> [<cite><a class="bibref" href="#bib-SVG11">SVG11</a></cite>] has the media type <code>image/svg+xml</code> and therefore must follow the rules for fragids that are common to all XML documents (<a href="http://www.w3.org/2006/02/son-of-3023/draft-murata-kohn-lilley-xml-04.html#frag">XML Media Types Draft</a>). As an image format, it should also use the common fragid structure for images (<a href="http://www.w3.org/TR/media-frags/">Media Fragments URI 1.0</a> [<cite><a class="bibref" href="#bib-MEDIA-FRAGMENTS">MEDIA-FRAGMENTS</a></cite>]). If RDF is embedded within the SVG through RDF/XML or RDFa, fragids might additionally have RDF semantics and be used to refer to real-world things pictured within the SVG. Finally, if fragids are interpreted by scripts embedded within the SVG, they may have yet another purpose: to encode local application state. This is described in detail in <a class="sectionRef sec-ref" href="#analysis">section B. Analysis</a>.
			</p>
			<p>
				SVG is only one example of a media type in which conflicts between different uses of fragids occur. XHTML, which also uses the <code>+xml</code> suffix, contains scripts that may interpret fragids and may be used to carry data interpreted according to RDF semantics.
			</p>
			<p>
				This document recommends some Best Practices for those registering media types, those registering structured syntax suffixes, the authors of fragid structures and individual document authors. Other issues with using fragment identifiers, such as unicode normalisation, internationalisation and the use of fragids with Javascript APIs, are not discussed in this document.
			</p>
		</section> 
		
		<section id="conformance"><!--OddPage--><h2><span class="secno">1. </span>Conformance</h2>
<p>
  As well as sections marked as non-normative, all authoring guidelines, diagrams, examples,
  and notes in this specification are non-normative. Everything else in this specification is
  normative.
</p>
<p>
  The key words <em class="rfc2119" title="must">must</em>, <em class="rfc2119" title="must not">must not</em>, <em class="rfc2119" title="required">required</em>, <em class="rfc2119" title="should">should</em>, <em class="rfc2119" title="should not">should not</em>, <em class="rfc2119" title="recommended">recommended</em>, <em class="rfc2119" title="may">may</em>,
  and <em class="rfc2119" title="optional">optional</em> in this specification are to be interpreted as described in [<cite><a class="bibref" href="#bib-RFC2119">RFC2119</a></cite>].
</p>

			<p>
				The RFC2119 keywords are only used within Best Practices.
			</p>
		</section>
		
		<section id="terminology">
			<!--OddPage--><h2><span class="secno">2. </span>Terminology</h2>
			<p>
				A lot of the terminology to do with the registration of media types consists of long noun-phrases such as "structured syntax suffix registrations" that can make recommendations hard to read. We have therefore adopted shorter terminology for the purpose of this document, as described here.
			</p>
			<dl>
				<dt><dfn id="dfn-fragid">fragid</dfn></dt>
				<dd>fragment identifier</dd>
				<dt><dfn id="dfn-metaformat">metaformat</dfn></dt>
				<dd>a structured syntax such as JSON or XML</dd>
				<dt><dfn id="dfn-suffix">+suffix</dfn></dt>
				<dd>a structured syntax suffix that can be adopted by the vocabularies that share a metaformat, such as <code>+json</code> or <code>+xml</code>, as defined in <a href="http://tools.ietf.org/html/draft-ietf-appsawg-media-type-regs-14">Media Type Specifications and Registration Procedures</a> [RFCXXXX]</dd>
				<dt><dfn id="dfn-suffix-registration">+suffix registration</dfn></dt>
				<dd>a registration for a +suffix, as defined in <a href="http://tools.ietf.org/html/draft-ietf-appsawg-media-type-regs-14">Media Type Specifications and Registration Procedures</a> [RFCXXXX]</dd>
			</dl>
			<p>
				This document also introduces a number of terms that help to describe how fragids can be defined and used within media types:
			</p>
			<dl>
				<dt><a href="#dfn-fragid-structure" class="internalDFN">fragid structure</a></dt>
				<dd>a defined set of fragid syntax, semantics and processing requirements</dd>
				<dt><a href="#dfn-plain-name-fragid" class="internalDFN">plain name fragid</a></dt>
				<dd>a fragid that does not include any special internal syntax</dd>
				<dt><a href="#dfn-semantic-fragid-structure" class="internalDFN">semantic fragid structure</a></dt>
				<dd>a fragid structure that provides access to semantic fragments of a document based on the information that it encodes, and may be used across multiple media types that use different syntaxes; media fragment URIs are an example</dd>
				<dt><a href="#dfn-syntax-based-fragid-structure" class="internalDFN">syntax-based fragid structure</a></dt>
				<dd>a fragid structure that provides access to structures within a document based on the syntax used by the document; XPointer is an example</dd>
			</dl>
		</section>
		
		<section id="bp-summary"><!--OddPage--><h2><span class="secno">3. </span>Best Practices Summary</h2><ul><li><a href="#consistent-generic-processing">Best Practice 1</a>: Ensure Consistent Generic Processing of Overlapping Fragid Structures</li><li><a href="#specify-resolution-of-overlaps">Best Practice 2</a>: Specify Resolution of Fragids that Comply with Multiple Fragid Structures</li><li><a href="#reserve-plain-name-fragids">Best Practice 3</a>: Reserve Plain Name Fragids</li><li><a href="#specify-script-handling">Best Practice 4</a>: Define Active Content Processing of Fragids</li><li><a href="#create-external-specifications">Best Practice 5</a>: Avoid Specifying Fragid Structures within Media Type Registrations</li><li><a href="#consistency-with-syntax">Best Practice 6</a>: Process Fragids in the Same Way as for the Associated Media Type</li><li><a href="#enable-additional-fragids">Best Practice 7</a>: Enable Additional Fragids to be Processed According to Media Type</li><li><a href="#avoid-conflicts">Best Practice 8</a>: Avoid Conflicting with Existing Fragid Structures</li><li><a href="#specify-at-general-level">Best Practice 9</a>: Define Fragid Structures for General Use</li><li><a href="#consistent-conneg">Best Practice 10</a>: Name Structures Consistently Across Content-Negotiated Representations</li><li><a href="#consistent-script-processing">Best Practice 11</a>: Scripts Must Adhere to Constraints Specified within Media Type Registrations</li><li><a href="#avoid-syntax-based-fragids">Best Practice 12</a>: Do Not Use Syntax-Based Fragids with Multiple Content-Negotiated Variants</li></ul></section>
		
		<section id="registrations">
			<!--OddPage--><h2><span class="secno">4. </span>Best Practices for Media Type Registrations</h2>
			<p>
				Individual media type registrations define how <a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a> should be interpreted when found in documents of that media type. These registrations must balance the following goals:
			</p>
			<ul>
				<li>enable consistent processing of fragids by applications that are aware of the specific media type and by generic processors for types that share the same <a href="#dfn-metaformat" class="internalDFN">metaformat</a> (if applicable)</li>
				<li>facilitate content negotiation between documents of the media type and other media types that might be used for representations of the same resource</li>
				<li>if the media type supports scripting, enable publishers to use fragids to encode application state where appropriate</li>
			</ul>
			<p>
				Generic applications may process documents of a particular media type without knowing about the specific rules that apply to that media type as specified in its registration. For example, a browser might always attempt to display any <code>text/*</code> document as text, or any <code>application/*+xml</code> document using XML syntax highlighting. The interpretation of fragids by media-type-aware applications should match the behaviour of these generic applications, so that the same fragment is identified whether or not the application has built-in knowledge of the media type.
			</p>
			<p>
				As specified in <a href="http://tools.ietf.org/html/draft-ietf-appsawg-media-type-regs-14">Media Type Specifications and Registration Procedures</a> [RFCXXXX], media type registrations that adopt a registered <a href="#dfn-suffix" class="internalDFN">+suffix</a>, such as <code>+xml</code> or <code>+json</code>, must follow whatever fragid rules are specified in the <a href="#dfn-suffix-registration" class="internalDFN">+suffix registration</a>. This ensures that there is consistency in processing between generic applications that understand the <a href="#dfn-metaformat" class="internalDFN">metaformat</a> and those that are aware of the specific media type that uses the +suffix. Similar considerations also apply, however, to other <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> that may be used by generic processors, for example those that perform generic processing based on the top-level type (<code>text</code>, <code>image</code> and so on).
			</p>
			<p>
				For example, the media type registration for <code>application/rdf+xml</code> must include fragid rules that adhere to those specified in the <a href="#dfn-suffix-registration" class="internalDFN">+suffix registration</a> for <code>+xml</code>. If a <code>application/rdf+xml</code> document contained an element with a <code>@xml:id</code> attribute with the value <code>me</code> then the fragid <code>#me</code> would be interpreted as referring to that element by generic XML processors. It would be inconsistent for other applications to interpret the <code>#me</code> fragid to refer to a person, and the media type registration for <code>application/rdf+xml</code> should not allow such an interpretation.
			</p>
			<p>
				Another source of constraints on fragid structures supported by a media type is support for content negotiation. When multiple representations with different media types are served for the same URL, fragids should be used consistently across those documents, either identifying content with the same semantic content in each representation, or giving an error.
			</p>
			<p>
				For example, it might be anticipated that documents in <a href="http://abcnotation.com/wiki/abc:standard:v2.1">ABC Music Notation</a> with a media type of <a href="http://www.iana.org/assignments/media-types/text/vnd.abc"><code>text/vnd.abc</code></a> would frequently be served up through content negotiation alongside documents in <a href="http://www.makemusic.com/musicxml/specification">MusicXML</a> with a media type of <a href="http://www.iana.org/assignments/media-types/application/vnd.recordare.musicxml+xml"><code>application/vnd.recordare.musicxml+xml</code></a>. People referring to music may want to reference particular bars within the musical score using fragids. To enable this to happen, both media types would need to support the same fragid structure, so that the same bar could be identified regardless of which content negotiated representation was served up. In this example, the two formats do not share the same metaformat and are not within the same top-level type: the need for consistency arises because the two formats have the same semantic content.
			</p>
			<p>
				With multiple potential fragid structures to comply with, there's the potential for the syntaxes of those structures to overlap with each other, which means that any given fragid might:
			</p>
			<ol>
				<li>identify the same part of the document under both interpretations</li>
				<li>only identify a part of the document under one interpretation (the fragid being an error under the alternative interpretation)</li>
				<li>identify different parts of the document under the different interpretations</li>
			</ol>
			<p>
				The last of these possibilities is problematic, and it can be hard for someone writing a URI reference to know which of these three categories a given fragid falls into. In addition, if the base document is changed after a given URI reference is created, a fragid might switch category, and suddenly become problematic without the creator of the URI reference being aware of the error.
			</p>
			<p>
				For these reasons, it is best if media types avoid syntactic conflicts between fragid structures. When syntactic overlaps occur due to a requirement to support different types of <em>generic</em> processing (ie to support generic processing based on the top-level type and generic processing based on a +suffix), the media type registrant should ensure that all fragids that are of the overlapping syntax identifies the same fragment in each; if that is not possible, the media type should not use the +suffix.
			</p>
			
			<div class="practice">
				<p>
					<span class="practicelab" id="consistent-generic-processing">Best Practice 1: Ensure Consistent Generic Processing of Overlapping Fragid Structures</span>
				</p>
				<p class="practicedesc">If two or more <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> used by different generic processors applicable to the media type overlap in syntax, they <em class="rfc2119" title="should">should</em> have consistent semantics for any <a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a> that use that common syntax.</p>
			</div>
			
			<p>
				There may also be syntactic overlaps between fragid structures that address application-specific fragments (as in the music notation example above), and between application-specific fragid structures and generic fragid structures. Applications that are aware of the application-specific fragid structures will know about and can therefore follow guidance within the media type registration about how to interpret fragids, so fragids that follow the syntax of more than one application-specific fragid structure can be resolved in a predictable and consistent manner across applications. The media type registration simply has to specify how this happens.
			</p>
			<div class="practice">
				<p>
					<span class="practicelab" id="specify-resolution-of-overlaps">Best Practice 2: Specify Resolution of Fragids that Comply with Multiple Fragid Structures</span>
				</p>
				<p class="practicedesc">If there's the possibility for a <a href="#dfn-fragid" class="internalDFN">fragid</a> to comply with the syntax of multiple <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> used by the media type, and the fragid would identify different fragments in those cases, the registration <em class="rfc2119" title="should">should</em> specify how such fragids are resolved.</p>
			</div>

			<p>
				Plain names are a common type of fragid structure. A <dfn id="dfn-plain-name-fragid">plain name fragid</dfn> is a <a href="#dfn-fragid" class="internalDFN">fragid</a> that is used to identify a named structure within a document, such as one identified by an <code>@id</code> attribute in HTML, a <code>@xml:id</code> attribute in XML or the name of a function within a Python program. These fragids are opaque to processors and as such they do not normally include punctuation characters, though this depends on the language: in XML, for example, they usually match the <a href="http://www.w3.org/TR/xml-names11/#NT-NCName">NCName</a> production from <a href="http://www.w3.org/TR/xml-names11/">XML Namespaces</a> [<cite><a class="bibref" href="#bib-XML-NAMES11">XML-NAMES11</a></cite>] which means they can contain hyphens (<code>-</code>) and periods (<code>.</code>).
			</p>
			<p>
				Plain name fragids are usually created by human authors but may also be generated by applications. They provide a good method of identifying content that is equivalent across content-negotiated variants of a document, for example paragraphs of text in French and Chinese that contain the same semantic content. Plain name fragids that do not identify a portion of a document are frequently used in Semantic Web applications as a way of providing an identifier for something described by the document.
			</p>
			<div class="practice">
				<p>
					<span class="practicelab" id="reserve-plain-name-fragids">Best Practice 3: Reserve Plain Name Fragids</span>
				</p>
				<p class="practicedesc">If the media type includes structures that can be given local names or identifiers, <a title="plain name fragid" href="#dfn-plain-name-fragid" class="internalDFN">plain name fragids</a> <em class="rfc2119" title="should">should</em> be reserved for addressing those structures.</p>
			</div>
			
			<p>
				Some media types support <dfn id="dfn-active-content">active content</dfn>, whereby scripts provided by the publisher are used to manipulate the document while it is being viewed. Depending on the scripting support in the media type, such scripts may use the <a href="#dfn-fragid" class="internalDFN">fragid</a> to encode application state (see <a href="http://www.w3.org/2001/tag/doc/IdentifyingApplicationState">Identifying Application State</a> for details). The presence of a script does not change what fragment a given fragid identifies, but individual scripts may extend the space of meaningful fragids for a particular document, by virtue of interpreting those fragids in code.
			</p>
			<p>
				As described in <a href="#authors" class="sectionRef sec-ref">section 7. Best Practices for Document Authors</a>, the developers of scripts need to ensure that when a fragid's behaviour is defined by the media type of a document, the script handles it consistently with that definition. Media type registrations therefore need to make it easy for such developers to understand how fragids will be interpreted by other applications, and what syntax can be used by script developers to encode application state. For example, in HTML hash-bang URIs, in which the fragid starts with <code>#!</code>, are commonly reserved for interpretation by scripts.
			</p>
			<div class="practice">
				<p>
					<span class="practicelab" id="specify-script-handling">Best Practice 4: Define Active Content Processing of Fragids</span>
				</p>
				<p class="practicedesc">If the media type supports active content, the registration <em class="rfc2119" title="should">should</em> specify any constraints on how scripts may process <a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a> adhering to known <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a>. The registration <em class="rfc2119" title="may">may</em> define a reserved syntax for fragids that are interpreted by scripts.</p>
			</div>
			
			<p>
				Aside from specifying support for plain name fragids and any fragid syntax reserved for use by scripts, individual media type registrations should not contain the specifications for media-type-specific fragid structures. Instead, registrants should consider creating a separate specification for the fragid structure, following the guidelines in <a href="#structures" class="sectionRef sec-ref">section 6. Best Practices for Fragid Structures</a>, and referencing that specification from the media type registration. This ensures that other media types with similar content can easily reference and reuse the same fragid structure.
			</p>
			<div class="practice">
				<p>
					<span class="practicelab" id="create-external-specifications">Best Practice 5: Avoid Specifying Fragid Structures within Media Type Registrations</span>
				</p>
				<p class="practicedesc">Media type registrations <em class="rfc2119" title="should">should</em> reference external <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> specifications where they exist, and the registrant <em class="rfc2119" title="should">should</em> create such specifications if required, rather than embedding the definitions of fragid structures within media type registrations.</p>
			</div>
			
			<p>
				It is possible for a given fragid used with a document to be an error in two ways:
			</p>
			<ul>
				<li>the fragid might not match the syntax of any of the fragid structures used by the media type</li>
				<li>the fragid might match the syntax but not resolve to a fragment of the document (for example because there is no named structure with a given plain name identifier)</li>
			</ul>
			<p>
				There are several legitimate reasons for fragids to error in these ways. Fragids, particularly plain name fragids, are sometimes used within URIs to identify things <em>described by</em> the document, rather than a fragment <em>within</em> the document. Active content may interpret otherwise unrecognised fragids. A given document may have a content-negotiated variant for which the fragid is meaningful. Thus the purpose of a media type registration is to define how recognised fragids are to be resolved, not to constrain the syntax of fragids used for a given document. The behaviour of an application faced with a fragid that does not resolve to a fragment for whatever reason should be implementation defined.
			</p>
		</section>
		
		<section id="suffixes">
			<!--OddPage--><h2><span class="secno">5. </span>Best Practices for +Suffix Registrations</h2>
			<p>
				<a title="+suffix registration" href="#dfn-suffix-registration" class="internalDFN">+Suffix registrations</a> are designed to enable generic processing of media types that share a <a href="#dfn-metaformat" class="internalDFN">metaformat</a> such as XML (<code>+xml</code>) and JSON (<code>+json</code>). These registrations should describe the generic processing of <a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a> within documents that use the metaformat.
			</p>
			<p>
				The processing of fragids for media types that adopt a <a href="#dfn-suffix" class="internalDFN">+suffix</a> and the media type for the metaformat itself should be identical. For example, fragids for <code>+xml</code> media types should be processed in the same way as fragids for the <code>application/xml</code> media type and fragids for <code>+json</code> should be processed in the same way as fragids for <code>application/json</code>. This ensures that generic processors designed for the generic media type can be used with the media types that adopt the +suffix.
			</p>
			<div class="practice">
				<p>
					<span class="practicelab" id="consistency-with-syntax">Best Practice 6: Process Fragids in the Same Way as for the Associated Media Type</span>
				</p>
				<p class="practicedesc"><a title="+suffix registration" href="#dfn-suffix-registration" class="internalDFN">+Suffix registrations</a> <em class="rfc2119" title="should">should</em> define <a href="#dfn-fragid" class="internalDFN">fragid</a> processing rules that are consistent with their associated media type.</p>
			</div>

			<p>
				As described in <a href="#registrations" class="sectionRef sec-ref">section 4. Best Practices for Media Type Registrations</a>, individual media types are required by <a href="http://tools.ietf.org/html/draft-ietf-appsawg-media-type-regs-14">Media Type Specifications and Registration Procedures</a> [RFCXXXX] to follow the fragid rules given in the registrations for any +suffixes that they adopt. They may need to adopt several <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> to support other generic processing or for consistency with other types with which they share semantics. For example, <code>image/svg+xml</code> needs to follow the generic fragid processing specified by the <code>+xml</code> registration as well as the generic processing of fragids used to identify portions of images.
			</p>

			<p>
				Fragid rules in +suffix registrations should therefore be focused on the generic processing of fragids for the <a href="#dfn-metaformat" class="internalDFN">metaformat</a>. They should not specify the behaviour of fragids that fall outside those generic fragid structures, because if they did it would be hard for media types to adopt fragid structures aside from those specified by the +suffix registration.
			</p>
			<div class="practice">
				<p>
					<span class="practicelab" id="enable-additional-fragids">Best Practice 7: Enable Additional Fragids to be Processed According to Media Type</span>
				</p>
				<p class="practicedesc"><a title="+suffix registration" href="#dfn-suffix-registration" class="internalDFN">+Suffix registrations</a> <em class="rfc2119" title="should not">should not</em> classify as errors <a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a> that do not match the defined fragid syntax for the +suffix or that do not resolve to a fragment, or constrain what they identify; instead the +suffix registration <em class="rfc2119" title="should">should</em> say that such fragids are resolved according to rules in the registration of specific media type that adopts the +suffix.</p>
			</div>
			
			<p>
				As described in <a href="#registrations" class="sectionRef sec-ref">section 4. Best Practices for Media Type Registrations</a>, <a title="plain name fragid" href="#dfn-plain-name-fragid" class="internalDFN">plain name fragids</a> are commonly used within media types to address named structures within a document. The ways in which these structures are named may be specified at the metaformat level, or at the specific media type level, or both. For example, XML itself defines a mechanism for naming elements within a document (using <a href="http://www.w3.org/TR/xml-id/"><code>xml:id</code> attributes</a> [<cite><a class="bibref" href="#bib-XML-ID">XML-ID</a></cite>] and the <a href="http://www.w3.org/TR/REC-xml/#id"><code>ID</code> attribute type</a>), but an XML-based markup language such as RDF/XML may specify an alternative semantics for plain name fragids, such as their RDF semantics.
			</p>
			<p>
				Following the two best practices above ensures that plain name fragids which identify fragments through the generic processing of the metaformat have a consistent semantics based on that processing, while the semantics of those that do not identify a fragment according to that generic processing can be determined by the individual media type.
			</p>
		</section>
		
		<section id="structures">
			<!--OddPage--><h2><span class="secno">6. </span>Best Practices for Fragid Structures</h2>
			<p>
				A <dfn id="dfn-fragid-structure">fragid structure</dfn> is a defined set of <a href="#dfn-fragid" class="internalDFN">fragid</a> syntax, semantics and processing requirements. A fragid structure may be specific to a particular media type but is often shared across a range of media types. Examples of cross-media-type fragid structures are XPointer [<cite><a class="bibref" href="#bib-XPTR-FRAMEWORK">XPTR-FRAMEWORK</a></cite>] and Media URI Fragments [<cite><a class="bibref" href="#bib-MEDIA-FRAGMENTS">MEDIA-FRAGMENTS</a></cite>].
			</p>
			<p>
				As described in <a href="#registrations" class="sectionRef sec-ref">section 4. Best Practices for Media Type Registrations</a>, a media type may adopt multiple fragid structures, and it can be a problem specifying processing if these have overlapping syntaxes with different semantics. Generally, fragid structures fall into two categories:
			</p>
			<ul>
				<li><dfn title="syntax-based fragid structure" id="dfn-syntax-based-fragid-structure">syntax-based fragid structures</dfn> provide access to structures within a document based on the syntax used by the document; XPointer is an example</li>
				<li><dfn title="semantic fragid structure" id="dfn-semantic-fragid-structure">semantic fragid structures</dfn> provide access to semantic fragments of a document based on the information that it encodes, and may be used across multiple media types that use different syntaxes; media fragment URIs are an example</li>
			</ul>
			<p>
				If the syntax of a syntax-based fragid structure overlaps with that of a semantic fragid structure, they cannot be used together, which constrains how they might be used. Similarly, if the syntax of two semantic fragid structures that could both apply to a given media type overlap and identify different things, the media type will have to specify which takes precedence during fragid processing. The designers of new fragid structures should therefore be careful to avoid clashing with existing fragid structures that could feasibly be used in combination. In particular, the developers of semantic fragid structures should avoid conflicts with known syntax-based fragid structures, such as XPointer.
			</p>
			<div class="practice">
				<p>
					<span class="practicelab" id="avoid-conflicts">Best Practice 8: Avoid Conflicting with Existing Fragid Structures</span>
				</p>
				<p class="practicedesc">New <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> <em class="rfc2119" title="should">should</em> avoid overlapping with the syntax used by existing fragid structures that could be used in combination with them.</p>
			</div>
			
			<p>
				Fragid structures are most useful when they can be adopted by a range of media types. This enables them to be used by generic processors and helps authors to reference structures common across multiple representations of content-negotiated resources. Fragid structures should therefore be targetted towards common use across media types rather than being media-type specific. For example, rather than designing a fragid structure to be used to identify musical structures purely with MusicML, designers should take into account other formats used to represent music with which the fragid structure could be used.
			</p>
			<div class="practice">
				<p>
					<span class="practicelab" id="specify-at-general-level">Best Practice 9: Define Fragid Structures for General Use</span>
				</p>
				<p class="practicedesc">New <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> <em class="rfc2119" title="should">should</em> be defined such that they can be used across media types that share the same syntax or semantics rather than being tuned specifically to a single media type.</p>
			</div>
		</section>
		
		<section id="authors">
			<!--OddPage--><h2><span class="secno">7. </span>Best Practices for Document Authors</h2>
			<p>
				There are two categories of usage of <a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a> by document authors: publishing documents that contain addressable content or use scripts that process fragids, and using fragids within referenced URIs to address content on documents published by others.
			</p>
			<section id="publishers">
				<h3><span class="secno">7.1 </span>Best Practices for Publishers</h3>
				<p>
					<a title="fragid" href="#dfn-fragid" class="internalDFN">Fragids</a> are not passed to servers for processing, but publishers can influence the interpretation of fragids within documents they publish, typically by naming structures within them so that they can be addressed through <a title="plain name fragid" href="#dfn-plain-name-fragid" class="internalDFN">plain name fragids</a>. As described in [<cite><a class="bibref" href="#bib-WEBARCH">WEBARCH</a></cite>], when publishers do this with content-negotiated resources, they should make sure that each plain name fragid identifies a set of fragments with consistent semantics across the content-negotiated representations.
				</p>
				<div class="practice">
					<p>
						<span class="practicelab" id="consistent-conneg">Best Practice 10: Name Structures Consistently Across Content-Negotiated Representations</span>
					</p>
					<p class="practicedesc">Publishers <em class="rfc2119" title="should">should</em> ensure that structures identifiable with the same <a href="#dfn-fragid" class="internalDFN">fragid</a> in two content-negotiated representations have the same semantics. Equally, where two structures in content-negotiated representations have the same semantics, they <em class="rfc2119" title="should">should</em> be addressable through the same fragid.</p>
				</div>
				
				<p>
					Publishers are also responsible for any scripts called from documents that they publish. Scripts can enhance the display of fragments within documents, for example by smoothly scrolling to the relevant area of the document, highlighting it, or zooming in or out to the selected area. Scripts may also process and alter fragids as a way of managing application state, as described in <a href="http://www.w3.org/2001/tag/doc/IdentifyingApplicationState">Identifying Application State</a>.
				</p>
				<p>
					Scripts do not change what a fragid identifies, but they can change what users see. For users viewing a document, it is helpful if scripts handle fragids in a way that is consistent with how they are resolved based on the media type. For example, given an HTML document, it would be confusing if a fragid <code>#example</code> were interpreted by a script as meaning that all instances of the word <code>example</code> should be highlighted, rather than scrolling to the HTML anchor named <code>example</code>. As described in <a href="#specify-script-handling"></a>, media type registrations may specify constraints on how fragids are handled by scripts, and may specify a reserved syntax for scripts that wish to use fragids to store application state.
				</p>
				<div class="practice">
					<p>
						<span class="practicelab" id="consistent-script-processing">Best Practice 11: Scripts Must Adhere to Constraints Specified within Media Type Registrations</span>
					</p>
					<p class="practicedesc">Scripts <em class="rfc2119" title="must">must</em> adhere to any constraints that are placed on their behaviour in the appropriate media type registration.</p>
				</div>
			</section>
			
			<section id="referrers">
				<h3><span class="secno">7.2 </span>Best Practices for Referrers</h3>
				<p>
					Different <a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a> are understood by different processors and have different longevity and utility across content-negotiated representations of a resource:
				</p>
				<ul>
					<li><a title="plain name fragid" href="#dfn-plain-name-fragid" class="internalDFN">plain name fragids</a> are typically author-generated, and therefore are relevant for so long as the structure that is named can be found within the document; referencing them can be useful when dealing with content-negotiated resources as publishers should ensure that they are consistently used across representations, but they generally require interpretation by processors that are aware of the particular media type of the representation</li>
					<li>referencing <a title="semantic fragid structure" href="#dfn-semantic-fragid-structure" class="internalDFN">semantic fragid structures</a> such as Media Fragment URIs is particularly useful when addressing content-negotiated resources or resources that do not support plain name fragids; they are also likely to be more robust than syntax-based fragids in the face of changes, but like plain name fragids usually require interpretation by processors that are aware of the specific media type of the representation</li>
					<li><a title="syntax-based fragid structure" href="#dfn-syntax-based-fragid-structure" class="internalDFN">syntax-based fragid structures</a> such as XPointer are useful when targetting a representation that uses a known format, particularly as they can be used by generic processors without knowledge of the underlying media type; they can be fragile in the face of changes to the underlying document, however, and do not generally work across content-negotiated variants (and when they do, they are likely to identify different fragments)</li>
				</ul>
				<p>
					In general, plain name and semantic fragids are much more useful than syntax-based fragids, the exception being when specifically targetting fragments of a document in a particular format for processing.
				</p>
				
				<div class="practice">
					<p>
						<span class="practicelab" id="avoid-syntax-based-fragids">Best Practice 12: Do Not Use Syntax-Based Fragids with Multiple Content-Negotiated Variants</span>
					</p>
					<p class="practicedesc">Authors <em class="rfc2119" title="should not">should not</em> use URIs with <a title="syntax-based fragid structure" href="#dfn-syntax-based-fragid-structure" class="internalDFN">syntax-based fragids</a> unless they can ascertain (through server documentation, an HTTP <code>OPTIONS</code> request or other methods) that the base URI addresses a resource with a single representation format.</p>
				</div>
			</section>
		</section>

		<section class="appendix" id="acknowledgements"> 
			<!--OddPage--><h2><span class="secno">A. </span>Acknowledgements</h2> 
			<p> 
				Many thanks to Robin Berjon, Tim Berners-Lee, Sebastian Hellmann, Yves Lafon, Chris Lilley, Peter Linss, Ashok Malhotra, Larry Masinter, Noah Mendelsohn, Jonathan Rees and Henry Thompson for their comments, and to Robin Berjon for <a href="http://respec.specifiction.com/">ReSpec.js</a>.
			</p> 
		</section> 
		
		<section class="appendix" id="analysis">
			<!--OddPage--><h2><span class="secno">B. </span>Analysis</h2>
			<p>
				This appendix looks at various <a title="fragid structure" href="#dfn-fragid-structure" class="internalDFN">fragid structures</a> that apply to SVG and uses as an example a simple bar chart at <code>http://example.org/potter</code>, which has an SVG representation:
			</p>
			<pre>&lt;svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225"&gt;
  &lt;g stroke="grey" stroke-width="40"&gt;
    &lt;line id="harry" x1="50" x2="50" y1="300" y2="50" /&gt;
    &lt;line id="hermione" x1="100" x2="100" y1="300" y2="0" /&gt;
    &lt;line id="ron" x1="150" x2="150" y1="300" y2="100" /&gt;
    &lt;line id="hagrid" x1="200" x2="200" y1="300" y2="50" /&gt;
    &lt;line id="dumbledore" x1="250" x2="250" y1="300" y2="150" /&gt;
  &lt;/g&gt;
&lt;/svg&gt;
			</pre>
			<p>which appears as:</p>
			<svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225">
				<g stroke="grey" stroke-width="40">
					<line x1="50" x2="50" y1="300" y2="50"></line>
					<line x1="100" x2="100" y1="300" y2="0"></line>
					<line x1="150" x2="150" y1="300" y2="100"></line>
					<line x1="200" x2="200" y1="300" y2="50"></line>
					<line x1="250" x2="250" y1="300" y2="150"></line>
				</g>
			</svg>
			<section id="media-fragment-uris">
				<h3><span class="secno">B.1 </span>Media Fragment URIs</h3>
				<p>
					The Media Fragment URIs specification [<cite><a class="bibref" href="#bib-MEDIA-FRAGMENTS">MEDIA-FRAGMENTS</a></cite>] defines a <a href="#dfn-fragid-structure" class="internalDFN">fragid structure</a> for images, videos and audio. They cover identification of spatial areas, time segments, tracks or named segments.
				</p>
				<p>
					Under that specification, the area covering the first two lines within the example bar chart can be addressed using a URI like:
				</p>
				<pre>http://example.org/potter#xywh=25,0,100,225</pre>
				<p>which would identify the area highlighted here:</p>
				<svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225">
					<rect x="25" y="0" width="100" height="225" fill="yellow"></rect>
					<g stroke="grey" stroke-width="40">
						<line x1="50" x2="50" y1="300" y2="50"></line>
						<line x1="100" x2="100" y1="300" y2="0"></line>
						<line x1="150" x2="150" y1="300" y2="100"></line>
						<line x1="200" x2="200" y1="300" y2="50"></line>
						<line x1="250" x2="250" y1="300" y2="150"></line>
					</g>
				</svg>
				<p>
					The syntax for <a title="fragid" href="#dfn-fragid" class="internalDFN">fragids</a> defined as part of that specification is:
				</p>
				<pre>namevalues = namevalue *( "&amp;" namevalue )
namevalue  = name [ "=" value ]
name       = fragment - "&amp;" - "="
value      = fragment - "&amp;"

; defined in RFC 3986
fragment      = *( pchar / "/" / "?" )
pchar         = unreserved / pct-encoded / sub-delims / ":" / "@"
unreserved    = ALPHA / DIGIT / "-" / "." / "_" / "~"
pct-encoded   = "%" HEXDIG HEXDIG
sub-delims    = "!" / "$" / "&amp;" / "'" / "(" / ")" / "*" / "+" / "," / ";" / "="

; defined in RFC 5234
ALPHA         =  %x41-5A / %x61-7A   ; A-Z / a-z
DIGIT         =  %x30-39 ; 0-9
HEXDIG        =  DIGIT / "A" / "B" / "C" / "D" / "E" / "F"
				</pre>
				<p>
					This syntax essentially allows anything within a fragid, although applications that follow the specification will attempt to interpret any fragid on an image, audio or video representation as a set of <code>name[=value]</code> pairs separated by ampersands.
				</p>
				<p>
					Named segments under this specification are addressable with the syntax <code>id=<var>id</var></code>. Thus, the URI:
				</p>
				<pre>http://example.org/potter#id=hermione</pre>
				<p>
					could (assuming an application that recognises <code>id</code> attributes in SVG as naming segments addressable through fragid structures defined in the Media Fragment URI specifications) identify the second bar within the bar chart, which has been labelled as <code>hermione</code>.
				</p>
			</section>
			
			<section id="xml-media-types">
				<h3><span class="secno">B.2 </span>XML Media Types</h3>
				<p>
					The <a href="http://www.w3.org/2006/02/son-of-3023/draft-murata-kohn-lilley-xml-04.html#frag">XML Media Types Draft</a> defines (among other things) syntax and processing for fragids for <code>*/*+xml</code> media types. It states (emphasis added):
				</p>
				<blockquote>
					<p>A family of specifications define fragment identifiers for XML media types. A modular syntax and semantics of fragment identifiers for the XML media types is as defined by the [XPointerFramework] <abbr title="World Wide Web Consortium">W3C</abbr> Recommendation. It allows simple names, and more complex constructions based on named schemes. <strong>The syntax of a fragment identifier part of any URI or IRI with a retrieved media type governed by the specification <em class="rfc2119" title="must">must</em> conform to the syntax specified in [XPointerFramework]. Conformant applications <em class="rfc2119" title="must">must</em> interpret such fragment identifiers as designating that part of the retrieved representation specified by [XPointerFramework] and whatever other specifications define any XPointer schemes used.</strong> Conformant applications <em class="rfc2119" title="must">must</em> support the 'element' scheme as defined in [XPointerElement].</p>
					<p>A registry of XPointer schemes [XPtrReg] is maintained at the <abbr title="World Wide Web Consortium">W3C</abbr>. Unregistered schemes <em class="rfc2119" title="should not">should not</em> be used.</p>
					<p>When an XML-based MIME media type follows the naming convention '+xml', the fragment identifier syntax for this media type <em class="rfc2119" title="may">may</em> restrict the syntax to a specified subset of schemes, but <em class="rfc2119" title="must">must</em> support barenames and 'element' scheme pointers. It <em class="rfc2119" title="may">may</em> further allow other registered schemes such as the xmlns scheme and other schemes.</p>
					<p>If [XPointerFramework] and [XPointerElement] are inappropriate for some XML-based media type, it <em class="rfc2119" title="should not">should not</em> follow the naming convention '+xml'.</p>
				</blockquote>
				<p>
					The XML Media Types draft thus defers the interpretation for fragids for <code>*/*+xml</code> media types to XPointer. XPointer specifies the syntax:
				</p>
				<pre>[1]   	Pointer        ::=   	Shorthand | SchemeBased
[2]   	Shorthand      ::=   	NCName
[3]   	SchemeBased    ::=   	PointerPart (S? PointerPart)*
[4]   	PointerPart    ::=   	SchemeName '(' SchemeData ')'
[5]   	SchemeName     ::=   	QName
[6]   	SchemeData     ::=   	EscapedData*
[7]   	EscapedData    ::=   	NormalChar | '^(' | '^)' | '^^' | '(' SchemeData ')'
[8]   	NormalChar     ::=   	UnicodeChar - [()^]
[9]   	UnicodeChar    ::=   	[#x0-#x10FFFF]
				</pre>
				<p>
					For example, because SVG is XML, the second of the <code>line</code> elements in the SVG bar chart can be addressed using:
				</p>
				<pre>http://example.org/potter#element(/1/1/2)</pre>
				<p>
					This is highlighted in the following XML:
				</p>
				<pre>&lt;svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225"&gt;
  &lt;g stroke="grey" stroke-width="40"&gt;
    &lt;line id="harry" x1="50" x2="50" y1="300" y2="50" /&gt;
    <span style="background-color: yellow">&lt;line id="hermione" x1="100" x2="100" y1="300" y2="0" /&gt;</span> 
    &lt;line id="ron" x1="150" x2="150" y1="300" y2="100" /&gt;
    &lt;line id="hagrid" x1="200" x2="200" y1="300" y2="50" /&gt;
    &lt;line id="dumbledore" x1="250" x2="250" y1="300" y2="150" /&gt;
  &lt;/g&gt;
&lt;/svg&gt;
				</pre>
				<p>
					The scheme used within a scheme-based XPointer determines what it identifies; the <code>element()</code> XPointer scheme used above is used to identify element nodes for example. The XPointer Framework specification also states:
				</p>
				<blockquote>
					<p>A shorthand pointer, formerly known as a barename, consists of an NCName alone. It identifies at most one element in the resource's information set; specifically, the first one (if any) in document order that has a matching NCName as an identifier.</p>				
				</blockquote>
				<p>
					This defines the semantics of a simple fragment identifier, such that a URI such as:
				</p>
				<pre>http://example.org/potter#hermione</pre>
				<p>
					means an element within the XML information set, in this case the second <code>line</code> element node.
				</p>
			</section>
			
			<section id="svg-fragment-identifiers">
				<h3><span class="secno">B.3 </span>SVG Fragment Identifiers</h3>
				<p>
					SVG itself describes how fragids can be used to identify views on SVG content. It says:
				</p>
				<blockquote>
					<p>An SVG fragment identifier can come in two forms:</p>
					<ul>
						<li>Shorthand bare name form of addressing (e.g., MyDrawing.svg#MyView). This form of addressing, which allows addressing an SVG element by its ID, is compatible with the fragment addressing mechanism for older versions of HTML.</li>
						<li>SVG view specification (e.g., MyDrawing.svg#svgView(viewBox(0,200,1000,1000))). This form of addressing specifies the desired view of the document (e.g., the region of the document to view, the initial zoom level) completely within the SVG fragment specification. The contents of the SVG view specification are the five parameter specifications, viewBox(...), preserveAspectRatio(...), transform(...), zoomAndPan(...) and viewTarget(...), whose parameters have the same meaning as the corresponding attributes on a ‘view’ element, or, in the case of transform(...), the same meaning as the corresponding attribute has on a ‘g’ element).</li>
					</ul>
				</blockquote>
				<p>
					SVG's fragids are conformant with XPointer: they follow the same syntax and are defined in the terms given in XPointer. For example, the URI:
				</p>
				<pre>http://example.org/potter#hermione</pre>
				<p>
					in this case will address the element with the ID <code>hermione</code>, highlighted here:
				</p>
				<pre>&lt;svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225"&gt;
  &lt;g stroke="grey" stroke-width="40"&gt;
    &lt;line id="harry" x1="50" x2="50" y1="300" y2="50" /&gt;
    <span style="background-color: yellow">&lt;line id="hermione" x1="100" x2="100" y1="300" y2="0" /&gt;</span> 
    &lt;line id="ron" x1="150" x2="150" y1="300" y2="100" /&gt;
    &lt;line id="hagrid" x1="200" x2="200" y1="300" y2="50" /&gt;
    &lt;line id="dumbledore" x1="250" x2="250" y1="300" y2="150" /&gt;
  &lt;/g&gt;
&lt;/svg&gt;
				</pre>
				<p>
					When fragids of this kind are used, SVG uses <a href="http://www.w3.org/TR/selectors/#target-pseudo">CSS's <code>:target</code> pseudo-class</a> which enables the identified element to be highlighted. For example, the SVG:
				</p>
				<pre>&lt;svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225"&gt;
  &lt;style type="text/css"&gt;
    line:target { stroke: red; }
  &lt;/style&gt;
  &lt;g stroke="grey" stroke-width="40"&gt;
    &lt;line id="harry" x1="50" x2="50" y1="300" y2="50" /&gt;
    &lt;line id="hermione" x1="100" x2="100" y1="300" y2="0" /&gt;
    &lt;line id="ron" x1="150" x2="150" y1="300" y2="100" /&gt;
    &lt;line id="hagrid" x1="200" x2="200" y1="300" y2="50" /&gt;
    &lt;line id="dumbledore" x1="250" x2="250" y1="300" y2="150" /&gt;
  &lt;/g&gt;
&lt;/svg&gt;
				</pre>
				<p>
					means that the URI
				</p>
				<pre>http://example.org/potter#hermione</pre>
				<p>
					is displayed with the second <code>line</code> (identified as <code>hermione</code>) stroked in red:
				</p>
<svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225">
	<g stroke="grey" stroke-width="40">
		<line x1="50" x2="50" y1="300" y2="50"></line>
		<line x1="100" x2="100" y1="300" y2="0" stroke="red"></line>
		<line x1="150" x2="150" y1="300" y2="100"></line>
		<line x1="200" x2="200" y1="300" y2="50"></line>
		<line x1="250" x2="250" y1="300" y2="150"></line>
	</g>
</svg>
				<p>
					SVG introduces a <code>svgView()</code> XPointer scheme that is used to describe views onto SVG images; one possible argument is <code>viewBox()</code>, which selects a particular area of an image in the same way as the <code>xywh</code> parameter defined for Media Fragment URIs described above. Thus the URI:
				</p>
				<pre>http://example.org/potter#svgView(viewBox(25,0,100,225))</pre>
				<p>
					identifies the area of the chart that covers the first two bars.
				</p>
			</section>
			
			<section id="active-content">
				<h3><span class="secno">B.4 </span>Active Content</h3>
				<p>
					SVG, like HTML, enables scripts to be embedded within documents and to respond to events such as clicks on particular parts of the content. Active content can read the document location and base the behaviour of the script on the fragid. 
				</p>
				<p>
					For example, the following SVG parses the fragid that's used to access the bar chart and uses it to highlight one of the bars:
				</p>
				<pre>&lt;svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225" onload="highlight()"&gt;
  &lt;script type="application/ecmascript"&gt;
    function highlight () {
      var id = document.location.hash.substring(1);
      if (id) {
        var element = document.getElementsByTagName('line')[id];
        if (element) {
          element.setAttribute('stroke', 'red');
        }
      }
    }
  &lt;/script&gt;
  &lt;g stroke="grey" stroke-width="40"&gt;
    &lt;line id="harry" x1="50" x2="50" y1="300" y2="50" /&gt;
    &lt;line id="hermione" x1="100" x2="100" y1="300" y2="0" /&gt;
    &lt;line id="ron" x1="150" x2="150" y1="300" y2="100" /&gt;
    &lt;line id="hagrid" x1="200" x2="200" y1="300" y2="50" /&gt;
    &lt;line id="dumbledore" x1="250" x2="250" y1="300" y2="150" /&gt;
  &lt;/g&gt;
&lt;/svg&gt;
				</pre>
				<p>
					The URI:
				</p>
				<pre>http://example.org/potter#2</pre>
				<p>
					thus highlights the second bar within the bar chart.
				</p>
				<p>
					In this case, the recognised syntax of the fragid is determined by the script, which recognises any numeric fragid between one and five. The fragid has no declarative semantics -- there is no specification that says what it means -- but in effect this script supports the identification of a bar of the bar chart through a fragid.
				</p>
			</section>
			
			<section id="semantic-content">
				<h3><span class="secno">B.5 </span>Semantic Content</h3>
				<p>
					SVG allows extensions; any element in a different namespace will be ignored by SVG processors. This facility can be used to embed semantic content through RDF/XML.
				</p>
				<p>
					The following example contains some RDF/XML which makes some basic assertions about the resource
				</p>
				<pre>http://example.org/potter#hermione</pre>
				<p>
					This resource has been identified with a fragid within an SVG document like this:
				</p>
				<pre>&lt;svg xmlns="http://www.w3.org/2000/svg" width="150px" height="120px" viewBox="0 0 300 225"&gt;
  &lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns:foaf="http://xmlns.com/foaf/0.1/"&gt;
    &lt;foaf:Person rdf:about="#hermione"&gt;
      &lt;foaf:name&gt;Hermione Granger&lt;/foaf:name&gt;
    &lt;/foaf:Person&gt;
  &lt;/rdf:RDF&gt;
  &lt;g stroke="grey" stroke-width="40"&gt;
    &lt;line x1="50" x2="50" y1="300" y2="50" /&gt;
    &lt;line x1="100" x2="100" y1="300" y2="0" /&gt;
    &lt;line x1="150" x2="150" y1="300" y2="100" /&gt;
    &lt;line x1="200" x2="200" y1="300" y2="50" /&gt;
    &lt;line x1="250" x2="250" y1="300" y2="150" /&gt;
  &lt;/g&gt;
&lt;/svg&gt;
				</pre>
				<p>
					In semantic content, fragids can mean anything. In this particular example, we can tell from the RDF that the above URI means the person named Hermione Granger. It is common practice when using RDF for URIs that include fragids to be used to refer to things that are <em>described by</em> the document retrieved at the base URI, as this makes it easy to serve RDF content.
				</p>
			</section>
			
		</section>
	 

<section id="references" class="appendix"><!--OddPage--><h2><span class="secno">C. </span>References</h2><section id="normative-references"><h3><span class="secno">C.1 </span>Normative references</h3><dl class="bibliography"><dt id="bib-RFC2119">[RFC2119]</dt><dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key words for use in RFCs to Indicate Requirement Levels.</cite></a> March 1997. Internet RFC 2119.  URL: <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a> 
</dd><dt id="bib-URI">[URI]</dt><dd>T. Berners-Lee; R. Fielding; L. Masinter. <a href="http://www.ietf.org/rfc/rfc3986.txt"><cite>Uniform Resource Identifiers (URI): generic syntax.</cite></a> January 2005. Internet RFC 3986. URL: <a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a> 
</dd></dl></section><section id="informative-references"><h3><span class="secno">C.2 </span>Informative references</h3><dl class="bibliography"><dt id="bib-MEDIA-FRAGMENTS">[MEDIA-FRAGMENTS]</dt><dd>Raphael Troncy; Erik Mannens; Silvia Pfeiffer and Davy Van Deursen. <a href="http://www.w3.org/TR/2011/WD-media-frags-20110317/"><cite>Media Fragments URI 1.0</cite></a>. W3C Working Draft 17 March 2011. URL: <a href="http://www.w3.org/TR/2011/WD-media-frags-20110317/">http://www.w3.org/TR/2011/WD-media-frags-20110317/</a> 
</dd><dt id="bib-RFC2046">[RFC2046]</dt><dd>N. Freed; N. Borenstein. <a href="http://www.ietf.org/rfc/rfc2046.txt"><cite>Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types.</cite></a> November 1996. Internet RFC 2046. URL: <a href="http://www.ietf.org/rfc/rfc2046.txt">http://www.ietf.org/rfc/rfc2046.txt</a> 
</dd><dt id="bib-RFC3986">[RFC3986]</dt><dd>T. Berners-Lee; R. Fielding; L. Masinter. <a href="http://www.ietf.org/rfc/rfc3986.txt"><cite>Uniform Resource Identifier (URI): Generic Syntax.</cite></a> January 2005. Internet RFC 3986. URL: <a href="http://www.ietf.org/rfc/rfc3986.txt">http://www.ietf.org/rfc/rfc3986.txt</a> 
</dd><dt id="bib-SVG11">[SVG11]</dt><dd>Erik Dahlström; et al. <a href="http://www.w3.org/TR/2011/REC-SVG11-20110816/"><cite>Scalable Vector Graphics (SVG) 1.1 (Second Edition).</cite></a> 16 August 2011. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2011/REC-SVG11-20110816/">http://www.w3.org/TR/2011/REC-SVG11-20110816/</a> 
</dd><dt id="bib-WEBARCH">[WEBARCH]</dt><dd>Norman Walsh; Ian Jacobs. <a href="http://www.w3.org/TR/2004/REC-webarch-20041215/"><cite>Architecture of the World Wide Web, Volume One.</cite></a> 15 December 2004. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2004/REC-webarch-20041215/">http://www.w3.org/TR/2004/REC-webarch-20041215/</a> 
</dd><dt id="bib-XML-ID">[XML-ID]</dt><dd>Daniel Veillard; Jonathan Marsh; Norman Walsh. <a href="http://www.w3.org/TR/2005/REC-xml-id-20050909"><cite>xml:id Version 1.0.</cite></a> 9 September 2005. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2005/REC-xml-id-20050909">http://www.w3.org/TR/2005/REC-xml-id-20050909</a> 
</dd><dt id="bib-XML-NAMES11">[XML-NAMES11]</dt><dd>Andrew Layman; et al. <a href="http://www.w3.org/TR/2006/REC-xml-names11-20060816"><cite>Namespaces in XML 1.1 (Second Edition).</cite></a> 16 August 2006. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2006/REC-xml-names11-20060816">http://www.w3.org/TR/2006/REC-xml-names11-20060816</a> 
</dd><dt id="bib-XPTR-FRAMEWORK">[XPTR-FRAMEWORK]</dt><dd>Paul Grosso; et al. <a href="http://www.w3.org/TR/2003/REC-xptr-framework-20030325/"><cite>XPointer Framework.</cite></a> 25 March 2003. W3C Recommendation. URL: <a href="http://www.w3.org/TR/2003/REC-xptr-framework-20030325/">http://www.w3.org/TR/2003/REC-xptr-framework-20030325/</a> 
</dd></dl></section></section></body></html>
