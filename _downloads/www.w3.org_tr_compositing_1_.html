<!-- http://www.w3.org/TR/compositing-1/ -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">

<html lang=en>
 <head
  profile="http://dublincore.org/documents/2008/08/04/dc-html/ http://www.w3.org/2006/03/hcard">
  <title>Compositing and Blending Level 1</title>

  <link href="http://purl.org/dc/terms/" rel=schema.dcterms>
  <link href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
   rel=dcterms.rights>
  <meta content="Compositing and Blending Level 1" name=dcterms.title>
  <meta content=text name=dcterms.type>
  <meta content=2014-02-20 name=dcterms.date>
  <meta content="Rik Cabanier" name=dcterms.creator>
  <meta content="Nikos Andronikos" name=dcterms.creator>
  <meta content=W3C name=dcterms.publisher>
  <meta content="http://www.w3.org/TR/2014/CR-compositing-1-20140220/"
   name=dcterms.identifier>
  <meta content="text/html; charset=UTF-8" http-equiv=content-type>
  <style type="text/css">
  
  /* Alternate stylesheet fonts are here because in some browsers (Opera 11.5) */
  /* The fonts are not applied if only loaded from the alternate stylesheet    */
  
  /* License font the following two fonts: fonts/Droid-Serif-fontfacekit/Google Android License.txt */
  @import url(fonts/Droid-Serif-fontfacekit/stylesheet.css);
  @import url(fonts/Droid-Sans-Mono-fontfacekit/stylesheet.css);

         a.toggle {
             position: fixed;
             top: 0.5em;
             right: 0.5em;
         	font-size: smaller;
         	color: gray;
         	opacity: 0.2;
         }

         a.toggle:hover {
             opacity: 1;
             color: #46A4E9;
         }
         
         .issue.resolved, .issue.stale, .issue.moved {
             display: none;
         }
         
         
         #region-style-example p, #region-style-example pre {
         	clear: both;
         }

         #region_styling_illustration {
         	margin: 0px auto;
         	width: 70ex;
         }
         
         .big.note {
             font-size: 1.2em;
             line-height: 1.3em;
             color: #2f2f2f;
         }
         
         #mobile-logo {
             display: none;
         }
         
         @media screen and (min-width: 68em){    
             
                  .issue-marker {
                      position: absolute;
                      width: 20ex;
                      margin-left: -22ex;
                      text-align: right;
                      margin-bottom: 1em;
                  }
                  
                  div.issue-marker .issue-marker {
                      position: static;
                      width: auto;
                      margin-left: 0;
                      text-align: right;
                  }  
                  
                  div.issue-marker {
                      position: absolute;
                      width: 20ex;
                      margin-left: -22ex;
                  }
         }

         @media screen and (max-width: 68em){
                  .issue-marker {
                      margin-bottom: 1em;
                  }
                  
                  .issue-marker a:link {
                      padding-left: 0.5em;
                  }
         } 
         
         #issue-manager form{
             background: #eee;
             padding:10px 1em;
         }
         
         /* hide all non-"updated" issues */
         #issue-manager[data-view_state="updated"] #issue-list>div:not([data-issue_state="updated"]){
             display:none;
         }
            
         /* hide all non-"new" issues */
         #issue-manager[data-view_state="new"] #issue-list>div:not([data-issue_state="new"]){
             display:none;
         }
                  
          #issue-manager .issue-marker{ 
              background: none;
              position: relative;  
              margin:0; 
              width:auto;
              text-align:left; 
              padding:0.5em 0;
          }
          
          #issue-manager .issue-marker a:link{
              padding:0.5em;
          }
          
          #issue-list div[data-issue_state="new"]{
              background:#C1FFC1;
          }  

          #issue-list div[data-issue_state="resolved"]{
              background:white;
              color: #a0a0a0;
          }  

          #issue-list div[data-issue_state="updated"]{
              background:papayawhip;
          }     
          
          #issue-list{
              margin-top:20px;
          }

          #issue-list pre{
              padding:1em;
              margin:0;
          }   
          
          #issue-list>div{
              position:relative;
          }
          
          #issue-list a.issue-markup-trigger{  
              font-size: 0.8em;
              padding: 0.2em 0.5em;
              background: #eee;      
              text-decoration: none;    
              color: #444;
              position: absolute;
              right: 10px;
              top: 10px;  
              z-index: 1;
          }  
          
           #issue-list a.issue-markup-trigger:hover{
               background: #ddd;
               color: #000;
           }                        
          
          #issue-list .showMarkup pre{
              display: block;
          }                           
          
          #issue-list .showMarkup .issue-marker,
          #issue-list pre{
              display: none;
          }
      
         .issue-marker {
              background:#eee;  
              border:1px solid #ddd; 
              font-size: 1em;
          }
          
          .issue-marker.wrapper {
              background: none;
              border: none;
          }

         .issue-marker a:link {
              color: #c00;
              background: none;
              font-weight: normal;
              padding-right: 0.5em;
          }
         
         .issue-details {  
              padding:0.5em;
              font-size: 0.8em;
              line-height: 1.5;
          }

         .issue-details p{
              padding:0;
              margin:0; 
          }           

         .issue-details .status{
              background:#333;   
              color:white;
              float:left;    
              padding:0.15em 0.8em;    
              font-size:0.8em;
              margin-right:0.8em;
              text-transform:uppercase;      
          }
       </style>
  <link href="style/alternate-spec-style.css" id=st
   rel="alternate stylesheet" title="alternate spec style" type="text/css">
  <link href="http://www.w3.org/StyleSheets/TR/W3C-CR.css" rel=stylesheet
   type="text/css">

 <body>
  <div class=head id=div-head> <!--begin-logo-->
   <p><a href="http://www.w3.org/"><img alt=W3C height=48
    src="http://www.w3.org/Icons/w3c_home" width=72></a> <!--end-logo-->

   <h1>Compositing and Blending Level 1</h1>

   <h2 class="no-num no-toc" id=longstatus-date>W3C Candidate Recommendation
    20 February 2014</h2>

   <dl>
    <dt>This version:

    <dd> <!--
        <a href="http://dev.w3.org/fxtf/compositing-1/">http://dev.w3.org/fxtf/compositing-1/</a>
        -->
     <a
     href="http://www.w3.org/TR/2014/CR-compositing-1-20140220/">http://www.w3.org/TR/2014/CR-compositing-1-20140220/</a>

    <dt>Latest version:

    <dd> <a
     href="http://www.w3.org/TR/compositing-1/">http://www.w3.org/TR/compositing-1/</a>

    <dt>Previous Version:

    <dd> <a
     href="http://www.w3.org/TR/2014/WD-compositing-1-20140107/">http://www.w3.org/TR/2014/WD-compositing-1-20140107/</a>

	<dt>Latest Editors Draft:

    <dd> <a
     href="http://dev.w3.org/fxtf/compositing-1/">http://dev.w3.org/fxtf/compositing-1/</a>
     
    <dt>Feedback:

    <dd> <a
     href="http://lists.w3.org/Archives/Public/public-fx/">public-fx@w3.org</a>
     or <a
     href="http://lists.w3.org/Archives/Public/www-style/">www-style@w3.org</a>
     with subject line “<kbd>[compositing-1] <var>…message
     topic…</var></kbd>”

    <dt>Editors:

    <dd class=vcard> <span class=fn>Rik Cabanier</span>, <span
     class=org>Adobe Systems</span>, <span
     class=email>cabanier@adobe.com</span>

    <dd class=vcard> <span class=fn>Nikos Andronikos</span>, <span
     class=org>Canon Information Systems Research Australia</span>, <span
     class=email>Nikos.Andronikos@cisra.canon.com.au</span>

    <dt>Authors:

    <dd> The authors of this specification are the participants of the W3C
     CSS and SVG Working Groups.
   </dl>
   <!--begin-copyright-->
   <p class=copyright><a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright"
    rel=license>Copyright</a> © 2014 <a href="http://www.w3.org/"><abbr
    title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a
    href="http://www.csail.mit.edu/"><abbr
    title="Massachusetts Institute of Technology">MIT</abbr></a>, <a
    href="http://www.ercim.eu/"><abbr
    title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>,
    <a href="http://www.keio.ac.jp/">Keio</a>, <a
    href="http://ev.buaa.edu.cn/">Beihang</a>), All Rights Reserved. W3C <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>,
    <a
    href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a>
    and <a
    href="http://www.w3.org/Consortium/Legal/copyright-documents">document
    use</a> rules apply.</p>
   <!--end-copyright-->
   <hr title="Separator for header">
  </div>

  <h2 class="no-num no-toc" id=abstract>Abstract</h2>

  <p> Compositing describes how shapes of different elements are combined
   into a single image. There are various possible approaches for
   compositing. Previous versions of SVG and CSS used <a
   href="http://www.w3.org/TR/SVG11/masking.html#SimpleAlphaBlending">Simple
   Alpha Compositing</a>. In this model, each element is rendered into its
   own buffer and is then merged with its <a href="#backdrop">backdrop</a>
   using the Porter Duff <a
   href="#porterduffcompositingoperators_srcover">source-over</a> operator.
   This specification will define a new compositing model that expands upon
   the Simple Alpha Compositing model by offering:

  <ul>
   <li>additional Porter Duff compositing operators

   <li>advanced blending modes which allow control of how colors mix in the
    areas where shapes overlap

   <li>compositing groups
  </ul>

  <p> In addition, this specification will define CSS properties for blending
   and group isolation and the properties of the <a
   href="http://www.w3.org/TR/2dcontext2/#dom-context-2d-globalcompositeoperation"
   title="canvas 2d globalcompositeoperation"> ‘<code
   class=property>globalcompositeoperation</code>’</a> attribute as defined
   in <a href="#ref-2DCONTEXT2"
   rel=biblioentry>[2DCONTEXT2]<!--{{!2DCONTEXT2}}--></a>.

  <h2 class="no-num no-toc" id=status>Status of This Document</h2>

  <p><em>This section describes the status of this document at the time of
   its publication. Other documents may supersede this document. A list of
   current W3C publications and the latest revision of this technical report
   can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
   index</a> at http://www.w3.org/TR/.</em>

  <p>The (<a
   href="http://lists.w3.org/Archives/Public/public-fx/">archived</a>) public
   mailing list <a href="mailto:public-fx@w3.org">public-fx@w3.org</a> (see
   <a href="http://www.w3.org/Mail/Request">instructions</a>) is preferred
   for discussion of this specification. When sending e-mail, please put the
   text “compositing-1” in the subject, preferably like this:
   “[<!---->compositing-1<!---->] <em>…summary of comment…</em>”

  <p>This document was produced by the <a
   href="http://www.w3.org/Style/CSS/members">CSS Working Group</a> (part of
   the <a href="http://www.w3.org/Style/">Style Activity</a>) and the <a
   href="http://www.w3.org/Graphics/SVG/">SVG Working Group</a> (part of the
   <a href="http://www.w3.org/Graphics/">Graphics Activity</a>).

  <p>This document was produced by groups operating under the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February
   2004 W3C Patent Policy</a>. W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/32061/status" rel="disclosure">public 
   list of any patent disclosures (CSS)</a> and a 
   <a href="http://www.w3.org/2004/01/pp-impl/19480/status" rel="disclosure">public 
   list of any patent disclosures (SVG)</a> made in
   connection with the deliverables of each group; these pages also include
   instructions for disclosing a patent. An individual who has actual
   knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential
   Claim(s)</a> must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section
   6 of the W3C Patent Policy</a>.</p>

  <p>Publication as a Candidate Recommendation does not imply endorsement by
   the W3C Membership. This is a draft document and may be updated, replaced
   or obsoleted by other documents at any time. It is inappropriate to cite
   this document as other than work in progress.

  <p>The following features are at risk:

  <ol>
   <li>Force <a href="#img_isolation">‘<code
    class=property>isolation</code>’</a> if an SVG images is linked using
    the ‘<code class=property>img</code>’ element.
  </ol>

  <p>The Candidate Recommendation period will end around 17 August 2014.
   There is currently no preliminary implementation report.
   During this period, the WG will complete its test suite and create an
   implementation report.

  <h2 class="no-num no-toc" id=contents>Table of Contents</h2>
  <!--begin-toc-->

  <ul class=toc>
   <li><a href="#introduction"><span class=secno>1. </span>Introduction</a>

   <li><a href="#reading-this-document"><span class=secno>2. </span>Reading
    This Document</a>
    <ul class=toc>
     <li><a href="#module-interactions"><span class=secno>2.1. </span>Module
      interactions</a>

     <li><a href="#values"><span class=secno>2.2. </span>Values</a>
    </ul>

   <li><a href="#csscompositingandblending"><span class=secno>3.
    </span>Specifying Blending in CSS </a>
    <ul class=toc>
     <li><a href="#compositingandblendingorder"><span class=secno>3.1.
      </span>Order of graphical operations</a>

     <li><a href="#csscompositingrules_CSS"><span class=secno>3.2.
      </span>Behavior specific to HTML</a>

     <li><a href="#csscompositingrules_SVG"><span class=secno>3.3.
      </span>Behavior specific to SVG</a>

     <li><a href="#csskeywords"><span class=secno>3.4. </span>CSS
      Properties</a>
      <ul class=toc>
       <li><a href="#mix-blend-mode"><span class=secno>3.4.1. </span>The
        <span class=prop-name>‘<code
        class=property>mix-blend-mode</code>’</span> property</a>

       <li><a href="#isolation"><span class=secno>3.4.2. </span>The <span
        class=prop-name>‘<code class=property>isolation</code>’</span>
        property</a>

       <li><a href="#background-blend-mode"><span class=secno>3.4.3.
        </span>The <span class=prop-name>‘<code
        class=property>background-blend-mode</code>’</span> property</a>
      </ul>
    </ul>

   <li><a href="#canvascompositingandblending"><span class=secno>4.
    </span>Specifying Compositing and Blending in Canvas 2D</a>

   <li><a href="#whatiscompositing"><span class=secno>5. </span>Introduction
    to compositing</a>
    <ul class=toc>
     <li><a href="#simplealphacompositing"><span class=secno>5.1.
      </span>Simple alpha compositing</a>
      <ul class=toc>
       <li><a href="#simplealphacompositingexamples"><span class=secno>5.1.1.
        </span>Examples of simple alpha compositing</a>
      </ul>
    </ul>

   <li><a href="#generalformula"><span class=secno>6. </span>General Formula
    for Compositing and Blending</a>

   <li><a href="#backdrop"><span class=secno>7. </span>Backdrop
    calculation</a>
    <ul class=toc>
     <li><a href="#backdropexamples"><span class=secno>7.1. </span>Examples
      of backdrop calculation</a>
    </ul>

   <li><a href="#groups"><span class=secno>8. </span>Compositing Groups</a>
    <ul class=toc>
     <li><a href="#groupinvariance"><span class=secno>8.1. </span>Group
      invariance</a>

     <li><a href="#isolatedgroups"><span class=secno>8.2. </span>Isolated
      Groups</a>

     <li><a href="#pagebackdrop"><span class=secno>8.3. </span>The Page
      Group</a>
    </ul>

   <li><a href="#advancedcompositing"><span class=secno>9. </span>Advanced
    compositing features</a>
    <ul class=toc>
     <li><a href="#porterduffcompositingoperators"><span class=secno>9.1.
      </span>The Porter Duff Compositing Operators</a>
      <ul class=toc>
       <li><a href="#porterduffcompositingoperators_clear"><span
        class=secno>9.1.1. </span>Clear</a>

       <li><a href="#porterduffcompositingoperators_src"><span
        class=secno>9.1.2. </span>Copy</a>

       <li><a href="#porterduffcompositingoperators_dst"><span
        class=secno>9.1.3. </span>Destination</a>

       <li><a href="#porterduffcompositingoperators_srcover"><span
        class=secno>9.1.4. </span>Source Over</a>

       <li><a href="#porterduffcompositingoperators_dstover"><span
        class=secno>9.1.5. </span>Destination Over</a>

       <li><a href="#porterduffcompositingoperators_srcin"><span
        class=secno>9.1.6. </span>Source In</a>

       <li><a href="#porterduffcompositingoperators_dstin"><span
        class=secno>9.1.7. </span>Destination In</a>

       <li><a href="#porterduffcompositingoperators_srcout"><span
        class=secno>9.1.8. </span>Source Out</a>

       <li><a href="#porterduffcompositingoperators_dstout"><span
        class=secno>9.1.9. </span>Destination Out</a>

       <li><a href="#porterduffcompositingoperators_srcatop"><span
        class=secno>9.1.10. </span>Source Atop</a>

       <li><a href="#porterduffcompositingoperators_dstatop"><span
        class=secno>9.1.11. </span>Destination Atop</a>

       <li><a href="#porterduffcompositingoperators_xor"><span
        class=secno>9.1.12. </span>XOR</a>

       <li><a href="#porterduffcompositingoperators_plus"><span
        class=secno>9.1.13. </span>Lighter</a>
      </ul>

     <li><a href="#groupcompositing"><span class=secno>9.2. </span>Group
      compositing behavior with Porter Duff modes</a>
    </ul>

   <li><a href="#blending"><span class=secno>10. </span>Blending</a>
    <ul class=toc>
     <li><a href="#blendingseparable"><span class=secno>10.1.
      </span>Separable blend modes</a>
      <ul class=toc>
       <li><a href="#blendingnormal"><span class=secno>10.1.1.
        </span>‘<code class=property>normal</code>’ blend mode</a>

       <li><a href="#blendingmultiply"><span class=secno>10.1.2.
        </span>‘<code class=property>multiply</code>’ blend mode</a>

       <li><a href="#blendingscreen"><span class=secno>10.1.3.
        </span>‘<code class=property>screen</code>’ blend mode</a>

       <li><a href="#blendingoverlay"><span class=secno>10.1.4.
        </span>‘<code class=property>overlay</code>’ blend mode</a>

       <li><a href="#blendingdarken"><span class=secno>10.1.5.
        </span>‘<code class=property>darken</code>’ blend mode</a>

       <li><a href="#blendinglighten"><span class=secno>10.1.6.
        </span>‘<code class=property>lighten</code>’ blend mode</a>

       <li><a href="#blendingcolordodge"><span class=secno>10.1.7.
        </span>‘<code class=property>color-dodge</code>’ blend mode</a>

       <li><a href="#blendingcolorburn"><span class=secno>10.1.8.
        </span>‘<code class=property>color-burn</code>’ blend mode</a>

       <li><a href="#blendinghardlight"><span class=secno>10.1.9.
        </span>‘<code class=property>hard-light</code>’ blend mode</a>

       <li><a href="#blendingsoftlight"><span class=secno>10.1.10.
        </span>‘<code class=property>soft-light</code>’ blend mode</a>

       <li><a href="#blendingdifference"><span class=secno>10.1.11.
        </span>‘<code class=property>difference</code>’ blend mode</a>

       <li><a href="#blendingexclusion"><span class=secno>10.1.12.
        </span>‘<code class=property>exclusion</code>’ blend mode</a>
      </ul>

     <li><a href="#blendingnonseparable"><span class=secno>10.2.
      </span>Non-separable blend modes</a>
      <ul class=toc>
       <li><a href="#blendinghue"><span class=secno>10.2.1. </span>‘<code
        class=property>hue</code>’ blend mode</a>

       <li><a href="#blendingsaturation"><span class=secno>10.2.2.
        </span>‘<code class=property>saturation</code>’ blend mode</a>

       <li><a href="#blendingcolor"><span class=secno>10.2.3. </span>‘<code
        class=property>color</code>’ blend mode</a>

       <li><a href="#blendingluminosity"><span class=secno>10.2.4.
        </span>‘<code class=property>luminosity</code>’ blend mode</a>
      </ul>

     <li><a href="#isolationblending"><span class=secno>10.3. </span>Effect
      of group isolation on blending</a>
    </ul>

   <li><a href="#security"><span class=secno>11. </span>Security issues with
    compositing and blending</a>

   <li><a href="#conformance"><span class=secno>12. </span>Conformance</a>

   <li><a href="#references1"><span class=secno>13. </span>References</a>
    <ul class=toc>
     <li><a href="#normref"><span class=secno>13.1. </span>Normative
      References</a>

     <li><a href="#informref"><span class=secno>13.2. </span>Informative
      References</a>
    </ul>

   <li><a href="#changes"><span class=secno>14. </span>Changes</a>
  </ul>
  <!--end-toc-->
  <!-- ****************************************************************************** -->

  <h2 id=introduction><span class=secno>1. </span>Introduction</h2>

  <p><em>This subsection is non-normative.</em><br>
   The first part of this document describes the properties used to control
   the compositing in CSS. The second part will describe the algorithms of
   Porter Duff compositing and blending.

  <h2 id=reading-this-document><span class=secno>2. </span>Reading This
   Document</h2>

  <p> Each section of this document is normative unless otherwise
   specified.<br>

  <h3 id=module-interactions><span class=secno>2.1. </span>Module
   interactions</h3>

  <p>This specification defines a set of CSS properties that affect the
   visual rendering of elements to which those properties are applied; these
   effects are applied after elements have been sized and positioned
   according to the <a href="http://www.w3.org/TR/CSS2/visuren.html"
   title="Visual formatting model">Visual formatting model</a> from <a
   href="#ref-CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>. Some
   values of these properties result in the creation of a <a
   href="http://www.w3.org/TR/CSS2/visuren.html#containing-block"
   title="Visual formatting model">containing block</a>, and/or the creation
   of a <a href="http://www.w3.org/TR/CSS2/visuren.html#z-index"
   title="Visual formatting model">stacking context</a>.

  <p>The ‘<code class=property>background-blend-mode</code>’ property
   also builds upon the properties defined in the <a
   href="http://www.w3.org/TR/css3-background/#placement"
   title="Backgrounds and Borders">CSS Backgrounds and Borders</a> module.<a
   href="#ref-CSS3BG" rel=biblioentry>[CSS3BG]<!--{{!CSS3BG}}--></a>

  <p>This specification also enhances the rules as specified in <a
   href="http://www.w3.org/TR/2003/REC-SVG11-20030114/masking.html#SimpleAlphaBlending"
   title="simple alpha blending">Section 14.2 Simple alpha compositing</a> of
   <a href="#ref-SVG11" rel=biblioentry>[SVG11]<!--{{SVG11}}--></a> and <a
   href="http://www.w3.org/TR/css3-color/#alpha"
   title="simple alpha compositing">simple alpha compositing</a> of <a
   href="#ref-CSS3COLOR"
   rel=biblioentry>[CSS3COLOR]<!--{{!CSS3COLOR}}--></a>.

  <p>This module also extends the <a
   href="http://www.w3.org/TR/2dcontext2/#dom-context-2d-globalcompositeoperation"
   title="canvas 2d globalcompositeoperation"> ‘<code
   class=property>globalcompositeoperation</code>’</a> as defined in <a
   href="#ref-2DCONTEXT2"
   rel=biblioentry>[2DCONTEXT2]<!--{{!2DCONTEXT2}}--></a>.

  <h3 id=values><span class=secno>2.2. </span>Values</h3>

  <p>This specification follows the <a
   href="http://www.w3.org/TR/CSS21/about.html#property-defs">CSS property
   definition conventions</a> from <a href="#ref-CSS21"
   rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>. Value types not defined in
   this specification are defined in CSS Level 2 Revision 1 <a
   href="#ref-CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>. Other CSS
   modules may expand the definitions of these value types: for example <a
   href="#ref-CSS3COLOR" rel=biblioentry>[CSS3COLOR]<!--{{CSS3COLOR}}--></a>,
   when combined with this module, expands the definition of the &lt;color>
   value type as used in this specification.

  <p>In addition to the property-specific values listed in their definitions,
   all properties defined in this specification also accept the <a
   href="http://www.w3.org/TR/CSS21/cascade.html#value-def-inherit">inherit</a>
   keyword as their property value. For readability it has not been repeated
   explicitly.

  <h2 id=csscompositingandblending><span class=secno>3. </span>Specifying
   Blending in CSS</h2>

  <h3 id=compositingandblendingorder><span class=secno>3.1. </span>Order of
   graphical operations</h3>

  <p>The compositing model must follow the <a
   href="http://www.w3.org/TR/SVG11/render.html#Introduction">SVG
   compositing</a> model <a href="#ref-SVG11"
   rel=biblioentry>[SVG11]<!--{{!SVG11}}--></a>: first any filter effect is
   applied, then any clipping, masking, blending and compositing.

  <h3 id="csscompositingrules_CSS"><span class=secno>3.2. </span>Behavior
   specific to HTML</h3>
  <!-- <p>
If an element specifies non-default blending or <a href="http://www.w3.org/TR/css3-color/#transparency">'opacity'</a>, its <a href="http://www.w3.org/TR/css3-2d-transforms/#transform-style-property">transform-style</a> [[CSS3-TRANSFORMS]] and that of all of its children must revert to 'flat'.<br>
The application of blending other than 'normal' to an element must also establish a <a href="http://www.w3.org/TR/CSS21/zindex.html">stacking context</a> [[!CSS21]] the same way that CSS <a href="http://www.w3.org/TR/css3-color/#transparency">'opacity'</a> does. One of the consequences is that elements with z-index must not honor the depth of elements outside of the group.<br> -->

  <p>Everything in CSS that creates a <a
   href="http://www.w3.org/TR/CSS21/zindex.html">stacking context</a> must be
   considered an <a href="#isolatedgroups">‘<code
   class=property>isolated</code>’ group</a>. HTML elements themselves
   should not create groups.

  <p> An element that has blending applied, must blend with all the
   underlying content of the <a
   href="http://www.w3.org/TR/CSS21/zindex.html">stacking context</a> <a
   href="#ref-CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a> that that
   element belongs to.

  <h3 id="csscompositingrules_SVG"><span class=secno>3.3. </span>Behavior
   specific to SVG</h3>

  <p>By default, every element must create a <a
   href="#isolatedgroups">non-isolated group</a>.</p>
  <!-- SVG has the following <a href="http://www.w3.org/TR/SVG11/render.html#Introduction">compositing model</a>: first any filter effect is applied, then any clipping, masking,  blending and compositing -->

  <p> However, certain operations in SVG will create <a
   href="#isolatedgroups">isolated groups</a>. If one of the following
   features is used, the group must become isolated:

  <ul>
   <li>opacity

   <li>filters

   <li>3D transforms (2D transforms must NOT cause isolation)

   <li>blending

   <li>masking
  </ul>

  <h3 id=csskeywords><span class=secno>3.4. </span>CSS Properties</h3>
  <!--
<h4 id="mix-composite">The <span class="prop-name">'mix-composite'</span> property</h4>
<p>
Defines the compositing mode that must be used on the area of an element.<br>
This behavior is described in more detail in <a href="#advancedcompositing">Advanced compositing features</a>.<br>
The description of the <span class="prop-name">'mix-composite'</span> property is
as follows:</p>

<div class="propdef">
<dl>
  <dt id='propdef-mix-composite'><span class='propdef-title prop-name'>'mix-composite'</span></dt>
    <dd>
      <table summary="mix-composite property" class="propinfo" cellspacing="0"
      cellpadding="0">
        <tbody>
          <tr valign="baseline">
            <td><em>Value:</em>  </td>
            <td><a href="#ltcompositeareagt"><var>&lt;composite-area&gt;</var></a># </td>      
          </tr>
          <tr valign="baseline">
            <td><em>Initial:</em>  </td>
            <td>source-over</td>
          </tr>
          <tr valign="baseline">
            <td><em>Applies to:</em>  </td>
            <td>All elements. In SVG, it applies to svg, g, use, image, path, rect, circle, ellipse, line, polyline, polygon, text, tspan, and marker.</td>
          </tr>
          <tr valign="baseline">
            <td><em>Inherited:</em>  </td>
            <td>no</td>uch as 3D transforms or a non-default blenduch as 3D transforms or a non-default blend
          </tr>
          <tr valign="baseline">
            <td><em>Percentages:</em>  </td>
            <td>N/A</td>
          </tr>
          <tr valign="baseline">
            <td><em>Media:</em>  </td>
            <td>visual</td>
          </tr>
          <tr valign="baseline">
            <td><em>Computed value:</em>  </td>
          	<td>as specified</td>
          </tr>          
          <tr valign="baseline">
            <td><em>Animatable:</em>  </td>
            <td>no</td>
          </tr>
        </tbody>
      </table>
    </dd>
</dl>
</div>
<p>The syntax of the property of <var>&lt;composite-area&gt;</var> is given with:</p>
<pre class="compositearea"><dfn id="ltcompositeareagt"><var>&lt;composite-area&gt;</var></dfn> = <a href="#ltareagt">&lt;area&gt;</a>? <a href="#ltcompositegt">&lt;composite-mode&gt;</a></pre>


<p>The syntax of the property of <var>&lt;area&gt;</var> is given with:</p>
<pre class="area"><dfn id="ltareagt"><var>&lt;area&gt;</var></dfn> = element | box-shadow | text-shadow | background | border | content</pre>
<p>Values have the following meanings:</p>

  <dl>
   <dt><dfn id='area-element' title="''element'' value">
    ‘<code class=css>element</code>’</dfn></dt>

   <dd>The area is the whole element, including shadows, background and content</dd>

   <dt><dfn id='area-box-shadow' title="''box-shadow'' value">
    ‘<code class=css>box-shadow</code>’</dfn></dt>

   <dd>The area is the box shadow</dd>
   
   <dt><dfn id='area-text-shadow' title="''text-shadow'' value">
    ‘<code class=css>text-shadow</code>’</dfn></dt>

   <dd>The area is the shadow of the text</dd>
   
   <dt><dfn id='area-background' title="''background'' value">
    ‘<code class=css>background</code>’</dfn></dt>

   <dd>The area is the composited result of all the background images.</dd>
   
   <dt><dfn id='area-border' title="''border'' value">
    ‘<code class=css>border</code>’</dfn></dt>

   <dd>The area is the composited result of all the borders.</dd>
   
   <dt><dfn id='area-content' title="''content'' value">
    ‘<code class=css>content</code>’</dfn></dt>

   <dd>The area is the content of the element (such as the text).</dd>              
  </dl>
 <p class="note">If <var>&lt;area&gt;</var> is omitted, <var>'<a href="#area-element">element</a>'</var> must be assumed. An area can only be set once in the CSS property; an attempt to list it more than once must be ignored.</p>
 <p class="note">In SVG, <var>'<a href="#area-element">element</a>'</var> will be used, regardless of what area is specified.</p>
 <p class="issue">We need to define more clearly what 'content' means.</p>
 
<p>The syntax of the property of <var>&lt;composite-mode&gt;</var> is given with:</p>
<pre class="composite"><dfn id="ltcompositegt"><var>&lt;composite-mode&gt;</var></dfn> = <a href="#porterduffcompositingoperators_clear">clear</a> | <a href="#porterduffcompositingoperators_src">copy</a> | <a href="#porterduffcompositingoperators_dst">destination</a> | <a href="#porterduffcompositingoperators_srcover">source-over</a> | <a href="#porterduffcompositingoperators_dstover">destination-over</a> | <a href="#porterduffcompositingoperators_srcin">source-in</a> | <a href="#porterduffcompositingoperators_dstin">destination-in</a> | <a href="#porterduffcompositingoperators_srcout">source-out</a> | <a href="#porterduffcompositingoperators_dstout">destination-out</a> | <a href="#porterduffcompositingoperators_srcatop">source-atop</a> | <a href="#porterduffcompositingoperators_dstatop">destination-atop</a> | <a href="#porterduffcompositingoperators_xor">xor</a> | <a href="#porterduffcompositingoperators_plus">lighter</a></pre>
 
<p class="note">Applying a non-default compositing mode to the <var>'<a href="#area-element">element</a>'</var> area must establish a new stacking context.</p>

<p class="note">Applying a non-default compositing mode to areas other than <var>'<a href="#area-element">element</a>'</var> must render those areas in an offscreen buffer first. This buffer will then be composited.</p>

<p class="note">An area must always composite with <a href="#groupcompositingcliptoself">'clip-to-self'</a> set to 'true'.</p>
-->

  <h4 id=mix-blend-mode><span class=secno>3.4.1. </span>The <span
   class=prop-name>‘<code class=property>mix-blend-mode</code>’</span>
   property</h4>

  <p> The blend mode defines the formula that must be used to mix the colors
   with the backdrop. This behavior is described in more detail in <a
   href="#blending">Blending</a>.

  <div class=propdef>
   <dl>
    <dt id=propdef-mix-blend-mode><span
     class="propdef-title prop-name">‘<code
     class=property>mix-blend-mode</code>’</span>

    <dd>
     <table cellpadding=0 cellspacing=0 class=propinfo
      summary="mix-blend-mode property">
      <tbody>
       <tr valign=baseline>
        <td><em>Value:</em>  

        <td><a href="#ltblendmodegt"><var>&lt;blend-mode&gt;</var></a>

       <tr valign=baseline>
        <td><em>Initial:</em>  

        <td><a href="#normal"><var>normal</var></a>

       <tr valign=baseline>
        <td><em>Applies to:</em>  

        <td>All elements. In SVG, it applies to <a
         href="http://www.w3.org/TR/SVG/intro.html#TermContainerElement">container
         elements</a>, <a
         href="http://www.w3.org/TR/SVG/intro.html#TermGraphicsElement">graphics
         elements</a> and <a
         href="http://www.w3.org/TR/2011/REC-SVG11-20110816/intro.html#TermGraphicsReferencingElement">graphics
         referencing elements</a>. <a href="#ref-SVG11"
         rel=biblioentry>[SVG11]<!--{{SVG11}}--></a>

       <tr valign=baseline>
        <td><em>Inherited:</em>  

        <td>no

       <tr valign=baseline>
        <td><em>Percentages:</em>  

        <td>N/A

       <tr valign=baseline>
        <td><em>Media:</em>  

        <td>visual

       <tr valign=baseline>
        <td><em>Computed value:</em>  

        <td>as specified

       <tr valign=baseline>
        <td><em>Animatable:</em>  

        <td>no
     </table>
   </dl>
  </div>
  <!--
<p>The syntax of the property of <var>&lt;blend-area&gt;</var> is given with:</p>
<pre class="blendarea"><dfn id="ltblendareagt"><var>&lt;blend-area&gt;</var></dfn> = <a href="#ltareagt">&lt;area&gt;</a>? <a href="#ltblendmodegt">&lt;blend-mode&gt;</a></pre>

<p>The syntax of the property of <var>&lt;area&gt;</var> is given with:</p>
<pre class="area"><dfn id="ltareagt"><var>&lt;area&gt;</var></dfn> = element | box-shadow | text-shadow | background | border | content</pre>
<p>Values have the following meanings:</p>

  <dl>
   <dt><dfn id='area-element' title="''element'' value">
    ‘<code class=css>element</code>’</dfn></dt>

   <dd>The area is the whole element, including shadows, background and content</dd>

   <dt><dfn id='area-box-shadow' title="''box-shadow'' value">
    ‘<code class=css>box-shadow</code>’</dfn></dt>

   <dd>The area is the box shadow</dd>
   
   <dt><dfn id='area-text-shadow' title="''text-shadow'' value">
    ‘<code class=css>text-shadow</code>’</dfn></dt>

   <dd>The area is the shadow of the text</dd>
   
   <dt><dfn id='area-background' title="''background'' value">
    ‘<code class=css>background</code>’</dfn></dt>

   <dd>The area is the composited result of all the background images.</dd>
   
   <dt><dfn id='area-border' title="''border'' value">
    ‘<code class=css>border</code>’</dfn></dt>

   <dd>The area is the composited result of all the borders.</dd>
   
   <dt><dfn id='area-content' title="''content'' value">
    ‘<code class=css>content</code>’</dfn></dt>

   <dd>The area is the content of the element (such as the text).</dd>              
  </dl>
 <p class="note">If <var>&lt;area&gt;</var> is omitted, <var>'<a href="#area-element">element</a>'</var> must be assumed. An area can only be set once in the CSS property; an attempt to list it more than once must be ignored.</p>
 <p class="note">In SVG, <var>'<a href="#area-element">element</a>'</var> will be used, regardless of what area is specified.</p>
 <p class="issue">We need to define more clearly what 'content' means.</p>
-->

  <p>The syntax of the property of <a
   href="#ltblendmodegt"><var>&lt;blend-mode&gt;</var></a> is given with:

  <pre class=blendmode><dfn
   id=ltblendmodegt><var>&lt;blend-mode&gt;</var></dfn> = <a
   href="#blendingnormal">normal</a> | <a
   href="#blendingmultiply">multiply</a> | <a
   href="#blendingscreen">screen</a> | <a
   href="#blendingoverlay">overlay</a> | <a
   href="#blendingdarken">darken</a> | <a
   href="#blendinglighten">lighten</a> | <a
   href="#blendingcolordodge">color-dodge</a> |
  <a
   href="#blendingcolorburn">color-burn</a> | <a
   href="#blendinghardlight">hard-light</a> | <a
   href="#blendingsoftlight">soft-light</a> | <a
   href="#blendingdifference">difference</a> | <a
   href="#blendingexclusion">exclusion</a> | <a
   href="#blendinghue">hue</a> | 
  <a
   href="#blendingsaturation">saturation</a> | <a
   href="#blendingcolor">color</a> | <a
   href="#blendingluminosity">luminosity</a></pre>

  <p class=note>Applying a blendmode other than <a
   href="#blendingnormal">‘<code class=property>normal</code>’</a> to the
   element must establish a new <a
   href="http://www.w3.org/TR/CSS21/zindex.html">stacking context</a> <a
   href="#ref-CSS21" rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a>. This group
   must then be blended and composited with the <a
   href="http://www.w3.org/TR/CSS21/zindex.html">stacking context</a> that
   contains the element.

  <div class=example>
   <p>Given the following sample markup:

   <pre>
<!-- -->&lt;body>
<!-- -->   &lt;img src="ducky.png"/>
<!-- -->&lt;/body>"
</pre>

   <p>And the following style rule:

   <pre>
body { background-color: green; }
</pre>

   <p> ... will produce the following result:

   <div class=figure> <img
    alt="example of an image of duck with the green color of the document"
    src="examples/ducky_normal.png" style="width:30%">
    <p class=caption> Partially transparent image on a green backdrop
   </div>

   <p>If we change the style rule to include blending:

   <pre>
body { background-color: green; }
img { mix-blend-mode: multiply; }
</pre>

   <p> ... the output will be the image blending with the green background of
    the &lt;body> element.

   <div class=figure> <img
    alt="example of an image of duck blending with the green color of the document"
    src="examples/ducky_multiply.png" style="width:30%">
    <p class=caption> Blending of a transparent image on a green backdrop.
   </div>
  </div>

  <div class=example>
   <p>Given the following svg code:

   <pre>
<!-- -->&lt;svg>
<!-- -->  &lt;circle cx="40" cy="40" r="40" fill="red"/>
<!-- -->  &lt;circle cx="80" cy="40" r="40" fill="green"/>
<!-- -->  &lt;circle cx="60" cy="80" r="40" fill="blue"/>
<!-- -->&lt;/svg>
</pre>

   <p>And the following style rule:

   <pre>
circle { mix-blend-mode: screen; }
</pre>

   <p> ... the output will be blending of the 3 circles. Each circle is
    rendered from bottom to top. Where the elements overlap, the blend mode
    produces a change in color.

   <div class=figure> <img
    alt="example of 3 circles blending with a screen blend mode"
    src="examples/screen_example.svg" style="width:30%">
    <p class=caption> Example of 3 circles blending with a screen blend mode
   </div>
  </div>

  <div class=example>
   <p>In the following style sheet and document fragment:

   <pre>
body { background-color: green; }
div { background-color: red; width: 200px; opacity: .95}
img { mix-blend-mode: difference; }

<!-- -->&lt;body>
<!-- -->  &lt;div>
<!-- -->     &lt;img src="ducky.png"/>
<!-- -->  &lt;/div>
<!-- -->&lt;/body>
</pre>

   <p> ... the ‘<code class=property>opacity</code>’ on the &lt;div>
    element is causing the creation of a stacking context. This causes the
    creation of a new group so the image doesn't blend with the color of the
    &lt;body>.

   <div class=figure> <img
    alt="example of an image of duck blending with the green color of the document"
    src="examples/ducky_difference.png" style="width:30%">
    <p class=caption> Example of blending within a stacking context.
   </div>

   <p> Note how the image is not blending with the green color.
  </div>

  <div class=example>
   <p>Given the following sample markup:

   <pre>
</pre>

   <pre>
<!-- -->&lt;body>
<!-- -->   &lt;div>
<!-- -->     &lt;p>'overlay' blending on text&lt;/p>
<!-- -->   &lt;/div>
<!-- -->&lt;/body>
</pre>

   <p>And the following style rule:

   <pre>
div { background-image: url('texture.png'); }
@font-face {
  font-family: "Mythos Std";
  src: url("http://myfontvendor.com/mythos.otf");
}
p {
  mix-blend-mode: overlay;
  font-family: "Mythos Std" 
}
</pre>

   <div class=figure> <img
    alt="example of text that has an overlay blend on top of a texture"
    src="examples/overlay_text.png" style="width:75%">
    <p class=caption> Text with a blend overlay on top of an image.
   </div>
  </div>

  <h4 id=isolation><span class=secno>3.4.2. </span>The <span
   class=prop-name>‘<code class=property>isolation</code>’</span>
   property</h4>

  <p> In SVG, this defines whether an element is isolated or not.<br>
   For CSS, setting ‘<code class=property>isolation</code>’ to ‘<code
   class=property>isolate</code>’ will turn the element into a stacking
   context.

  <p> By default, elements use the ‘<code class=property>auto</code>’
   keyword which implies that they are not isolated. However operations that
   cause the creation of stacking context <a href="#ref-CSS21"
   rel=biblioentry>[CSS21]<!--{{!CSS21}}--></a> must cause a group to be
   isolated. These operations are described in <a
   href="#csscompositingrules_CSS">‘<code class=css>behavior specific to
   HTML</code>’</a> and <a href="#csscompositingrules_SVG">‘<code
   class=css>behavior specific to SVG</code>’</a>.

  <div class=propdef>
   <dl>
    <dt id=propdef-isolation><span class="propdef-title prop-name">‘<code
     class=property>isolation</code>’</span>

    <dd>
     <table cellpadding=0 cellspacing=0 class=propinfo
      summary="isolation property">
      <tbody>
       <tr valign=baseline>
        <td><em>Value:</em>  

        <td><a href="#isolated-propid"><var>&lt;isolation-mode&gt;</var></a>

       <tr valign=baseline>
        <td><em>Initial:</em>  

        <td>auto

       <tr valign=baseline>
        <td><em>Applies to:</em>  

        <td>All elements. In SVG, it applies to <a
         href="http://www.w3.org/TR/SVG/intro.html#TermContainerElement">container
         elements</a>, <a
         href="http://www.w3.org/TR/SVG/intro.html#TermGraphicsElement">graphics
         elements</a> and <a
         href="http://www.w3.org/TR/2011/REC-SVG11-20110816/intro.html#TermGraphicsReferencingElement">graphics
         referencing elements</a>. <a href="#ref-SVG11"
         rel=biblioentry>[SVG11]<!--{{SVG11}}--></a>

       <tr valign=baseline>
        <td><em>Inherited:</em>  

        <td>no

       <tr valign=baseline>
        <td><em>Percentages:</em>  

        <td>N/A

       <tr valign=baseline>
        <td><em>Media:</em>  

        <td>visual

       <tr valign=baseline>
        <td><em>Computed value:</em>  

        <td>as specified

       <tr valign=baseline>
        <td><em>Animatable:</em>  

        <td>no
     </table>
   </dl>
  </div>

  <p>The syntax of the property of <a
   href="#isolated-propid"><var>&lt;isolation-mode&gt;</var></a> is given
   with:

  <pre class=isolated><dfn
   id=isolated-propid><var>&lt;isolation-mode&gt;</var></dfn> = auto | isolate</pre>

  <p id="img_isolation"> In CSS, a background image or the content of an
   &lt;img&gt; must always be rendered into an isolated group.<br>
   For instance, if you link to an SVG file through the ‘<code
   class=property>img</code>’ tag, the artwork of that SVG will not blend
   with the backdrop of the content.

  <p> In SVG, <a
   href="http://www.w3.org/TR/SVG/masking.html#Masking">‘<code
   class=property>mask</code>’</a> always creates an isolated group.</p>
  <!--
<h4 id="knock-out">The <span class="prop-name">'knock-out'</span> property</h4>
<p>
Defines whether a group is a knock-out group.<br>
When a group is set to 'knock-out', the elements within the group must only composite and blend with elements outside that group. This effectively 'knocks out' any element from within the group that is already drawn. The end result is as if every shape composites with a 'clear' operation (with clip-to-self enabled) first before it blends and composites.<br>
When 'knock-out' is set to 'preserve', the group must not be a knock-out group and its elements composite normally.<br>
The behavior of this keyword is described in more detail in <a href="#knockoutgroups">Knockout Groups</a>.

<div class="propdef">
<dl>
  <dt id='propdef-knock-out'><span class='propdef-title prop-name'>'knock-out'</span></dt>
    <dd>
      <table summary="knock-out property" class="propinfo" cellspacing="0"
      cellpadding="0">
        <tbody>
          <tr valign="baseline">
            <td><em>Value:</em>  </td>
            <td><a href="#knockout-propid"><var>&lt;knock-out-mode&gt;</var></a></td>
          </tr>
          <tr valign="baseline">
            <td><em>Initial:</em>  </td>
            <td>preserve</td>
          </tr>
          <tr valign="baseline">
            <td><em>Applies to:</em>  </td>
            <td>All HTML elements. In SVG, it applies to all container elements except 'mask'</td>
          </tr>
          <tr valign="baseline">
            <td><em>Inherited:</em>  </td>
            <td>yes</td>
          </tr>
          <tr valign="baseline">
            <td><em>Percentages:</em>  </td>
            <td>N/A</td>
          </tr>
          <tr valign="baseline">
            <td><em>Media:</em>  </td>
            <td>visual</td>
          </tr>
          <tr valign="baseline">
            <td><em>Computed value:</em>  </td>
          	<td>as specified</td>
          </tr>
          <tr valign="baseline">
            <td><em>Animatable:</em>  </td>
            <td>no</td>
          </tr>
        </tbody>
      </table>
    </dd>
</dl>
</div>
<p>The syntax of the property of <var>&lt;knock-out-mode&gt;</var> is given with:</p>
<pre class="knockout-prop"><dfn id="knockout-propid"><var>&lt;knock-out-mode&gt;</var></dfn> = preserve | knock-out</pre>
<p class="note">'Knock-out' is always applied to the area of the element</p>

<h4 id="mix-shorthand">Compositing and blending shorthand: the <span class="prop-name">'mix'</span> property</h4>
<p>
The 'mix' property is a shorthand property for setting blending and compositing properties at the same place in the style sheet.<br>
Omitted values are set to their initial values.
</p>
<div class="propdef">
<dl>
  <dt id='propdef-mix'><span class='propdef-title prop-name'>'mix'</span></dt>
    <dd>
      <table summary="knock-out property" class="propinfo" cellspacing="0"
      cellpadding="0">
        <tbody>
          <tr valign="baseline">
            <td><em>Value:</em>  </td>
            <td><a href="#ltmixareagt"><var>&lt;mix-area&gt;</var></a>#</td>
          </tr>
          <tr valign="baseline">
            <td><em>Initial:</em>  </td>
            <td>source-over</td>
          </tr>
          <tr valign="baseline">
            <td><em>Applies to:</em>  </td>
            <td>See individual properties</td>
          </tr>
          <tr valign="baseline">
            <td><em>Inherited:</em>  </td>
            <td>See individual properties</td>
          </tr>
          <tr valign="baseline">
            <td><em>Percentages:</em>  </td>
            <td>N/A</td>
          </tr>
          <tr valign="baseline">
            <td><em>Media:</em>  </td>
            <td>visual</td>
          </tr>
           <tr valign="baseline">
            <td><em>Computed value:</em>  </td>
          	<td>as specified</td>
          </tr>         
          <tr valign="baseline">
            <td><em>Animatable:</em>  </td>
            <td>No</td>
          </tr>
        </tbody>
      </table>
    </dd>
</dl>
</div>

<p>The syntax of the property of <var>&lt;mix-area&gt;</var> is given with:</p>
<pre class="blendarea"><dfn id="ltmixareagt"><var>&lt;mix-area&gt;</var></dfn> = <a href="#ltareagt"><var>&lt;area&gt;</var></a>? [<a href="#ltblendmodegt"><var>&lt;blend-mode&gt;</var></a> || <a href="#ltcompositegt"><var>&lt;composite-mode&gt;</var></a> || <a href="#isolated-propid"><var>&lt;isolation-mode&gt;</var></a> || <a href="#knockout-propid"><var>&lt;knock-out-mode&gt;</var></a>]</pre>
-->
  <!--
<h3 id="cssbackgroundsyntax">Specifying blending and compositing in the element background</h3>
Defines how background images composite with each other.<br>
Background images must always composite with <a href="#groupcompositingcliptoself">'clip-to-self'</a> set to 'true'.<br>
</p>
<p>
  The description of the <span class="prop-name">'background-composite'</span> property is
as follows:</p>

<div class="propdef">
<dl>
  <dt id='propdef-background-composite'><span class='propdef-title prop-name'>'background-composite'</span></dt>
    <dd>
      <table summary="background-composite property" class="propinfo" cellspacing="0"
      cellpadding="0">
        <tbody>
          <tr valign="baseline">
            <td><em>Value:</em>  </td>
            <td> <a href="#ltcompositegt">&lt;composite-mode&gt;</a># </td>
          </tr>
          <tr valign="baseline">
            <td><em>Initial:</em>  </td>
            <td>source-over</td>
          </tr>
          <tr valign="baseline">
            <td><em>Applies to:</em>  </td>
            <td>All HTML elements</span></td>
          </tr>
          <tr valign="baseline">
            <td><em>Inherited:</em>  </td>
            <td>no</td>
          </tr>
          <tr valign="baseline">
            <td><em>Percentages:</em>  </td>
            <td>N/A</td>
          </tr>
          <tr valign="baseline">
            <td><em>Media:</em>  </td>
            <td>visual</td>
          </tr>
           <tr valign="baseline">
            <td><em>Computed value:</em>  </td>
          	<td>as specified</td>
          </tr>         
          <tr valign="baseline">
            <td><em>Animatable:</em>  </td>
            <td>no</td>
          </tr>
        </tbody>
      </table>
    </dd>
</dl>
</div>
-->

  <h4 id=background-blend-mode><span class=secno>3.4.3. </span>The <span
   class=prop-name>‘<code
   class=property>background-blend-mode</code>’</span> property</h4>

  <p>Defines the blending mode of each background layer.

  <p> Each background layer must blend with the element's background layer
   that is below it and the element's background color. Background layers
   must not blend with the content that is behind the element, instead they
   must act as if they are rendered into an isolated group.

  <p>The description of the <span class=prop-name>‘<code
   class=property>background-blend-mode</code>’</span> property is as
   follows:

  <div class=propdef>
   <dl>
    <dt id=propdef-mix-blend-mode-background><span
     class="propdef-title prop-name">‘<code
     class=property>background-blend-mode</code>’</span>

    <dd>
     <table cellpadding=0 cellspacing=0 class=propinfo
      summary="background-blend-mode property">
      <tbody>
       <tr valign=baseline>
        <td><em>Value:</em>  

        <td> <a href="#ltblendmodegt">&lt;blendmode&gt;</a>#

       <tr valign=baseline>
        <td><em>Initial:</em>  

        <td><a href="#normal"><var>normal</var></a>

       <tr valign=baseline>
        <td><em>Applies to:</em>  

        <td>All HTML elements

       <tr valign=baseline>
        <td><em>Inherited:</em>  

        <td>no

       <tr valign=baseline>
        <td><em>Percentages:</em>  

        <td>N/A

       <tr valign=baseline>
        <td><em>Media:</em>  

        <td>visual

       <tr valign=baseline>
        <td><em>Computed value:</em>  

        <td>as specified

       <tr valign=baseline>
        <td><em>Animatable:</em>  

        <td>no
     </table>
   </dl>
  </div>

  <p>The <span class=prop-name>‘<code
   class=property>background-blend-mode</code>’</span> list must be applied
   in the same order as <a
   href="http://www.w3.org/TR/css3-background/#the-background-image">‘<code
   class=property>background-image</code>’</a><a href="#ref-CSS3BG"
   rel=biblioentry>[CSS3BG]<!--{{!CSS3BG}}--></a>. This means that the first
   element in the list will apply to the layer that is on top. If a property
   doesn't have enough comma-separated values to match the number of layers,
   the UA must calculate its used value by repeating the list of values until
   there are enough.

  <p>If the <a
   href="http://dev.w3.org/csswg/css-backgrounds/#the-background"><span
   class=prop-name>‘<code class=property>background</code>’</span></a> <a
   href="#ref-CSS3BG" rel=biblioentry>[CSS3BG]<!--{{!CSS3BG}}--></a>
   shorthand is used, the <span class=prop-name>‘<code
   class=property>background-blend-mode</code>’</span> property for that
   element must be reset to its initial value.

  <div class=example>
   <p>Given the following sample markup:

   <pre>
<!-- -->&lt;body>
<!-- -->   &lt;div>&lt;/div>
<!-- -->&lt;/body>
</pre>

   <p>And the following style rule:

   <pre>
body { background-color: green; }
div { 
  width: 200px;
  height: 200px;
  background-size: 200px 200px;
  background-repeat:no-repeat;
  background-image: linear-gradient(to right, #000000 0%,#ffffff 100%), url('ducky.png');
  background-blend-mode: difference, normal;
}
</pre>

   <div class=figure> <img
    alt="example of div that has an image of a duck and a gradient that is blending"
    src="examples/ducky_background_blend.png" style="width:30%">
    <p class=caption> Blending of 2 background images.
   </div>

   <p> Note that the gradient is not blending with the color of &lt;body>.
    Instead it retains its original color.
  </div>

  <h2 id=canvascompositingandblending><span class=secno>4. </span>Specifying
   Compositing and Blending in Canvas 2D</h2>

  <p>The <a href="http://www.w3.org/TR/2dcontext">canvas 2d</a> context
   defines the <a
   href="http://www.w3.org/TR/2dcontext/#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a>
   attribute that is used to set the current compositing and blending
   operator.

  <p>This property takes the following value:</p>
  <!--
<p><a href="http://www.w3.org/TR/2dcontext/#dom-context-2d-globalcompositeoperation">globalCompositeOperation</a> takes the same arguments as the '<a href='#mix-shorthand'>mix</a>' shorthand property except that it doesn't support the <a href="#ltareagt">&lt;area&gt;</a>. The 'isolation' and 'knock-out' values are ignored in a canvas 2d context. If a value is not specified, it is assumed to be the default.</p>

<p>Compositing and blending in canvas 2D must always done with <a href="#groupcompositingcliptoself">clip-to-self</a> assumed false. This means that a compositing operation may affect the entire canvas and not just be limited to the shape that is being composited.
However, the <a href="http://www.w3.org/TR/2dcontext/#clipping-region">clipping region</a> will still be in effect and limit the affected area.</p>
-->

  <div class=propdef>
   <dl>
    <dt id=propdef-mix><span class="propdef-title prop-name">‘<code
     class=property>globalCompositeOperation</code>’</span>

    <dd>
     <table cellpadding=0 cellspacing=0 class=propinfo
      summary="knock-out property">
      <tbody>
       <tr valign=baseline>
        <td><em>Value:</em>  

        <td> <a href="#ltblendmodegt"><var>&lt;blend-mode&gt;</var></a> | <a
         href="#ltcompositegt"><var>&lt;composite-mode&gt;</var></a>
         <!--|| <a href="#isolated-propid"><var>&lt;isolation-mode&gt;</var></a> || <a href="#knockout-propid"><var>&lt;knock-out-mode&gt;</var></a>-->

       <tr valign=baseline>
        <td><em>Initial:</em>  

        <td>source-over
     </table>
   </dl>
  </div>

  <p>The syntax of the property of <a
   href="#ltcompositegt"><var>&lt;composite-mode&gt;</var></a> is given with:

  <pre class=composite><dfn
   id=ltcompositegt><var>&lt;composite-mode&gt;</var></dfn> = <a
   href="#porterduffcompositingoperators_clear">clear</a> | <a
   href="#porterduffcompositingoperators_src">copy</a> | <a
   href="#porterduffcompositingoperators_dst">destination</a> | <a
   href="#porterduffcompositingoperators_srcover">source-over</a> | <a
   href="#porterduffcompositingoperators_dstover">destination-over</a> | <a
   href="#porterduffcompositingoperators_srcin">source-in</a> | <br><a
   href="#porterduffcompositingoperators_dstin">destination-in</a> | <a
   href="#porterduffcompositingoperators_srcout">source-out</a> | <a
   href="#porterduffcompositingoperators_dstout">destination-out</a> | <a
   href="#porterduffcompositingoperators_srcatop">source-atop</a> | <a
   href="#porterduffcompositingoperators_dstatop">destination-atop</a> | <a
   href="#porterduffcompositingoperators_xor">xor</a> | <a
   href="#porterduffcompositingoperators_plus">lighter</a></pre>

  <h2 id=whatiscompositing><span class=secno>5. </span>Introduction to
   compositing</h2>

  <p> Compositing is the combining of a graphic element with its backdrop.
   <!--
<p>
The figure below, gives a basic example of compositing. The graphic element is overlaid on top of the backdrop to produce a composite image.
Where the graphic element is opaque, it obscures the backdrop and where the graphic element is partially transparent, some of the backdrop can be seen through.
</p>
-->

  <p> In the model described in this specification there are two steps to the
   overall compositing operation - <a href="#advancedcompositing">Porter-Duff
   compositing</a> and <a href="#blending">blending</a>.
   <!--Porter Duff compositing takes into account the overall shape of the graphic element and its opacity, as well as the opacity and shape of the backdrop, and 
determines where the backdrop is visible, where the graphic element is visible and where one is visible through the other.-->
   The blending step determines how the colors from the graphic element and
   the backdrop interact.

  <p> Typically, the blending step is performed first, followed by the
   Porter-Duff compositing step. In the blending step, the resultant color
   from the mix of the element and the the <a href="#backdrop">backdrop</a>
   is calculated. The graphic element's color is replaced with this resultant
   color. The graphic element is then composited with the <a
   href="#backdrop">backdrop</a> using the specified compositing operator.

  <p class=note> Shape is defined by the mathematical description of the
   shape. A particular point is either inside the shape or it is not. There
   are no gradations.

  <p class=note> Opacity is described using an alpha value, stored alongside
   the color value for each particular point. The alpha value is between 0
   and 1, inclusive. A value of 0 means that the pixel has no coverage at
   that point, and is therefore transparent; i.e. there is no color
   contribution from any geometry because the geometry does not overlap this
   pixel. A value of 1 means that the pixel is fully opaque; the geometry
   completely overlaps the pixel.

  <h3 id=simplealphacompositing><span class=secno>5.1. </span>Simple alpha
   compositing</h3>

  <p> The formula for simple alpha compositing is

  <pre>
co = Cs x αs + Cb x αb x (1 - αs)
</pre>

  <p>Where

  <ul>
   <li>co: the premultiplied pixel value after compositing

   <li>Cs: the color value of the source graphic element being composited

   <li>αs: the alpha value of the source graphic element being composited

   <li>Cb: the color value of the <a href="#backdrop">backdrop</a>

   <li>αb: the alpha value of the <a href="#backdrop">backdrop</a>
  </ul>

  <p class=note> All values are between 0 and 1 inclusive.

  <p> The pixel value after compositing (co) is given by adding the
   contributions from the source graphic element [Cs x αs] and the backdrop
   [Cb x αb x (1 - αs)]. For both the graphic element and the backdrop, the
   color values are multiplied by the alpha to determine the amount of color
   that contributes. With zero alpha meaning that the color does not
   contribute and partial alpha means that some percentage of the color
   contributes. The contribution of the backdrop is further reduced based on
   the opacity of the graphic element. Conceptually, (1 - αs) of the
   backdrop shows through the graphic element, meaning that if the graphic
   element is fully opaque (αs=1) then no backdrop shows through.

  <p> The simple alpha compositing formula listed above gives a resultant
   color which is the result of the weighted average of the backdrop color
   and graphic element color, with the weighting determined by the backdrop
   and graphic element alphas. The resultant alpha value of the composite is
   simply the sum of the contributed alpha of the composited elements. The
   formula for the resultant alpha of the composite is

  <pre>
αo = αs + αb x (1 - αs)
</pre>

  <p>Where

  <ul>
   <li>αo: the alpha value of the composite

   <li>αs: the alpha value of the graphic element being composited

   <li>αb: the alpha value of the <a href="#backdrop">backdrop</a>
  </ul>

  <div class=note>
   <p> Often, it can be more efficient to store a <code>pre-multiplied
    value</code> for the color and opacity. The pre-multiplied value is given
    by

   <pre>
cs = Cs x αs
</pre>
   with
   <ul>
    <li>cs: the pre-multiplied value

    <li>Cs: the color value

    <li>αs: the alpha value
   </ul>

   <p> Thus the formula for simple alpha compositing using pre-multiplied
    values becomes

   <pre>
co = cs + cb x (1 - αs)
</pre>

   <p> To extract the color component of a pre-multiplied value, the formula
    is reversed:

   <pre>
Co = co / αo
</pre>
  </div>

  <h4 id=simplealphacompositingexamples><span class=secno>5.1.1.
   </span>Examples of simple alpha compositing</h4>

  <div class=example>
   <div class=figure> <img alt="Simple box showing alpha compositing"
    src="examples/simple_box.svg">
    <p class=caption>
   </div>

   <p> This describes the most basic case. It consists of 1 shape that is
    filled with a solid color (α = 1). The shape is composited with an empty
    background. The empty background has no effect on the resultant
    composite.

   <pre>

Cs = RGB(1,0,0)
αs = 1
Cb = RGB(0,0,0)
αb = 0

co = Cs x αs + Cb x αb x (1 - αs)
co = RGB(1,0,0) x 1 + RGB(0,0,0) x 0 x (1 - 1)
co = RGB(1,0,0) x 1
co = RGB(1,0,0)
</pre>
  </div>

  <div class=example>
   <div class=figure> <img alt="simple shape" src="examples/two_box.svg">
    <p class=caption>
   </div>

   <p> This is a more complex example. There is no transparency, but the 2
    shapes intersect.

   <p> Applying the compositing formula in the area of intersection, gives:

   <pre>
Cs = RGB(0,0,1)
αs = 1
Cb = RGB(1,0,0)
αb = 1

co = Cs x αs + Cb x αb x (1 - αs)
co = RGB(0,0,1) x 1 + RGB(1,0,0) x 1 x (1 - 1)
co = RGB(0,0,1) x 1 + RGB(1,0,0) x 1 x 0
co = RGB(0,0,1) x 1
co = RGB(0,0,1)
</pre>
   Calculating the alpha of the resultant composite
   <pre>
αo = αs + αb x (1 - αs)
αo = 1 + 1 x (1 - 1)
αo = 1
</pre>
   Calculating the color component of the resultant composite
   <pre>
Co = co / αo
Co = RGB(0, 0, 1) / 1
Co = RGB(0, 0, 1)
</pre>
  </div>

  <div class=example>
   <div class=figure> <img
    alt="interaction of a solid box with a transparent box on top"
    src="examples/two_box_transparency.svg">
    <p class=caption>
   </div>

   <p> This is an example where the shape has some transparency, but the <a
    href="#backdrop">backdrop</a> is fully opaque.

   <p> Applying the compositing formula in the area of intersection, gives:

   <pre>
Cs = RGB(0,0,1)
αs = 0.5
Cb = RGB(1,0,0)
αb = 1

co = Cs x αs + Cb x αb x (1 - αs)
co = RGB(0,0,1) x 0.5 + RGB(1,0,0) x 1 x (1 - 0.5)
co = RGB(0,0,1) x 0.5 + RGB(1,0,0) x 0.5
co = RGB(0.5,0,0.5)
</pre>
   Calculating the alpha of the resultant composite
   <pre>
αo = αs + αb x (1 - αs)
αo = 0.5 + 1 x (1 - 0.5)
αo = 1
</pre>
   Calculating the color component of the resultant composite
   <pre>
Co = co / αo
Co = RGB(0.5, 0, 0.5) / 1
Co = RGB(0.5, 0, 0.5)
</pre>
  </div>

  <div class=example>
   <div class=figure> <img alt="interaction of 2 transparent boxes"
    src="examples/two_box_transparency_both.svg">
    <p class=caption>
   </div>

   <p> Figure 4 shows an example where both the shape and the <a
    href="#backdrop">backdrop</a> are transparent.

   <p> Applying the compositing formula in the area of intersection, gives:

   <pre>
Cs = RGB(0,0,1)
αs = 0.5
Cb = RGB(1,0,0)
αb = 0.5

co = Cs x αs + Cb x αb x (1 - αs)
co = RGB(0,0,1) x 0.5 + RGB(1,0,0) x 0.5 x (1 - 0.5)
co = RGB(0,0,1) x 0.5 + RGB(1,0,0) x 0.25
co = RGB(0.25, 0, 0.5)
</pre>
   Calculating the alpha of the resultant composite
   <pre>
αo = αs + αb x (1 - αs)
αo = 0.5 + 0.5 x (1 - 0.5)
αo = 0.75
</pre>
   Calculating the color component of the resultant composite
   <pre>
Co = co / αo
Co = RGB(0.25, 0, 0.5) / 0.75
Co = RGB(0.33, 0, 0.66)
</pre>
  </div>

  <h2 id=generalformula><span class=secno>6. </span>General Formula for
   Compositing and Blending</h2>

  <p> The general formula for compositing and blending which allows for
   selection of the compositing operator and blending function comprises two
   steps. The terms used in these functions will be described in detail in
   the following sections.

  <p> Apply the blend in place

  <pre>
Cs = (1 - αb) x Cs + αb x B(Cb, Cs)
</pre>

  <p> Composite

  <pre>
Co = αs x Fa x Cs + αb x Fb x Cb
</pre>

  <p>Where:

  <ul>
   <li><strong>Cs</strong>: is the source color

   <li><strong>Cb</strong>: is the backdrop color

   <li><strong>αs</strong>: is the source alpha

   <li><strong>αb</strong>: is the backdrop alpha

   <li><strong>B(Cb, Cs)</strong>: is the mixing function

   <li><strong>Fa</strong>: is defined by the Porter Duff operator in use

   <li><strong>Fb</strong>: is defined by the Porter Duff operator in use
  </ul>

  <h2 id=backdrop><span class=secno>7. </span>Backdrop calculation</h2>

  <p> The backdrop is the content behind the element and is what the element
   is composited with. This means that the backdrop is the result of
   compositing all previous elements.

  <h3 id=backdropexamples><span class=secno>7.1. </span>Examples of backdrop
   calculation</h3>

  <div class=example>
   <div class=figure> <img alt="example of a simple backdrop calculation"
    src="examples/simple_backdrop.svg">
    <p class=caption>
   </div>

   <p> This example has 2 simple shapes. The backdrop for the blue shape
    includes the bottom right corner of the red shape . The dotted line shows
    the area that is examined during compositing of the blue shape.
  </div>

  <div class=example>
   <div class=figure> <img alt="example of a backdrop with alpha"
    src="examples/simple_backdrop_alpha.svg">
    <p class=caption>
   </div>

   <p> The shape in the backdrop has an alpha value. The alpha value of the
    backdrop shape is preserved when the backdrop is calculated.
  </div>

  <h2 id=groups><span class=secno>8. </span>Compositing Groups</h2>

  <p> Compositing groups allow more control over the interaction of
   compositing with the backdrop. Groups can be used to specify how a
   compositing effect within a group will interact with the content that is
   already in the scene (the backdrop).

  <p> Compositing groups may be made up of any number of elements, and may
   contain other compositing groups.

  <p> The default properties of a compositing group shall cause no visual
   difference compared to having no group. See <a
   href="#groupinvariance">Group Invariance</a>.

  <p> A compositing group is rendered by first compositing the elements of
   the group onto the initial backdrop. The result of this is a single
   element containing color and alpha information. This element is then
   composited onto the group backdrop. Steps shall be taken to ensure the
   group backdrop makes only a single contribution to the final composite.

  <dl>
   <dt id=initialbackdrop>initial backdrop

   <dd> The initial backdrop is the backdrop used for compositing the group's
    first element. This will be the same as the group backdrop in a
    non-isolated group, or a fully transparent backdrop for an isolated
    group.

   <dt id=groupbackdrop>group backdrop

   <dd> The group backdrop is the result of compositing all elements up to
    but not including the first element in the group.
    <!--The use of <a href="#knockoutgroups">knockout groups</a> changes this definition.-->
  </dl>

  <h3 id=groupinvariance><span class=secno>8.1. </span>Group invariance</h3>

  <p> An important property of simple alpha compositing is its group
   invariance. This behavior is preserved in the more complex model described
   in this specification. Adding or removing grouping with default attributes
   shall not show visual differences.

  <pre>so: A + B + C = A + (B + C) = (A + B) + C</pre>

  <p>When adding attributes to the group such as <!--'knockout', --> ‘<code
   class=property>isolate</code>’, blending modes other than ‘<a
   href="#normal"><code class=property>normal</code></a>’ or Porter Duff
   compositing operators other than ‘<code
   class=property>source-over</code>’, groups may no longer be invariant.

  <h3 id=isolatedgroups><span class=secno>8.2. </span>Isolated Groups</h3>

  <p> In an isolated group, the initial backdrop shall be black and fully
   transparent.

  <p> In this instance, the initial backdrop is different than the group
   backdrop. The only interaction with the group backdrop shall occur when
   the group's computed color, shape and alpha are composited with it.

  <p>See ‘<code class=css><a href="#groupcompositing">Isolated groups and
   Porter Duff modes</a></code>’ for a description of the effect of
   isolated groups on compositing. See ‘<code class=css><a
   href="#isolationblending">Effect of group isolation on
   blending</a></code>’ for a description of the effect of isolated groups
   on blending. <!--
<h3 id="knockoutgroups">Knockout Groups</h3>
<p>
In a knockout group, each individual element shall be composited with the initial backdrop rather than with the stack of preceding elements in the group.
When calculating the <a href="#backdrop">backdrop</a> for an element inside a knockout group, the elements of the group are ignored. Instead, only the elements that are behind the knockout group are included in the backdrop.
</p>
<div class="example">
<p style="text-align:center"><img src="examples/knockout.png" alt="example of a knockout group"/></p>
</div>
<p>
The above example demonstrates two versions of a group containing three squares (red, green, blue) that are 50% opaque. The group is composited over a grey striped background.<br>
On the left, the group has the 'knock-out' property activated. On the right, the group has the 'knock-out' property disabled'.<br>
If the 'knock-out' property is disabled, each element within the group is only composited with the elements underneath the group.
</p>
-->

  <h3 id=pagebackdrop><span class=secno>8.3. </span>The Page Group</h3>

  <p> The top level group is the page group. All other elements and groups
   are composited into this group. The page group is an <a
   href="#isolatedgroups">isolated group</a>.

  <p>

  <p> The page group is composited with a backdrop color of white with 100%
   opacity.<!--<br>
The page group may be used as an element in another graphical composition.--></p>
  <!--
<p>
For example,
this is an SVG file that contains a red object at 50% opacity. <br>
The UA will composite the page group onto a white background with 100% opacity. <br>
The results are as follows:
<pre>
co = RGB(255, 0, 0) * .5 + RGB(255, 255, 255) * 1 * (1 - .5)
co = RGB(127, 0, 0) + RGB(127, 127, 127)
co = RGB(255, 127, 127)
</pre>
which is the color value ultimately displayed by the UA.
</p>
-->

  <h2 id=advancedcompositing><span class=secno>9. </span>Advanced compositing
   features</h2>

  <p> <a href="#simplealphacompositing">Simple alpha compositing</a> uses the
   <a href="#porterduffcompositingoperators_srcover">source-over</a> Porter
   Duff compositing operator.
   <!-- Additional compositing operators exist and may be specified with the <a href="#propdef-mix-composite">mix-composite property</a>.
The additional compositing operators allow for more complex interactions between the shapes of elements being composited. The compositing operators are described in the <a href="#porterduffcompositingoperators">Porter Duff compositing operators</a>.
The operators that applies to an element or group is selected using the <a href="#propdef-mix-composite">mix-composite</a> property.-->

  <p> Porter Duff compositing is based on a model of a pixel in which two
   shapes (source and destination) may contribute to the final color of the
   pixel. The pixel is divided into 4 sub-pixel regions and each region
   represents a possible combination of source and destination. <a
   href="#ref-PORTERDUFF"
   rel=biblioentry>[PORTERDUFF]<!--{{PORTERDUFF}}--></a>

  <p> The four regions are:

  <dl>
   <dt>Source Only

   <dd>Where only the source contributes to the pixel color

   <dt>Destination only

   <dd>where only the destination contributes to the pixel color

   <dt>Both

   <dd>Source and Destination – where both the source and destination may
    combine to define the pixel color

   <dt>None

   <dd>No source or Destination – where neither make a contribution to the
    final pixel color
  </dl>

  <p class=note>Destination is synonymous with backdrop. The term destination
   is used in this section as this is considered the standard when working
   with Porter Duff compositing. Additionally, the compositing operators use
   ‘<code class=property>destination</code>’ in their names.

  <div class=figure>
   <p style="text-align:center"><img
    alt="overview of the regions affected by porter duff"
    src="examples/PD_regions.svg">

   <p class=caption>
  </div>

  <p>The contribution from each region to the final pixel color is defined by
   the coverage of the shape at that pixel, and the operator in use. Coverage
   is specified in terms of alpha. Full alpha (1) implies full coverage,
   while zero alpha (0) implies no coverage. This means that the area of each
   region within the sub-pixel is dependent on the coverage of each shape
   contributing to the pixel. The area of each region can be calculated with
   the following equations:

  <div class=data>
   <table>
    <tbody>
     <tr>
      <th>Both

      <th>αs x αb

     <tr>
      <th>Source only

      <th>αs x (1 – αb)

     <tr>
      <th>Destination only

      <th>αb x (1 – αs)

     <tr>
      <th>None

      <th>(1 – αs) x (1 – αb)
   </table>
  </div>

  <p>The figure above represents coverage of 0.5 for both source and
   destination.

  <pre>
Both = 0.5 x 0.5 = 0.25 
Source Only = 0.5 (1 – 0.5) = 0.25
Destination Only = 0.5(1 – 0.5) = 0.25
None = (1 – 0.5)(1 – 0.5) = 0.25
</pre>

  <p>Therefore, the coverage of each region is 0.25 in this example.

  <h3 id=porterduffcompositingoperators><span class=secno>9.1. </span>The
   Porter Duff Compositing Operators</h3>

  <p> The landmark paper by Thomas Porter and Tom Duff, who worked for
   Lucasfilm, defined the algebra of compositing and developed the twelve
   "Porter Duff" operators. These operators control the results of mixing the
   four sub-pixel regions formed by the overlapping of graphical objects that
   have an alpha or pixel coverage channel/value. The operators use all
   practical combinations of the four regions.

  <p> There are 12 basic Porter Duff operators, satisfying all possible
   combinations of source and destination.

  <p> From the geometric representation of each operator, the contribution of
   each shape can be seen to be expressed as a fraction of the total coverage
   of the output. For example, in source over, the possible contribution of
   source is full (1) and the possible contribution of destination is
   whatever is remaining (1 – αs). This is modified by the coverage of
   source and destination to give the equation for the final coverage of the
   pixel:

  <pre>
    αo = αs x 1 + αb x (1 – αs)
</pre>

  <p>The fractional terms Fa (1 in this example) and Fb (1 – αs in this
   example) are defined for each operator and specify the fraction of the
   shapes that may contribute to the final pixel value. The general form of
   the equation for coverage is:

  <pre>
    αs x Fa + αb x Fb
</pre>

  <p>and incorporating color gives the general Porter Duff equation

  <pre>
    co = αs x Fa x Cs + αb x Fb x Cb
</pre>

  <p>Where:

  <ul>
   <li>co is the output color pre-multiplied with the output alpha [0 &lt;=
    co &lt;= 1]

   <li>αs is the coverage of the source Fa is defined by the operator and
    controls inclusion of the source Cs is the color of the source (not
    multiplied by alpha)

   <li>αb is the coverage of the destination Fb is defined by the operator
    and controls inclusion of the destination Cb is the color of the
    destination (not multiplied by alpha)
  </ul>

  <h4 id="porterduffcompositingoperators_clear"><span class=secno>9.1.1.
   </span>Clear</h4>

  <p>No regions are enabled.

  <div class=figure> <img alt="example of porter duff clear"
   src="examples/PD_clr.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 0; Fb = 0
    co = 0
    αo = 0
</pre>

  <h4 id="porterduffcompositingoperators_src"><span class=secno>9.1.2.
   </span>Copy</h4>

  <p>Only the source will be present.

  <div class=figure> <img alt="example of porter duff copy"
   src="examples/PD_src.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 1; Fb = 0
    co = αs x Cs
    αo = αs
</pre>

  <h4 id="porterduffcompositingoperators_dst"><span class=secno>9.1.3.
   </span>Destination</h4>

  <p>Only the destination will be present.

  <div class=figure> <img alt="example of porter duff destination"
   src="examples/PD_dst.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 0; Fb = 1
    co = αb x Cb
    αo = αb
</pre>

  <h4 id="porterduffcompositingoperators_srcover"><span class=secno>9.1.4.
   </span>Source Over</h4>

  <p>Source is placed over the destination

  <div class=figure> <img alt="example of porter duff source over"
   src="examples/PD_src-over.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 1; Fb = 1 – αs
    co = αs x Cs + αb x Cb x (1 – αs)
    αo = αs + αb x (1 – αs)
</pre>

  <h4 id="porterduffcompositingoperators_dstover"><span class=secno>9.1.5.
   </span>Destination Over</h4>

  <p>Destination is placed over the source.

  <div class=figure> <img alt="example of porter duff destination over"
   src="examples/PD_dst-over.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 1 – αb; Fb = 1
    co = αs x Cs x (1 – αb) + αb x Cb
    αo = αs x (1 – αb) + αb
</pre>

  <h4 id="porterduffcompositingoperators_srcin"><span class=secno>9.1.6.
   </span>Source In</h4>

  <p>The source that overlaps the destination, replaces the destination.

  <div class=figure> <img alt="example of porter duff source in"
   src="examples/PD_src-in.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = αb; Fb = 0
    co = αs x Cs x αb
    αo = αs x αb
</pre>

  <h4 id="porterduffcompositingoperators_dstin"><span class=secno>9.1.7.
   </span>Destination In</h4>

  <p>Destination which overlaps the source, replaces the source.

  <div class=figure> <img alt="example of porter duff destination in "
   src="examples/PD_dst-in.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 0; Fb = αs
    co = αb x Cb x αs 
    αo = αb x αs
</pre>

  <h4 id="porterduffcompositingoperators_srcout"><span class=secno>9.1.8.
   </span>Source Out</h4>

  <p>Source is placed, where it falls outside of the destination.

  <div class=figure> <img alt="example of porter duff source out"
   src="examples/PD_src-out.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 1 – αb; Fb = 0
    co = αs x Cs x (1 – αb)
    αo = αs x (1 – αb)
</pre>

  <h4 id="porterduffcompositingoperators_dstout"><span class=secno>9.1.9.
   </span>Destination Out</h4>

  <p>Destination is placed, where it falls outside of the source.

  <div class=figure> <img alt="example of porter duff destination out"
   src="examples/PD_dst-out.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 0; Fb = 1 – αs
    co = αb x Cb x (1 – αs)
    αo = αb x (1 – αs)
</pre>

  <h4 id="porterduffcompositingoperators_srcatop"><span class=secno>9.1.10.
   </span>Source Atop</h4>

  <p>Source which overlaps the destination, replaces the destination.
   Destination is placed elsewhere.

  <div class=figure> <img alt="example of porter duff source atop"
   src="examples/PD_src-atop.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = αb; Fb = 1 – αs
    co = αs x Cs x αb + αb x Cb x (1 – αs)
    αo = αs x αb + αb x (1 – αs)
</pre>

  <h4 id="porterduffcompositingoperators_dstatop"><span class=secno>9.1.11.
   </span>Destination Atop</h4>

  <p>Destination which overlaps the source replaces the source. Source is
   placed elsewhere.

  <div class=figure> <img alt="example of porter duff destination atop"
   src="examples/PD_dst-atop.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 1 - αb; Fb = αs
    co = αs x Cs x (1 - αb) + αb x Cb x αs
    αo = αs x (1 - αb) + αb x αs
</pre>

  <h4 id="porterduffcompositingoperators_xor"><span class=secno>9.1.12.
   </span>XOR</h4>

  <p>The non-overlapping regions of source and destination are combined.

  <div class=figure> <img alt="example of porter duff xor"
   src="examples/PD_xor.svg">
   <p class=caption>
  </div>

  <pre>
    Fa = 1 - αb; Fb = 1 – αs
    co = αs x Cs x (1 - αb) + αb x Cb x (1 – αs)
    αo = αs x (1 - αb) + αb x (1 – αs)
</pre>

  <h4 id="porterduffcompositingoperators_plus"><span class=secno>9.1.13.
   </span>Lighter</h4>

  <p>Display the sum of the source image and destination image. It is defined
   in the Porter Duff paper as the ‘<code class=property>plus</code>’
   operator. <a href="#ref-PORTERDUFF"
   rel=biblioentry>[PORTERDUFF]<!--{{PORTERDUFF}}--></a>

  <pre>
    Fa = 1; Fb = 1
    co = αs x Cs + αb x Cb;
    αo = αs + αb
</pre>

  <h3 id=groupcompositing><span class=secno>9.2. </span>Group compositing
   behavior with Porter Duff modes</h3>
  <!--<h4 id="groupcompositingisolation">Isolated groups and Porter Duff modes</h4>-->

  <p> When compositing the elements within an isolated group, the elements
   are composited over a transparent black initial backdrop. If the bottom
   element in the group uses a Porter Duff compositing operator which is
   dependent on the backdrop, such as <a
   href="#porterduffcompositingoperators_dst">destination</a>, <a
   href="#porterduffcompositingoperators_srcin">source-in</a>, <a
   href="#porterduffcompositingoperators_dstin">destination-in</a>, <a
   href="#porterduffcompositingoperators_dstout">destination-out</a> or <a
   href="#porterduffcompositingoperators_srcatop">source-atop</a>, then the
   result of the composite will be empty. Subsequent elements within the
   group are composited with the result of the first composite.</p>
  <!--
<h4 id="groupcompositingknockout">Knockout groups and Porter Duff modes</h4>
<p>
Every element within a knock-out group is composited with the initial backdrop.
This means, that for every element within the group, the backdrop for the compositing of that element, is the initial backdrop.
</p><p>
In the example below, the elements within the group (the circle and the square) are composited using the <a href="#porterduffcompositingoperators_srcatop">source-atop</a> operator, with only the hexagon.
This has the effect of "knocking out" the circle, where it is overlapped by the square.<br>
Additionally, because the source-atop Porter Duff operator is used, the source shape (either the square or the circle) is only placed where the backdrop exists (the backdrop being the hexagon for both compositing operations within the group).
<div class="example"><img src="examples/pd-knockout.png" alt="example of knockout with porter duff"/></div>
</p>
-->
  <!--
<h4 id="groupcompositingcliptoself">Clip to self behavior</h4>
<p>
When compositing, the areas of the composite that may be modified by the compositing operation, must fall within the shape of the element being composited (i.e. where α > 0).
This is known as "clip to self" in some graphics libraries.
The alternative is to not clip the compositing operation at all. The results can be seen in the figure below.
Some of the Porter Duff operators are unchanged, because they normally have no effect outside the source region. The changes can be seen in the clear, source, source-in, destination-in, source-out and destination-atop.
<div class="figure"><img src="examples/clip-to-self.png" alt="example of clip to self with porter duff"/></div>
</p>
-->

  <h2 id=blending><span class=secno>10. </span>Blending</h2>

  <p> Blending is the aspect of compositing that calculates the mixing of
   colors where the source element and <a href="#backdrop">backdrop</a>
   overlap.<br>
   Conceptually, the colors in the source element are blended in place with
   the backdrop. After blending, the modified source element is composited
   with the backdrop. In practice, this is usually all performed in one step.
   <br>
   The blending calculations must not use pre-multiplied color values.

  <p> The "mixing" formula is defined as:

  <pre>
	Cm = B(Cb, Cs)
</pre>

  <p>with:

  <ul>
   <li>Cm: the result color after blending

   <li>B: the formula that does the blending

   <li>Cb: the <a href="#backdrop">backdrop</a> color

   <li>Cs: the source color
  </ul>

  <p>The result of the mixing formula must be clamped to the minimum and
   maximum values of the color range.

  <p> The result of the mixing function is modulated by the backdrop alpha. A
   fully opaque backdrop allows the mixing function to be fully realized. A
   transparent backdrop will cause the final result to be a weighted average
   between the source color and mixed color with the weight controlled by the
   backdrop alpha. The value of the new color becomes:

  <pre>
	Cr = (1 - αb) x Cs + αb x B(Cb, Cs)
</pre>

  <p>with:

  <ul>
   <li>Cr: the result color

   <li>B: the formula that does the blending

   <li>Cs: the source color

   <li>Cb: the <a href="#backdrop">backdrop</a> color

   <li>αb: the <a href="#backdrop">backdrop</a> alpha
  </ul>

  <div class=example>
   <div class=figure> <img alt="example of blending with opacity"
    src="examples/blend_background_opacity.svg">
    <p class=caption>
   </div>

   <p> This example has a red rectangle with a blending mode that is placed
    on top of a set of green rectangles that have different levels of
    opacity.

   <p> Note how the top rectangle shifts more toward red as the opacity of
    the <a href="#backdrop">backdrop</a> gets smaller.
  </div>

  <p class=note> The following formula gives the color value in the area
   where the source and backdrop intersects and then composites with the
   specified Porter Duff compositing formula. For simple alpha blending, the
   formula thus becomes:

  <pre>
simple alpha compositing:
	co = cs + cb x (1 - αs)
written as non-premultiplied:
	αo x Co = αs x Cs + (1 - αs) x αb x Cb
now substitute the result of blending for Cs:
    αo x Co = αs x ((1 - αb) x Cs + αb x B(Cb, Cs)) + (1 - αs) x αb x Cb
            = αs x (1 - αb) x Cs + αs x αb x B(Cb, Cs) + (1 - αs) x αb x Cb
</pre>

  <h3 id=blendingseparable><span class=secno>10.1. </span>Separable blend
   modes</h3>

  <p> A blend mode is termed separable if each component of the result color
   is completely determined by the corresponding components of the
   constituent <a href="#backdrop">backdrop</a> and source colors — that
   is, if the mixing formula is applied <strong>separately</strong> to each
   set of corresponding components.

  <p> Each of the following blend modes will apply the blending function
   B(Cb, Cs) on each of the color components. For simplicity, all the
   examples in this chapter use <a
   href="#porterduffcompositingoperators_srcover">source-over</a>
   compositing.

  <h4 id=blendingnormal><span class=secno>10.1.1. </span><dfn
   id=normal>‘<code class=property>normal</code>’</dfn> blend mode</h4>

  <p> This is the default attribute which specifies no blending. The blending
   formula simply selects the source color.

  <pre>
    B(Cb, Cs) = Cs
</pre>

  <div class=figure> <img alt="example of normal blending"
   src="examples/normal.png">
   <p class=caption>
  </div>

  <h4 id=blendingmultiply><span class=secno>10.1.2. </span>‘<code
   class=property>multiply</code>’ blend mode</h4>

  <p> The source color is multiplied by the destination color and replaces
   the destination.

  <p> The resultant color is always at least as dark as either the source or
   destination color. Multiplying any color with black results in black.
   Multiplying any color with white preserves the original color.

  <pre>
    B(Cb, Cs) = Cb x Cs
</pre>

  <div class=figure> <img alt="example of multiply blending"
   src="examples/multiply.png">
   <p class=caption>
  </div>

  <h4 id=blendingscreen><span class=secno>10.1.3. </span>‘<code
   class=property>screen</code>’ blend mode</h4>

  <p> Multiplies the complements of the <a href="#backdrop">backdrop</a> and
   source color values, then complements the result.

  <p> The result color is always at least as light as either of the two
   constituent colors. Screening any color with white produces white;
   screening with black leaves the original color unchanged. The effect is
   similar to projecting multiple photographic slides simultaneously onto a
   single screen.

  <pre>
    B(Cb, Cs) = 1 - [(1 - Cb) x (1 - Cs)]
              = Cb + Cs -(Cb x Cs)
</pre>

  <div class=figure> <img alt="example of screen blending"
   src="examples/screen.png">
   <p class=caption>
  </div>

  <h4 id=blendingoverlay><span class=secno>10.1.4. </span>‘<code
   class=property>overlay</code>’ blend mode</h4>

  <p> Multiplies or screens the colors, depending on the <a
   href="#backdrop">backdrop</a> color value.

  <p> Source colors overlay the <a href="#backdrop">backdrop</a> while
   preserving its highlights and shadows. The <a
   href="#backdrop">backdrop</a> color is not replaced but is mixed with the
   source color to reflect the lightness or darkness of the <a
   href="#backdrop">backdrop</a>.

  <pre>
    B(Cb, Cs) = HardLight(Cs, Cb)
</pre>

  <p>Overlay is the inverse of the ‘<code
   class=property>hardlight</code>’ blend mode. See the definition of
   ‘<code class=property>hardlight</code>’ for the formula.

  <div class=figure> <img alt="example of overlay blending"
   src="examples/overlay.png">
   <p class=caption>
  </div>

  <h4 id=blendingdarken><span class=secno>10.1.5. </span>‘<code
   class=property>darken</code>’ blend mode</h4>

  <p> Selects the darker of the <a href="#backdrop">backdrop</a> and source
   colors.

  <p> The <a href="#backdrop">backdrop</a> is replaced with the source where
   the source is darker; otherwise, it is left unchanged.

  <pre>
    B(Cb, Cs) = min(Cb, Cs)
</pre>

  <div class=figure> <img alt="example of darken blending"
   src="examples/darken.png">
   <p class=caption>
  </div>

  <h4 id=blendinglighten><span class=secno>10.1.6. </span>‘<code
   class=property>lighten</code>’ blend mode</h4>

  <p> Selects the lighter of the <a href="#backdrop">backdrop</a> and source
   colors.

  <p> The <a href="#backdrop">backdrop</a> is replaced with the source where
   the source is lighter; otherwise, it is left unchanged.

  <pre>
    B(Cb, Cs) = max(Cb, Cs)
</pre>

  <p class=note>The result must be rounded down if it exceeds the range.

  <div class=figure> <img alt="example of lighten blending"
   src="examples/lighten.png">
   <p class=caption>
  </div>

  <h4 id=blendingcolordodge><span class=secno>10.1.7. </span>‘<code
   class=property>color-dodge</code>’ blend mode</h4>

  <p> Brightens the <a href="#backdrop">backdrop</a> color to reflect the
   source color. Painting with black produces no changes.

  <pre>
    if(Cb == 0)
        B(Cb, Cs) = 0
    else if(Cs == 1)
        B(Cb, Cs) = 1
    else
        B(Cb, Cs) = min(1, Cb / (1 - Cs))
</pre>

  <div class=figure> <img alt="example of color dodge blending"
   src="examples/colordodge.png">
   <p class=caption>
  </div>

  <h4 id=blendingcolorburn><span class=secno>10.1.8. </span>‘<code
   class=property>color-burn</code>’ blend mode</h4>

  <p> Darkens the <a href="#backdrop">backdrop</a> color to reflect the
   source color. Painting with white produces no change.

  <pre>
    if(Cb == 1)
        B(Cb, Cs) = 1
    else if(Cs == 0)
        B(Cb, Cs) = 0
    else
        B(Cb, Cs) = 1 - min(1, (1 - Cb) / Cs)
</pre>

  <div class=figure> <img alt="example of color burn blending"
   src="examples/colorburn.png">
   <p class=caption>
  </div>

  <h4 id=blendinghardlight><span class=secno>10.1.9. </span>‘<code
   class=property>hard-light</code>’ blend mode</h4>

  <p> Multiplies or screens the colors, depending on the source color value.
   The effect is similar to shining a harsh spotlight on the <a
   href="#backdrop">backdrop</a>.

  <pre>
    if(Cs &lt;= 0.5)
        B(Cb, Cs) = Multiply(Cb, 2 x Cs)
    else
        B(Cb, Cs) = Screen(Cb, 2 x Cs -1)	
</pre>

  <p>See the definition of ‘<code class=property>multiply</code>’ and
   ‘<code class=property>screen</code>’ for their formulas.

  <div class=figure> <img alt="example of hard light blending"
   src="examples/hardlight.png">
   <p class=caption>
  </div>

  <h4 id=blendingsoftlight><span class=secno>10.1.10. </span>‘<code
   class=property>soft-light</code>’ blend mode</h4>

  <p> Darkens or lightens the colors, depending on the source color value.
   The effect is similar to shining a diffused spotlight on the <a
   href="#backdrop">backdrop</a>

  <pre>
    if(Cs &lt;= 0.5)
        B(Cb, Cs) = Cb - (1 - 2 x Cs) x Cb x (1 - Cb)
    else
        B(Cb, Cs) = Cb + (2 x Cs - 1) x (D(Cb) - Cb)
with
    if(Cb &lt;= 0.25)
        D(Cb) = ((16 * Cb - 12) x Cb + 4) x Cb
    else
        D(Cb) = sqrt(Cb)
</pre>

  <div class=figure> <img alt="example of soft light blending"
   src="examples/softlight.png">
   <p class=caption>
  </div>

  <h4 id=blendingdifference><span class=secno>10.1.11. </span>‘<code
   class=property>difference</code>’ blend mode</h4>

  <p> Subtracts the darker of the two constituent colors from the lighter
   color.

  <p> Painting with white inverts the <a href="#backdrop">backdrop</a> color;
   painting with black produces no change.

  <pre>
    B(Cb, Cs) = | Cb - Cs |
</pre>

  <div class=figure> <img alt="example of difference blending"
   src="examples/difference.png">
   <p class=caption>
  </div>

  <h4 id=blendingexclusion><span class=secno>10.1.12. </span>‘<code
   class=property>exclusion</code>’ blend mode</h4>

  <p> Produces an effect similar to that of the Difference mode but lower in
   contrast. Painting with white inverts the <a href="#backdrop">backdrop</a>
   color; painting with black produces no change

  <pre>
    B(Cb, Cs) = Cb + Cs - 2 x Cb x Cs
</pre>

  <div class=figure> <img alt="example of exclusion blending"
   src="examples/exclusion.png">
   <p class=caption>
  </div>

  <h3 id=blendingnonseparable><span class=secno>10.2. </span>Non-separable
   blend modes</h3>

  <p> Nonseparable blend modes consider all color components in combination
   as opposed to the separable ones that look at each component individually.
   All of these blend modes conceptually entail the following steps:

  <p>

  <ol>
   <li>Convert the <a href="#backdrop">backdrop</a> and source colors from
    the blending color space to an intermediate hue-saturation-luminosity
    representation.

   <li>Create a new color from some combination of hue, saturation, and
    luminosity components selected from the <a href="#backdrop">backdrop</a>
    and source colors.

   <li>Convert the result back to the original color space.
  </ol>

  <p> The nonseparable blend mode formulas make use of several auxiliary
   functions:

  <pre>
    Lum(C) = 0.3 x Cred + 0.59 x Cgreen + 0.11 x Cblue
    
    ClipColor(C)
        L = Lum(C)
        n = min(Cred, Cgreen, Cblue)
        x = max(Cred, Cgreen, Cblue)
        if(n &lt; 0)
            C = L + (((C - L) * L) / (L - n))
                      
        if(x > 1)
            C = L + (((C - L) * (1 - L)) / (x - L))
        
        return C
    
    SetLum(C, l)
        d = l - Lum(C)
        Cred = Cred + d
        Cgreen = Cgreen + d
        Cblue = Cblue + d
        return ClipColor(C)
        
    Sat(C) = max(Cred, Cgreen, Cblue) - min(Cred, Cgreen, Cblue)
        
The subscripts min, mid, and max in the next function refer to the color
components having the minimum, middle, and maximum values upon entry to the function.

    SetSat(C, s)
        if(Cmax > Cmin)
            Cmid = (((Cmid - Cmin) x s) / (Cmax - Cmin))
            Cmax = s
        else
            Cmid = Cmax = 0
        Cmin = 0
        return C;
</pre>

  <h4 id=blendinghue><span class=secno>10.2.1. </span>‘<code
   class=property>hue</code>’ blend mode</h4>

  <p> Creates a color with the hue of the source color and the saturation and
   luminosity of the <a href="#backdrop">backdrop</a> color.

  <pre>
	B(Cb, Cs) = SetLum(SetSat(Cs, Sat(Cb)), Lum(Cb))
</pre>

  <div class=figure> <img alt="example of hue blending"
   src="examples/hue.png">
   <p class=caption>
  </div>

  <h4 id=blendingsaturation><span class=secno>10.2.2. </span>‘<code
   class=property>saturation</code>’ blend mode</h4>

  <p> Creates a color with the saturation of the source color and the hue and
   luminosity of the <a href="#backdrop">backdrop</a> color. Painting with
   this mode in an area of the <a href="#backdrop">backdrop</a> that is a
   pure gray (no saturation) produces no change.

  <pre>
	B(Cb, Cs) = SetLum(SetSat(Cb, Sat(Cs)), Lum(Cb))
</pre>

  <div class=figure> <img alt="example of saturation blending"
   src="examples/saturation.png">
   <p class=caption>
  </div>

  <h4 id=blendingcolor><span class=secno>10.2.3. </span>‘<code
   class=property>color</code>’ blend mode</h4>

  <p> Creates a color with the hue and saturation of the source color and the
   luminosity of the <a href="#backdrop">backdrop</a> color. This preserves
   the gray levels of the <a href="#backdrop">backdrop</a> and is useful for
   coloring monochrome images or tinting color images.

  <pre>
	B(Cb, Cs) = SetLum(Cs, Lum(Cb))
</pre>

  <div class=figure> <img alt="example of color blending"
   src="examples/color.png">
   <p class=caption>
  </div>

  <h4 id=blendingluminosity><span class=secno>10.2.4. </span>‘<code
   class=property>luminosity</code>’ blend mode</h4>

  <p> Creates a color with the luminosity of the source color and the hue and
   saturation of the <a href="#backdrop">backdrop</a> color. This produces an
   inverse effect to that of the Color mode.

  <pre>
	B(Cb, Cs) = SetLum(Cb, Lum(Cs))
</pre>

  <div class=figure> <img alt="example of luminosity blending"
   src="examples/luminosity.png">
   <p class=caption>
  </div>

  <h3 id=isolationblending><span class=secno>10.3. </span>Effect of group
   isolation on blending</h3>

  <p class=note> In the following example, the elements used to construct the
   paper airplane are within a group. Each of these elements has their blend
   mode set to multiply.

  <div class=example> The airplane on the left is a normal group, the
   airplane on the right is an <a href="#isolatedgroups">isolated group</a>.
   <p> In the isolated group, the elements within the group are composited
    onto an empty initial backdrop, this stops the elements within the group
    multiplying with the backdrop. In the normal group, the elements within
    the group are composited onto the initial backdrop containing the land
    and sky. Therefore the elements of the airplane multiply with the land
    and sky. In both instances, the result of the group composite is
    composited onto the land and sky using the normal mix-blend-mode (the
    default mix-blend-mode applied to the group).

   <div class=figure> <img alt="example of isolated group blending"
    src="examples/isolate_blend_example.png">
    <p class=caption>
   </div>
  </div>

  <h2 id=security><span class=secno>11. </span>Security issues with
   compositing and blending</h2>

  <p> It is important that the timing to the blending and compositing
   operations is independent of the source and destination pixel. Operations
   must be implemented in such a way that they always take the same amount of
   time regardless of the pixel values.

  <div class=note>
   <p> If this rule is not followed, an attacker could infer information and
    mount a timing attack.

   <p> A timing attack is a method of obtaining information about content
    that is otherwise protected, based on studying the amount of time it
    takes for an operation to occur. If, for example, red pixels took longer
    to draw than green pixels, one might be able to reconstruct a rough image
    of the element being rendered, without ever having access to the content
    of the element.
  </div>

  <h2 id=conformance><span class=secno>12. </span>Conformance</h2>
  <!--begin-conformance-->

  <h3 class=no-ref id=conventions> Document conventions</h3>

  <p>Conformance requirements are expressed with a combination of descriptive
   assertions and RFC 2119 terminology. The key words “MUST”, “MUST
   NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”,
   “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in the
   normative parts of this document are to be interpreted as described in RFC
   2119. However, for readability, these words do not appear in all uppercase
   letters in this specification.

  <p>All of the text of this specification is normative except sections
   explicitly marked as non-normative, examples, and notes. <a
   href="#ref-RFC2119" rel=biblioentry>[RFC2119]<!--{{!RFC2119}}--></a>

  <p>Examples in this specification are introduced with the words “for
   example” or are set apart from the normative text with
   <code>class="example"</code>, like this:

  <div class=example>
   <p>This is an example of an informative example.
  </div>

  <p>Informative notes begin with the word “Note” and are set apart from
   the normative text with <code>class="note"</code>, like this:

  <p class=note>Note, this is an informative note.

  <h3 class=no-ref id=conformance-classes> Conformance classes</h3>

  <p>Conformance to this is defined for three conformance classes:

  <dl>
   <dt><dfn id=style-sheet title="style sheet!!as conformance class">style
    sheet</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#style-sheet">CSS
    style sheet</a>.

   <dt><dfn id=renderer>renderer</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
    that interprets the semantics of a style sheet and renders documents that
    use them.

   <dt><dfn id=authoring-tool>authoring tool</dfn>

   <dd>A <a href="http://www.w3.org/TR/CSS21/conform.html#user-agent">UA</a>
    that writes a style sheet.
  </dl>

  <p>A style sheet is conformant to this specification if all of its
   statements that use syntax defined in this module are valid according to
   the generic CSS grammar and the individual grammars of each feature
   defined in this module.

  <p>A renderer is conformant to this specification if, in addition to
   interpreting the style sheet as defined by the appropriate specifications,
   it supports all the features defined by this specification by parsing them
   correctly and rendering the document accordingly. However, the inability
   of a UA to correctly render a document due to limitations of the device
   does not make the UA non-conformant. (For example, a UA is not required to
   render color on a monochrome monitor.)

  <p>An authoring tool is conformant to this specification if it writes style
   sheets that are syntactically correct according to the generic CSS grammar
   and the individual grammars of each feature in this module, and meet all
   other conformance requirements of style sheets as described in this
   module.

  <h3 class=no-ref id=partial> Partial implementations</h3>

  <p>So that authors can exploit the forward-compatible parsing rules to
   assign fallback values, CSS renderers <strong>must</strong> treat as
   invalid (and <a
   href="http://www.w3.org/TR/CSS21/conform.html#ignore">ignore as
   appropriate</a>) any at-rules, properties, property values, keywords, and
   other syntactic constructs for which they have no usable level of support.
   In particular, user agents <strong>must not</strong> selectively ignore
   unsupported component values and honor supported values in a single
   multi-value property declaration: if any value is considered invalid (as
   unsupported values must be), CSS requires that the entire declaration be
   ignored.

  <h3 class=no-ref id=experimental> Experimental implementations</h3>

  <p>To avoid clashes with future CSS features, the CSS 2.1 specification
   reserves a <a
   href="http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords">prefixed
   syntax</a> for proprietary and experimental extensions to CSS.

  <p>Prior to a specification reaching the Candidate Recommendation stage in
   the W3C process, all implementations of a CSS feature are considered
   experimental. The CSS Working Group recommends that implementations use a
   vendor-prefixed syntax for such features, including those in W3C Working
   Drafts. This avoids incompatibilities with future changes in the draft.

  <h3 class=no-ref id=testing> Non-experimental implementations</h3>

  <p>Once a specification reaches the Candidate Recommendation stage,
   non-experimental implementations are possible, and implementors should
   release an unprefixed implementation of any CR-level feature they can
   demonstrate to be correctly implemented according to spec.

  <p>To establish and maintain the interoperability of CSS across
   implementations, the CSS Working Group requests that non-experimental CSS
   renderers submit an implementation report (and, if necessary, the
   testcases used for that implementation report) to the W3C before releasing
   an unprefixed implementation of any CSS features. Testcases submitted to
   W3C are subject to review and correction by the CSS Working Group.

  <p>Further information on submitting testcases and implementation reports
   can be found from on the CSS Working Group's website at <a
   href="http://www.w3.org/Style/CSS/Test/">http://www.w3.org/Style/CSS/Test/</a>.
   Questions should be directed to the <a
   href="http://lists.w3.org/Archives/Public/public-css-testsuite">public-css-testsuite@w3.org</a>
   mailing list.

  <h3 class=no-ref id=cr-exit-criteria> CR exit criteria</h3>

  <p>For this specification to be advanced to Proposed Recommendation, there
   must be at least two independent, interoperable implementations of each
   feature. Each feature may be implemented by a different set of products,
   there is no requirement that all features be implemented by a single
   product. For the purposes of this criterion, we define the following
   terms:

  <dl>
   <dt>independent

   <dd>each implementation must be developed by a different party and cannot
    share, reuse, or derive from code used by another qualifying
    implementation. Sections of code that have no bearing on the
    implementation of this specification are exempt from this requirement.

   <dt>interoperable

   <dd>passing the respective test case(s) in the official CSS test suite,
    or, if the implementation is not a Web browser, an equivalent test. Every
    relevant test in the test suite should have an equivalent test created if
    such a user agent (UA) is to be used to claim interoperability. In
    addition if such a UA is to be used to claim interoperability, then there
    must one or more additional UAs which can also pass those equivalent
    tests in the same way for the purpose of interoperability. The equivalent
    tests must be made publicly available for the purposes of peer review.

   <dt>implementation

   <dd>a user agent which:
    <ol class=inline>
     <li>implements the specification.

     <li>is available to the general public. The implementation may be a
      shipping product or other publicly available version (i.e., beta
      version, preview release, or “nightly build”). Non-shipping product
      releases must have implemented the feature(s) for a period of at least
      one month in order to demonstrate stability.

     <li>is not experimental (i.e., a version specifically designed to pass
      the test suite and is not intended for normal usage going forward).
    </ol>
  </dl>

  <p>The specification will remain Candidate Recommendation for at least six
   months. <!--end-conformance-->

  <h2 id=references1><span class=secno>13. </span>References</h2>

  <h3 id=normref><span class=secno>13.1. </span>Normative References</h3>
  <!--begin-normative-->
  <!-- Sorted by label -->

  <dl class=bibliography>
   <dd style="display: none"><!-- keeps the doc valid if the DL is empty -->
    <!---->

   <dt id=ref-2DCONTEXT2>[2DCONTEXT2]

   <dd>Rik Cabanier; et al. <a
    href="http://www.w3.org/TR/2013/WD-2dcontext2-20131029/"><cite>HTML
    Canvas 2D Context, Level 2.</cite></a> 29 October 2013. W3C Working
    Draft. (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2013/WD-2dcontext2-20131029/">http://www.w3.org/TR/2013/WD-2dcontext2-20131029/</a>
   </dd>
   <!---->

   <dt id=ref-CSS21>[CSS21]

   <dd>Bert Bos; et al. <a
    href="http://www.w3.org/TR/2011/REC-CSS2-20110607"><cite>Cascading Style
    Sheets Level 2 Revision 1 (CSS 2.1) Specification.</cite></a> 7 June
    2011. W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/2011/REC-CSS2-20110607">http://www.w3.org/TR/2011/REC-CSS2-20110607</a>
   </dd>
   <!---->

   <dt id=ref-CSS3BG>[CSS3BG]

   <dd>Bert Bos; Elika J. Etemad; Brad Kemper. <a
    href="http://www.w3.org/TR/2014/WD-css3-background-20140204/"><cite>CSS
    Backgrounds and Borders Module Level 3.</cite></a> 4 February 2014. W3C
    Last Call Working Draft. (Work in progress.) URL: <a
    href="http://www.w3.org/TR/2014/WD-css3-background-20140204/">http://www.w3.org/TR/2014/WD-css3-background-20140204/</a>
   </dd>
   <!---->

   <dt id=ref-CSS3COLOR>[CSS3COLOR]

   <dd>Tantek Çelik; Chris Lilley; L. David Baron. <a
    href="http://www.w3.org/TR/2011/REC-css3-color-20110607"><cite>CSS Color
    Module Level 3.</cite></a> 7 June 2011. W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/2011/REC-css3-color-20110607">http://www.w3.org/TR/2011/REC-css3-color-20110607</a>
   </dd>
   <!---->

   <dt id=ref-RFC2119>[RFC2119]

   <dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key
    words for use in RFCs to Indicate Requirement Levels.</cite></a> Internet
    RFC 2119. URL: <a
    href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a>
   </dd>
   <!---->

   <dt id=ref-SVG11>[SVG11]

   <dd>Erik Dahlström; et al. <a
    href="http://www.w3.org/TR/2011/REC-SVG11-20110816/"><cite>Scalable
    Vector Graphics (SVG) 1.1 (Second Edition).</cite></a> 16 August 2011.
    W3C Recommendation. URL: <a
    href="http://www.w3.org/TR/2011/REC-SVG11-20110816/">http://www.w3.org/TR/2011/REC-SVG11-20110816/</a>
   </dd>
   <!---->
  </dl>
  <!--end-normative-->

  <h3 id=informref><span class=secno>13.2. </span>Informative References</h3>
  <!--begin-informative-->
  <!-- Sorted by label -->

  <dl class=bibliography>
   <dd style="display: none"><!-- keeps the doc valid if the DL is empty -->
    <!---->

   <dt id=ref-PORTERDUFF>[PORTERDUFF]

   <dd>Thomas Porter; Tom Duff. “Compositing digital images” in:
    <cite>ACM SIGGRAPH Computer Graphics.</cite> Volume 18. Issue 3. pp.
    253–259. ACM. July 1984. New York, NY, USA. ISSN 0097-8930</dd>
   <!---->
  </dl>
  <!--end-informative-->

  <h2 id=changes><span class=secno>14. </span>Changes</h2>

  <p>The following changes were made relative to the <a
   href="http://www.w3.org/TR/2013/WD-compositing-1-20131010/"> Last Call
   Working draft of 7 January 2014</a>:

  <ul>
   <li>unneeded normative and informative references were removed
  </ul>

  <p>The following changes were made relative to the <a
   href="http://www.w3.org/TR/2013/WD-compositing-1-20131010/"> Last Call
   Working draft of 10 October 2013</a>:

  <ul>
   <li>knockout was removed from the non-normative section

   <li>removed paragraph on SVG from simple alpha compositing

   <li>updated abstract to include CSS and clarify intent

   <li>removed clip-to-self and its references

   <li>Changed section 5-10 to be normative + clarified notes/examples in
    those sections
  </ul>

  <p>The following changes were made relative to the <a
   href="http://www.w3.org/TR/2013/WD-compositing-1-20130625/">Working Draft
   of 2013-06-25</a>:

  <ul>
   <li>clipping was removed as one of the operators that creates an isolated
    group in SVG

   <li>background-blend-mode was changed so it matches repeating behavior of
    other background syntaxes.

   <li>The mix-composite property was removed

   <li>all open issues were resolved
  </ul>
