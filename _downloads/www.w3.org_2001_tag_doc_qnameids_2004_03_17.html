<!-- http://www.w3.org/2001/tag/doc/qnameids-2004-03-17 -->
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="EN">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">

  <title>Using Qualified Names (QNames) as Identifiers in XML Content</title>
  <style type="text/css">
  code           { font-family: monospace; }

  div.constraint,
  div.issue,
  div.note,
  div.notice     { margin-left: 2em; }

  ol.enumar      { list-style-type: decimal; }
  ol.enumla      { list-style-type: lower-alpha; }
  ol.enumlr      { list-style-type: lower-roman; }
  ol.enumua      { list-style-type: upper-alpha; }
  ol.enumur      { list-style-type: upper-roman; }


  div.exampleInner pre { margin-left: 1em;
                       margin-top: 0em; margin-bottom: 0em}
  div.exampleOuter {border: 4px double gray;
                  margin: 0em; padding: 0em}
  div.exampleInner { background-color: #d5dee3;
                   border-top-width: 4px;
                   border-top-style: double;
                   border-top-color: #d3d3d3;
                   border-bottom-width: 4px;
                   border-bottom-style: double;
                   border-bottom-color: #d3d3d3;
                   padding: 4px; margin: 0em }
  div.exampleWrapper { margin: 4px }
  div.exampleHeader { font-weight: bold;
                    margin: 4px}
  </style>
  <link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/base.css">
</head>

<body>
  <div class="head">
    <p><a href="http://www.w3.org/"><img src="http://www.w3.org/Icons/w3c_home" alt="W3C" height="48" width="72"></a></p>

    <h1><a name="title" id="title"></a>Using Qualified Names (QNames) as Identifiers in XML Content</h1>

    <h2><a name="w3c-doctype" id="w3c-doctype"></a>TAG Finding 17 March 2004</h2>

    <dl>
      <dt>This version:</dt>

      <dd><a href="http://www.w3.org/2001/tag/doc/qnameids-2004-03-17">http://www.w3.org/2001/tag/doc/qnameids-2004-03-17</a></dd>

      <dt>Latest version:</dt>

      <dd><a href="http://www.w3.org/2001/tag/doc/qnameids">http://www.w3.org/2001/tag/doc/qnameids</a></dd>

      <dt>Previous versions:</dt>

      <dd><a href="http://www.w3.org/2001/tag/doc/qnameids-2004-02-27.html">http://www.w3.org/2001/tag/doc/qnameids-2004-02-27</a> <a href="http://www.w3.org/2001/tag/doc/qnameids-2004-01-14.html">http://www.w3.org/2001/tag/doc/qnameids-2004-01-14</a> <a href="http://www.w3.org/2001/tag/doc/qnameids-2004-01-06.html">http://www.w3.org/2001/tag/doc/qnameids-2004-01-06</a></dd>

      <dt>Editor:</dt>

      <dd>Norman Walsh, Sun Microsystems, Inc. <a href="mailto:Norman.Walsh@Sun.COM">&lt;Norman.Walsh@Sun.COM&gt;</a></dd>
    </dl>

    <p>This document is also available in these non-normative formats: <a href="http://www.w3.org/2001/tag/doc/qnameids-2004-03-17.xml">XML</a> and&#160;<a href="http://www.w3.org/2001/tag/doc/qnameids-2004-03-17-diff.html">2004-02-27 Diff</a>.</p>

    <p class="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice-20000612#Copyright">Copyright</a> &#169; 2004 <a href="http://www.w3.org/">W3C</a><sup>&#174;</sup> (<a href="http://www.lcs.mit.edu/">MIT</a>, <a href="http://www.inria.fr/">INRIA</a>, <a href="http://www.keio.ac.jp/">Keio</a>), All Rights Reserved. W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice-20000612#Legal_Disclaimer">liability</a>, <a href=
    "http://www.w3.org/Consortium/Legal/ipr-notice-20000612#W3C_Trademarks">trademark</a>, <a href="http://www.w3.org/Consortium/Legal/copyright-documents-19990405">document use</a>, and <a href="http://www.w3.org/Consortium/Legal/copyright-software-19980720">software licensing</a> rules apply.</p>
  </div>
  <hr>

  <div>
    <h2><a name="abstract" id="abstract"></a>Abstract</h2>

    <p>The question that prompted this finding was "are QNames acceptable replacements for URIs as identifiers within specifications?" This finding documents the TAG's opinion on the use of QNames as identifiers.</p>
  </div>

  <div>
    <h2><a name="status" id="status"></a>Status of this Document</h2>

    <p>This document has been produced by the <a href="/2001/tag/">W3C Technical Architecture Group (TAG)</a>. This finding addresses TAG <a href="http://www.w3.org/2001/tag/ilist#qnameAsId-18">issue qnameAsId-18</a>.</p>

    <p>This is the 17 March 2004 revision of this finding. At their March face-to-face meeting, the TAG decided to accept this finding.</p>

    <p><a href="/2001/tag/findings">Additional TAG findings</a>, both accepted and in draft state, may also be available. The TAG expects to incorporate this and other findings into a Web Architecture Document that will be published according to the process of the <a href="/Consortium/Process-20010719/tr#Recs">W3C Recommendation Track</a>.</p>

    <p>The terms <strong>MUST</strong>, <strong>SHOULD</strong>, and <strong>SHOULD NOT</strong> are used in this document in accordance with <a href="#rfc2119">[RFC 2119]</a>.</p>

    <p>Please send comments on this finding to the publicly archived TAG mailing list <a href="mailto:www-tag@w3.org">www-tag@w3.org</a> (<a href="http://lists.w3.org/Archives/Public/www-tag/">archive</a>).</p>
  </div>

  <div class="toc">
    <h2><a name="contents" id="contents"></a>Table of Contents</h2>

    <p class="toc">1 <a href="#preface">Preface</a><br>
    2 <a href="#sec-qnamesids">QNames as Identifiers</a><br>
    3 <a href="#sec-qnames-xml">QNames in XML Element and Attribute Names</a><br>
    4 <a href="#sec-cname-ids">QNames in Other XML Names</a><br>
    &#160;&#160;&#160;&#160;4.1 <a href="#sec-qnames-other">QNames in Other Specifications</a><br>
    &#160;&#160;&#160;&#160;4.2 <a href="#bindings">Namespace Bindings</a><br>
    5 <a href="#sec-archobs">Architectural Observations</a><br>
    6 <a href="#sec-archrec">Architectural Statement</a><br>
    7 <a href="#references">References</a></p>

    <h3><a name="appendices" id="appendices"></a>Appendix</h3>

    <p class="toc">A <a href="#c14n-use-case">Use Case: XML Canonicalization</a> (Non-Normative)</p>
  </div>
  <hr>

  <div class="body">
    <div class="div1">
      <h2><a name="preface" id="preface"></a>1 Preface</h2>

      <p>This TAG Finding documents a portion of the web architecture where conflicting requirements and design goals intersect. It is a simple matter of fact that specifications which have chosen one set of design criteria interoperate less well with specifications that have chosen a different set.</p>

      <p>Given that there are existing specifications which exhibit incompatible designs and strong arguments in favor of each design, the TAG elects not to assert architectural principles that would be in direct conflict with some significant set of specifications.</p>

      <p>It's possible that these issues could be addressed in the scope of some larger, more global redesign of, for example, XML, but no short-term solution presents itself</p>
    </div>

    <div class="div1">
      <h2><a name="sec-qnamesids" id="sec-qnamesids"></a>2 QNames as Identifiers</h2>

      <p>This finding is concerned with the use of qualified names (QNames) as identifiers. That is, the contexts in which a colonized name can be understood to be a QName.</p>

      <p>A related TAG issue, <a href="http://www.w3.org/2001/tag/ilist#rdfmsQnameUriMapping-6">rdfmsQnameUriMapping-6</a>, concerns the mechanism by which one can (or can not) construct a URI for a particular QName. We do not consider that issue in this finding.</p>
    </div>

    <div class="div1">
      <h2><a name="sec-qnames-xml" id="sec-qnames-xml"></a>3 QNames in XML Element and Attribute Names</h2>

      <p>Qualified names were introduced by <a href="#xml-names">[XML Namespaces]</a>. They were defined for element and attribute <em>names</em> (only) and provide a mechanism for concisely identifying a {URI, local-name} pair. For example, in the following document:</p>

      <div class="exampleInner">
        <pre>
&lt;?xml version='1.0'?&gt;
&lt;doc xmlns:x="http://example.com/ns/foo"&gt;
&lt;x:p/&gt;
&lt;/doc&gt;
</pre>
      </div>

      <p>The QName "<code>x:p</code>" is a concise, unambiguous name for the {URI, local-name} pair <code>{"http://example.com/ns/foo", "p"}</code>.</p>

      <p>When used solely in element and attribute names, all QNames are identified by the XML processor and can logically be replaced by the URI/local-name pair they identify.</p>
    </div>

    <div class="div1">
      <h2><a name="sec-cname-ids" id="sec-cname-ids"></a>4 QNames in Other XML Names</h2>

      <p>At the request of the XML Schema Working Group, the XML Core Working Group is producing <a href="http://www.w3.org/XML/xml-names-19990114-errata#NE08">an erratum</a> to <a href="#xml-names">[XML Namespaces]</a> to clarify the meaning of colons in other contexts.</p>

      <p>In particular, this erratum makes it clear that entity names, processing instruction targets, and notation names are not QNames and they may not include colons. Documents that do not satisfy this constraint are not namespace well-formed. Furthermore, the <em>values</em> of attributes of type ID, IDREF(S), ENTITY(IES), and NOTATION are also forbidden from containing colons. Documents that do not satisfy this constraint are not namespace valid.</p>

      <p>A colon that introduces a namespace validity or namespace well-formedness error into a document <em>does not</em> introduce a QName. In other words, the term "identifier" in this finding is not related to XML identifiers of type ID since they cannot be QNames.</p>

      <div class="div2">
        <h3><a name="sec-qnames-other" id="sec-qnames-other"></a>4.1 QNames in Other Specifications</h3>

        <p>Other specifications, starting with <a href="#xslt">[XSLT]</a>, have taken QNames and employed them in contexts other than element and attribute names. Specifically, QNames have been used in attribute <em>values</em> and element <em>content</em>.</p>

        <p>For example, in the following document, "<code>x:p</code>" is understood to be a QName even though it appears in an attribute value, not an element or attribute name.</p>

        <div class="exampleInner">
          <pre>
&lt;?xml version='1.0'?&gt;
&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:x="http://example.com/ns/foo"
                version="1.0"&gt;

&lt;xsl:output method="html"/&gt;

&lt;xsl:template match="x:p"&gt;
  &lt;p&gt;
    &lt;xsl:apply-templates/&gt;
  &lt;/p&gt;
&lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;
&lt;/doc&gt;
</pre>
        </div>

        <p>In attribute values and element content, QNames are often used to identify a particular element type; they are, in principle, using QNames as they were intended. However, some specifications use QNames as shortcuts for unique identifiers derived from a {URI, local-name} pair that have no relationship to element or attribute types.</p>

        <p>The <a href="#fando">[Functions and Operators]</a> specification, for example, uses QNames to identify functions. This is motivated partly by backwards compatibility with XPath 1.0, but also by the fact that function names share some characteristics with element and attribute names. In particular, the names need to be globally unique so that name collisions don&#8217;t occur either between independently developed functions or different versions of the specification.</p>

        <p>Using a QName as a shortcut for a {URI, local-name} pair is often convenient, but it carries a price. In order to identify QNames in content, a processor must understand the syntax and possibly the semantics of the content. The &#8220;<code>x:p</code>&#8221; in the preceding example can only be recognized as a QName by a processor that understands both XPath (in order to parse the attribute value) and XSLT (in order to know which attributes contain XPath expressions).</p>
      </div>

      <div class="div2">
        <h3><a name="bindings" id="bindings"></a>4.2 Namespace Bindings</h3>

        <p>Specifications for XML-based languages usually rely on the in-scope namespace bindings in the XML document to associate prefixes with namespace names.</p>

        <p>Using the in-scope namespace bindings has the advantage that it theoretically allows a generic processor to interpret QNames in content without having to be aware of any application-specific mechanisms. The alternative, where every specification defines its own mechanism, would clearly lead to a badly fragmented web.</p>

        <p>However, there is at least one application where a compelling argument has been made for <em>requiring</em> an alternative mechanism for defining namespace bindings. That application is <a href="#xpointer-framework">[XPointer Framework]</a>. It is an architectural principle of URIs that they be context-independent. It follows that the QNames that appear in an XPointer must not refer to in-scope namespaces as this would make transcription impossible in the general case.</p>

        <p>We must therefore accept that there are some applications which use in-scope namespaces and some which use their own mechanisms. However, the namespace binding framework defined by the <a href="#xml-names">[XML Namespaces]</a> is well established and widely supported. The cost associated with defining and deploying an alternate mechanism is very large and should be avoided wherever possible.</p>

        <p>Because there is some possibility of variation in the way namespace bindings are established, even if a QName can be identified in content, it may be difficult or impossible to determine what {URI, local-name} it represents. The mapping may depend on the context in which it occurs. Therefore, at the very least, it is important for specifications to identify the mapping algorithm that they have chosen.</p>

        <p class="principle">Specifications that use QNames to represent {URI, local-name} pairs <strong>MUST</strong> describe the algorithm that is used to map between them.</p>

        <p>We observe also that there is an overlap in the lexical space of QNames and URIs.</p>

        <p class="practice">Specifications that use QNames to represent {URI, local-name} pairs <strong>SHOULD NOT</strong> allow both forms in attribute values or element content where they would be indistinguishable.</p>
      </div>
    </div>

    <div class="div1">
      <h2><a name="sec-archobs" id="sec-archobs"></a>5 Architectural Observations</h2>

      <p>The TAG makes the following observations:</p>

      <ul>
        <li>
          <p>Whatever the architectural ramifications of using QNames as identifiers in contexts other than XML element and attribute names, it is already established practice.</p>

          <p>It is simply not practical to suggest that this usage should be forbidden on architectural grounds.</p>
        </li>

        <li>
          <p>Using QNames in untyped (<code>#PCDATA</code> or <code>xs:string</code>) attribute values or element content places an additional burden on the processor that was not anticipated by <a href="#xml-names">[XML Namespaces]</a>.</p>

          <p>If QNames are only used in element and attribute <em>names</em>, the processor can fully resolve all of the prefixes as it parses. This gives it the freedom to discard the prefix-to-URI mappings when they go out of scope. A serializer, presented with an object model that conforms to <a href="#xml-names">[XML Namespaces]</a> can manufacture new prefixes on the fly. (In practice, users expect most prefixes to be preserved through transformations, so things aren't quite this simple for most
          developers, but this is still theoretically the case.)</p>

          <p>As soon as QNames may appear in element or attribute <em>values</em>, the processor must retain all of the prefix-to-URI mappings (and any API must expose these mappings). This is necessary because some subsequent micro-parser, in the course of examining some content, may encounter a token that it recognizes as a QName and need to find its {URI, local-name}.</p>

          <p>In our previous XSL example, from the perspective of the XML processor, there are no qualified names that use the <code>x:</code> prefix. However, when the <em>XSL</em> processor examines the <code>match</code> attribute on <code>xsl:template</code>, it must be able to resolve the <code>x:</code> prefix.</p>
        </li>

        <li>
          <p>QNames in attribute values or element content <em>by themselves</em>, in other words, in contexts that could be typed as <code>xs:QName</code> (<a href="#xmlschema-2">[XML Datatypes]</a>) in a schema, could in principle be identified by the schema processor.</p>

          <p>For example, given:</p>

          <div class="exampleInner">
            <pre>
&lt;elem ref="data:myInteger"/&gt;
</pre>
          </div>

          <p>If schema validation reveals that the following component applies to this instance of the <code>elem</code> element:</p>

          <div class="exampleInner">
            <pre>
&lt;xs:complexType name="elemType"&gt;
  &lt;xs:complexContent&gt;
    &lt;xs:restriction base="xs:anyType"&gt;
      &lt;xs:attribute name="ref" type="xs:QName"/&gt;
    &lt;/xs:restriction&gt;
  &lt;/xs:complexContent&gt;
&lt;/xs:complexType&gt;
</pre>
          </div>

          <p>The schema processor can determine that <code>data:myInteger</code> is a QName and must therefore be a concise name for the {URI, local-name} pair consisting of the in-scope namespace URI for the prefix <code>data</code> and the local-name <code>myInteger</code>.</p>
        </li>

        <li>
          <p>Perhaps the most common use of QNames in untyped values at the moment is in locations where XPath expressions may occur. As XPath is reused in more and more specifications, it may eventually be reasonable to define an XPath data type to identify all of these values in a way that makes them accessible to higher-level parsers.</p>
        </li>

        <li>
          <p>Some specifications rely on mechanisms other than in-scope namespaces to associate prefixes with namespace names. In general, therefore, even when <em>all</em> of the in-scope namespace declarations are available, there may still be prefixes which can only be known in an application-dependent manner.</p>
        </li>

        <li>
          <p>Almost every specification that has wrestled with what XML documents mean or how two putatively identical documents can be compared has stumbled over the issues associated with QNames in content. Some of these issues are described in detail in <a href="#canonical-xml">[Canonical XML]</a>, but they are also known to have occurred in the development of RDF, XML Query, security specifications such as <a href="#xml-dsig">[XML-DSig Core]</a>, and elsewhere.</p>
        </li>
      </ul>
    </div>

    <div class="div1">
      <h2><a name="sec-archrec" id="sec-archrec"></a>6 Architectural Statement</h2>

      <p>In so far as the identification mechanism of the Web is the URI and QNames are not URIs, it is a mistake to use a QName for identification when a URI would serve.</p>

      <p>That said, the TAG recognizes that there are sometimes pragmatic reasons for chosing short, lexical representations of more complex names and accepts that QNames are an established mechanism for doing so. Further, it must be observed that some things <em>are</em> identified by QNames: element and attribute names, types in W3C XML Schema, etc.</p>

      <p>Where there is a compelling reason to use QNames instead of URIs for identification, it is imperative that specifications provide a mapping between QNames and URIs, if such a mapping is possible.</p>

      <p>Finally, we observe that a whole class of interpretation problems can be avoided if the use of QNames can be restricted to contexts where their identification is natural and unambiguous (element and attribute names, simple content of type <code>xs:QName</code>, etc.) and we encourage developers to employ such restrictions wherever possible.</p>
    </div>

    <div class="div1">
      <h2><a name="references" id="references"></a>7 References</h2>

      <dl>
        <dt class="label"><a name="rfc2119" id="rfc2119"></a>RFC 2119</dt>

        <dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. IETF. March, 1997. (See http://www.ietf.org/rfc/rfc2119.txt.)</dd>

        <dt class="label"><a name="canonical-xml" id="canonical-xml"></a>Canonical XML</dt>

        <dd>John Boyer, editor. <a href="http://www.w3.org/TR/xml-c14n"><cite>Canonical XML Version 1.0</cite></a>. World Wide Web Consortium, 2001. (See http://www.w3.org/TR/xml-c14n.)</dd>

        <dt class="label"><a name="xpointer-framework" id="xpointer-framework"></a>XPointer Framework</dt>

        <dd>Paul Grosso, Eve Maler, Jonathan Marsh, Norman Walsh, editors. <a href="http://www.w3.org/TR/xptr-framework/"><cite>XPointer Framework</cite></a>. World Wide Web Consortium, 2002. (See http://www.w3.org/TR/xptr-framework/.)</dd>

        <dt class="label"><a name="xmlschema-2" id="xmlschema-2"></a>XML Datatypes</dt>

        <dd>Paul V. Biron and Ashok Malhotra, editors. <a href="http://www.w3.org/TR/xmlschema-2/"><cite>XML Schema Part 2: Datatypes</cite></a>. World Wide Web Consortium, 2000. (See http://www.w3.org/TR/xmlschema-2/.)</dd>

        <dt class="label"><a name="xml-names" id="xml-names"></a>XML Namespaces</dt>

        <dd>Tim Bray, Dave Hollander, Andrew Layman, editors. <a href="http://www.w3.org/TR/REC-xml-names/"><cite>Namespaces in XML</cite></a>. World Wide Web Consortium, 1999. (See http://www.w3.org/TR/REC-xml-names/.)</dd>

        <dt class="label"><a name="xml-dsig" id="xml-dsig"></a>XML-DSig Core</dt>

        <dd>Donald Eastlake, Joseph Reagle, and David Solo, editors. <a href="http://www.w3.org/TR/xmldsig-core/"><cite>XML-Signature Syntax and Processing</cite></a>. World Wide Web Consortium, 2002. (See http://www.w3.org/TR/xmldsig-core/.)</dd>

        <dt class="label"><a name="xslt" id="xslt"></a>XSLT</dt>

        <dd>James Clark, editor. <a href="http://www.w3.org/TR/xslt"><cite>XML Transformations (XSLT) Version 1.0</cite></a>. World Wide Web Consortium, 1999. (See http://www.w3.org/TR/xslt.)</dd>

        <dt class="label"><a name="fando" id="fando"></a>Functions and Operators</dt>

        <dd>Ashok Malhotra, Jim Melton, and Norman Walsh, editors. <a href="http://www.w3.org/TR/xpath-functions/"><cite>XQuery 1.0 and XPath 2.0 Functions and Operators</cite></a>. World Wide Web Consortium, 2003. (See http://www.w3.org/TR/xpath-functions/.)</dd>
      </dl>
    </div>
  </div>

  <div class="back">
    <div class="div1">
      <h2><a name="c14n-use-case" id="c14n-use-case"></a>A Use Case: XML Canonicalization (Non-Normative)</h2>

      <p>Suppose you want to answer the question, &#8220;are two XML documents the same?&#8221; One way to attempt to answer this question is to define a canonical representation for an XML document and then compare the two canonical representations to see if they are the same. This use case provides a nice demonstration of the issues discussed in this finding.</p>

      <p>Imagine for a moment that we aren&#8217;t concerned with QNames in content and consider these two documents:</p>

      <div class="exampleOuter">
        <div class="exampleHeader">
          <a name="d1" id="d1"></a>Example: Document A
        </div>

        <div class="exampleInner">
          <pre>
&lt;doc xmlns="http://example.org/ns/one"&gt;
  &lt;t:title xmlns:t="http://example.org/ns/one"&gt;
    Title
  &lt;/t:title&gt;
  &lt;div xmlns:t="http://example.org/ns/two"
       xmlns:u="http://example.org/ns/three"&gt;
    &lt;title u:attr="1"&gt;
      Division Title
    &lt;/title&gt;
    &lt;t:para xmlns:u="http://example.org/ns/three"
            u:a1="one" u:a2='two'    u:a3='three'&gt;Text&lt;/t:para&gt;
  &lt;/div&gt;
&lt;/doc&gt;
</pre>
        </div>
      </div>

      <div class="exampleOuter">
        <div class="exampleHeader">
          <a name="d2" id="d2"></a>Example: Document B
        </div>

        <div class="exampleInner">
          <pre>
&lt;r:doc xmlns:r="http://example.org/ns/one"
       xmlns:z="http://example.org/ns/four"&gt;
  &lt;a:title xmlns:a="http://example.org/ns/one"&gt;
    Title
  &lt;/a:title&gt;
  &lt;r:div xmlns:u="http://example.org/ns/three"
         xmlns:a="http://example.org/ns/two"&gt;
    &lt;r:title u:attr="1"&gt;
      Division Title
    &lt;/r:title&gt;
    &lt;a:para x:a1="one" x:a3='three' x:a2='two'
            xmlns:x="http://example.org/ns/three"&gt;Text&lt;/a:para&gt;
  &lt;/r:div&gt;
&lt;/r:doc&gt;
</pre>
        </div>
      </div>

      <p>Are they the same? At first glance, it probably isn&#8217;t clear if they&#8217;re the same or not. Two make the problem easier, we can define some rules for canonicalization:</p>

      <ul>
        <li>
          <p>Normalize insignificant whitespace.</p>
        </li>

        <li>
          <p>Normalize attribute order (lexicographically)</p>
        </li>

        <li>
          <p>Normalize attribute quote marks.</p>
        </li>

        <li>
          <p>Discard unnecessary and duplicate namespace declarations.</p>
        </li>

        <li>
          <p>Assign standard prefixes to namespace names.</p>
        </li>

        <li>
          <p>etc.</p>
        </li>
      </ul>

      <p>Under these rules, Document A would be transformed to:</p>

      <div class="exampleOuter">
        <div class="exampleHeader">
          <a name="d1c" id="d1c"></a>Example: Canonical Document A
        </div>

        <div class="exampleInner">
          <pre>
&lt;a1:doc xmlns:a1="http://example.org/ns/one"&gt;
  &lt;a1:title&gt;
    Title
  &lt;/a1:title&gt;
  &lt;a1:div xmlns:a2="http://example.org/ns/three"
          xmlns:a3="http://example.org/ns/two"&gt;
    &lt;a1:title a2:attr="1"&gt;
      Division Title
    &lt;/a1:title&gt;
    &lt;a3:para a2:a1="one" a2:a2="two" a2:a3="three"&gt;Text&lt;/a3:para&gt;
  &lt;/a1:div&gt;
&lt;/a1:doc&gt;
</pre>
        </div>
      </div>

      <p>And, in fact, so would Document B, demonstrating that they are the same.</p>

      <p>Now consider the case where QNames may occur in content. Suppose we begin with this document:</p>

      <div class="exampleOuter">
        <div class="exampleHeader">
          <a name="d3" id="d3"></a>Example: Document C
        </div>

        <div class="exampleInner">
          <pre>
&lt;doc xmlns="http://example.org/ns/one"&gt;
  &lt;t:title xmlns:t="http://example.org/ns/one"&gt;
    Title {t:title}
  &lt;/t:title&gt;
  &lt;div xmlns:t="http://example.org/ns/two"
       xmlns:u="http://example.org/ns/three"&gt;
    &lt;title u:attr="1" t:attr="u:expr"&gt;
      Division Title
    &lt;/title&gt;
    &lt;t:para xmlns:u="http://example.org/ns/three"
            u:a1="one" u:a2='two'    u:a3='three'&gt;Text&lt;/t:para&gt;
  &lt;/div&gt;
&lt;/doc&gt;
</pre>
        </div>
      </div>

      <p>By our canonicalization rules, this would become:</p>

      <div class="exampleOuter">
        <div class="exampleHeader">
          <a name="d3c-broken" id="d3c-broken"></a>Example: Badly Canonical Document C
        </div>

        <div class="exampleInner">
          <pre>
&lt;a1:doc xmlns:a1="http://example.org/ns/one"&gt;
  &lt;a1:title&gt;
    Title {t:title}
  &lt;/a1:title&gt;
  &lt;a1:div xmlns:a2="http://example.org/ns/three"
          xmlns:a3="http://example.org/ns/two"&gt;
    &lt;title a2:attr="1" a3:attr="u:expr"&gt;
      Division Title
    &lt;/title&gt;
    &lt;a3:para a2:a1="one" a2:a2="two" a2:a3="three"&gt;Text&lt;/a3:para&gt;
  &lt;/a1:div&gt;
&lt;/a1:doc&gt;
</pre>
        </div>
      </div>

      <p>Unfortunately, we&#8217;ve destroyed the information content of the document.</p>

      <p>If we wish to preserve the information content of the document, we must be much more conservative. It&#8217;s no longer appropriate to throw away duplicate namespace declarations (unless they declare the same prefix and URI) or change prefixes:</p>

      <div class="exampleOuter">
        <div class="exampleHeader">
          <a name="d3c" id="d3c"></a>Example: Canonical Document C
        </div>

        <div class="exampleInner">
          <pre>
&lt;doc xmlns="http://example.org/ns/one"&gt;
  &lt;t:title xmlns:t="http://example.org/ns/one"&gt;
    Title {t:title}
  &lt;/t:title&gt;
  &lt;div xmlns:t="http://example.org/ns/two"
       xmlns:u="http://example.org/ns/three"&gt;
    &lt;title u:attr="1" t:attr="u:expr"&gt;
      Division Title
    &lt;/title&gt;
    &lt;t:para u:a1="one" u:a2="two" u:a3="three"&gt;Text&lt;/t:para&gt;
  &lt;/div&gt;
&lt;/doc&gt;
</pre>
        </div>
      </div>

      <p>Under these rules, differences in the canonical representations of two documents do not necessarily constitute real differences. (Comparison of different documents is not the only use case for canonicalization, however, so it is not without value.)</p>

      <p>For a much more complete discussion of these issues, see <a href="#canonical-xml">[Canonical XML]</a> where they are addressed in detail and a complete description of reasonable &#8220;conservative&#8221; algorithm is described.</p>
    </div>
  </div>
</body>
</html>
